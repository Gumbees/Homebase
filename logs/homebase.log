2025-05-24 18:37:47,641 - app - INFO - Creating database tables...
2025-05-24 18:37:47,663 - app - INFO - Creating database tables...
2025-05-24 18:37:47,690 - app - INFO - Database tables created successfully
2025-05-24 18:37:47,690 - app - INFO - Database tables created successfully
2025-05-24 18:37:47,700 - app - INFO - Creating database tables...
2025-05-24 18:37:47,717 - app - INFO - Database tables created successfully
2025-05-24 18:37:47,793 - app - INFO - Creating database tables...
2025-05-24 18:37:47,808 - app - INFO - Database tables created successfully
2025-05-24 18:37:48,311 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:37:48,318 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:37:48,324 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:37:48,392 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:40:10,248 - app - INFO - Creating database tables...
2025-05-24 18:40:10,326 - app - INFO - Creating database tables...
2025-05-24 18:40:10,325 - app - INFO - Creating database tables...
2025-05-24 18:40:10,340 - app - INFO - Database tables created successfully
2025-05-24 18:40:10,341 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(vendors_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 18:40:10,341 - app - ERROR - Error creating database tables: (psycopg2.errors.DuplicateTable) relation "vendors" already exists

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 18:40:10,409 - app - INFO - Creating database tables...
2025-05-24 18:40:10,426 - app - INFO - Database tables created successfully
2025-05-24 18:40:10,884 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:40:10,884 - routes - ERROR - Error initializing AI settings: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ai_settings_provider_key"
DETAIL:  Key (provider)=(anthropic) already exists.

[SQL: INSERT INTO ai_settings (provider, is_enabled, is_default, api_key, api_endpoint, config, created_at, updated_at) VALUES (%(provider)s, %(is_enabled)s, %(is_default)s, %(api_key)s, %(api_endpoint)s, %(config)s, %(created_at)s, %(updated_at)s) RETURNING ai_settings.id]
[parameters: {'provider': 'anthropic', 'is_enabled': True, 'is_default': True, 'api_key': None, 'api_endpoint': None, 'config': '{"default_model": "claude-3-5-sonnet-20241022", "vision_model": "claude-3-opus-20240229", "timeout": 180}', 'created_at': datetime.datetime(2025, 5, 24, 18, 40, 10, 882866), 'updated_at': datetime.datetime(2025, 5, 24, 18, 40, 10, 882868)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 18:40:10,890 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:40:10,952 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:42:06,944 - app - INFO - Creating database tables...
2025-05-24 18:42:06,960 - app - INFO - Database tables created successfully
2025-05-24 18:42:06,981 - app - INFO - Creating database tables...
2025-05-24 18:42:06,995 - app - INFO - Database tables created successfully
2025-05-24 18:42:07,052 - app - INFO - Creating database tables...
2025-05-24 18:42:07,066 - app - INFO - Database tables created successfully
2025-05-24 18:42:07,105 - app - INFO - Creating database tables...
2025-05-24 18:42:07,118 - app - INFO - Database tables created successfully
2025-05-24 18:42:07,482 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:42:07,521 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:42:07,589 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:42:07,633 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:44:55,252 - app - INFO - Creating database tables...
2025-05-24 18:44:55,257 - app - INFO - Creating database tables...
2025-05-24 18:44:55,265 - app - INFO - Database tables created successfully
2025-05-24 18:44:55,270 - app - INFO - Database tables created successfully
2025-05-24 18:44:55,301 - app - INFO - Creating database tables...
2025-05-24 18:44:55,304 - app - INFO - Creating database tables...
2025-05-24 18:44:55,314 - app - INFO - Database tables created successfully
2025-05-24 18:44:55,317 - app - INFO - Database tables created successfully
2025-05-24 18:44:55,784 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:44:55,788 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:44:55,837 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:44:55,873 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:45:43,549 - app - INFO - Creating database tables...
2025-05-24 18:45:43,564 - app - INFO - Database tables created successfully
2025-05-24 18:45:43,629 - app - INFO - Creating database tables...
2025-05-24 18:45:43,643 - app - INFO - Database tables created successfully
2025-05-24 18:45:43,650 - app - INFO - Creating database tables...
2025-05-24 18:45:43,652 - app - INFO - Creating database tables...
2025-05-24 18:45:43,665 - app - INFO - Database tables created successfully
2025-05-24 18:45:43,665 - app - INFO - Database tables created successfully
2025-05-24 18:45:44,127 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:45:44,202 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:45:44,218 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:45:44,236 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:46:47,569 - routes - INFO - Processing receipt file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf, auto_analyze=True
2025-05-24 18:46:47,570 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 18:46:47,571 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp768eiyab.pdf
2025-05-24 18:46:47,758 - ocr_utils - INFO - Successfully converted PDF to JPEG image using pdf2image
2025-05-24 18:46:47,759 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 18:46:47,760 - routes - INFO - Processing receipt with AI (auto_analyze=True, auto_link=True)
2025-05-24 18:46:47,761 - routes - INFO - Processing receipt with OpenAI
2025-05-24 18:46:47,761 - ocr_utils - INFO - Processing receipt 'RECEIPT_Blue_Heron_Music_Festival_July_2025.jpg' using OpenAI
2025-05-24 18:46:47,791 - openai_utils - INFO - Successfully converted image to JPEG for OpenAI API
2025-05-24 18:46:47,792 - openai_utils - INFO - Extracting receipt data with OpenAI (attempt 1/3)
2025-05-24 18:46:48,486 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-05-24 18:46:48,488 - openai_utils - ERROR - Error in receipt data extraction with OpenAI: Error code: 401 - {'error': {'message': 'Incorrect API key provided: your_ope************here. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-05-24 18:46:48,489 - openai_utils - ERROR - Non-retriable error in receipt extraction: unknown
2025-05-24 18:46:48,489 - openai_utils - INFO - Analyzing line items...
2025-05-24 18:46:48,490 - routes - WARNING - Missing required fields for receipt processing
2025-05-24 18:50:15,411 - app - INFO - Creating database tables...
2025-05-24 18:50:15,446 - app - INFO - Database tables created successfully
2025-05-24 18:50:15,463 - app - INFO - Creating database tables...
2025-05-24 18:50:15,481 - app - INFO - Database tables created successfully
2025-05-24 18:50:15,521 - app - INFO - Creating database tables...
2025-05-24 18:50:15,540 - app - INFO - Database tables created successfully
2025-05-24 18:50:15,546 - app - INFO - Creating database tables...
2025-05-24 18:50:15,567 - app - INFO - Database tables created successfully
2025-05-24 18:50:16,179 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:50:16,191 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:50:16,206 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:50:16,234 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:50:42,246 - routes - INFO - Processing receipt file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf, auto_analyze=True
2025-05-24 18:50:42,246 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 18:50:42,247 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpmooh684g.pdf
2025-05-24 18:50:42,461 - ocr_utils - INFO - Successfully converted PDF to JPEG image using pdf2image
2025-05-24 18:50:42,462 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 18:50:42,463 - routes - INFO - Processing receipt with AI (auto_analyze=True, auto_link=True)
2025-05-24 18:50:42,463 - routes - INFO - Processing receipt with OpenAI
2025-05-24 18:50:42,464 - ocr_utils - INFO - Processing receipt 'RECEIPT_Blue_Heron_Music_Festival_July_2025.jpg' using OpenAI
2025-05-24 18:50:42,493 - openai_utils - INFO - Successfully converted image to JPEG for OpenAI API
2025-05-24 18:50:42,494 - openai_utils - INFO - Extracting receipt data with OpenAI (attempt 1/3)
2025-05-24 18:50:42,899 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-24 18:50:42,913 - openai_utils - INFO - Successfully extracted and validated receipt data with OpenAI: {'vendor_name': 'Eventeny', 'date': '2025-05-17', 'total_amount': 0.0, 'receipt_number': None, 'due_date': None, 'line_items': [], 'is_bill': False}
2025-05-24 18:50:42,914 - openai_utils - INFO - Analyzing line items...
2025-05-24 18:50:42,915 - routes - WARNING - Missing required fields for receipt processing
2025-05-24 18:56:37,284 - app - INFO - Creating database tables...
2025-05-24 18:56:37,285 - app - INFO - Creating database tables...
2025-05-24 18:56:37,316 - app - INFO - Database tables created successfully
2025-05-24 18:56:37,316 - app - INFO - Database tables created successfully
2025-05-24 18:56:37,323 - app - INFO - Creating database tables...
2025-05-24 18:56:37,336 - app - INFO - Database tables created successfully
2025-05-24 18:56:37,413 - app - INFO - Creating database tables...
2025-05-24 18:56:37,427 - app - INFO - Database tables created successfully
2025-05-24 18:56:38,170 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:56:38,170 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:56:38,172 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:56:38,174 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:56:44,703 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:14:12,362 - app - INFO - Creating database tables...
2025-05-24 19:14:12,362 - app - INFO - Creating database tables...
2025-05-24 19:14:12,362 - app - INFO - Creating database tables...
2025-05-24 19:14:12,362 - app - INFO - Creating database tables...
2025-05-24 19:14:12,401 - app - INFO - Database tables created successfully
2025-05-24 19:14:12,401 - app - INFO - Database tables created successfully
2025-05-24 19:14:12,402 - app - INFO - Database tables created successfully
2025-05-24 19:14:12,402 - app - INFO - Database tables created successfully
2025-05-24 19:14:13,306 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:14:13,306 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:14:13,308 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:14:13,308 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:14:28,014 - routes - INFO - Processing receipt file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 19:14:28,015 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 19:14:28,016 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpq4tltj_1.pdf
2025-05-24 19:14:28,240 - ocr_utils - INFO - Successfully converted PDF to JPEG image using pdf2image
2025-05-24 19:14:28,240 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 19:14:28,241 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 19:14:28,271 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/receipt/analyze "HTTP/1.1 422 Unprocessable Entity"
2025-05-24 19:14:28,272 - mcp_client - ERROR - Receipt analysis failed: Client error '422 Unprocessable Entity' for url 'http://mcp-server:8080/ai/receipt/analyze'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
2025-05-24 19:14:28,273 - routes - ERROR - MCP server analysis failed: Client error '422 Unprocessable Entity' for url 'http://mcp-server:8080/ai/receipt/analyze'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
2025-05-24 19:14:28,274 - routes - ERROR - Error processing receipt: cannot access local variable 'TaskQueue' where it is not associated with a value
Traceback (most recent call last):
  File "/app/routes.py", line 138, in receipt_upload
    mcp_result = analyze_receipt_sync(
                 ^^^^^^^^^^^^^^^^^^^^^
  File "/app/mcp_client.py", line 345, in analyze_receipt_sync
    return run_async_in_thread(
           ^^^^^^^^^^^^^^^^^^^^
  File "/app/mcp_client.py", line 336, in run_async_in_thread
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 456, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/usr/local/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/mcp_client.py", line 330, in run_in_thread
    return loop.run_until_complete(coro)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/app/mcp_client.py", line 299, in analyze_receipt_async
    return await client.analyze_receipt(image_data, filename, provider)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/mcp_client.py", line 83, in analyze_receipt
    response.raise_for_status()
  File "/usr/local/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://mcp-server:8080/ai/receipt/analyze'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/app/routes.py", line 201, in receipt_upload
    receipt_task = TaskQueue.queue_task({
                   ^^^^^^^^^
UnboundLocalError: cannot access local variable 'TaskQueue' where it is not associated with a value
2025-05-24 19:20:04,240 - app - INFO - Creating database tables...
2025-05-24 19:20:04,240 - app - INFO - Creating database tables...
2025-05-24 19:20:04,260 - app - INFO - Creating database tables...
2025-05-24 19:20:04,271 - app - INFO - Database tables created successfully
2025-05-24 19:20:04,271 - app - INFO - Database tables created successfully
2025-05-24 19:20:04,274 - app - INFO - Database tables created successfully
2025-05-24 19:20:04,321 - app - INFO - Creating database tables...
2025-05-24 19:20:04,335 - app - INFO - Database tables created successfully
2025-05-24 19:20:05,132 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:20:05,132 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:20:05,132 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:20:05,132 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:20:54,867 - app - INFO - Creating database tables...
2025-05-24 19:20:54,883 - app - INFO - Database tables created successfully
2025-05-24 19:20:54,940 - app - INFO - Creating database tables...
2025-05-24 19:20:54,955 - app - INFO - Database tables created successfully
2025-05-24 19:20:55,039 - app - INFO - Creating database tables...
2025-05-24 19:20:55,053 - app - INFO - Database tables created successfully
2025-05-24 19:20:55,056 - app - INFO - Creating database tables...
2025-05-24 19:20:55,071 - app - INFO - Database tables created successfully
2025-05-24 19:20:55,434 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:20:55,489 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:20:55,569 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:20:55,589 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:27:40,117 - app - INFO - Creating database tables...
2025-05-24 19:27:40,118 - app - INFO - Creating database tables...
2025-05-24 19:27:40,121 - app - INFO - Creating database tables...
2025-05-24 19:27:40,205 - app - INFO - Creating database tables...
2025-05-24 19:27:40,222 - app - INFO - Database tables created successfully
2025-05-24 19:27:40,223 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(organizations_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE organizations (
	id SERIAL NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	organization_type VARCHAR(50), 
	data JSONB NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	is_active BOOLEAN, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 19:27:40,223 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(organizations_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE organizations (
	id SERIAL NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	organization_type VARCHAR(50), 
	data JSONB NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	is_active BOOLEAN, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 19:27:40,223 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(organizations_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE organizations (
	id SERIAL NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	organization_type VARCHAR(50), 
	data JSONB NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	is_active BOOLEAN, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 19:27:41,154 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:27:41,154 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:27:41,154 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:27:41,158 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:27:58,395 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 19:27:58,396 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 19:27:58,397 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp2n8xlvjm.pdf
2025-05-24 19:27:58,633 - ocr_utils - INFO - Successfully converted PDF to JPEG image using pdf2image
2025-05-24 19:27:58,635 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 19:27:58,636 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-24 19:27:58,714 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/receipt/analyze "HTTP/1.1 422 Unprocessable Entity"
2025-05-24 19:27:58,715 - mcp_client - ERROR - Receipt analysis failed: Client error '422 Unprocessable Entity' for url 'http://mcp-server:8080/ai/receipt/analyze'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
2025-05-24 19:27:58,716 - routes - ERROR - MCP server analysis failed: Client error '422 Unprocessable Entity' for url 'http://mcp-server:8080/ai/receipt/analyze'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
2025-05-24 19:27:58,737 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:28:29,152 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:28:53,996 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:29:48,873 - app - INFO - Creating database tables...
2025-05-24 19:29:48,873 - app - INFO - Creating database tables...
2025-05-24 19:29:48,873 - app - INFO - Creating database tables...
2025-05-24 19:29:48,880 - app - INFO - Creating database tables...
2025-05-24 19:29:48,906 - app - INFO - Database tables created successfully
2025-05-24 19:29:48,906 - app - INFO - Database tables created successfully
2025-05-24 19:29:48,906 - app - INFO - Database tables created successfully
2025-05-24 19:29:48,906 - app - INFO - Database tables created successfully
2025-05-24 19:29:49,828 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:29:49,828 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:29:49,828 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:29:49,828 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:29:49,839 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:30:10,214 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 19:30:10,215 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 19:30:10,216 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp9_piwu2j.pdf
2025-05-24 19:30:10,432 - ocr_utils - INFO - Successfully converted PDF to JPEG image using pdf2image
2025-05-24 19:30:10,433 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 19:30:10,433 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 19:30:16,905 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 19:30:16,906 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 19:30:16,907 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-05-17",\n  "total_amount": 0.0,\n  "subtotal": null,\n  "tax_amount": null,\n  "receipt_number": null,\n  "description": "Tickets for Great Blue Heron Music Festival 2025",\n  "due_date": null,\n  "is_bill": false,\n  "line_items": [\n    {\n      "description": "Great Blue Heron Music Festival 2025 Ticket",\n      "quantity": 1.0,\n      "unit_price": 0.0,\n      "total_price": 0.0,\n      "category": "entertainment",\n      "suggested_object_type": "service"\n    }\n  ],\n  "confidence": 0.8\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 6.437476634979248, 'timestamp': '2025-05-24T19:30:16.904008', 'tokens_used': 1565, 'cost_estimate': 0.009555}
2025-05-24 19:30:16,925 - routes - INFO - Receipt queued for review: Task ID 34
2025-05-24 19:30:16,935 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 19:30:44,591 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 19:31:14,968 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 19:31:26,170 - routes - INFO - Receipt rejected: Task 1, Reason: 
2025-05-24 19:31:26,176 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:31:37,079 - routes - INFO - Receipt rejected: Task 34, Reason: 
2025-05-24 19:31:37,085 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:32:06,808 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:32:46,443 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:33:16,794 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:33:45,438 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:34:17,547 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:34:47,892 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:35:18,260 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:35:19,137 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:35:43,468 - app - INFO - Creating database tables...
2025-05-24 19:35:43,468 - app - INFO - Creating database tables...
2025-05-24 19:35:43,469 - app - INFO - Creating database tables...
2025-05-24 19:35:43,475 - app - INFO - Creating database tables...
2025-05-24 19:35:43,503 - app - INFO - Database tables created successfully
2025-05-24 19:35:43,504 - app - INFO - Database tables created successfully
2025-05-24 19:35:43,504 - app - INFO - Database tables created successfully
2025-05-24 19:35:43,504 - app - INFO - Database tables created successfully
2025-05-24 19:35:44,421 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:35:44,421 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:35:44,422 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:35:44,429 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:35:46,679 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:35:44,550 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:35:44,835 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:35:45,042 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:35:45,544 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:35:53,724 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 19:35:53,725 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 19:35:53,726 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmplylmjivl.pdf
2025-05-24 19:35:53,947 - ocr_utils - INFO - Successfully converted PDF to JPEG image using pdf2image
2025-05-24 19:35:53,948 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 19:35:53,949 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 19:35:58,670 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 19:35:58,671 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 19:35:58,672 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-05-17",\n  "total_amount": 0.0,\n  "subtotal": null,\n  "tax_amount": null,\n  "receipt_number": null,\n  "description": "Tickets for Great Blue Heron Music Festival 2025",\n  "due_date": null,\n  "is_bill": false,\n  "line_items": [],\n  "confidence": 0.8\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 4.684763431549072, 'timestamp': '2025-05-24T19:35:58.668654', 'tokens_used': 1495, 'cost_estimate': 0.008505}
2025-05-24 19:35:58,684 - routes - INFO - Receipt queued for review: Task ID 35
2025-05-24 19:35:58,693 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:36:29,134 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:36:59,491 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:37:29,856 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:38:00,208 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:38:27,857 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:38:58,373 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:38:58,396 - routes - ERROR - Error loading AI queue: No filter named 'from_json' found.
2025-05-24 19:39:28,475 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:39:28,478 - routes - ERROR - Error loading AI queue: No filter named 'from_json' found.
2025-05-24 19:40:12,727 - app - INFO - Creating database tables...
2025-05-24 19:40:12,729 - app - INFO - Creating database tables...
2025-05-24 19:40:12,729 - app - INFO - Creating database tables...
2025-05-24 19:40:12,730 - app - INFO - Creating database tables...
2025-05-24 19:40:12,766 - app - INFO - Database tables created successfully
2025-05-24 19:40:12,766 - app - INFO - Database tables created successfully
2025-05-24 19:40:12,766 - app - INFO - Database tables created successfully
2025-05-24 19:40:12,766 - app - INFO - Database tables created successfully
2025-05-24 19:40:13,690 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:40:13,690 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:40:13,691 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:40:13,696 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:40:14,345 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:40:19,709 - routes - INFO - Receipt rejected: Task 35, Reason: 
2025-05-24 19:40:19,716 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:40:29,162 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 19:40:29,163 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 19:40:29,164 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp66kdub61.pdf
2025-05-24 19:40:29,400 - ocr_utils - INFO - Successfully converted PDF to JPEG image using pdf2image
2025-05-24 19:40:29,400 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 19:40:29,401 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 19:40:39,540 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 19:40:39,542 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 19:40:39,543 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-05-17",\n  "total_amount": 0.0,\n  "subtotal": null,\n  "tax_amount": null,\n  "receipt_number": null,\n  "description": "Tickets for Great Blue Heron Music Festival 2025",\n  "due_date": null,\n  "is_bill": false,\n  "line_items": [],\n  "confidence": 0.8\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 10.101931095123291, 'timestamp': '2025-05-24T19:40:39.539608', 'tokens_used': 1495, 'cost_estimate': 0.008505}
2025-05-24 19:40:39,552 - routes - INFO - Receipt queued for review: Task ID 68
2025-05-24 19:40:39,559 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:40:43,402 - routes - INFO - AI Analysis Structure for Task 68: {
  "content": {
    "response": "```json\n{\n  \"vendor_name\": \"Eventeny\",\n  \"date\": \"2025-05-17\",\n  \"total_amount\": 0.0,\n  \"subtotal\": null,\n  \"tax_amount\": null,\n  \"receipt_number\": null,\n  \"description\": \"Tickets for Great Blue Heron Music Festival 2025\",\n  \"due_date\": null,\n  \"is_bill\": false,\n  \"line_items\": [],\n  \"confidence\": 0.8\n}\n```"
  },
  "provider": "openai",
  "timestamp": "2025-05-24T19:40:39.539608",
  "confidence": null,
  "prompt_type": "unknown",
  "tokens_used": 1495,
  "cost_estimate": 0.008505,
  "processing_time": 10.101931095123291
}
2025-05-24 19:40:43,403 - routes - INFO - Extracted Receipt Data for Task 68: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 0.0,
  "subtotal": null,
  "tax_amount": null,
  "receipt_number": null,
  "description": "Tickets for Great Blue Heron Music Festival 2025",
  "due_date": null,
  "is_bill": false,
  "line_items": [],
  "confidence": 0.8
}
2025-05-24 19:58:33,117 - app - INFO - Creating database tables...
2025-05-24 19:58:33,119 - app - INFO - Creating database tables...
2025-05-24 19:58:33,152 - app - INFO - Database tables created successfully
2025-05-24 19:58:33,152 - app - INFO - Database tables created successfully
2025-05-24 19:58:33,172 - app - INFO - Creating database tables...
2025-05-24 19:58:33,188 - app - INFO - Database tables created successfully
2025-05-24 19:58:33,208 - app - INFO - Creating database tables...
2025-05-24 19:58:33,224 - app - INFO - Database tables created successfully
2025-05-24 19:58:34,058 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:58:34,058 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:58:34,058 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:58:34,058 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:58:42,187 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 19:58:42,188 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 19:58:42,189 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpiaprubtw.pdf
2025-05-24 19:58:42,418 - ocr_utils - INFO - Successfully converted PDF to JPEG image using pdf2image
2025-05-24 19:58:42,419 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 19:58:42,420 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 19:58:52,949 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 19:58:52,950 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 19:58:52,952 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-05-17",\n  "total_amount": null,\n  "subtotal": null,\n  "tax_amount": null,\n  "tip_amount": null,\n  "fees": null,\n  "receipt_number": null,\n  "payment_method": null,\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "ticket_confirmation",\n  "description": "Great Blue Heron Music Festival 2025 ticket confirmation",\n  "line_items": [],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 pm",\n    "venue_location": "2361 Waits Corners Rd, Sherman 14781, United States",\n    "seat_info": null,\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": null,\n    "business_phone": null,\n    "business_email": "express@eventeny.com",\n    "business_website": null,\n    "business_hours": null,\n    "business_type": null\n  },\n  "overall_confidence": 0.9,\n  "image_quality": "good",\n  "missing_information": [\n    "total_amount",\n    "subtotal",\n    "tax_amount",\n    "tip_amount",\n    "fees",\n    "receipt_number",\n    "payment_method"\n  ],\n  "extraction_notes": "This is a ticket confirmation email, not a traditional receipt."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 10.495326280593872, 'timestamp': '2025-05-24T19:58:52.948471', 'tokens_used': 2756, 'cost_estimate': 0.017750000000000002}
2025-05-24 19:58:52,975 - routes - INFO - Receipt queued for review: Task ID 69
2025-05-24 19:58:52,986 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 19:58:56,345 - routes - INFO - AI Analysis Structure for Task 69: {
  "content": {
    "response": "```json\n{\n  \"vendor_name\": \"Eventeny\",\n  \"date\": \"2025-05-17\",\n  \"total_amount\": null,\n  \"subtotal\": null,\n  \"tax_amount\": null,\n  \"tip_amount\": null,\n  \"fees\": null,\n  \"receipt_number\": null,\n  \"payment_method\": null,\n  \"due_date\": null,\n  \"is_bill\": false,\n  \"document_type\": \"ticket_confirmation\",\n  \"description\": \"Great Blue Heron Music Festival 2025 ticket confirmation\",\n  \"line_items\": [],\n  \"people_found\": [],\n  \"digital_assets\": {\n    \"qr_codes\": [],\n    \"barcodes\": [],\n    \"urls\": [],\n    \"confirmation_codes\": [\n      \"TDSLVDVJ\"\n    ],\n    \"ticket_numbers\": [],\n    \"account_numbers\": []\n  },\n  \"event_details\": {\n    \"event_name\": \"Great Blue Heron Music Festival 2025\",\n    \"event_date\": \"2025-07-03\",\n    \"event_time\": \"1:00 pm\",\n    \"venue_location\": \"2361 Waits Corners Rd, Sherman 14781, United States\",\n    \"seat_info\": null,\n    \"additional_details\": {}\n  },\n  \"vendor_details\": {\n    \"business_address\": null,\n    \"business_phone\": null,\n    \"business_email\": \"express@eventeny.com\",\n    \"business_website\": null,\n    \"business_hours\": null,\n    \"business_type\": null\n  },\n  \"overall_confidence\": 0.9,\n  \"image_quality\": \"good\",\n  \"missing_information\": [\n    \"total_amount\",\n    \"subtotal\",\n    \"tax_amount\",\n    \"tip_amount\",\n    \"fees\",\n    \"receipt_number\",\n    \"payment_method\"\n  ],\n  \"extraction_notes\": \"This is a ticket confirmation email, not a traditional receipt.\"\n}\n```"
  },
  "provider": "openai",
  "timestamp": "2025-05-24T19:58:52.948471",
  "confidence": null,
  "prompt_type": "unknown",
  "tokens_used": 2756,
  "cost_estimate": 0.017750000000000002,
  "processing_time": 10.495326280593872
}
2025-05-24 19:58:56,346 - routes - INFO - Extracted Receipt Data for Task 69: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": null,
  "subtotal": null,
  "tax_amount": null,
  "tip_amount": null,
  "fees": null,
  "receipt_number": null,
  "payment_method": null,
  "due_date": null,
  "is_bill": false,
  "document_type": "ticket_confirmation",
  "description": "Great Blue Heron Music Festival 2025 ticket confirmation",
  "line_items": [],
  "people_found": [],
  "digital_assets": {
    "qr_codes": [],
    "barcodes": [],
    "urls": [],
    "confirmation_codes": [
      "TDSLVDVJ"
    ],
    "ticket_numbers": [],
    "account_numbers": []
  },
  "event_details": {
    "event_name": "Great Blue Heron Music Festival 2025",
    "event_date": "2025-07-03",
    "event_time": "1:00 pm",
    "venue_location": "2361 Waits Corners Rd, Sherman 14781, United States",
    "seat_info": null,
    "additional_details": {}
  },
  "vendor_details": {
    "business_address": null,
    "business_phone": null,
    "business_email": "express@eventeny.com",
    "business_website": null,
    "business_hours": null,
    "business_type": null
  },
  "overall_confidence": 0.9,
  "image_quality": "good",
  "missing_information": [
    "total_amount",
    "subtotal",
    "tax_amount",
    "tip_amount",
    "fees",
    "receipt_number",
    "payment_method"
  ],
  "extraction_notes": "This is a ticket confirmation email, not a traditional receipt."
}
2025-05-24 19:59:29,015 - routes - ERROR - Error approving receipt: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "/app/routes.py", line 856, in approve_receipt
    total_amount = float(receipt_data.get('total_amount', 0))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-05-24 19:59:29,026 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 19:59:34,791 - routes - ERROR - Error approving receipt: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "/app/routes.py", line 856, in approve_receipt
    total_amount = float(receipt_data.get('total_amount', 0))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-05-24 19:59:34,802 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 20:00:05,186 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 20:00:35,554 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 20:01:05,922 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 20:01:36,290 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 20:02:06,544 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 20:02:34,533 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 20:03:04,893 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 20:03:23,070 - routes - INFO - Receipt rejected: Task 69, Reason: 
2025-05-24 20:03:23,076 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 20:03:25,217 - routes - INFO - Receipt rejected: Task 68, Reason: 
2025-05-24 20:03:25,224 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:03:55,592 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:04:32,399 - app - INFO - Creating database tables...
2025-05-24 20:04:32,404 - app - INFO - Creating database tables...
2025-05-24 20:04:32,404 - app - INFO - Creating database tables...
2025-05-24 20:04:32,435 - app - INFO - Database tables created successfully
2025-05-24 20:04:32,434 - app - INFO - Database tables created successfully
2025-05-24 20:04:32,434 - app - INFO - Database tables created successfully
2025-05-24 20:04:32,445 - app - INFO - Creating database tables...
2025-05-24 20:04:32,461 - app - INFO - Database tables created successfully
2025-05-24 20:04:33,340 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:04:33,340 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:04:33,340 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:04:33,345 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:04:33,353 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:04:42,089 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 20:04:42,089 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 20:04:42,090 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmphsfkc18z.pdf
2025-05-24 20:04:42,091 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 20:04:42,539 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 20:04:42,540 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 20:04:42,617 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 20:04:42,653 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 20:04:42,654 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 20:04:42,655 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 20:04:52,649 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 20:04:52,650 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 20:04:52,651 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Great Blue Heron Music Festival 2025 Ticket Purchase",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "category": "event",\n      "object_type": "service",\n      "confidence": 0.95\n    }\n  ],\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Processed from an email receipt for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 9.953361511230469, 'timestamp': '2025-05-24T20:04:52.647566', 'tokens_used': 3268, 'cost_estimate': 0.01863}
2025-05-24 20:04:52,671 - routes - INFO - Receipt queued for review: Task ID 70
2025-05-24 20:04:52,681 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 20:04:54,462 - routes - INFO - AI Analysis Structure for Task 70: {
  "content": {
    "response": "```json\n{\n  \"vendor_name\": \"Eventeny\",\n  \"date\": \"2025-03-17\",\n  \"total_amount\": 257.61,\n  \"subtotal\": 215.00,\n  \"tax_amount\": 0.00,\n  \"fees\": 41.61,\n  \"receipt_number\": \"TDSLVDVJ\",\n  \"is_bill\": false,\n  \"document_type\": \"receipt\",\n  \"description\": \"Great Blue Heron Music Festival 2025 Ticket Purchase\",\n  \"line_items\": [\n    {\n      \"description\": \"Weekend Pass Thursday Entry\",\n      \"quantity\": 1.0,\n      \"unit_price\": 215.00,\n      \"total_price\": 215.00,\n      \"category\": \"event\",\n      \"object_type\": \"service\",\n      \"confidence\": 0.95\n    }\n  ],\n  \"overall_confidence\": 0.95,\n  \"image_quality\": \"good\",\n  \"missing_information\": [],\n  \"extraction_notes\": \"Processed from an email receipt for a music festival ticket purchase.\"\n}\n```"
  },
  "provider": "openai",
  "timestamp": "2025-05-24T20:04:52.647566",
  "confidence": null,
  "prompt_type": "unknown",
  "tokens_used": 3268,
  "cost_estimate": 0.01863,
  "processing_time": 9.953361511230469
}
2025-05-24 20:04:54,463 - routes - INFO - Extracted Receipt Data for Task 70: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.0,
  "tax_amount": 0.0,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "is_bill": false,
  "document_type": "receipt",
  "description": "Great Blue Heron Music Festival 2025 Ticket Purchase",
  "line_items": [
    {
      "description": "Weekend Pass Thursday Entry",
      "quantity": 1.0,
      "unit_price": 215.0,
      "total_price": 215.0,
      "category": "event",
      "object_type": "service",
      "confidence": 0.95
    }
  ],
  "overall_confidence": 0.95,
  "image_quality": "good",
  "missing_information": [],
  "extraction_notes": "Processed from an email receipt for a music festival ticket purchase."
}
2025-05-24 20:05:25,597 - routes - INFO - Approving receipt: Eventeny, $257.61, 1 line items, confidence: 0.95
2025-05-24 20:05:25,605 - routes - INFO - Created new vendor: Eventeny with enhanced details
2025-05-24 20:05:25,616 - routes - INFO - Receipt approved and processed: Invoice #INV-20250524-7AEECBED created, 1 line items
2025-05-24 20:05:25,622 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:09:09,139 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:11:40,870 - app - INFO - Creating database tables...
2025-05-24 20:11:40,878 - app - INFO - Database tables created successfully
2025-05-24 20:14:54,269 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 20:14:54,270 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 20:14:54,272 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpvbvu911k.pdf
2025-05-24 20:14:54,273 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 20:14:54,694 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 20:14:54,695 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 20:14:54,769 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 20:14:54,806 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 20:14:54,808 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 20:14:54,808 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 20:15:10,896 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 20:15:10,897 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 20:15:10,898 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Entry on 1:00 pm",\n      "create_object": false,\n      "object_type": "service",\n      "category": "event",\n      "expiration_info": {\n        "expiration_date": "2025-07-08",\n        "event_date": "2025-07-03",\n        "shelf_life_days": 5\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": ""\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": [],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "",\n    "business_phone": "",\n    "business_email": "express@eventeny.com",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": "event management"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Extracted from email receipt for event ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 16.050493717193604, 'timestamp': '2025-05-24T20:15:10.895039', 'tokens_used': 3572, 'cost_estimate': 0.023190000000000002}
2025-05-24 20:15:10,910 - routes - INFO - Receipt queued for review: Task ID 71
2025-05-24 20:15:10,918 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 20:15:20,486 - routes - INFO - AI Analysis Structure for Task 71: {
  "content": {
    "response": "```json\n{\n  \"vendor_name\": \"Eventeny\",\n  \"date\": \"2025-03-17\",\n  \"total_amount\": 257.61,\n  \"subtotal\": 215.00,\n  \"tax_amount\": 0.00,\n  \"tip_amount\": 0.00,\n  \"fees\": 41.61,\n  \"receipt_number\": \"TDSLVDVJ\",\n  \"payment_method\": \"Not specified\",\n  \"due_date\": null,\n  \"is_bill\": false,\n  \"document_type\": \"receipt\",\n  \"description\": \"Ticket purchase for Great Blue Heron Music Festival 2025\",\n  \"line_items\": [\n    {\n      \"description\": \"Weekend Pass Thursday Entry\",\n      \"quantity\": 1.0,\n      \"unit_price\": 215.00,\n      \"total_price\": 215.00,\n      \"item_details\": \"Entry on 1:00 pm\",\n      \"create_object\": false,\n      \"object_type\": \"service\",\n      \"category\": \"event\",\n      \"expiration_info\": {\n        \"expiration_date\": \"2025-07-08\",\n        \"event_date\": \"2025-07-03\",\n        \"shelf_life_days\": 5\n      },\n      \"object_details\": {\n        \"serial_numbers\": [],\n        \"specifications\": {},\n        \"warranty_info\": \"\"\n      },\n      \"confidence\": 0.95\n    }\n  ],\n  \"people_found\": [],\n  \"digital_assets\": {\n    \"qr_codes\": [],\n    \"barcodes\": [],\n    \"urls\": [],\n    \"confirmation_codes\": [],\n    \"ticket_numbers\": [],\n    \"account_numbers\": []\n  },\n  \"event_details\": {\n    \"event_name\": \"Great Blue Heron Music Festival 2025\",\n    \"event_date\": \"2025-07-03\",\n    \"event_time\": \"13:00\",\n    \"venue_location\": \"2361 Waits Corners Rd, Sherman, NY 14781, United States\",\n    \"seat_info\": \"\",\n    \"additional_details\": {}\n  },\n  \"vendor_details\": {\n    \"business_address\": \"\",\n    \"business_phone\": \"\",\n    \"business_email\": \"express@eventeny.com\",\n    \"business_website\": \"\",\n    \"business_hours\": \"\",\n    \"business_type\": \"event management\"\n  },\n  \"overall_confidence\": 0.95,\n  \"image_quality\": \"good\",\n  \"missing_information\": [],\n  \"extraction_notes\": \"Extracted from email receipt for event ticket purchase.\"\n}\n```"
  },
  "provider": "openai",
  "timestamp": "2025-05-24T20:15:10.895039",
  "confidence": null,
  "prompt_type": "unknown",
  "tokens_used": 3572,
  "cost_estimate": 0.023190000000000002,
  "processing_time": 16.050493717193604
}
2025-05-24 20:15:20,487 - routes - INFO - Extracted Receipt Data for Task 71: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.0,
  "tax_amount": 0.0,
  "tip_amount": 0.0,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not specified",
  "due_date": null,
  "is_bill": false,
  "document_type": "receipt",
  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",
  "line_items": [
    {
      "description": "Weekend Pass Thursday Entry",
      "quantity": 1.0,
      "unit_price": 215.0,
      "total_price": 215.0,
      "item_details": "Entry on 1:00 pm",
      "create_object": false,
      "object_type": "service",
      "category": "event",
      "expiration_info": {
        "expiration_date": "2025-07-08",
        "event_date": "2025-07-03",
        "shelf_life_days": 5
      },
      "object_details": {
        "serial_numbers": [],
        "specifications": {},
        "warranty_info": ""
      },
      "confidence": 0.95
    }
  ],
  "people_found": [],
  "digital_assets": {
    "qr_codes": [],
    "barcodes": [],
    "urls": [],
    "confirmation_codes": [],
    "ticket_numbers": [],
    "account_numbers": []
  },
  "event_details": {
    "event_name": "Great Blue Heron Music Festival 2025",
    "event_date": "2025-07-03",
    "event_time": "13:00",
    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",
    "seat_info": "",
    "additional_details": {}
  },
  "vendor_details": {
    "business_address": "",
    "business_phone": "",
    "business_email": "express@eventeny.com",
    "business_website": "",
    "business_hours": "",
    "business_type": "event management"
  },
  "overall_confidence": 0.95,
  "image_quality": "good",
  "missing_information": [],
  "extraction_notes": "Extracted from email receipt for event ticket purchase."
}
2025-05-24 20:15:30,251 - routes - INFO - Approving receipt: Eventeny, $257.61, 1 line items, confidence: 0.95
2025-05-24 20:15:30,259 - routes - INFO - Receipt approved and processed: Invoice #INV-20250524-7FFF80DA created, 1 line items
2025-05-24 20:15:30,267 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:17:09,795 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:17:15,243 - routes - INFO - Processing receipt file: RECEIPT PAePay DUI Fine Nate Smith.pdf
2025-05-24 20:17:15,244 - routes - INFO - Processing PDF file: RECEIPT_PAePay_DUI_Fine_Nate_Smith.pdf
2025-05-24 20:17:15,246 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp725a_rnv.pdf
2025-05-24 20:17:15,246 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 20:17:15,481 - ocr_utils - INFO - Successfully converted 1 pages from PDF
2025-05-24 20:17:15,511 - ocr_utils - INFO - Successfully converted PDF (1 pages) to JPEG image using pdf2image
2025-05-24 20:17:15,512 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 20:17:15,513 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 20:17:29,877 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 20:17:29,878 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 20:17:29,879 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "PAePay",\n  "date": "2025-05-20",\n  "total_amount": 267.15,\n  "subtotal": 260.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 7.15,\n  "receipt_number": "01XF693J7H",\n  "payment_method": "unknown",\n  "due_date": "2025-05-24",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Traffic Ticket or Court Costs Payment",\n  "line_items": [\n    {\n      "description": "Payment Plan 67-2018-P000007328",\n      "quantity": 1.0,\n      "unit_price": 260.00,\n      "total_price": 260.00,\n      "item_details": "Next payment amount due: $65.00, Overdue amount: $195.00",\n      "create_object": false,\n      "object_type": "service",\n      "category": "legal",\n      "expiration_info": {\n        "expiration_date": "2025-05-24",\n        "event_date": "2025-05-24",\n        "shelf_life_days": 4\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": ""\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://ujsportal.pacourts.us/PAePayFCR/Receipt?shoppingCartID=814535c8-114d-4020-dad0-08dd94ab10d0"\n    ],\n    "confirmation_codes": [\n      "01XF693J7H"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {},\n  "vendor_details": {\n    "business_address": "",\n    "business_phone": "",\n    "business_email": "",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": "government"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt for a traffic ticket or court costs payment."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 14.31165623664856, 'timestamp': '2025-05-24T20:17:29.876334', 'tokens_used': 2886, 'cost_estimate': 0.019700000000000002}
2025-05-24 20:17:29,887 - routes - INFO - Receipt queued for review: Task ID 72
2025-05-24 20:17:29,895 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 20:18:00,372 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 20:18:10,604 - routes - INFO - AI Analysis Structure for Task 72: {
  "content": {
    "response": "```json\n{\n  \"vendor_name\": \"PAePay\",\n  \"date\": \"2025-05-20\",\n  \"total_amount\": 267.15,\n  \"subtotal\": 260.00,\n  \"tax_amount\": 0.00,\n  \"tip_amount\": 0.00,\n  \"fees\": 7.15,\n  \"receipt_number\": \"01XF693J7H\",\n  \"payment_method\": \"unknown\",\n  \"due_date\": \"2025-05-24\",\n  \"is_bill\": false,\n  \"document_type\": \"receipt\",\n  \"description\": \"Traffic Ticket or Court Costs Payment\",\n  \"line_items\": [\n    {\n      \"description\": \"Payment Plan 67-2018-P000007328\",\n      \"quantity\": 1.0,\n      \"unit_price\": 260.00,\n      \"total_price\": 260.00,\n      \"item_details\": \"Next payment amount due: $65.00, Overdue amount: $195.00\",\n      \"create_object\": false,\n      \"object_type\": \"service\",\n      \"category\": \"legal\",\n      \"expiration_info\": {\n        \"expiration_date\": \"2025-05-24\",\n        \"event_date\": \"2025-05-24\",\n        \"shelf_life_days\": 4\n      },\n      \"object_details\": {\n        \"serial_numbers\": [],\n        \"specifications\": {},\n        \"warranty_info\": \"\"\n      },\n      \"confidence\": 0.95\n    }\n  ],\n  \"people_found\": [],\n  \"digital_assets\": {\n    \"qr_codes\": [],\n    \"barcodes\": [],\n    \"urls\": [\n      \"https://ujsportal.pacourts.us/PAePayFCR/Receipt?shoppingCartID=814535c8-114d-4020-dad0-08dd94ab10d0\"\n    ],\n    \"confirmation_codes\": [\n      \"01XF693J7H\"\n    ],\n    \"ticket_numbers\": [],\n    \"account_numbers\": []\n  },\n  \"event_details\": {},\n  \"vendor_details\": {\n    \"business_address\": \"\",\n    \"business_phone\": \"\",\n    \"business_email\": \"\",\n    \"business_website\": \"\",\n    \"business_hours\": \"\",\n    \"business_type\": \"government\"\n  },\n  \"overall_confidence\": 0.95,\n  \"image_quality\": \"good\",\n  \"missing_information\": [],\n  \"extraction_notes\": \"Receipt for a traffic ticket or court costs payment.\"\n}\n```"
  },
  "provider": "openai",
  "timestamp": "2025-05-24T20:17:29.876334",
  "confidence": null,
  "prompt_type": "unknown",
  "tokens_used": 2886,
  "cost_estimate": 0.019700000000000002,
  "processing_time": 14.31165623664856
}
2025-05-24 20:18:10,605 - routes - INFO - Extracted Receipt Data for Task 72: {
  "vendor_name": "PAePay",
  "date": "2025-05-20",
  "total_amount": 267.15,
  "subtotal": 260.0,
  "tax_amount": 0.0,
  "tip_amount": 0.0,
  "fees": 7.15,
  "receipt_number": "01XF693J7H",
  "payment_method": "unknown",
  "due_date": "2025-05-24",
  "is_bill": false,
  "document_type": "receipt",
  "description": "Traffic Ticket or Court Costs Payment",
  "line_items": [
    {
      "description": "Payment Plan 67-2018-P000007328",
      "quantity": 1.0,
      "unit_price": 260.0,
      "total_price": 260.0,
      "item_details": "Next payment amount due: $65.00, Overdue amount: $195.00",
      "create_object": false,
      "object_type": "service",
      "category": "legal",
      "expiration_info": {
        "expiration_date": "2025-05-24",
        "event_date": "2025-05-24",
        "shelf_life_days": 4
      },
      "object_details": {
        "serial_numbers": [],
        "specifications": {},
        "warranty_info": ""
      },
      "confidence": 0.95
    }
  ],
  "people_found": [],
  "digital_assets": {
    "qr_codes": [],
    "barcodes": [],
    "urls": [
      "https://ujsportal.pacourts.us/PAePayFCR/Receipt?shoppingCartID=814535c8-114d-4020-dad0-08dd94ab10d0"
    ],
    "confirmation_codes": [
      "01XF693J7H"
    ],
    "ticket_numbers": [],
    "account_numbers": []
  },
  "event_details": {},
  "vendor_details": {
    "business_address": "",
    "business_phone": "",
    "business_email": "",
    "business_website": "",
    "business_hours": "",
    "business_type": "government"
  },
  "overall_confidence": 0.95,
  "image_quality": "good",
  "missing_information": [],
  "extraction_notes": "Receipt for a traffic ticket or court costs payment."
}
2025-05-24 20:18:27,857 - routes - INFO - Approving receipt: PAePay, $267.15, 1 line items, confidence: 0.95
2025-05-24 20:18:27,860 - routes - INFO - Created new vendor: PAePay with enhanced details
2025-05-24 20:18:27,861 - routes - INFO - Captured digital assets: 0 QR codes, 1 URLs, etc.
2025-05-24 20:18:27,866 - routes - INFO - Receipt approved and processed: Invoice #INV-20250524-B0546549 created, 1 line items, digital assets captured
2025-05-24 20:18:27,871 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:18:31,941 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:18:31,589 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:25:38,910 - app - INFO - Creating database tables...
2025-05-24 20:25:38,911 - app - INFO - Creating database tables...
2025-05-24 20:25:38,946 - app - INFO - Database tables created successfully
2025-05-24 20:25:38,946 - app - INFO - Database tables created successfully
2025-05-24 20:25:38,967 - app - INFO - Creating database tables...
2025-05-24 20:25:38,987 - app - INFO - Database tables created successfully
2025-05-24 20:25:39,087 - app - INFO - Creating database tables...
2025-05-24 20:25:39,105 - app - INFO - Database tables created successfully
2025-05-24 20:25:39,885 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:25:39,885 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:25:39,885 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:25:39,891 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:25:46,858 - routes - ERROR - Error loading bills: (psycopg2.errors.SyntaxError) syntax error at or near "json_extract"
LINE 3: WHERE invoices.is_paid = false OR (invoices.data json_extrac...
                                                         ^

[SQL: SELECT invoices.id AS invoices_id, invoices.invoice_number AS invoices_invoice_number, invoices.vendor_id AS invoices_vendor_id, invoices.created_at AS invoices_created_at, invoices.updated_at AS invoices_updated_at, invoices.is_paid AS invoices_is_paid, invoices.data AS invoices_data 
FROM invoices 
WHERE invoices.is_paid = false OR (invoices.data json_extract %(data_1)s) IS NOT NULL ORDER BY invoices.created_at DESC]
[parameters: {'data_1': '$.due_date'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 20:25:54,746 - routes - INFO - Deleting receipt INV-20250524-7FFF80DA: 1 line items, 0 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-24 20:25:54,753 - routes - ERROR - Error deleting receipt: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ..."business_address": "", "business_website": ""}}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "status": "approved", "vendor": "Eventeny", "is_bill": false, "due_date": null, "subtotal": 215.0, "tax_amount" ... (573 characters truncated) ... t management", "business_email": "express@eventeny.com", "business_hours": "", "business_phone": "", "business_address": "", "business_website": ""}}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.AmbiguousFunction: operator is not unique: unknown ->> unknown
LINE 3: ..."business_address": "", "business_website": ""}}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 966, in delete_receipt
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 442, in execute
    postsort_actions = self._generate_actions()
                       ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 400, in _generate_actions
    if action.execute(self):
       ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 540, in execute
    self.dependency_processor.prop_has_changes(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/dependency.py", line 254, in prop_has_changes
    history = uowcommit.get_attribute_history(s, self.key, passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 283, in get_attribute_history
    history = impl.get_history(
              ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1366, in get_history
    current = self.get(state, dict_, passive=passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ..."business_address": "", "business_website": ""}}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "status": "approved", "vendor": "Eventeny", "is_bill": false, "due_date": null, "subtotal": 215.0, "tax_amount" ... (573 characters truncated) ... t management", "business_email": "express@eventeny.com", "business_hours": "", "business_phone": "", "business_address": "", "business_website": ""}}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 20:31:10,724 - app - INFO - Creating database tables...
2025-05-24 20:31:10,724 - app - INFO - Creating database tables...
2025-05-24 20:31:10,727 - app - INFO - Creating database tables...
2025-05-24 20:31:10,728 - app - INFO - Creating database tables...
2025-05-24 20:31:10,760 - app - INFO - Database tables created successfully
2025-05-24 20:31:10,760 - app - INFO - Database tables created successfully
2025-05-24 20:31:10,760 - app - INFO - Database tables created successfully
2025-05-24 20:31:10,760 - app - INFO - Database tables created successfully
2025-05-24 20:31:11,678 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:31:11,678 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:31:11,678 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:31:11,686 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:36:07,769 - app - INFO - Creating database tables...
2025-05-24 20:36:07,770 - app - INFO - Creating database tables...
2025-05-24 20:36:07,770 - app - INFO - Creating database tables...
2025-05-24 20:36:07,788 - app - INFO - Database tables created successfully
2025-05-24 20:36:07,788 - app - INFO - Database tables created successfully
2025-05-24 20:36:07,788 - app - INFO - Database tables created successfully
2025-05-24 20:36:07,845 - app - INFO - Creating database tables...
2025-05-24 20:36:07,862 - app - INFO - Database tables created successfully
2025-05-24 20:36:08,732 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:36:08,732 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:36:08,737 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:36:08,739 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:36:19,558 - routes - ERROR - Error loading bills: (psycopg2.errors.SyntaxError) syntax error at or near "json_extract"
LINE 3: WHERE invoices.is_paid = false OR (invoices.data json_extrac...
                                                         ^

[SQL: SELECT invoices.id AS invoices_id, invoices.invoice_number AS invoices_invoice_number, invoices.vendor_id AS invoices_vendor_id, invoices.created_at AS invoices_created_at, invoices.updated_at AS invoices_updated_at, invoices.is_paid AS invoices_is_paid, invoices.data AS invoices_data 
FROM invoices 
WHERE invoices.is_paid = false OR (invoices.data json_extract %(data_1)s) IS NOT NULL ORDER BY invoices.created_at DESC]
[parameters: {'data_1': '$.due_date'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 20:36:28,499 - routes - INFO - Deleting receipt INV-20250524-7FFF80DA: 1 line items, 0 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-24 20:36:28,507 - routes - ERROR - Error deleting receipt: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ..."business_address": "", "business_website": ""}}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "status": "approved", "vendor": "Eventeny", "is_bill": false, "due_date": null, "subtotal": 215.0, "tax_amount" ... (573 characters truncated) ... t management", "business_email": "express@eventeny.com", "business_hours": "", "business_phone": "", "business_address": "", "business_website": ""}}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.AmbiguousFunction: operator is not unique: unknown ->> unknown
LINE 3: ..."business_address": "", "business_website": ""}}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1069, in delete_receipt
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 442, in execute
    postsort_actions = self._generate_actions()
                       ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 400, in _generate_actions
    if action.execute(self):
       ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 540, in execute
    self.dependency_processor.prop_has_changes(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/dependency.py", line 254, in prop_has_changes
    history = uowcommit.get_attribute_history(s, self.key, passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 283, in get_attribute_history
    history = impl.get_history(
              ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1366, in get_history
    current = self.get(state, dict_, passive=passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ..."business_address": "", "business_website": ""}}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "status": "approved", "vendor": "Eventeny", "is_bill": false, "due_date": null, "subtotal": 215.0, "tax_amount" ... (573 characters truncated) ... t management", "business_email": "express@eventeny.com", "business_hours": "", "business_phone": "", "business_address": "", "business_website": ""}}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 20:37:58,527 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 20:37:58,528 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 20:37:58,531 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmps_3z92g1.pdf
2025-05-24 20:37:58,531 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 20:37:59,015 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 20:37:59,016 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 20:37:59,101 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 20:37:59,143 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 20:37:59,144 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 20:37:59,145 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 20:38:12,479 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 20:38:12,481 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 20:38:12,482 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Entry on 1:00 pm",\n      "create_object": false,\n      "object_type": "service",\n      "category": "event",\n      "expiration_info": {\n        "expiration_date": "2025-07-08",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": false,\n      "person_name": "Nate Smith",\n      "role": "Attendee",\n      "relationship_to_purchase": "Purchaser",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://www.eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": null,\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "business_phone": null,\n    "business_email": "express@eventeny.com",\n    "business_website": "https://www.eventeny.com",\n    "business_hours": null,\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from email confirmation for event ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 13.285435438156128, 'timestamp': '2025-05-24T20:38:12.478467', 'tokens_used': 3677, 'cost_estimate': 0.024765000000000002}
2025-05-24 20:38:12,510 - routes - INFO - Receipt queued for review: Task ID 73
2025-05-24 20:38:28,462 - routes - ERROR - Error loading bills: (psycopg2.errors.SyntaxError) syntax error at or near "json_extract"
LINE 3: WHERE invoices.is_paid = false OR (invoices.data json_extrac...
                                                         ^

[SQL: SELECT invoices.id AS invoices_id, invoices.invoice_number AS invoices_invoice_number, invoices.vendor_id AS invoices_vendor_id, invoices.created_at AS invoices_created_at, invoices.updated_at AS invoices_updated_at, invoices.is_paid AS invoices_is_paid, invoices.data AS invoices_data 
FROM invoices 
WHERE invoices.is_paid = false OR (invoices.data json_extract %(data_1)s) IS NOT NULL ORDER BY invoices.created_at DESC]
[parameters: {'data_1': '$.due_date'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 20:40:20,345 - app - INFO - Creating database tables...
2025-05-24 20:40:20,346 - app - INFO - Creating database tables...
2025-05-24 20:40:20,348 - app - INFO - Creating database tables...
2025-05-24 20:40:20,353 - app - INFO - Creating database tables...
2025-05-24 20:40:20,483 - app - INFO - Database tables created successfully
2025-05-24 20:40:20,483 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(vendors_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 20:40:20,483 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(vendors_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 20:40:20,483 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(vendors_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 20:40:21,484 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:40:21,484 - routes - ERROR - Error initializing AI settings: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ai_settings_provider_key"
DETAIL:  Key (provider)=(anthropic) already exists.

[SQL: INSERT INTO ai_settings (provider, is_enabled, is_default, api_key, api_endpoint, config, created_at, updated_at) VALUES (%(provider)s, %(is_enabled)s, %(is_default)s, %(api_key)s, %(api_endpoint)s, %(config)s, %(created_at)s, %(updated_at)s) RETURNING ai_settings.id]
[parameters: {'provider': 'anthropic', 'is_enabled': True, 'is_default': True, 'api_key': None, 'api_endpoint': None, 'config': '{"default_model": "claude-3-5-sonnet-20241022", "vision_model": "claude-3-opus-20240229", "timeout": 180}', 'created_at': datetime.datetime(2025, 5, 24, 20, 40, 21, 483231), 'updated_at': datetime.datetime(2025, 5, 24, 20, 40, 21, 483234)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 20:40:21,484 - routes - ERROR - Error initializing AI settings: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ai_settings_provider_key"
DETAIL:  Key (provider)=(anthropic) already exists.

[SQL: INSERT INTO ai_settings (provider, is_enabled, is_default, api_key, api_endpoint, config, created_at, updated_at) VALUES (%(provider)s, %(is_enabled)s, %(is_default)s, %(api_key)s, %(api_endpoint)s, %(config)s, %(created_at)s, %(updated_at)s) RETURNING ai_settings.id]
[parameters: {'provider': 'anthropic', 'is_enabled': True, 'is_default': True, 'api_key': None, 'api_endpoint': None, 'config': '{"default_model": "claude-3-5-sonnet-20241022", "vision_model": "claude-3-opus-20240229", "timeout": 180}', 'created_at': datetime.datetime(2025, 5, 24, 20, 40, 21, 483594), 'updated_at': datetime.datetime(2025, 5, 24, 20, 40, 21, 483596)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 20:40:21,488 - routes - ERROR - Error initializing AI settings: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ai_settings_provider_key"
DETAIL:  Key (provider)=(anthropic) already exists.

[SQL: INSERT INTO ai_settings (provider, is_enabled, is_default, api_key, api_endpoint, config, created_at, updated_at) VALUES (%(provider)s, %(is_enabled)s, %(is_default)s, %(api_key)s, %(api_endpoint)s, %(config)s, %(created_at)s, %(updated_at)s) RETURNING ai_settings.id]
[parameters: {'provider': 'anthropic', 'is_enabled': True, 'is_default': True, 'api_key': None, 'api_endpoint': None, 'config': '{"default_model": "claude-3-5-sonnet-20241022", "vision_model": "claude-3-opus-20240229", "timeout": 180}', 'created_at': datetime.datetime(2025, 5, 24, 20, 40, 21, 487323), 'updated_at': datetime.datetime(2025, 5, 24, 20, 40, 21, 487325)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 20:40:48,249 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 20:40:48,250 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 20:40:48,251 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpsy01_uk3.pdf
2025-05-24 20:40:48,252 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 20:40:48,694 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 20:40:48,695 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 20:40:48,781 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 20:40:48,820 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 20:40:48,821 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 20:40:48,822 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 20:41:03,379 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 20:41:03,380 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 20:41:03,382 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Entry on 1:00 pm",\n      "create_object": false,\n      "object_type": "service",\n      "category": "event",\n      "expiration_info": {\n        "expiration_date": null,\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": ["TDSLVDVJ"],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 pm",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": null,\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": null,\n    "business_phone": null,\n    "business_email": "express@eventeny.com",\n    "business_website": null,\n    "business_hours": null,\n    "business_type": null\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from email confirmation for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 14.507539749145508, 'timestamp': '2025-05-24T20:41:03.377820', 'tokens_used': 3579, 'cost_estimate': 0.023295000000000003}
2025-05-24 20:41:03,400 - routes - INFO - Receipt queued for review: Task ID 1
2025-05-24 20:49:55,066 - routes - ERROR - Error loading approvals queue: approvals_queue.html
2025-05-24 20:49:55,088 - routes - ERROR - Error loading approvals queue: approvals_queue.html
2025-05-24 20:49:55,107 - routes - ERROR - Error loading approvals queue: approvals_queue.html
2025-05-24 20:49:53,544 - routes - ERROR - Error loading approvals queue: approvals_queue.html
2025-05-24 21:06:45,019 - app - INFO - Creating database tables...
2025-05-24 21:06:45,076 - app - INFO - Database tables created successfully
2025-05-24 21:06:45,081 - app - INFO - Creating database tables...
2025-05-24 21:06:45,098 - app - INFO - Database tables created successfully
2025-05-24 21:06:45,142 - app - INFO - Creating database tables...
2025-05-24 21:06:45,160 - app - INFO - Database tables created successfully
2025-05-24 21:06:45,185 - app - INFO - Creating database tables...
2025-05-24 21:06:45,202 - app - INFO - Database tables created successfully
2025-05-24 21:06:45,993 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:06:45,993 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:06:45,999 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:06:46,001 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:08:15,426 - app - INFO - Creating database tables...
2025-05-24 21:08:15,429 - app - INFO - Creating database tables...
2025-05-24 21:08:15,433 - app - INFO - Creating database tables...
2025-05-24 21:08:15,433 - app - INFO - Creating database tables...
2025-05-24 21:08:15,460 - app - INFO - Database tables created successfully
2025-05-24 21:08:15,460 - app - INFO - Database tables created successfully
2025-05-24 21:08:15,460 - app - INFO - Database tables created successfully
2025-05-24 21:08:15,461 - app - INFO - Database tables created successfully
2025-05-24 21:08:16,359 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:08:16,359 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:08:16,359 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:08:16,360 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:08:36,577 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 21:08:36,578 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 21:08:36,579 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpj8g0dxxc.pdf
2025-05-24 21:08:36,580 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 21:08:37,048 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 21:08:37,049 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 21:08:37,129 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 21:08:37,166 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 21:08:37,167 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 21:08:37,168 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 21:08:46,222 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 21:08:46,224 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 21:08:46,225 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "category": "event",\n      "object_type": "service",\n      "confidence": 1.0\n    }\n  ],\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Extracted from an email receipt for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 9.00408148765564, 'timestamp': '2025-05-24T21:08:46.220783', 'tokens_used': 3270, 'cost_estimate': 0.018660000000000003}
2025-05-24 21:08:46,247 - routes - INFO - Receipt queued for review: Task ID 2
2025-05-24 21:11:06,862 - app - INFO - Creating database tables...
2025-05-24 21:11:06,872 - app - INFO - Creating database tables...
2025-05-24 21:11:06,880 - app - INFO - Database tables created successfully
2025-05-24 21:11:06,888 - app - INFO - Database tables created successfully
2025-05-24 21:11:06,950 - app - INFO - Creating database tables...
2025-05-24 21:11:06,968 - app - INFO - Database tables created successfully
2025-05-24 21:11:06,997 - app - INFO - Creating database tables...
2025-05-24 21:11:07,017 - app - INFO - Database tables created successfully
2025-05-24 21:11:07,462 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:11:07,466 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:11:07,567 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:11:07,633 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:11:08,038 - routes - INFO - AI Queue loaded: 2 tasks (0 pending review, 0 failed)
2025-05-24 21:11:11,349 - routes - INFO - AI Queue loaded: 2 tasks (0 pending review, 0 failed)
2025-05-24 21:11:17,610 - routes - INFO - Processing receipt file: RECEIPT PAePay DUI Fine Nate Smith.pdf
2025-05-24 21:11:17,611 - routes - INFO - Processing PDF file: RECEIPT_PAePay_DUI_Fine_Nate_Smith.pdf
2025-05-24 21:11:17,612 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpyen42ez8.pdf
2025-05-24 21:11:17,613 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 21:11:17,695 - ocr_utils - INFO - Successfully converted 1 pages from PDF
2025-05-24 21:11:17,717 - ocr_utils - INFO - Successfully converted PDF (1 pages) to JPEG image using pdf2image
2025-05-24 21:11:17,718 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 21:11:17,719 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 21:11:29,173 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 21:11:29,174 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 21:11:29,176 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "PAePay",\n  "date": "2025-05-20",\n  "total_amount": 267.15,\n  "subtotal": 260.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 7.15,\n  "receipt_number": "01XF693J7H",\n  "payment_method": "unknown",\n  "due_date": "2025-05-24",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Traffic Ticket or Court Costs Payment",\n  "line_items": [\n    {\n      "description": "Payment Plan 67-2018-P000007328",\n      "quantity": 1.0,\n      "unit_price": 260.00,\n      "total_price": 260.00,\n      "item_details": "Next payment amount due: $65.00, Overdue amount: $195.00",\n      "create_object": false,\n      "object_type": "service",\n      "category": "legal",\n      "expiration_info": {\n        "expiration_date": "2025-05-24",\n        "event_date": "2025-05-24",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": ""\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://ujsportal.pacourts.us/PAePayFCR/Receipt?shoppingCartID=814535c8-114d-4020-dad0-08dd94ab10d0"\n    ],\n    "confirmation_codes": [\n      "01XF693J7H"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {},\n  "vendor_details": {},\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt for traffic ticket or court costs payment."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 11.419824838638306, 'timestamp': '2025-05-24T21:11:29.172045', 'tokens_used': 2843, 'cost_estimate': 0.019055}
2025-05-24 21:11:29,192 - routes - INFO - Receipt queued for review: Task ID 3
2025-05-24 21:11:29,199 - routes - INFO - AI Queue loaded: 3 tasks (0 pending review, 0 failed)
2025-05-24 21:11:59,698 - routes - INFO - AI Queue loaded: 3 tasks (0 pending review, 0 failed)
2025-05-24 21:12:30,235 - routes - INFO - AI Queue loaded: 3 tasks (0 pending review, 0 failed)
2025-05-24 21:12:56,887 - routes - INFO - AI Queue loaded: 3 tasks (0 pending review, 0 failed)
2025-05-24 21:12:57,633 - routes - INFO - AI Queue loaded: 3 tasks (0 pending review, 0 failed)
2025-05-24 21:13:14,189 - routes - INFO - Processing receipt file: RECEIPT PAePay DUI Fine Nate Smith.pdf
2025-05-24 21:13:14,190 - routes - INFO - Processing PDF file: RECEIPT_PAePay_DUI_Fine_Nate_Smith.pdf
2025-05-24 21:13:14,191 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpzpwbri0s.pdf
2025-05-24 21:13:14,192 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 21:13:14,269 - ocr_utils - INFO - Successfully converted 1 pages from PDF
2025-05-24 21:13:14,298 - ocr_utils - INFO - Successfully converted PDF (1 pages) to JPEG image using pdf2image
2025-05-24 21:13:14,299 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 21:13:14,300 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 21:13:28,722 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 21:13:28,723 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 21:13:28,725 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "PAePay Traffic Ticket or Court Costs",\n  "date": "2025-05-20",\n  "total_amount": 267.15,\n  "subtotal": 260.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 7.15,\n  "receipt_number": "01XF693J7H",\n  "payment_method": "unknown",\n  "due_date": "2025-05-24",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Payment for traffic ticket or court costs",\n  "line_items": [\n    {\n      "description": "Payment Plan 67-2018-P000007328",\n      "quantity": 1.0,\n      "unit_price": 260.00,\n      "total_price": 260.00,\n      "item_details": "Next payment amount due: $65.00, Overdue amount: $195.00",\n      "create_object": false,\n      "object_type": "service",\n      "category": "legal",\n      "expiration_info": {\n        "expiration_date": "2025-05-24",\n        "event_date": "2025-05-24",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": ""\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://ujsportal.pacourts.us/PAePayFCR/Receipt?shoppingCartID=814535c8-114d-4020-dad0-08dd94ab10d0"\n    ],\n    "confirmation_codes": [\n      "01XF693J7H"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "",\n    "event_date": "",\n    "event_time": "",\n    "venue_location": "",\n    "seat_info": "",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "",\n    "business_phone": "",\n    "business_email": "",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": "government"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt for payment of traffic ticket or court costs."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 14.398568153381348, 'timestamp': '2025-05-24T21:13:28.721878', 'tokens_used': 2929, 'cost_estimate': 0.020345}
2025-05-24 21:13:28,738 - routes - INFO - Receipt queued for review: Task ID 4
2025-05-24 21:13:28,744 - routes - INFO - AI Queue loaded: 4 tasks (0 pending review, 0 failed)
2025-05-24 21:13:59,106 - routes - INFO - AI Queue loaded: 4 tasks (0 pending review, 0 failed)
2025-05-24 21:14:26,757 - routes - INFO - AI Queue loaded: 4 tasks (0 pending review, 0 failed)
2025-05-24 21:14:54,035 - routes - INFO - AI Queue loaded: 4 tasks (0 pending review, 0 failed)
2025-05-24 21:15:27,695 - routes - INFO - AI Queue loaded: 4 tasks (0 pending review, 0 failed)
2025-05-24 21:15:34,841 - app - INFO - Creating database tables...
2025-05-24 21:15:34,859 - app - INFO - Database tables created successfully
2025-05-24 21:15:35,380 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:15:58,076 - routes - INFO - AI Queue loaded: 4 tasks (0 pending review, 0 failed)
2025-05-24 21:15:58,134 - app - INFO - Creating database tables...
2025-05-24 21:15:58,151 - app - INFO - Database tables created successfully
2025-05-24 21:15:58,674 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:16:28,493 - routes - INFO - AI Queue loaded: 4 tasks (0 pending review, 0 failed)
2025-05-24 21:16:31,192 - app - INFO - Creating database tables...
2025-05-24 21:16:31,209 - app - INFO - Database tables created successfully
2025-05-24 21:16:31,730 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:16:58,862 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:17:29,232 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:17:45,338 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:17:52,905 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:18:23,263 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:18:53,791 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:18:57,697 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:18:58,317 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:19:28,666 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:19:24,930 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:19:58,405 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:20:01,579 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:20:02,187 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:20:20,135 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 21:20:20,136 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 21:20:20,139 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpimn7_xbm.pdf
2025-05-24 21:20:20,140 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 21:20:20,577 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 21:20:20,578 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 21:20:20,662 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 21:20:20,699 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 21:20:20,700 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 21:20:20,701 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 21:20:36,107 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 21:20:36,108 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 21:20:36,109 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Great Blue Heron Music Festival 2025 ticket purchase",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Entry on 1:00 pm",\n      "create_object": false,\n      "object_type": "service",\n      "category": "event",\n      "expiration_info": {\n        "expiration_date": "2025-07-06",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": ""\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": ["TDSLVDVJ"],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 pm",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "",\n    "business_phone": "",\n    "business_email": "express@eventeny.com",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": ""\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from email confirmation for event ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 15.370657682418823, 'timestamp': '2025-05-24T21:20:36.105966', 'tokens_used': 3556, 'cost_estimate': 0.02295}
2025-05-24 21:20:36,124 - routes - INFO - Receipt queued for review: Task ID 6
2025-05-24 21:20:36,131 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:21:06,491 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:21:23,336 - app - INFO - Creating database tables...
2025-05-24 21:21:23,354 - app - INFO - Database tables created successfully
2025-05-24 21:21:24,193 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:21:36,861 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:21:54,626 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:22:25,050 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:22:55,506 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:22:59,765 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:23:00,486 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:23:09,300 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:23:39,462 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:23:44,785 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:24:04,850 - app - INFO - Creating database tables...
2025-05-24 21:24:04,858 - app - INFO - Creating database tables...
2025-05-24 21:24:04,868 - app - INFO - Database tables created successfully
2025-05-24 21:24:04,874 - app - INFO - Database tables created successfully
2025-05-24 21:24:04,911 - app - INFO - Creating database tables...
2025-05-24 21:24:04,927 - app - INFO - Database tables created successfully
2025-05-24 21:24:04,944 - app - INFO - Creating database tables...
2025-05-24 21:24:04,962 - app - INFO - Database tables created successfully
2025-05-24 21:24:05,411 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:24:05,420 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:24:05,468 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:24:05,471 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:24:08,539 - routes - INFO - DEBUG: Found 6 total tasks
2025-05-24 21:24:08,540 - routes - INFO - DEBUG: Processing task 6, type=receipt_processing, status=pending
2025-05-24 21:24:08,541 - routes - INFO - DEBUG: Task 6 has AI analysis
2025-05-24 21:24:08,541 - routes - INFO - DEBUG: Added task 6 to receipt_tasks, now has 1 items
2025-05-24 21:24:08,542 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:24:08,543 - routes - INFO - DEBUG: Processing task 4, type=receipt_processing, status=pending
2025-05-24 21:24:08,543 - routes - INFO - DEBUG: Task 4 has AI analysis
2025-05-24 21:24:08,544 - routes - INFO - DEBUG: Added task 4 to receipt_tasks, now has 2 items
2025-05-24 21:24:08,545 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending
2025-05-24 21:24:08,546 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-24 21:24:08,546 - routes - INFO - DEBUG: Added task 3 to receipt_tasks, now has 3 items
2025-05-24 21:24:08,547 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending
2025-05-24 21:24:08,548 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-24 21:24:08,549 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 4 items
2025-05-24 21:24:08,549 - routes - INFO - DEBUG: Processing task 1, type=receipt_processing, status=pending
2025-05-24 21:24:08,550 - routes - INFO - DEBUG: Task 1 has AI analysis
2025-05-24 21:24:08,551 - routes - INFO - DEBUG: Added task 1 to receipt_tasks, now has 5 items
2025-05-24 21:24:08,551 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 5, ai_evaluations: 0
2025-05-24 21:24:08,552 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:24:14,888 - routes - INFO - Receipt task 1 rejected: 
2025-05-24 21:24:14,895 - routes - INFO - DEBUG: Found 5 total tasks
2025-05-24 21:24:14,895 - routes - INFO - DEBUG: Processing task 6, type=receipt_processing, status=pending
2025-05-24 21:24:14,896 - routes - INFO - DEBUG: Task 6 has AI analysis
2025-05-24 21:24:14,897 - routes - INFO - DEBUG: Added task 6 to receipt_tasks, now has 1 items
2025-05-24 21:24:14,898 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:24:14,898 - routes - INFO - DEBUG: Processing task 4, type=receipt_processing, status=pending
2025-05-24 21:24:14,899 - routes - INFO - DEBUG: Task 4 has AI analysis
2025-05-24 21:24:14,900 - routes - INFO - DEBUG: Added task 4 to receipt_tasks, now has 2 items
2025-05-24 21:24:14,901 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending
2025-05-24 21:24:14,902 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-24 21:24:14,902 - routes - INFO - DEBUG: Added task 3 to receipt_tasks, now has 3 items
2025-05-24 21:24:14,903 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending
2025-05-24 21:24:14,904 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-24 21:24:14,904 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 4 items
2025-05-24 21:24:14,905 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 4, ai_evaluations: 0
2025-05-24 21:24:14,906 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:24:20,553 - routes - INFO - Receipt task 2 rejected: 
2025-05-24 21:24:20,560 - routes - INFO - DEBUG: Found 4 total tasks
2025-05-24 21:24:20,561 - routes - INFO - DEBUG: Processing task 6, type=receipt_processing, status=pending
2025-05-24 21:24:20,561 - routes - INFO - DEBUG: Task 6 has AI analysis
2025-05-24 21:24:20,562 - routes - INFO - DEBUG: Added task 6 to receipt_tasks, now has 1 items
2025-05-24 21:24:20,563 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:24:20,563 - routes - INFO - DEBUG: Processing task 4, type=receipt_processing, status=pending
2025-05-24 21:24:20,564 - routes - INFO - DEBUG: Task 4 has AI analysis
2025-05-24 21:24:20,565 - routes - INFO - DEBUG: Added task 4 to receipt_tasks, now has 2 items
2025-05-24 21:24:20,566 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending
2025-05-24 21:24:20,566 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-24 21:24:20,567 - routes - INFO - DEBUG: Added task 3 to receipt_tasks, now has 3 items
2025-05-24 21:24:20,568 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 3, ai_evaluations: 0
2025-05-24 21:24:20,569 - routes - INFO - AI Queue loaded: 4 tasks (1 pending review, 0 failed)
2025-05-24 21:24:23,369 - routes - INFO - Receipt task 3 rejected: 
2025-05-24 21:24:23,375 - routes - INFO - DEBUG: Found 3 total tasks
2025-05-24 21:24:23,376 - routes - INFO - DEBUG: Processing task 6, type=receipt_processing, status=pending
2025-05-24 21:24:23,377 - routes - INFO - DEBUG: Task 6 has AI analysis
2025-05-24 21:24:23,378 - routes - INFO - DEBUG: Added task 6 to receipt_tasks, now has 1 items
2025-05-24 21:24:23,378 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:24:23,379 - routes - INFO - DEBUG: Processing task 4, type=receipt_processing, status=pending
2025-05-24 21:24:23,380 - routes - INFO - DEBUG: Task 4 has AI analysis
2025-05-24 21:24:23,381 - routes - INFO - DEBUG: Added task 4 to receipt_tasks, now has 2 items
2025-05-24 21:24:23,382 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-24 21:24:23,382 - routes - INFO - AI Queue loaded: 3 tasks (1 pending review, 0 failed)
2025-05-24 21:24:32,636 - routes - INFO - Receipt task 4 rejected: 
2025-05-24 21:24:32,641 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:24:32,642 - routes - INFO - DEBUG: Processing task 6, type=receipt_processing, status=pending
2025-05-24 21:24:32,643 - routes - INFO - DEBUG: Task 6 has AI analysis
2025-05-24 21:24:32,645 - routes - INFO - DEBUG: Added task 6 to receipt_tasks, now has 1 items
2025-05-24 21:24:32,645 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:24:32,647 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:24:32,648 - routes - INFO - AI Queue loaded: 2 tasks (1 pending review, 0 failed)
2025-05-24 21:24:35,753 - routes - INFO - Receipt task 6 rejected: 
2025-05-24 21:24:35,758 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 21:24:35,759 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:24:35,760 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 21:24:35,761 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 21:24:44,812 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 21:24:44,813 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 21:24:44,814 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp56dnpk8l.pdf
2025-05-24 21:24:44,815 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 21:24:45,231 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 21:24:45,232 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 21:24:45,316 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 21:24:45,352 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 21:24:45,353 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 21:24:45,354 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 21:25:01,724 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 21:25:01,725 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 21:25:01,726 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Entry on 1:00 pm",\n      "create_object": false,\n      "object_type": "service",\n      "category": "event",\n      "expiration_info": {\n        "expiration_date": "2025-07-06",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": ""\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": ["TDSLVDVJ"],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 pm",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "business_phone": "",\n    "business_email": "express@eventeny.com",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": "event management"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from email confirmation for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 16.32852077484131, 'timestamp': '2025-05-24T21:25:01.722890', 'tokens_used': 3587, 'cost_estimate': 0.023415000000000002}
2025-05-24 21:25:01,737 - routes - INFO - Receipt queued for review: Task ID 7
2025-05-24 21:25:01,745 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:25:01,746 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:25:01,746 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:25:01,747 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:25:01,748 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:25:01,749 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:25:01,750 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:26:18,484 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:26:18,485 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:26:18,486 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:26:18,487 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:26:18,488 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:26:18,489 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:26:18,490 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:26:52,243 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:26:52,244 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:26:52,245 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:26:52,247 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:26:52,247 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:26:52,248 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:26:52,249 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:27:18,719 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:27:18,721 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:27:18,722 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:27:18,723 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:27:18,724 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:27:18,725 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:27:18,726 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:27:53,116 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:27:53,119 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:27:53,121 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:27:53,123 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:27:53,124 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:27:53,125 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:27:53,126 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:27:57,372 - app - INFO - Creating database tables...
2025-05-24 21:27:57,390 - app - INFO - Database tables created successfully
2025-05-24 21:27:58,230 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:28:23,670 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:28:23,671 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:28:23,672 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:28:23,673 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:28:23,674 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:28:23,674 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:28:23,675 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:28:54,039 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:28:54,040 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:28:54,041 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:28:54,043 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:28:54,044 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:28:54,045 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:28:54,046 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:29:24,418 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:29:24,419 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:29:24,420 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:29:24,421 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:29:24,422 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:29:24,423 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:29:24,424 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:29:54,783 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:29:54,784 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:29:54,785 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:29:54,786 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:29:54,788 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:29:54,788 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:29:54,789 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:30:22,444 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:30:22,445 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:30:22,446 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:30:22,447 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:30:22,448 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:30:22,449 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:30:22,449 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:30:52,814 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:30:52,817 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:30:52,818 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:30:52,820 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:30:52,821 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:30:52,822 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:30:52,823 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:31:12,680 - app - INFO - Creating database tables...
2025-05-24 21:31:12,699 - app - INFO - Database tables created successfully
2025-05-24 21:31:12,799 - app - INFO - Creating database tables...
2025-05-24 21:31:12,818 - app - INFO - Database tables created successfully
2025-05-24 21:31:12,839 - app - INFO - Creating database tables...
2025-05-24 21:31:12,857 - app - INFO - Database tables created successfully
2025-05-24 21:31:12,923 - app - INFO - Creating database tables...
2025-05-24 21:31:12,943 - app - INFO - Database tables created successfully
2025-05-24 21:31:13,341 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:31:13,435 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:31:13,477 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:31:13,553 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:31:15,280 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:31:15,281 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:31:15,282 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:31:15,284 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:31:15,285 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:31:15,286 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:31:15,287 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:31:15,288 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:31:25,855 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:31:25,856 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:31:25,857 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:31:25,858 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:31:25,859 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:31:25,860 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:31:25,860 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:31:25,861 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:31:39,252 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:31:39,253 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:31:39,254 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:31:39,255 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:31:39,256 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:31:39,257 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:31:39,258 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:31:39,259 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:32:07,964 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:32:07,965 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:32:07,966 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:32:07,967 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:32:07,968 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:32:07,968 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:32:07,970 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:32:07,970 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:32:39,980 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:32:39,981 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:32:39,981 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:32:39,982 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:32:39,983 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:32:39,984 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:32:39,985 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:32:39,986 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:33:07,633 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:33:07,633 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:33:07,634 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:33:07,635 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:33:07,637 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:33:07,639 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:33:07,640 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:33:07,640 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:33:13,274 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:33:13,275 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:33:13,276 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:33:13,277 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:33:13,278 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:33:13,279 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:33:13,279 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:33:13,280 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:33:43,636 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:33:43,637 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:33:43,638 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:33:43,639 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:33:43,640 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:33:43,641 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:33:43,642 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:33:43,642 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:34:14,009 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:34:14,010 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:34:14,011 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:34:14,012 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:34:14,013 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:34:14,013 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:34:14,014 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:34:14,015 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:34:44,575 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:34:44,576 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:34:44,577 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:34:44,578 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:34:44,579 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:34:44,579 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:34:44,580 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:34:44,581 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:35:08,215 - app - INFO - Creating database tables...
2025-05-24 21:35:08,232 - app - INFO - Database tables created successfully
2025-05-24 21:35:09,081 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:35:14,956 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:35:14,958 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:35:14,959 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:35:14,959 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:35:14,960 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:35:14,961 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:35:14,962 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:35:14,962 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:35:45,334 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:35:45,335 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:35:45,336 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:35:45,337 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:35:45,338 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:35:45,339 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:35:45,339 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:35:45,340 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:36:15,731 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:36:15,732 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:36:15,733 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:36:15,734 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:36:15,735 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:36:15,735 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:36:15,736 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:36:15,737 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:36:46,104 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:36:46,106 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:36:46,107 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:36:46,107 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:36:46,108 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:36:46,109 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:36:46,110 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:36:46,111 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:37:10,597 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:37:10,598 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:37:10,598 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:37:10,599 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:37:10,600 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:37:10,601 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:37:10,602 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:37:10,602 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:37:43,910 - app - INFO - Creating database tables...
2025-05-24 21:37:43,929 - app - INFO - Database tables created successfully
2025-05-24 21:37:43,937 - app - INFO - Creating database tables...
2025-05-24 21:37:43,955 - app - INFO - Database tables created successfully
2025-05-24 21:37:44,021 - app - INFO - Creating database tables...
2025-05-24 21:37:44,038 - app - INFO - Database tables created successfully
2025-05-24 21:37:44,071 - app - INFO - Creating database tables...
2025-05-24 21:37:44,088 - app - INFO - Database tables created successfully
2025-05-24 21:37:44,495 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:37:44,507 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:37:44,508 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:37:44,509 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:37:44,510 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:37:44,511 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:37:44,512 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:37:44,512 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:37:44,513 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:37:44,517 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:37:44,586 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:37:44,639 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:38:14,915 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:38:14,916 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:38:14,917 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:38:14,917 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:38:14,918 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:38:14,919 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:38:14,920 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:38:14,920 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:38:30,939 - routes - INFO - Successfully processed receipt task: Invoice INV-20250524-E365142C, 0 objects created
2025-05-24 21:38:30,952 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 21:38:30,953 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:38:30,954 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 21:38:30,955 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 21:38:39,695 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 21:38:39,696 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:38:39,697 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 21:38:39,697 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 21:46:53,184 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 21:46:53,185 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:46:53,186 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 21:46:53,187 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:04:20,464 - app - INFO - Creating database tables...
2025-05-24 22:04:20,464 - app - INFO - Creating database tables...
2025-05-24 22:04:20,464 - app - INFO - Creating database tables...
2025-05-24 22:04:20,465 - app - INFO - Creating database tables...
2025-05-24 22:04:20,498 - app - INFO - Database tables created successfully
2025-05-24 22:04:20,498 - app - INFO - Database tables created successfully
2025-05-24 22:04:20,498 - app - INFO - Database tables created successfully
2025-05-24 22:04:20,499 - app - INFO - Database tables created successfully
2025-05-24 22:04:21,436 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:04:21,435 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:04:21,435 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:04:21,440 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:04:56,531 - routes - INFO - Processing receipt file: RECEIPT PAePay DUI Fine Nate Smith.pdf
2025-05-24 22:04:56,532 - routes - INFO - Processing PDF file: RECEIPT_PAePay_DUI_Fine_Nate_Smith.pdf
2025-05-24 22:04:56,533 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmptwyx_goh.pdf
2025-05-24 22:04:56,534 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:04:56,664 - ocr_utils - INFO - Successfully converted 1 pages from PDF
2025-05-24 22:04:56,689 - ocr_utils - INFO - Successfully converted PDF (1 pages) to JPEG image using pdf2image
2025-05-24 22:04:56,690 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:04:56,690 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 22:05:08,105 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 22:05:08,107 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 22:05:08,108 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "PAePay",\n  "date": "2025-05-20",\n  "total_amount": 267.15,\n  "subtotal": 260.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 7.15,\n  "receipt_number": "01XF693J7H",\n  "payment_method": "",\n  "due_date": "2025-05-24",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Traffic Ticket or Court Costs Payment",\n  "line_items": [\n    {\n      "description": "Payment Plan 67-2018-P000007328",\n      "quantity": 1.0,\n      "unit_price": 260.00,\n      "total_price": 260.00,\n      "item_details": "Next payment amount due: $65.00, Overdue amount: $195.00",\n      "create_object": false,\n      "object_type": "service",\n      "category": "legal",\n      "expiration_info": {\n        "expiration_date": "",\n        "event_date": "",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": ""\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://ujsportal.pacourts.us/PAePayFCR/Receipt?shoppingCartID=814535c8-114d-4020-dad0-08dd94ab10d0"\n    ],\n    "confirmation_codes": [],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "",\n    "event_date": "",\n    "event_time": "",\n    "venue_location": "",\n    "seat_info": "",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "",\n    "business_phone": "",\n    "business_email": "",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": ""\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt for traffic ticket or court costs payment."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 11.379912853240967, 'timestamp': '2025-05-24T22:05:08.104457', 'tokens_used': 2893, 'cost_estimate': 0.019805}
2025-05-24 22:05:08,130 - routes - INFO - Receipt queued for review: Task ID 8
2025-05-24 22:05:08,139 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:05:08,140 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-24 22:05:08,141 - routes - INFO - DEBUG: Task 8 extracted receipt data: vendor=PAePay, total=$267.15
2025-05-24 22:05:08,141 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-24 22:05:08,143 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 1 items
2025-05-24 22:05:08,143 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:05:08,144 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:05:08,145 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:05:38,538 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:05:38,539 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-24 22:05:38,540 - routes - INFO - DEBUG: Task 8 extracted receipt data: vendor=PAePay, total=$267.15
2025-05-24 22:05:38,541 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-24 22:05:38,542 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 1 items
2025-05-24 22:05:38,543 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:05:38,543 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:05:38,544 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:05:58,950 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 22:05:58,951 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 22:05:58,953 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpqgybvete.pdf
2025-05-24 22:05:58,953 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:05:59,386 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 22:05:59,387 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 22:05:59,473 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 22:05:59,512 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 22:05:59,514 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:05:59,514 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 22:06:17,601 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 22:06:17,602 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 22:06:17,604 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Entry on 1:00 pm",\n      "create_object": false,\n      "object_type": "service",\n      "category": "event",\n      "expiration_info": {\n        "expiration_date": "2025-07-06",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": ""\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": ["TDSLVDVJ"],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 pm",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "",\n    "business_phone": "",\n    "business_email": "express@eventeny.com",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": ""\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from an email confirmation for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 18.052536249160767, 'timestamp': '2025-05-24T22:06:17.600250', 'tokens_used': 3579, 'cost_estimate': 0.023295000000000003}
2025-05-24 22:06:17,615 - routes - WARNING - Potential duplicate receipt detected: Eventeny on 2025-03-17 for $257.61
2025-05-24 22:06:17,620 - routes - INFO - Receipt queued for review: Task ID 9
2025-05-24 22:06:17,627 - routes - INFO - DEBUG: Found 3 total tasks
2025-05-24 22:06:17,628 - routes - INFO - DEBUG: Processing task 9, type=receipt_processing, status=pending_review
2025-05-24 22:06:17,629 - routes - INFO - DEBUG: Task 9 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:06:17,629 - routes - INFO - DEBUG: Task 9 has AI analysis
2025-05-24 22:06:17,630 - routes - INFO - DEBUG: Added task 9 to receipt_tasks, now has 1 items
2025-05-24 22:06:17,631 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-24 22:06:17,632 - routes - INFO - DEBUG: Task 8 extracted receipt data: vendor=PAePay, total=$267.15
2025-05-24 22:06:17,632 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-24 22:06:17,633 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 2 items
2025-05-24 22:06:17,634 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:06:17,635 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-24 22:06:17,635 - routes - INFO - AI Queue loaded: 3 tasks (3 pending review, 0 failed)
2025-05-24 22:06:47,987 - routes - INFO - DEBUG: Found 3 total tasks
2025-05-24 22:06:47,988 - routes - INFO - DEBUG: Processing task 9, type=receipt_processing, status=pending_review
2025-05-24 22:06:47,989 - routes - INFO - DEBUG: Task 9 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:06:47,990 - routes - INFO - DEBUG: Task 9 has AI analysis
2025-05-24 22:06:47,991 - routes - INFO - DEBUG: Added task 9 to receipt_tasks, now has 1 items
2025-05-24 22:06:47,991 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-24 22:06:47,992 - routes - INFO - DEBUG: Task 8 extracted receipt data: vendor=PAePay, total=$267.15
2025-05-24 22:06:47,993 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-24 22:06:47,994 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 2 items
2025-05-24 22:06:47,995 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:06:47,996 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-24 22:06:47,996 - routes - INFO - AI Queue loaded: 3 tasks (3 pending review, 0 failed)
2025-05-24 22:07:03,983 - routes - INFO - Receipt task 8 rejected: 
2025-05-24 22:07:03,990 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:07:03,991 - routes - INFO - DEBUG: Processing task 9, type=receipt_processing, status=pending_review
2025-05-24 22:07:03,992 - routes - INFO - DEBUG: Task 9 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:07:03,993 - routes - INFO - DEBUG: Task 9 has AI analysis
2025-05-24 22:07:03,994 - routes - INFO - DEBUG: Added task 9 to receipt_tasks, now has 1 items
2025-05-24 22:07:03,994 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:07:03,995 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:07:03,996 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:07:10,859 - routes - ERROR - Error creating calendar event from task: 'event_date' is an invalid keyword argument for CalendarEvent
2025-05-24 22:07:16,482 - routes - INFO - Receipt task 9 rejected: 
2025-05-24 22:07:16,487 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:07:16,488 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:07:16,489 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:07:16,490 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:09:14,863 - app - INFO - Creating database tables...
2025-05-24 22:09:14,864 - app - INFO - Creating database tables...
2025-05-24 22:09:14,868 - app - INFO - Creating database tables...
2025-05-24 22:09:14,888 - app - INFO - Creating database tables...
2025-05-24 22:09:14,899 - app - INFO - Database tables created successfully
2025-05-24 22:09:14,899 - app - INFO - Database tables created successfully
2025-05-24 22:09:14,899 - app - INFO - Database tables created successfully
2025-05-24 22:09:14,906 - app - INFO - Database tables created successfully
2025-05-24 22:09:15,832 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:09:15,833 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:09:15,833 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:09:15,835 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:12:26,600 - app - INFO - Creating database tables...
2025-05-24 22:12:26,601 - app - INFO - Creating database tables...
2025-05-24 22:12:26,601 - app - INFO - Creating database tables...
2025-05-24 22:12:26,601 - app - INFO - Creating database tables...
2025-05-24 22:12:26,639 - app - INFO - Database tables created successfully
2025-05-24 22:12:26,639 - app - INFO - Database tables created successfully
2025-05-24 22:12:26,639 - app - INFO - Database tables created successfully
2025-05-24 22:12:26,639 - app - INFO - Database tables created successfully
2025-05-24 22:12:27,580 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:12:27,580 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:12:27,580 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:12:27,581 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:12:38,922 - routes - INFO - Created service object 'Weekend Pass Thursday Entry' from receipt INV-20250524-E365142C
2025-05-24 22:12:58,670 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 22:12:58,671 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 22:12:58,672 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpjgq16jo2.pdf
2025-05-24 22:12:58,673 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:12:59,130 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 22:12:59,131 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 22:12:59,218 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 22:12:59,256 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 22:12:59,257 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:12:59,258 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 22:13:05,489 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 22:13:05,490 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 22:13:05,492 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "category": "event",\n      "object_type": "service",\n      "confidence": 0.95\n    }\n  ],\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from an email confirmation for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 6.184553384780884, 'timestamp': '2025-05-24T22:13:05.488083', 'tokens_used': 3269, 'cost_estimate': 0.018645000000000002}
2025-05-24 22:13:05,502 - routes - WARNING - Potential duplicate receipt detected: Eventeny on 2025-03-17 for $257.61
2025-05-24 22:13:05,513 - routes - INFO - Receipt queued for review: Task ID 41
2025-05-24 22:13:05,521 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:13:05,522 - routes - INFO - DEBUG: Processing task 41, type=receipt_processing, status=pending_review
2025-05-24 22:13:05,523 - routes - INFO - DEBUG: Task 41 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:13:05,523 - routes - INFO - DEBUG: Task 41 has AI analysis
2025-05-24 22:13:05,524 - routes - INFO - DEBUG: Added task 41 to receipt_tasks, now has 1 items
2025-05-24 22:13:05,525 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:13:05,526 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:13:05,526 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:13:39,180 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:13:39,183 - routes - INFO - DEBUG: Processing task 41, type=receipt_processing, status=pending_review
2025-05-24 22:13:39,184 - routes - INFO - DEBUG: Task 41 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:13:39,185 - routes - INFO - DEBUG: Task 41 has AI analysis
2025-05-24 22:13:39,185 - routes - INFO - DEBUG: Added task 41 to receipt_tasks, now has 1 items
2025-05-24 22:13:39,186 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:13:39,187 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:13:39,187 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:15:30,482 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 22:15:30,483 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 22:15:30,486 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp2ab__2np.pdf
2025-05-24 22:15:30,487 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:15:30,943 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 22:15:30,945 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 22:15:31,025 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 22:15:31,065 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 22:15:31,067 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:15:31,068 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-24 22:15:32,253 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 500 Internal Server Error"
2025-05-24 22:15:32,254 - mcp_client - ERROR - Receipt analysis failed: Server error '500 Internal Server Error' for url 'http://mcp-server:8080/ai/process'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500
2025-05-24 22:15:32,255 - routes - ERROR - MCP server analysis failed: Server error '500 Internal Server Error' for url 'http://mcp-server:8080/ai/process'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500
2025-05-24 22:15:32,275 - routes - INFO - DEBUG: Found 3 total tasks
2025-05-24 22:15:32,276 - routes - INFO - DEBUG: Processing task 42, type=receipt_processing, status=ai_analysis_failed
2025-05-24 22:15:32,277 - routes - INFO - DEBUG: Task 42 has no AI analysis
2025-05-24 22:15:32,278 - routes - INFO - DEBUG: Added task 42 to receipt_tasks, now has 1 items
2025-05-24 22:15:32,278 - routes - INFO - DEBUG: Processing task 41, type=receipt_processing, status=pending_review
2025-05-24 22:15:32,279 - routes - INFO - DEBUG: Task 41 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:15:32,280 - routes - INFO - DEBUG: Task 41 has AI analysis
2025-05-24 22:15:32,280 - routes - INFO - DEBUG: Added task 41 to receipt_tasks, now has 2 items
2025-05-24 22:15:32,281 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:15:32,282 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-24 22:15:32,283 - routes - INFO - AI Queue loaded: 3 tasks (2 pending review, 1 failed)
2025-05-24 22:15:42,673 - routes - INFO - Receipt task 42 rejected: 
2025-05-24 22:15:42,679 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:15:42,680 - routes - INFO - DEBUG: Processing task 41, type=receipt_processing, status=pending_review
2025-05-24 22:15:42,681 - routes - INFO - DEBUG: Task 41 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:15:42,681 - routes - INFO - DEBUG: Task 41 has AI analysis
2025-05-24 22:15:42,682 - routes - INFO - DEBUG: Added task 41 to receipt_tasks, now has 1 items
2025-05-24 22:15:42,683 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:15:42,684 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:15:42,685 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:15:45,960 - routes - INFO - Receipt task 41 rejected: 
2025-05-24 22:15:45,966 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:15:45,967 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:15:45,967 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:15:45,968 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:15:51,235 - routes - INFO - Deleting receipt INV-20250524-E365142C: 1 line items, 1 objects, 0 attachments. Delete objects: True. Reason: 
2025-05-24 22:15:51,243 - routes - INFO - Deleted object: Weekend Pass Thursday Entry (ID: 1)
2025-05-24 22:15:51,270 - routes - ERROR - Error deleting receipt: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "vendor": "Eventeny", "is_paid": true, "subtotal": 215.0, "tax_amount": 0.0, "description": "Ticket purchase fo ... (143 characters truncated) ... ence": null, "payment_method": "Not specified", "receipt_number": "TDSLVDVJ", "original_filename": "RECEIPT Blue Heron Music Festival July 2025.pdf"}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.AmbiguousFunction: operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1120, in delete_receipt
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 442, in execute
    postsort_actions = self._generate_actions()
                       ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 400, in _generate_actions
    if action.execute(self):
       ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 540, in execute
    self.dependency_processor.prop_has_changes(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/dependency.py", line 254, in prop_has_changes
    history = uowcommit.get_attribute_history(s, self.key, passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 283, in get_attribute_history
    history = impl.get_history(
              ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1366, in get_history
    current = self.get(state, dict_, passive=passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "vendor": "Eventeny", "is_paid": true, "subtotal": 215.0, "tax_amount": 0.0, "description": "Ticket purchase fo ... (143 characters truncated) ... ence": null, "payment_method": "Not specified", "receipt_number": "TDSLVDVJ", "original_filename": "RECEIPT Blue Heron Music Festival July 2025.pdf"}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 22:15:51,855 - routes - INFO - Deleting receipt INV-20250524-E365142C: 1 line items, 1 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-24 22:15:51,862 - routes - ERROR - Error deleting receipt: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "vendor": "Eventeny", "is_paid": true, "subtotal": 215.0, "tax_amount": 0.0, "description": "Ticket purchase fo ... (143 characters truncated) ... ence": null, "payment_method": "Not specified", "receipt_number": "TDSLVDVJ", "original_filename": "RECEIPT Blue Heron Music Festival July 2025.pdf"}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.AmbiguousFunction: operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1120, in delete_receipt
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 442, in execute
    postsort_actions = self._generate_actions()
                       ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 400, in _generate_actions
    if action.execute(self):
       ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 540, in execute
    self.dependency_processor.prop_has_changes(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/dependency.py", line 254, in prop_has_changes
    history = uowcommit.get_attribute_history(s, self.key, passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 283, in get_attribute_history
    history = impl.get_history(
              ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1366, in get_history
    current = self.get(state, dict_, passive=passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "vendor": "Eventeny", "is_paid": true, "subtotal": 215.0, "tax_amount": 0.0, "description": "Ticket purchase fo ... (143 characters truncated) ... ence": null, "payment_method": "Not specified", "receipt_number": "TDSLVDVJ", "original_filename": "RECEIPT Blue Heron Music Festival July 2025.pdf"}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 22:16:49,724 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 22:16:49,725 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 22:16:49,726 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpm0tz_bu6.pdf
2025-05-24 22:16:49,727 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:16:50,125 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 22:16:50,126 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 22:16:50,200 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 22:16:50,236 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 22:16:50,238 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:16:50,239 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 22:16:58,915 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 22:16:58,916 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 22:16:58,917 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "category": "event",\n      "object_type": "service",\n      "confidence": 0.95\n    }\n  ],\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from an email confirmation for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 8.643802881240845, 'timestamp': '2025-05-24T22:16:58.914210', 'tokens_used': 3270, 'cost_estimate': 0.018660000000000003}
2025-05-24 22:16:58,921 - routes - WARNING - Potential duplicate receipt detected: Eventeny on 2025-03-17 for $257.61
2025-05-24 22:16:58,927 - routes - INFO - Receipt queued for review: Task ID 43
2025-05-24 22:16:58,934 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:16:58,935 - routes - INFO - DEBUG: Processing task 43, type=receipt_processing, status=pending_review
2025-05-24 22:16:58,936 - routes - INFO - DEBUG: Task 43 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:16:58,936 - routes - INFO - DEBUG: Task 43 has AI analysis
2025-05-24 22:16:58,937 - routes - INFO - DEBUG: Added task 43 to receipt_tasks, now has 1 items
2025-05-24 22:16:58,938 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:16:58,939 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:16:58,940 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:17:30,273 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:17:30,274 - routes - INFO - DEBUG: Processing task 43, type=receipt_processing, status=pending_review
2025-05-24 22:17:30,275 - routes - INFO - DEBUG: Task 43 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:17:30,276 - routes - INFO - DEBUG: Task 43 has AI analysis
2025-05-24 22:17:30,277 - routes - INFO - DEBUG: Added task 43 to receipt_tasks, now has 1 items
2025-05-24 22:17:30,278 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:17:30,278 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:17:30,279 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:18:09,938 - app - INFO - Creating database tables...
2025-05-24 22:18:09,939 - app - INFO - Creating database tables...
2025-05-24 22:18:09,940 - app - INFO - Creating database tables...
2025-05-24 22:18:09,942 - app - INFO - Creating database tables...
2025-05-24 22:18:09,976 - app - INFO - Database tables created successfully
2025-05-24 22:18:09,976 - app - INFO - Database tables created successfully
2025-05-24 22:18:09,976 - app - INFO - Database tables created successfully
2025-05-24 22:18:09,976 - app - INFO - Database tables created successfully
2025-05-24 22:18:08,289 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:18:08,289 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:18:08,289 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:18:08,293 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:21:09,138 - routes - INFO - Deleting receipt INV-20250524-E365142C: 1 line items, 1 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-24 22:21:09,147 - routes - ERROR - Error deleting receipt: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "vendor": "Eventeny", "is_paid": true, "subtotal": 215.0, "tax_amount": 0.0, "description": "Ticket purchase fo ... (143 characters truncated) ... ence": null, "payment_method": "Not specified", "receipt_number": "TDSLVDVJ", "original_filename": "RECEIPT Blue Heron Music Festival July 2025.pdf"}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.AmbiguousFunction: operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1131, in delete_receipt
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 442, in execute
    postsort_actions = self._generate_actions()
                       ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 400, in _generate_actions
    if action.execute(self):
       ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 540, in execute
    self.dependency_processor.prop_has_changes(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/dependency.py", line 254, in prop_has_changes
    history = uowcommit.get_attribute_history(s, self.key, passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 283, in get_attribute_history
    history = impl.get_history(
              ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1366, in get_history
    current = self.get(state, dict_, passive=passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "vendor": "Eventeny", "is_paid": true, "subtotal": 215.0, "tax_amount": 0.0, "description": "Ticket purchase fo ... (143 characters truncated) ... ence": null, "payment_method": "Not specified", "receipt_number": "TDSLVDVJ", "original_filename": "RECEIPT Blue Heron Music Festival July 2025.pdf"}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 22:24:13,731 - app - INFO - Creating database tables...
2025-05-24 22:24:13,747 - app - INFO - Creating database tables...
2025-05-24 22:24:13,766 - app - INFO - Database tables created successfully
2025-05-24 22:24:13,766 - app - INFO - Database tables created successfully
2025-05-24 22:24:13,775 - app - INFO - Creating database tables...
2025-05-24 22:24:13,792 - app - INFO - Database tables created successfully
2025-05-24 22:24:13,846 - app - INFO - Creating database tables...
2025-05-24 22:24:13,865 - app - INFO - Database tables created successfully
2025-05-24 22:24:14,751 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:24:14,752 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:24:14,752 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:24:14,756 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:25:25,947 - app - INFO - Creating database tables...
2025-05-24 22:25:25,948 - app - INFO - Creating database tables...
2025-05-24 22:25:25,953 - app - INFO - Creating database tables...
2025-05-24 22:25:25,954 - app - INFO - Creating database tables...
2025-05-24 22:25:25,995 - app - INFO - Database tables created successfully
2025-05-24 22:25:25,995 - app - INFO - Database tables created successfully
2025-05-24 22:25:25,995 - app - INFO - Database tables created successfully
2025-05-24 22:25:25,995 - app - INFO - Database tables created successfully
2025-05-24 22:25:26,944 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:25:26,944 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:25:26,944 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:25:26,947 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:25:35,585 - routes - INFO - Deleting receipt INV-20250524-E365142C: 1 line items, 1 objects, 0 attachments. Delete objects: True. Reason: 
2025-05-24 22:25:35,594 - routes - INFO - Deleted object: Weekend Pass Thursday Entry (ID: 1)
2025-05-24 22:25:35,610 - routes - ERROR - Error deleting receipt: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(psycopg2.errors.UndefinedColumn) column calendar_events.event_date does not exist
LINE 1: ..._events.event_type AS calendar_events_event_type, calendar_e...
                                                             ^
HINT:  Perhaps you meant to reference the column "calendar_events.event_type".

[SQL: SELECT calendar_events.id AS calendar_events_id, calendar_events.title AS calendar_events_title, calendar_events.description AS calendar_events_description, calendar_events.event_type AS calendar_events_event_type, calendar_events.event_date AS calendar_events_event_date, calendar_events.end_time AS calendar_events_end_time, calendar_events.location AS calendar_events_location, calendar_events.object_id AS calendar_events_object_id, calendar_events.organization_id AS calendar_events_organization_id, calendar_events.user_id AS calendar_events_user_id, calendar_events.event_metadata AS calendar_events_event_metadata, calendar_events.created_at AS calendar_events_created_at, calendar_events.updated_at AS calendar_events_updated_at, calendar_events.is_completed AS calendar_events_is_completed 
FROM calendar_events 
WHERE %(param_1)s = calendar_events.object_id]
[parameters: {'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column calendar_events.event_date does not exist
LINE 1: ..._events.event_type AS calendar_events_event_type, calendar_e...
                                                             ^
HINT:  Perhaps you meant to reference the column "calendar_events.event_type".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1130, in delete_receipt
    db.session.delete(receipt)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 673, in delete
    return self._proxied.delete(instance)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 3498, in delete
    self._delete_impl(state, instance, head=True)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 3525, in _delete_impl
    cascade_states = list(
                     ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/mapper.py", line 3964, in cascade_iterator
    queue = deque(
            ^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/relationships.py", line 1505, in cascade_iterator
    tuples = self._value_as_iterable(
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/relationships.py", line 1475, in _value_as_iterable
    x = impl.get(state, dict_, passive=passive)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2169, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 551, in orm_pre_session_exec
    session._autoflush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 3021, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 3010, in _autoflush
    self.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 442, in execute
    postsort_actions = self._generate_actions()
                       ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 400, in _generate_actions
    if action.execute(self):
       ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 532, in execute
    self.dependency_processor.presort_deletes(uow, delete_states)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/dependency.py", line 448, in presort_deletes
    history = uowcommit.get_attribute_history(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 283, in get_attribute_history
    history = impl.get_history(
              ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1683, in get_history
    current = self.get(state, dict_, passive=passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(psycopg2.errors.UndefinedColumn) column calendar_events.event_date does not exist
LINE 1: ..._events.event_type AS calendar_events_event_type, calendar_e...
                                                             ^
HINT:  Perhaps you meant to reference the column "calendar_events.event_type".

[SQL: SELECT calendar_events.id AS calendar_events_id, calendar_events.title AS calendar_events_title, calendar_events.description AS calendar_events_description, calendar_events.event_type AS calendar_events_event_type, calendar_events.event_date AS calendar_events_event_date, calendar_events.end_time AS calendar_events_end_time, calendar_events.location AS calendar_events_location, calendar_events.object_id AS calendar_events_object_id, calendar_events.organization_id AS calendar_events_organization_id, calendar_events.user_id AS calendar_events_user_id, calendar_events.event_metadata AS calendar_events_event_metadata, calendar_events.created_at AS calendar_events_created_at, calendar_events.updated_at AS calendar_events_updated_at, calendar_events.is_completed AS calendar_events_is_completed 
FROM calendar_events 
WHERE %(param_1)s = calendar_events.object_id]
[parameters: {'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 22:25:40,715 - routes - INFO - Deleting receipt INV-20250524-E365142C: 1 line items, 1 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-24 22:25:40,730 - routes - ERROR - Error deleting receipt: (psycopg2.errors.ForeignKeyViolation) update or delete on table "invoices" violates foreign key constraint "objects_invoice_id_fkey" on table "objects"
DETAIL:  Key (id)=(1) is still referenced from table "objects".

[SQL: DELETE FROM invoices WHERE invoices.id = %(id)s]
[parameters: {'id': 1}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.ForeignKeyViolation: update or delete on table "invoices" violates foreign key constraint "objects_invoice_id_fkey" on table "objects"
DETAIL:  Key (id)=(1) is still referenced from table "objects".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1131, in delete_receipt
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 679, in execute
    util.preloaded.orm_persistence.delete_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 191, in delete_obj
    _emit_delete_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1456, in _emit_delete_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.ForeignKeyViolation) update or delete on table "invoices" violates foreign key constraint "objects_invoice_id_fkey" on table "objects"
DETAIL:  Key (id)=(1) is still referenced from table "objects".

[SQL: DELETE FROM invoices WHERE invoices.id = %(id)s]
[parameters: {'id': 1}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 22:27:17,348 - app - INFO - Creating database tables...
2025-05-24 22:27:17,366 - app - INFO - Database tables created successfully
2025-05-24 22:27:17,407 - app - INFO - Creating database tables...
2025-05-24 22:27:17,409 - app - INFO - Creating database tables...
2025-05-24 22:27:17,419 - app - INFO - Creating database tables...
2025-05-24 22:27:17,426 - app - INFO - Database tables created successfully
2025-05-24 22:27:17,426 - app - INFO - Database tables created successfully
2025-05-24 22:27:17,435 - app - INFO - Database tables created successfully
2025-05-24 22:27:17,915 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:27:17,971 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:27:17,976 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:27:17,985 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:27:24,551 - routes - INFO - Deleting receipt INV-20250524-E365142C: 1 line items, 1 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-24 22:27:24,552 - routes - INFO - Unlinked object: Weekend Pass Thursday Entry (ID: 1) from receipt
2025-05-24 22:27:40,104 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 22:27:40,105 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 22:27:40,106 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp8xn1jm33.pdf
2025-05-24 22:27:40,107 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:27:40,571 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 22:27:40,572 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 22:27:40,652 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 22:27:40,695 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 22:27:40,696 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:27:40,697 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 22:27:53,713 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 22:27:53,714 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 22:27:53,716 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Great Blue Heron Music Festival 2025 Ticket Purchase",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "category": "event",\n      "object_type": "service",\n      "confidence": 0.95\n    }\n  ],\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from an email confirmation for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 12.970839500427246, 'timestamp': '2025-05-24T22:27:53.712366', 'tokens_used': 3269, 'cost_estimate': 0.018645000000000002}
2025-05-24 22:27:53,740 - routes - INFO - Receipt queued for review: Task ID 44
2025-05-24 22:27:53,748 - routes - INFO - DEBUG: Found 3 total tasks
2025-05-24 22:27:53,749 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:27:53,750 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:27:53,750 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:27:53,751 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:27:53,752 - routes - INFO - DEBUG: Processing task 43, type=receipt_processing, status=pending_review
2025-05-24 22:27:53,753 - routes - INFO - DEBUG: Task 43 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:27:53,753 - routes - INFO - DEBUG: Task 43 has AI analysis
2025-05-24 22:27:53,754 - routes - INFO - DEBUG: Added task 43 to receipt_tasks, now has 2 items
2025-05-24 22:27:53,755 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:27:53,756 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-24 22:27:53,757 - routes - INFO - AI Queue loaded: 3 tasks (3 pending review, 0 failed)
2025-05-24 22:28:03,694 - routes - INFO - Receipt task 43 rejected: 
2025-05-24 22:28:03,702 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:28:03,703 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:28:03,705 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:28:03,706 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:28:03,708 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:28:03,709 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:28:03,710 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:28:03,711 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:28:34,537 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:28:34,538 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:28:34,538 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:28:34,539 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:28:34,540 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:28:34,541 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:28:34,542 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:28:34,543 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:29:04,560 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:29:04,560 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:29:04,562 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:29:04,562 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:29:04,564 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:29:04,564 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:29:04,565 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:29:04,566 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:29:32,712 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:29:32,713 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:29:32,714 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:29:32,715 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:29:32,716 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:29:32,717 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:29:32,718 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:29:32,719 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:30:03,092 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:30:03,092 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:30:03,093 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:30:03,095 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:30:03,095 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:30:03,096 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:30:03,097 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:30:03,098 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:30:33,447 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:30:33,449 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:30:33,450 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:30:33,451 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:30:33,452 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:30:33,453 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:30:33,454 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:30:33,456 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:31:03,826 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:31:03,827 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:31:03,828 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:31:03,829 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:31:03,830 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:31:03,830 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:31:03,831 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:31:03,832 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:31:34,233 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:31:34,234 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:31:34,235 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:31:34,236 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:31:34,237 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:31:34,238 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:31:34,239 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:31:34,240 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:31:39,284 - routes - INFO - Receipt task 44 rejected: 
2025-05-24 22:31:39,290 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:31:39,291 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:31:39,291 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:31:39,292 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:32:09,778 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:32:09,779 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:32:09,780 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:32:09,780 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:32:45,909 - app - INFO - Creating database tables...
2025-05-24 22:32:45,928 - app - INFO - Database tables created successfully
2025-05-24 22:32:46,012 - app - INFO - Creating database tables...
2025-05-24 22:32:46,031 - app - INFO - Database tables created successfully
2025-05-24 22:32:46,044 - app - INFO - Creating database tables...
2025-05-24 22:32:46,065 - app - INFO - Database tables created successfully
2025-05-24 22:32:46,081 - app - INFO - Creating database tables...
2025-05-24 22:32:46,099 - app - INFO - Database tables created successfully
2025-05-24 22:32:46,500 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:32:46,600 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:32:46,631 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:32:46,648 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:32:47,457 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:32:47,458 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:32:47,459 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:32:47,460 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:33:18,400 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:33:18,401 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:33:18,402 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:33:18,403 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:33:42,660 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 22:33:42,661 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 22:33:42,663 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpq0wgf4ea.pdf
2025-05-24 22:33:42,664 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:33:43,086 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 22:33:43,087 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 22:33:43,170 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 22:33:43,210 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 22:33:43,211 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:33:43,212 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 22:34:03,384 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 22:34:03,385 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 22:34:03,387 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Entry on 1:00 pm",\n      "create_object": false,\n      "object_type": "service",\n      "category": "event",\n      "expiration_info": {\n        "expiration_date": null,\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": null,\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": null,\n    "business_phone": null,\n    "business_email": "express@eventeny.com",\n    "business_website": "https://eventeny.com",\n    "business_hours": null,\n    "business_type": "event management"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from email confirmation for event ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 20.123992443084717, 'timestamp': '2025-05-24T22:34:03.383043', 'tokens_used': 3595, 'cost_estimate': 0.023535}
2025-05-24 22:34:03,400 - routes - INFO - Receipt queued for review: Task ID 45
2025-05-24 22:34:03,407 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:34:03,408 - routes - INFO - DEBUG: Processing task 45, type=receipt_processing, status=pending_review
2025-05-24 22:34:03,409 - routes - INFO - DEBUG: Task 45 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:34:03,410 - routes - INFO - Task 45 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '13:00', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': None, 'additional_details': {}}
2025-05-24 22:34:03,410 - routes - INFO - DEBUG: Task 45 has AI analysis
2025-05-24 22:34:03,411 - routes - INFO - DEBUG: Added task 45 to receipt_tasks, now has 1 items
2025-05-24 22:34:03,412 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:34:03,413 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:34:03,414 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:34:31,102 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:34:31,103 - routes - INFO - DEBUG: Processing task 45, type=receipt_processing, status=pending_review
2025-05-24 22:34:31,104 - routes - INFO - DEBUG: Task 45 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:34:31,105 - routes - INFO - Task 45 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '13:00', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': None, 'additional_details': {}}
2025-05-24 22:34:31,106 - routes - INFO - DEBUG: Task 45 has AI analysis
2025-05-24 22:34:31,106 - routes - INFO - DEBUG: Added task 45 to receipt_tasks, now has 1 items
2025-05-24 22:34:31,107 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:34:31,108 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:34:31,109 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:34:48,652 - routes - INFO - Receipt task 45 rejected: 
2025-05-24 22:34:48,659 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:34:48,660 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:34:48,661 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:34:48,662 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:35:19,161 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:35:19,162 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:35:19,163 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:35:19,164 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:35:49,571 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:35:49,572 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:35:49,572 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:35:49,573 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:36:19,930 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:36:19,931 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:36:19,932 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:36:19,933 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:36:47,591 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:36:47,593 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:36:47,594 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:36:47,595 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:37:17,952 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:37:17,953 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:37:17,954 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:37:17,955 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:37:48,281 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:37:48,282 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:37:48,283 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:37:48,284 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:38:18,404 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:38:18,405 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:38:18,406 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:38:18,407 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:38:49,180 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:38:49,181 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:38:49,182 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:38:49,183 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:39:17,870 - app - INFO - Creating database tables...
2025-05-24 22:39:17,870 - app - INFO - Creating database tables...
2025-05-24 22:39:17,889 - app - INFO - Database tables created successfully
2025-05-24 22:39:17,889 - app - INFO - Database tables created successfully
2025-05-24 22:39:17,917 - app - INFO - Creating database tables...
2025-05-24 22:39:17,935 - app - INFO - Database tables created successfully
2025-05-24 22:39:18,023 - app - INFO - Creating database tables...
2025-05-24 22:39:18,043 - app - INFO - Database tables created successfully
2025-05-24 22:39:18,967 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:39:18,967 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:39:18,974 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:39:18,982 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:39:32,043 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 22:39:32,044 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 22:39:32,045 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp5ea5iyi1.pdf
2025-05-24 22:39:32,046 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:39:32,500 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 22:39:32,501 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 22:39:32,579 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 22:39:32,614 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 22:39:32,616 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:39:32,617 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 22:39:38,129 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 22:39:38,131 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 22:39:38,132 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Great Blue Heron Music Festival 2025 Ticket Purchase",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "category": "event",\n      "object_type": "service",\n      "confidence": 0.95\n    }\n  ],\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "The receipt is for a music festival ticket purchase with no taxes applied."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 5.467743158340454, 'timestamp': '2025-05-24T22:39:38.128705', 'tokens_used': 3270, 'cost_estimate': 0.018660000000000003}
2025-05-24 22:39:38,158 - routes - INFO - Receipt queued for review: Task ID 46
2025-05-24 22:39:38,167 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:39:38,168 - routes - INFO - DEBUG: Processing task 46, type=receipt_processing, status=pending_review
2025-05-24 22:39:38,169 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-24 22:39:38,170 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-24 22:39:38,170 - routes - INFO - Task 46 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-24 22:39:38,171 - routes - INFO - DEBUG: Task 46 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:39:38,172 - routes - INFO - Task 46 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-03-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket purchase', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 215.0, 'total_price': 215.0, 'category': 'event_ticket', 'object_type': 'consumable', 'confidence': 0.95, 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-03-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-24 22:39:38,173 - routes - INFO - DEBUG: Task 46 has AI analysis
2025-05-24 22:39:38,173 - routes - INFO - DEBUG: Added task 46 to receipt_tasks, now has 1 items
2025-05-24 22:39:38,174 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:39:38,175 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:39:38,175 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:39:58,836 - routes - ERROR - Error creating object from task: invalid literal for int() with base 10: '1.0'
2025-05-24 22:40:08,555 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:40:08,556 - routes - INFO - DEBUG: Processing task 46, type=receipt_processing, status=pending_review
2025-05-24 22:40:08,558 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-24 22:40:08,559 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-24 22:40:08,560 - routes - INFO - Task 46 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-24 22:40:08,561 - routes - INFO - DEBUG: Task 46 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:40:08,562 - routes - INFO - Task 46 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-03-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket purchase', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 215.0, 'total_price': 215.0, 'category': 'event_ticket', 'object_type': 'consumable', 'confidence': 0.95, 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-03-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-24 22:40:08,563 - routes - INFO - DEBUG: Task 46 has AI analysis
2025-05-24 22:40:08,564 - routes - INFO - DEBUG: Added task 46 to receipt_tasks, now has 1 items
2025-05-24 22:40:08,565 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:40:08,568 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:40:08,568 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:40:10,544 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-24 22:40:10,545 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-24 22:40:10,546 - routes - INFO - Task 46 - Using smart-detected event details for calendar creation
2025-05-24 22:40:10,557 - routes - ERROR - Error creating calendar event from task: (psycopg2.errors.UndefinedColumn) column "event_date" of relation "calendar_events" does not exist
LINE 1: ... calendar_events (title, description, event_type, event_date...
                                                             ^

[SQL: INSERT INTO calendar_events (title, description, event_type, event_date, end_time, location, object_id, organization_id, user_id, event_metadata, created_at, updated_at, is_completed) VALUES (%(title)s, %(description)s, %(event_type)s, %(event_date)s, %(end_time)s, %(location)s, %(object_id)s, %(organization_id)s, %(user_id)s, %(event_metadata)s, %(created_at)s, %(updated_at)s, %(is_completed)s) RETURNING calendar_events.id]
[parameters: {'title': 'Heron Music Festival 2025 Ticket', 'description': 'Event created from task analysis. great blue heron music festival 2025 ticket purchase', 'event_type': 'task_generated', 'event_date': datetime.datetime(2025, 3, 17, 0, 0), 'end_time': None, 'location': '', 'object_id': None, 'organization_id': None, 'user_id': None, 'event_metadata': '{"created_from_task": true, "task_id": "46", "vendor": "Eventeny", "event_details": {"event_name": "Heron Music Festival 2025 Ticket", "event_date":  ... (570 characters truncated) ... -17"}}], "indicators": {"description_match": true, "line_items_match": true, "vendor_match": true, "matching_line_items": 1}}, "ai_confidence": 0.95}', 'created_at': datetime.datetime(2025, 5, 24, 22, 40, 10, 555095), 'updated_at': datetime.datetime(2025, 5, 24, 22, 40, 10, 555097), 'is_completed': False}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 22:40:16,678 - routes - INFO - Receipt task 46 rejected: 
2025-05-24 22:40:16,684 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:40:16,685 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:40:16,686 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:40:16,687 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:40:47,050 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:40:47,051 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:40:47,052 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:40:47,053 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:41:16,990 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:41:16,991 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:41:16,992 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:41:16,993 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:41:47,785 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:41:47,786 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:41:47,787 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:41:47,787 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:42:12,135 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:42:12,136 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:42:12,137 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:42:12,138 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:42:46,042 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:42:46,042 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:42:46,043 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:42:46,044 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:43:16,410 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:43:16,411 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:43:16,412 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:43:16,412 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:43:46,780 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:43:46,781 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:43:46,782 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:43:46,782 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:44:28,146 - app - INFO - Creating database tables...
2025-05-24 22:44:28,147 - app - INFO - Creating database tables...
2025-05-24 22:44:28,147 - app - INFO - Creating database tables...
2025-05-24 22:44:28,149 - app - INFO - Creating database tables...
2025-05-24 22:44:28,182 - app - INFO - Database tables created successfully
2025-05-24 22:44:28,182 - app - INFO - Database tables created successfully
2025-05-24 22:44:28,182 - app - INFO - Database tables created successfully
2025-05-24 22:44:28,183 - app - INFO - Database tables created successfully
2025-05-24 22:44:29,140 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:44:29,140 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:44:29,144 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:44:29,146 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:44:31,622 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:44:31,623 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:44:31,624 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:44:31,624 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:44:36,459 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 22:44:36,460 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 22:44:36,461 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp54h45iwq.pdf
2025-05-24 22:44:36,462 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:44:36,933 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 22:44:36,934 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 22:44:37,009 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 22:44:37,045 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 22:44:37,046 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:44:37,047 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 22:44:49,336 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 22:44:49,338 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 22:44:49,339 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Great Blue Heron Music Festival 2025 Ticket Purchase",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "category": "event",\n      "object_type": "service",\n      "confidence": 0.95\n    }\n  ],\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States"\n  },\n  "vendor_details": {\n    "business_address": "2361 Waits Corners Rd, Sherman, NY 14781, United States"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Extracted from email receipt for event ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 12.244158506393433, 'timestamp': '2025-05-24T22:44:49.335544', 'tokens_used': 3359, 'cost_estimate': 0.019995000000000002}
2025-05-24 22:44:49,366 - routes - INFO - Receipt queued for review: Task ID 47
2025-05-24 22:44:49,374 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:44:49,374 - routes - INFO - DEBUG: Processing task 47, type=receipt_processing, status=pending_review
2025-05-24 22:44:49,375 - routes - INFO - DEBUG: Task 47 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:44:49,376 - routes - INFO - Task 47 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States'}
2025-05-24 22:44:49,377 - routes - INFO - DEBUG: Task 47 has AI analysis
2025-05-24 22:44:49,377 - routes - INFO - DEBUG: Added task 47 to receipt_tasks, now has 1 items
2025-05-24 22:44:49,378 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:44:49,379 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:44:49,380 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:44:59,328 - routes - INFO - Created calendar event 'Great Blue Heron Music Festival 2025' from task 47
2025-05-24 22:45:00,911 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:45:00,912 - routes - INFO - DEBUG: Processing task 47, type=receipt_processing, status=pending_review
2025-05-24 22:45:00,913 - routes - INFO - DEBUG: Task 47 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:45:00,914 - routes - INFO - Task 47 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States'}
2025-05-24 22:45:00,915 - routes - INFO - DEBUG: Task 47 has AI analysis
2025-05-24 22:45:00,916 - routes - INFO - DEBUG: Added task 47 to receipt_tasks, now has 1 items
2025-05-24 22:45:00,917 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:45:00,917 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:45:00,918 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:45:12,687 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:45:12,688 - routes - INFO - DEBUG: Processing task 47, type=receipt_processing, status=pending_review
2025-05-24 22:45:12,689 - routes - INFO - DEBUG: Task 47 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:45:12,690 - routes - INFO - Task 47 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States'}
2025-05-24 22:45:12,690 - routes - INFO - DEBUG: Task 47 has AI analysis
2025-05-24 22:45:12,691 - routes - INFO - DEBUG: Added task 47 to receipt_tasks, now has 1 items
2025-05-24 22:45:12,692 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:45:12,693 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:45:12,694 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:45:15,882 - routes - INFO - Successfully processed receipt task: Invoice INV-20250524-56D476BC, 0 objects created
2025-05-24 22:45:15,893 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:45:15,893 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:45:15,894 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:45:15,895 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:45:34,881 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:45:34,882 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:45:34,883 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:45:34,883 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:46:44,989 - app - INFO - Creating database tables...
2025-05-24 22:46:44,990 - app - INFO - Creating database tables...
2025-05-24 22:46:44,990 - app - INFO - Creating database tables...
2025-05-24 22:46:44,995 - app - INFO - Creating database tables...
2025-05-24 22:46:45,025 - app - INFO - Database tables created successfully
2025-05-24 22:46:45,025 - app - INFO - Database tables created successfully
2025-05-24 22:46:45,026 - app - INFO - Database tables created successfully
2025-05-24 22:46:45,026 - app - INFO - Database tables created successfully
2025-05-24 22:46:45,986 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:46:45,986 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:46:45,996 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:46:46,000 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:49:22,071 - app - INFO - Creating database tables...
2025-05-24 22:49:22,071 - app - INFO - Creating database tables...
2025-05-24 22:49:22,072 - app - INFO - Creating database tables...
2025-05-24 22:49:22,074 - app - INFO - Creating database tables...
2025-05-24 22:49:22,107 - app - INFO - Database tables created successfully
2025-05-24 22:49:22,107 - app - INFO - Database tables created successfully
2025-05-24 22:49:22,108 - app - INFO - Database tables created successfully
2025-05-24 22:49:22,108 - app - INFO - Database tables created successfully
2025-05-24 22:49:23,119 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:49:23,119 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:49:23,119 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:49:23,122 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:57:53,614 - app - INFO - Creating database tables...
2025-05-24 22:57:53,618 - app - INFO - Creating database tables...
2025-05-24 22:57:53,618 - app - INFO - Creating database tables...
2025-05-24 22:57:53,650 - app - INFO - Database tables created successfully
2025-05-24 22:57:53,650 - app - INFO - Database tables created successfully
2025-05-24 22:57:53,651 - app - INFO - Database tables created successfully
2025-05-24 22:57:53,712 - app - INFO - Creating database tables...
2025-05-24 22:57:53,730 - app - INFO - Database tables created successfully
2025-05-24 22:57:54,620 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:57:54,620 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:57:54,620 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:57:54,621 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:58:58,014 - routes - INFO - Auto-classified 'Weekend Pass Thursday Entry' as consumable event ticket
2025-05-24 22:58:58,034 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from receipt INV-20250524-56D476BC
2025-05-24 23:10:19,586 - app - INFO - Creating database tables...
2025-05-24 23:10:19,590 - app - INFO - Creating database tables...
2025-05-24 23:10:19,592 - app - INFO - Creating database tables...
2025-05-24 23:10:19,604 - app - INFO - Creating database tables...
2025-05-24 23:10:19,623 - app - INFO - Database tables created successfully
2025-05-24 23:10:19,623 - app - INFO - Database tables created successfully
2025-05-24 23:10:19,623 - app - INFO - Database tables created successfully
2025-05-24 23:10:19,624 - app - INFO - Database tables created successfully
2025-05-24 23:10:26,026 - app - INFO - Creating database tables...
2025-05-24 23:10:26,047 - app - INFO - Database tables created successfully
2025-05-24 23:10:26,097 - app - INFO - Creating database tables...
2025-05-24 23:10:26,118 - app - INFO - Database tables created successfully
2025-05-24 23:10:26,188 - app - INFO - Creating database tables...
2025-05-24 23:10:26,194 - app - INFO - Creating database tables...
2025-05-24 23:10:26,208 - app - INFO - Database tables created successfully
2025-05-24 23:10:26,212 - app - INFO - Database tables created successfully
2025-05-24 23:10:29,776 - app - INFO - Creating database tables...
2025-05-24 23:10:29,794 - app - INFO - Database tables created successfully
2025-05-24 23:10:29,900 - app - INFO - Creating database tables...
2025-05-24 23:10:29,918 - app - INFO - Database tables created successfully
2025-05-24 23:10:29,942 - app - INFO - Creating database tables...
2025-05-24 23:10:29,963 - app - INFO - Database tables created successfully
2025-05-24 23:10:36,169 - app - INFO - Creating database tables...
2025-05-24 23:10:36,186 - app - INFO - Database tables created successfully
2025-05-24 23:10:36,278 - app - INFO - Creating database tables...
2025-05-24 23:10:36,295 - app - INFO - Database tables created successfully
2025-05-24 23:10:42,961 - app - INFO - Creating database tables...
2025-05-24 23:10:42,978 - app - INFO - Database tables created successfully
2025-05-24 23:10:43,036 - app - INFO - Creating database tables...
2025-05-24 23:10:43,055 - app - INFO - Creating database tables...
2025-05-24 23:10:43,055 - app - INFO - Database tables created successfully
2025-05-24 23:10:43,073 - app - INFO - Database tables created successfully
2025-05-24 23:10:43,092 - app - INFO - Creating database tables...
2025-05-24 23:10:43,115 - app - INFO - Database tables created successfully
2025-05-24 23:10:50,508 - app - INFO - Creating database tables...
2025-05-24 23:10:50,526 - app - INFO - Creating database tables...
2025-05-24 23:10:50,526 - app - INFO - Database tables created successfully
2025-05-24 23:10:50,545 - app - INFO - Database tables created successfully
2025-05-24 23:10:50,634 - app - INFO - Creating database tables...
2025-05-24 23:10:50,652 - app - INFO - Database tables created successfully
2025-05-24 23:10:56,873 - app - INFO - Creating database tables...
2025-05-24 23:10:56,882 - app - INFO - Creating database tables...
2025-05-24 23:10:56,898 - app - INFO - Database tables created successfully
2025-05-24 23:10:56,905 - app - INFO - Database tables created successfully
2025-05-24 23:10:57,019 - app - INFO - Creating database tables...
2025-05-24 23:10:57,039 - app - INFO - Database tables created successfully
2025-05-24 23:10:57,147 - app - INFO - Creating database tables...
2025-05-24 23:11:09,262 - app - INFO - Creating database tables...
2025-05-24 23:11:09,279 - app - INFO - Database tables created successfully
2025-05-24 23:11:09,329 - app - INFO - Creating database tables...
2025-05-24 23:11:09,348 - app - INFO - Database tables created successfully
2025-05-24 23:11:09,422 - app - INFO - Creating database tables...
2025-05-24 23:11:09,443 - app - INFO - Database tables created successfully
2025-05-24 23:11:25,391 - app - INFO - Creating database tables...
2025-05-24 23:11:25,410 - app - INFO - Database tables created successfully
2025-05-24 23:11:25,476 - app - INFO - Creating database tables...
2025-05-24 23:11:25,496 - app - INFO - Database tables created successfully
2025-05-24 23:11:25,552 - app - INFO - Creating database tables...
2025-05-24 23:11:25,571 - app - INFO - Database tables created successfully
2025-05-24 23:11:54,279 - app - INFO - Creating database tables...
2025-05-24 23:11:54,299 - app - INFO - Database tables created successfully
2025-05-24 23:11:54,396 - app - INFO - Creating database tables...
2025-05-24 23:11:54,414 - app - INFO - Database tables created successfully
2025-05-24 23:11:54,508 - app - INFO - Creating database tables...
2025-05-24 23:12:46,092 - app - INFO - Creating database tables...
2025-05-24 23:12:46,109 - app - INFO - Database tables created successfully
2025-05-24 23:12:46,112 - app - INFO - Creating database tables...
2025-05-24 23:12:46,132 - app - INFO - Database tables created successfully
2025-05-24 23:12:46,231 - app - INFO - Creating database tables...
2025-05-24 23:12:46,249 - app - INFO - Database tables created successfully
2025-05-24 23:12:46,260 - app - INFO - Creating database tables...
2025-05-24 23:12:46,286 - app - INFO - Database tables created successfully
2025-05-24 23:13:46,990 - app - INFO - Creating database tables...
2025-05-24 23:13:46,990 - app - INFO - Creating database tables...
2025-05-24 23:13:46,990 - app - INFO - Creating database tables...
2025-05-24 23:13:46,997 - app - INFO - Creating database tables...
2025-05-24 23:13:47,023 - app - INFO - Database tables created successfully
2025-05-24 23:13:47,023 - app - INFO - Database tables created successfully
2025-05-24 23:13:47,023 - app - INFO - Database tables created successfully
2025-05-24 23:13:47,023 - app - INFO - Database tables created successfully
2025-05-24 23:14:47,824 - app - INFO - Creating database tables...
2025-05-24 23:14:47,826 - app - INFO - Creating database tables...
2025-05-24 23:14:47,827 - app - INFO - Creating database tables...
2025-05-24 23:14:47,829 - app - INFO - Creating database tables...
2025-05-24 23:14:47,857 - app - INFO - Database tables created successfully
2025-05-24 23:14:47,857 - app - INFO - Database tables created successfully
2025-05-24 23:14:47,857 - app - INFO - Database tables created successfully
2025-05-24 23:14:47,858 - app - INFO - Database tables created successfully
2025-05-24 23:15:48,350 - app - INFO - Creating database tables...
2025-05-24 23:15:48,368 - app - INFO - Database tables created successfully
2025-05-24 23:15:48,434 - app - INFO - Creating database tables...
2025-05-24 23:15:48,448 - app - INFO - Creating database tables...
2025-05-24 23:15:48,452 - app - INFO - Database tables created successfully
2025-05-24 23:15:48,467 - app - INFO - Database tables created successfully
2025-05-24 23:15:48,536 - app - INFO - Creating database tables...
2025-05-24 23:15:48,557 - app - INFO - Database tables created successfully
2025-05-24 23:16:48,017 - app - INFO - Creating database tables...
2025-05-24 23:16:48,035 - app - INFO - Database tables created successfully
2025-05-24 23:16:48,078 - app - INFO - Creating database tables...
2025-05-24 23:16:48,084 - app - INFO - Creating database tables...
2025-05-24 23:16:48,096 - app - INFO - Database tables created successfully
2025-05-24 23:16:48,101 - app - INFO - Database tables created successfully
2025-05-24 23:16:48,124 - app - INFO - Creating database tables...
2025-05-24 23:16:48,145 - app - INFO - Database tables created successfully
2025-05-24 23:17:46,633 - app - INFO - Creating database tables...
2025-05-24 23:17:46,633 - app - INFO - Creating database tables...
2025-05-24 23:17:46,652 - app - INFO - Database tables created successfully
2025-05-24 23:17:46,652 - app - INFO - Database tables created successfully
2025-05-24 23:17:46,703 - app - INFO - Creating database tables...
2025-05-24 23:17:46,725 - app - INFO - Database tables created successfully
2025-05-24 23:17:46,726 - app - INFO - Creating database tables...
2025-05-24 23:17:46,750 - app - INFO - Database tables created successfully
2025-05-24 23:18:47,159 - app - INFO - Creating database tables...
2025-05-24 23:18:47,179 - app - INFO - Database tables created successfully
2025-05-24 23:18:47,210 - app - INFO - Creating database tables...
2025-05-24 23:18:47,233 - app - INFO - Database tables created successfully
2025-05-24 23:18:47,302 - app - INFO - Creating database tables...
2025-05-24 23:18:47,319 - app - INFO - Database tables created successfully
2025-05-24 23:19:47,739 - app - INFO - Creating database tables...
2025-05-24 23:19:47,740 - app - INFO - Creating database tables...
2025-05-24 23:19:47,758 - app - INFO - Database tables created successfully
2025-05-24 23:19:47,758 - app - INFO - Database tables created successfully
2025-05-24 23:19:47,773 - app - INFO - Creating database tables...
2025-05-24 23:19:47,797 - app - INFO - Database tables created successfully
2025-05-24 23:19:47,867 - app - INFO - Creating database tables...
2025-05-24 23:19:47,886 - app - INFO - Database tables created successfully
2025-05-24 23:20:48,590 - app - INFO - Creating database tables...
2025-05-24 23:20:48,595 - app - INFO - Creating database tables...
2025-05-24 23:20:48,617 - app - INFO - Creating database tables...
2025-05-24 23:20:48,623 - app - INFO - Database tables created successfully
2025-05-24 23:20:48,623 - app - INFO - Database tables created successfully
2025-05-24 23:20:48,636 - app - INFO - Database tables created successfully
2025-05-24 23:20:48,689 - app - INFO - Creating database tables...
2025-05-24 23:20:48,708 - app - INFO - Database tables created successfully
2025-05-24 23:20:49,602 - routes - INFO - AI Settings initialized successfully
2025-05-24 23:20:49,602 - routes - INFO - AI Settings initialized successfully
2025-05-24 23:20:49,602 - routes - INFO - AI Settings initialized successfully
2025-05-24 23:20:49,608 - routes - INFO - AI Settings initialized successfully
2025-05-25 12:05:26,431 - app - INFO - Creating database tables...
2025-05-25 12:05:26,432 - app - INFO - Creating database tables...
2025-05-25 12:05:26,433 - app - INFO - Creating database tables...
2025-05-25 12:05:26,436 - app - INFO - Creating database tables...
2025-05-25 12:05:26,472 - app - INFO - Database tables created successfully
2025-05-25 12:05:26,472 - app - INFO - Database tables created successfully
2025-05-25 12:05:26,472 - app - INFO - Database tables created successfully
2025-05-25 12:05:26,472 - app - INFO - Database tables created successfully
2025-05-25 12:05:27,629 - routes - INFO - AI Settings initialized successfully
2025-05-25 12:05:27,629 - routes - INFO - AI Settings initialized successfully
2025-05-25 12:05:27,629 - routes - INFO - AI Settings initialized successfully
2025-05-25 12:05:27,629 - routes - INFO - AI Settings initialized successfully
2025-05-25 12:05:45,579 - routes - INFO - Deleted service object: Weekend Pass Thursday Entry (ID: 1)
2025-05-25 13:11:58,389 - app - INFO - Creating database tables...
2025-05-25 13:11:58,393 - app - INFO - Creating database tables...
2025-05-25 13:11:58,399 - app - INFO - Creating database tables...
2025-05-25 13:11:58,412 - app - INFO - Creating database tables...
2025-05-25 13:11:58,530 - app - INFO - Database tables created successfully
2025-05-25 13:11:58,530 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(vendors_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 13:11:58,530 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(vendors_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 13:11:58,530 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(vendors_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 13:11:59,451 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:11:59,451 - routes - ERROR - Error initializing AI settings: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ai_settings_provider_key"
DETAIL:  Key (provider)=(anthropic) already exists.

[SQL: INSERT INTO ai_settings (provider, is_enabled, is_default, api_key, api_endpoint, config, created_at, updated_at) VALUES (%(provider)s, %(is_enabled)s, %(is_default)s, %(api_key)s, %(api_endpoint)s, %(config)s, %(created_at)s, %(updated_at)s) RETURNING ai_settings.id]
[parameters: {'provider': 'anthropic', 'is_enabled': True, 'is_default': True, 'api_key': None, 'api_endpoint': None, 'config': '{"default_model": "claude-3-5-sonnet-20241022", "vision_model": "claude-3-opus-20240229", "timeout": 180}', 'created_at': datetime.datetime(2025, 5, 25, 13, 11, 59, 449941), 'updated_at': datetime.datetime(2025, 5, 25, 13, 11, 59, 449944)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 13:11:59,452 - routes - ERROR - Error initializing AI settings: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ai_settings_provider_key"
DETAIL:  Key (provider)=(anthropic) already exists.

[SQL: INSERT INTO ai_settings (provider, is_enabled, is_default, api_key, api_endpoint, config, created_at, updated_at) VALUES (%(provider)s, %(is_enabled)s, %(is_default)s, %(api_key)s, %(api_endpoint)s, %(config)s, %(created_at)s, %(updated_at)s) RETURNING ai_settings.id]
[parameters: {'provider': 'anthropic', 'is_enabled': True, 'is_default': True, 'api_key': None, 'api_endpoint': None, 'config': '{"default_model": "claude-3-5-sonnet-20241022", "vision_model": "claude-3-opus-20240229", "timeout": 180}', 'created_at': datetime.datetime(2025, 5, 25, 13, 11, 59, 450407), 'updated_at': datetime.datetime(2025, 5, 25, 13, 11, 59, 450409)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 13:11:59,453 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:12:08,348 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 13:12:08,349 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 13:12:08,350 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp0pgp22i2.pdf
2025-05-25 13:12:08,351 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 13:12:08,781 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 13:12:08,782 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 13:12:08,856 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 13:12:08,892 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 13:12:08,893 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 13:12:08,894 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 13:12:08,916 - mcp_client - WARNING - MCP server unavailable, using enhanced fallback: 'AsyncClient' object has no attribute 'call_tool'
2025-05-25 13:12:08,920 - routes - INFO - MCP analysis successful: {'content': {'response': '{"vendor_name": "Unknown", "date": "2025-05-25", "total_amount": 0.0, "description": "Receipt analysis from RECEIPT_Blue_Heron_Music_Festival_July_2025.jpg", "line_items": [{"description": "Receipt item (manual review required)", "quantity": 1, "unit_price": 0.0, "extracted_metadata": {"upc_code": null, "manufacturer": "Unknown", "model": null, "serial_number": null, "suggested_object_type": "expense", "category_suggestions": ["uncategorized"], "needs_manual_review": true}}], "enhanced_analysis": true, "metadata_extraction": "fallback", "event_details": null, "digital_assets": {}, "overall_confidence": 0.3}'}}
2025-05-25 13:12:08,929 - routes - INFO - Receipt queued for review: Task ID 1
2025-05-25 13:12:08,938 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:12:08,940 - routes - INFO - DEBUG: Processing task 1, type=receipt_processing, status=pending_review
2025-05-25 13:12:08,940 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:12:08,941 - routes - INFO - Task 1 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:12:08,942 - routes - INFO - DEBUG: Task 1 extracted receipt data: vendor=Unknown, total=$0.0
2025-05-25 13:12:08,943 - routes - INFO - Task 1 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:12:08,944 - routes - INFO - DEBUG: Task 1 has AI analysis
2025-05-25 13:12:08,945 - routes - INFO - DEBUG: Added task 1 to receipt_tasks, now has 1 items
2025-05-25 13:12:08,946 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:12:08,946 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:12:39,205 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:12:39,206 - routes - INFO - DEBUG: Processing task 1, type=receipt_processing, status=pending_review
2025-05-25 13:12:39,207 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:12:39,208 - routes - INFO - Task 1 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:12:39,209 - routes - INFO - DEBUG: Task 1 extracted receipt data: vendor=Unknown, total=$0.0
2025-05-25 13:12:39,209 - routes - INFO - Task 1 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:12:39,210 - routes - INFO - DEBUG: Task 1 has AI analysis
2025-05-25 13:12:39,211 - routes - INFO - DEBUG: Added task 1 to receipt_tasks, now has 1 items
2025-05-25 13:12:39,211 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:12:39,212 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:13:02,984 - routes - INFO - Receipt task 1 rejected: 
2025-05-25 13:13:02,990 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 13:13:02,990 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 13:13:02,991 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 13:16:58,773 - app - INFO - Creating database tables...
2025-05-25 13:16:58,779 - app - INFO - Creating database tables...
2025-05-25 13:16:58,794 - app - INFO - Creating database tables...
2025-05-25 13:16:58,804 - app - INFO - Database tables created successfully
2025-05-25 13:16:58,804 - app - INFO - Database tables created successfully
2025-05-25 13:16:58,810 - app - INFO - Database tables created successfully
2025-05-25 13:16:58,892 - app - INFO - Creating database tables...
2025-05-25 13:16:58,910 - app - INFO - Database tables created successfully
2025-05-25 13:16:59,702 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:16:59,703 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:16:59,705 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:16:59,706 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:17:13,852 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 13:17:13,853 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 13:17:13,854 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpw6ri5jdc.pdf
2025-05-25 13:17:13,855 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 13:17:14,289 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 13:17:14,290 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 13:17:14,372 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 13:17:14,407 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 13:17:14,408 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 13:17:14,409 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 13:17:14,460 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 422 Unprocessable Entity"
2025-05-25 13:17:14,462 - mcp_client - WARNING - MCP server unavailable, using enhanced fallback: Client error '422 Unprocessable Entity' for url 'http://mcp-server:8080/ai/process'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
2025-05-25 13:17:14,463 - routes - INFO - MCP analysis successful: {'content': {'response': '{"vendor_name": "Blue Heron", "date": "2025-05-25", "total_amount": 0.0, "description": "Receipt analysis from RECEIPT_Blue_Heron_Music_Festival_July_2025.jpg", "line_items": [{"description": "Receipt item (manual review required)", "quantity": 1, "unit_price": 0.0, "extracted_metadata": {"upc_code": null, "manufacturer": "Blue Heron", "model": null, "serial_number": null, "suggested_object_type": "expense", "category_suggestions": ["uncategorized"], "needs_manual_review": true}}], "enhanced_analysis": true, "metadata_extraction": "fallback", "event_details": null, "digital_assets": {}, "overall_confidence": 0.3}'}}
2025-05-25 13:17:14,473 - routes - INFO - Receipt queued for review: Task ID 2
2025-05-25 13:17:14,481 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:17:14,482 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending_review
2025-05-25 13:17:14,483 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:17:14,483 - routes - INFO - Task 2 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:17:14,484 - routes - INFO - DEBUG: Task 2 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:17:14,485 - routes - INFO - Task 2 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:17:14,486 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-25 13:17:14,487 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 1 items
2025-05-25 13:17:14,487 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:17:14,488 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:17:44,756 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:17:44,757 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending_review
2025-05-25 13:17:44,758 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:17:44,760 - routes - INFO - Task 2 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:17:44,761 - routes - INFO - DEBUG: Task 2 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:17:44,762 - routes - INFO - Task 2 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:17:44,763 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-25 13:17:44,763 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 1 items
2025-05-25 13:17:44,764 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:17:44,765 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:18:22,779 - app - INFO - Creating database tables...
2025-05-25 13:18:22,783 - app - INFO - Creating database tables...
2025-05-25 13:18:22,798 - app - INFO - Creating database tables...
2025-05-25 13:18:22,809 - app - INFO - Creating database tables...
2025-05-25 13:18:22,814 - app - INFO - Database tables created successfully
2025-05-25 13:18:22,814 - app - INFO - Database tables created successfully
2025-05-25 13:18:22,814 - app - INFO - Database tables created successfully
2025-05-25 13:18:22,825 - app - INFO - Database tables created successfully
2025-05-25 13:18:23,737 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:18:23,737 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:18:23,737 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:18:23,739 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:18:23,754 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:18:23,755 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending_review
2025-05-25 13:18:23,755 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:18:23,756 - routes - INFO - Task 2 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:18:23,757 - routes - INFO - DEBUG: Task 2 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:18:23,758 - routes - INFO - Task 2 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:18:23,759 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-25 13:18:23,759 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 1 items
2025-05-25 13:18:23,760 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:18:23,761 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:18:27,969 - routes - INFO - Receipt task 2 rejected: 
2025-05-25 13:18:27,976 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 13:18:27,976 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 13:18:27,977 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 13:18:32,362 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 13:18:32,363 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 13:18:32,365 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpe0eu48p9.pdf
2025-05-25 13:18:32,365 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 13:18:32,809 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 13:18:32,810 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 13:18:32,885 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 13:18:32,925 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 13:18:32,927 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 13:18:32,927 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 13:18:32,969 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 422 Unprocessable Entity"
2025-05-25 13:18:32,970 - mcp_client - WARNING - MCP server unavailable, using enhanced fallback: Client error '422 Unprocessable Entity' for url 'http://mcp-server:8080/ai/process'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
2025-05-25 13:18:32,972 - routes - INFO - MCP analysis successful: {'content': {'response': '{"vendor_name": "Blue Heron", "date": "2025-05-25", "total_amount": 0.0, "description": "Receipt analysis from RECEIPT_Blue_Heron_Music_Festival_July_2025.jpg", "line_items": [{"description": "Receipt item (manual review required)", "quantity": 1, "unit_price": 0.0, "extracted_metadata": {"upc_code": null, "manufacturer": "Blue Heron", "model": null, "serial_number": null, "suggested_object_type": "expense", "category_suggestions": ["uncategorized"], "needs_manual_review": true}}], "enhanced_analysis": true, "metadata_extraction": "fallback", "event_details": null, "digital_assets": {}, "overall_confidence": 0.3}'}}
2025-05-25 13:18:32,982 - routes - INFO - Receipt queued for review: Task ID 3
2025-05-25 13:18:32,989 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:18:32,990 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 13:18:32,991 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:18:32,991 - routes - INFO - Task 3 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:18:32,992 - routes - INFO - DEBUG: Task 3 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:18:32,993 - routes - INFO - Task 3 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:18:32,994 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 13:18:32,994 - routes - INFO - DEBUG: Added task 3 to receipt_tasks, now has 1 items
2025-05-25 13:18:32,995 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:18:32,996 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:19:03,199 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:19:03,200 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 13:19:03,201 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:19:03,201 - routes - INFO - Task 3 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:19:03,202 - routes - INFO - DEBUG: Task 3 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:19:03,203 - routes - INFO - Task 3 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:19:03,204 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 13:19:03,204 - routes - INFO - DEBUG: Added task 3 to receipt_tasks, now has 1 items
2025-05-25 13:19:03,205 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:19:03,206 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:19:33,419 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:19:33,420 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 13:19:33,421 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:19:33,422 - routes - INFO - Task 3 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:19:33,423 - routes - INFO - DEBUG: Task 3 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:19:33,423 - routes - INFO - Task 3 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:19:33,425 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 13:19:33,425 - routes - INFO - DEBUG: Added task 3 to receipt_tasks, now has 1 items
2025-05-25 13:19:33,426 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:19:33,427 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:20:14,540 - app - INFO - Creating database tables...
2025-05-25 13:20:14,541 - app - INFO - Creating database tables...
2025-05-25 13:20:14,542 - app - INFO - Creating database tables...
2025-05-25 13:20:14,544 - app - INFO - Creating database tables...
2025-05-25 13:20:14,574 - app - INFO - Database tables created successfully
2025-05-25 13:20:14,574 - app - INFO - Database tables created successfully
2025-05-25 13:20:14,574 - app - INFO - Database tables created successfully
2025-05-25 13:20:14,574 - app - INFO - Database tables created successfully
2025-05-25 13:20:15,481 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:20:15,481 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:20:15,484 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:20:15,486 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:20:15,497 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:20:15,497 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 13:20:15,498 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:20:15,499 - routes - INFO - Task 3 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:20:15,500 - routes - INFO - DEBUG: Task 3 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:20:15,501 - routes - INFO - Task 3 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:20:15,501 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 13:20:15,502 - routes - INFO - DEBUG: Added task 3 to receipt_tasks, now has 1 items
2025-05-25 13:20:15,503 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:20:15,504 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:20:18,064 - routes - INFO - Receipt task 3 rejected: 
2025-05-25 13:20:18,069 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 13:20:18,070 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 13:20:18,071 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 13:20:23,405 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 13:20:23,406 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 13:20:23,407 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp0nzkjdqy.pdf
2025-05-25 13:20:23,408 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 13:20:23,855 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 13:20:23,856 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 13:20:23,934 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 13:20:23,970 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 13:20:23,971 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 13:20:23,972 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 13:20:30,075 - mcp_client - WARNING - MCP server unavailable, using enhanced fallback: [Errno -2] Name or service not known
2025-05-25 13:20:30,078 - routes - INFO - MCP analysis successful: {'content': {'response': '{"vendor_name": "Blue Heron", "date": "2025-05-25", "total_amount": 0.0, "description": "Receipt analysis from RECEIPT_Blue_Heron_Music_Festival_July_2025.jpg", "line_items": [{"description": "Receipt item (manual review required)", "quantity": 1, "unit_price": 0.0, "extracted_metadata": {"upc_code": null, "manufacturer": "Blue Heron", "model": null, "serial_number": null, "suggested_object_type": "expense", "category_suggestions": ["uncategorized"], "needs_manual_review": true}}], "enhanced_analysis": true, "metadata_extraction": "fallback", "event_details": null, "digital_assets": {}, "overall_confidence": 0.3}'}}
2025-05-25 13:20:30,089 - routes - INFO - Receipt queued for review: Task ID 4
2025-05-25 13:20:30,096 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:20:30,097 - routes - INFO - DEBUG: Processing task 4, type=receipt_processing, status=pending_review
2025-05-25 13:20:30,099 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:20:30,099 - routes - INFO - Task 4 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:20:30,100 - routes - INFO - DEBUG: Task 4 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:20:30,101 - routes - INFO - Task 4 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:20:30,102 - routes - INFO - DEBUG: Task 4 has AI analysis
2025-05-25 13:20:30,102 - routes - INFO - DEBUG: Added task 4 to receipt_tasks, now has 1 items
2025-05-25 13:20:30,103 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:20:30,104 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:21:00,385 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:21:00,386 - routes - INFO - DEBUG: Processing task 4, type=receipt_processing, status=pending_review
2025-05-25 13:21:00,387 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:21:00,387 - routes - INFO - Task 4 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:21:00,388 - routes - INFO - DEBUG: Task 4 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:21:00,389 - routes - INFO - Task 4 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:21:00,390 - routes - INFO - DEBUG: Task 4 has AI analysis
2025-05-25 13:21:00,391 - routes - INFO - DEBUG: Added task 4 to receipt_tasks, now has 1 items
2025-05-25 13:21:00,391 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:21:00,392 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:21:30,610 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:21:30,610 - routes - INFO - DEBUG: Processing task 4, type=receipt_processing, status=pending_review
2025-05-25 13:21:30,612 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:21:30,612 - routes - INFO - Task 4 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:21:30,613 - routes - INFO - DEBUG: Task 4 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:21:30,614 - routes - INFO - Task 4 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:21:30,615 - routes - INFO - DEBUG: Task 4 has AI analysis
2025-05-25 13:21:30,615 - routes - INFO - DEBUG: Added task 4 to receipt_tasks, now has 1 items
2025-05-25 13:21:30,616 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:21:30,617 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:22:00,861 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:22:00,862 - routes - INFO - DEBUG: Processing task 4, type=receipt_processing, status=pending_review
2025-05-25 13:22:00,863 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:22:00,863 - routes - INFO - Task 4 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:22:00,864 - routes - INFO - DEBUG: Task 4 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:22:00,865 - routes - INFO - Task 4 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:22:00,866 - routes - INFO - DEBUG: Task 4 has AI analysis
2025-05-25 13:22:00,866 - routes - INFO - DEBUG: Added task 4 to receipt_tasks, now has 1 items
2025-05-25 13:22:00,867 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:22:00,868 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:22:31,117 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:22:31,118 - routes - INFO - DEBUG: Processing task 4, type=receipt_processing, status=pending_review
2025-05-25 13:22:31,119 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:22:31,120 - routes - INFO - Task 4 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:22:31,121 - routes - INFO - DEBUG: Task 4 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:22:31,121 - routes - INFO - Task 4 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:22:31,122 - routes - INFO - DEBUG: Task 4 has AI analysis
2025-05-25 13:22:31,123 - routes - INFO - DEBUG: Added task 4 to receipt_tasks, now has 1 items
2025-05-25 13:22:31,124 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:22:31,125 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:23:01,386 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:23:01,386 - routes - INFO - DEBUG: Processing task 4, type=receipt_processing, status=pending_review
2025-05-25 13:23:01,387 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:23:01,388 - routes - INFO - Task 4 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:23:01,389 - routes - INFO - DEBUG: Task 4 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:23:01,390 - routes - INFO - Task 4 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:23:01,390 - routes - INFO - DEBUG: Task 4 has AI analysis
2025-05-25 13:23:01,391 - routes - INFO - DEBUG: Added task 4 to receipt_tasks, now has 1 items
2025-05-25 13:23:01,392 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:23:01,393 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:23:31,664 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:23:31,664 - routes - INFO - DEBUG: Processing task 4, type=receipt_processing, status=pending_review
2025-05-25 13:23:31,665 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:23:31,666 - routes - INFO - Task 4 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:23:31,667 - routes - INFO - DEBUG: Task 4 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:23:31,668 - routes - INFO - Task 4 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:23:31,668 - routes - INFO - DEBUG: Task 4 has AI analysis
2025-05-25 13:23:31,669 - routes - INFO - DEBUG: Added task 4 to receipt_tasks, now has 1 items
2025-05-25 13:23:31,670 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:23:31,671 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:24:05,811 - app - INFO - Creating database tables...
2025-05-25 13:24:05,828 - app - INFO - Database tables created successfully
2025-05-25 13:24:05,846 - app - INFO - Creating database tables...
2025-05-25 13:24:05,862 - app - INFO - Database tables created successfully
2025-05-25 13:24:05,868 - app - INFO - Creating database tables...
2025-05-25 13:24:05,884 - app - INFO - Database tables created successfully
2025-05-25 13:24:05,935 - app - INFO - Creating database tables...
2025-05-25 13:24:05,952 - app - INFO - Database tables created successfully
2025-05-25 13:24:06,390 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:24:06,410 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:24:06,430 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:24:06,500 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:24:07,089 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:24:07,090 - routes - INFO - DEBUG: Processing task 4, type=receipt_processing, status=pending_review
2025-05-25 13:24:07,091 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:24:07,091 - routes - INFO - Task 4 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:24:07,092 - routes - INFO - DEBUG: Task 4 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:24:07,093 - routes - INFO - Task 4 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:24:07,094 - routes - INFO - DEBUG: Task 4 has AI analysis
2025-05-25 13:24:07,095 - routes - INFO - DEBUG: Added task 4 to receipt_tasks, now has 1 items
2025-05-25 13:24:07,096 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:24:07,097 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:24:09,648 - routes - INFO - Receipt task 4 rejected: 
2025-05-25 13:24:09,653 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 13:24:09,654 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 13:24:09,655 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 13:24:13,678 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 13:24:13,680 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 13:24:13,681 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmphmgri0nx.pdf
2025-05-25 13:24:13,682 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 13:24:14,072 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 13:24:14,072 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 13:24:14,155 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 13:24:14,189 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 13:24:14,190 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 13:24:14,191 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 13:24:14,232 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 422 Unprocessable Entity"
2025-05-25 13:24:14,233 - mcp_client - WARNING - MCP server unavailable, using enhanced fallback: Client error '422 Unprocessable Entity' for url 'http://mcp-server:8080/ai/process'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
2025-05-25 13:24:14,235 - routes - INFO - MCP analysis successful: {'content': {'response': '{"vendor_name": "Blue Heron", "date": "2025-05-25", "total_amount": 0.0, "description": "Receipt analysis from RECEIPT_Blue_Heron_Music_Festival_July_2025.jpg", "line_items": [{"description": "Receipt item (manual review required)", "quantity": 1, "unit_price": 0.0, "extracted_metadata": {"upc_code": null, "manufacturer": "Blue Heron", "model": null, "serial_number": null, "suggested_object_type": "expense", "category_suggestions": ["uncategorized"], "needs_manual_review": true}}], "enhanced_analysis": true, "metadata_extraction": "fallback", "event_details": null, "digital_assets": {}, "overall_confidence": 0.3}'}}
2025-05-25 13:24:14,242 - routes - INFO - Receipt queued for review: Task ID 5
2025-05-25 13:24:14,249 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:24:14,250 - routes - INFO - DEBUG: Processing task 5, type=receipt_processing, status=pending_review
2025-05-25 13:24:14,250 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:24:14,251 - routes - INFO - Task 5 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:24:14,252 - routes - INFO - DEBUG: Task 5 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:24:14,253 - routes - INFO - Task 5 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:24:14,254 - routes - INFO - DEBUG: Task 5 has AI analysis
2025-05-25 13:24:14,254 - routes - INFO - DEBUG: Added task 5 to receipt_tasks, now has 1 items
2025-05-25 13:24:14,255 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:24:14,256 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:24:44,476 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:24:44,477 - routes - INFO - DEBUG: Processing task 5, type=receipt_processing, status=pending_review
2025-05-25 13:24:44,478 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:24:44,479 - routes - INFO - Task 5 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:24:44,480 - routes - INFO - DEBUG: Task 5 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:24:44,480 - routes - INFO - Task 5 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:24:44,481 - routes - INFO - DEBUG: Task 5 has AI analysis
2025-05-25 13:24:44,482 - routes - INFO - DEBUG: Added task 5 to receipt_tasks, now has 1 items
2025-05-25 13:24:44,483 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:24:44,483 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:25:14,694 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:25:14,695 - routes - INFO - DEBUG: Processing task 5, type=receipt_processing, status=pending_review
2025-05-25 13:25:14,696 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:25:14,697 - routes - INFO - Task 5 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:25:14,698 - routes - INFO - DEBUG: Task 5 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:25:14,699 - routes - INFO - Task 5 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:25:14,700 - routes - INFO - DEBUG: Task 5 has AI analysis
2025-05-25 13:25:14,702 - routes - INFO - DEBUG: Added task 5 to receipt_tasks, now has 1 items
2025-05-25 13:25:14,703 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:25:14,703 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:25:44,948 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:25:44,949 - routes - INFO - DEBUG: Processing task 5, type=receipt_processing, status=pending_review
2025-05-25 13:25:44,950 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:25:44,951 - routes - INFO - Task 5 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:25:44,952 - routes - INFO - DEBUG: Task 5 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:25:44,953 - routes - INFO - Task 5 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:25:44,953 - routes - INFO - DEBUG: Task 5 has AI analysis
2025-05-25 13:25:44,954 - routes - INFO - DEBUG: Added task 5 to receipt_tasks, now has 1 items
2025-05-25 13:25:44,955 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:25:44,956 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:26:26,488 - app - INFO - Creating database tables...
2025-05-25 13:26:26,506 - app - INFO - Database tables created successfully
2025-05-25 13:26:26,549 - app - INFO - Creating database tables...
2025-05-25 13:26:26,566 - app - INFO - Database tables created successfully
2025-05-25 13:26:26,646 - app - INFO - Creating database tables...
2025-05-25 13:26:26,663 - app - INFO - Database tables created successfully
2025-05-25 13:26:26,733 - app - INFO - Creating database tables...
2025-05-25 13:26:26,750 - app - INFO - Database tables created successfully
2025-05-25 13:26:27,045 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:26:27,111 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:26:27,197 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:26:27,279 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:26:28,075 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:26:28,076 - routes - INFO - DEBUG: Processing task 5, type=receipt_processing, status=pending_review
2025-05-25 13:26:28,077 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:26:28,078 - routes - INFO - Task 5 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:26:28,078 - routes - INFO - DEBUG: Task 5 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:26:28,079 - routes - INFO - Task 5 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:26:28,080 - routes - INFO - DEBUG: Task 5 has AI analysis
2025-05-25 13:26:28,080 - routes - INFO - DEBUG: Added task 5 to receipt_tasks, now has 1 items
2025-05-25 13:26:28,081 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:26:28,082 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:26:30,891 - routes - INFO - Receipt task 5 rejected: 
2025-05-25 13:26:30,897 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 13:26:30,898 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 13:26:30,898 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 13:26:33,368 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 13:26:33,368 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 13:26:33,370 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp2kp4lgpy.pdf
2025-05-25 13:26:33,370 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 13:26:33,761 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 13:26:33,762 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 13:26:33,838 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 13:26:33,871 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 13:26:33,872 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 13:26:33,873 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 13:26:36,047 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 500 Internal Server Error"
2025-05-25 13:26:36,049 - mcp_client - WARNING - MCP server unavailable, using enhanced fallback: Server error '500 Internal Server Error' for url 'http://mcp-server:8080/ai/process'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500
2025-05-25 13:26:36,050 - routes - INFO - MCP analysis successful: {'content': {'response': '{"vendor_name": "Blue Heron", "date": "2025-05-25", "total_amount": 0.0, "description": "Receipt analysis from RECEIPT_Blue_Heron_Music_Festival_July_2025.jpg", "line_items": [{"description": "Receipt item (manual review required)", "quantity": 1, "unit_price": 0.0, "extracted_metadata": {"upc_code": null, "manufacturer": "Blue Heron", "model": null, "serial_number": null, "suggested_object_type": "expense", "category_suggestions": ["uncategorized"], "needs_manual_review": true}}], "enhanced_analysis": true, "metadata_extraction": "fallback", "event_details": null, "digital_assets": {}, "overall_confidence": 0.3}'}}
2025-05-25 13:26:36,066 - routes - INFO - Receipt queued for review: Task ID 6
2025-05-25 13:26:36,072 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:26:36,073 - routes - INFO - DEBUG: Processing task 6, type=receipt_processing, status=pending_review
2025-05-25 13:26:36,074 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:26:36,074 - routes - INFO - Task 6 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:26:36,075 - routes - INFO - DEBUG: Task 6 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:26:36,076 - routes - INFO - Task 6 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:26:36,077 - routes - INFO - DEBUG: Task 6 has AI analysis
2025-05-25 13:26:36,077 - routes - INFO - DEBUG: Added task 6 to receipt_tasks, now has 1 items
2025-05-25 13:26:36,078 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:26:36,079 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:27:06,426 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:27:06,426 - routes - INFO - DEBUG: Processing task 6, type=receipt_processing, status=pending_review
2025-05-25 13:27:06,428 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:27:06,428 - routes - INFO - Task 6 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:27:06,429 - routes - INFO - DEBUG: Task 6 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:27:06,430 - routes - INFO - Task 6 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:27:06,431 - routes - INFO - DEBUG: Task 6 has AI analysis
2025-05-25 13:27:06,431 - routes - INFO - DEBUG: Added task 6 to receipt_tasks, now has 1 items
2025-05-25 13:27:06,432 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:27:06,433 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:27:36,646 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:27:36,647 - routes - INFO - DEBUG: Processing task 6, type=receipt_processing, status=pending_review
2025-05-25 13:27:36,648 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:27:36,649 - routes - INFO - Task 6 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:27:36,650 - routes - INFO - DEBUG: Task 6 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:27:36,651 - routes - INFO - Task 6 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:27:36,651 - routes - INFO - DEBUG: Task 6 has AI analysis
2025-05-25 13:27:36,652 - routes - INFO - DEBUG: Added task 6 to receipt_tasks, now has 1 items
2025-05-25 13:27:36,653 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:27:36,654 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:28:19,947 - app - INFO - Creating database tables...
2025-05-25 13:28:19,949 - app - INFO - Creating database tables...
2025-05-25 13:28:19,964 - app - INFO - Database tables created successfully
2025-05-25 13:28:19,965 - app - INFO - Database tables created successfully
2025-05-25 13:28:19,990 - app - INFO - Creating database tables...
2025-05-25 13:28:20,010 - app - INFO - Database tables created successfully
2025-05-25 13:28:20,080 - app - INFO - Creating database tables...
2025-05-25 13:28:20,097 - app - INFO - Database tables created successfully
2025-05-25 13:28:20,549 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:28:20,565 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:28:20,566 - routes - INFO - DEBUG: Processing task 6, type=receipt_processing, status=pending_review
2025-05-25 13:28:20,566 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:28:20,567 - routes - INFO - Detected event from receipt: analysis from receipt_blue_heron_music_festival_july_2025.jpg (confidence: 0.6, 0 consumable items)
2025-05-25 13:28:20,568 - routes - INFO - Task 6 - Detected event from receipt data: Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg
2025-05-25 13:28:20,569 - routes - INFO - DEBUG: Task 6 extracted receipt data: vendor=Blue Heron, total=$0.0
2025-05-25 13:28:20,570 - routes - INFO - Task 6 has event details: {'event_name': 'Analysis From Receipt_Blue_Heron_Music_Festival_July_2025.Jpg', 'event_date': '2025-05-25', 'venue_location': '', 'description': 'receipt analysis from receipt_blue_heron_music_festival_july_2025.jpg', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 13:28:20,571 - routes - INFO - DEBUG: Task 6 has AI analysis
2025-05-25 13:28:20,572 - routes - INFO - DEBUG: Added task 6 to receipt_tasks, now has 1 items
2025-05-25 13:28:20,573 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:28:20,574 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:28:20,597 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:28:20,682 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:28:22,816 - routes - INFO - Receipt task 6 rejected: 
2025-05-25 13:28:22,823 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 13:28:22,824 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 13:28:22,825 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 13:28:26,093 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 13:28:26,094 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 13:28:26,095 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpuglpxs15.pdf
2025-05-25 13:28:26,096 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 13:28:26,516 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 13:28:26,517 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 13:28:26,598 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 13:28:26,599 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 13:28:26,947 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 13:28:26,949 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 13:28:26,950 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 13:28:35,832 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 13:28:35,833 - mcp_client - INFO - Receipt analyzed successfully with claude
2025-05-25 13:28:35,835 - routes - INFO - MCP analysis successful: {'content': {'vendor_name': 'Great Blue Heron Music Festival', 'date': '2025-07-03', 'total_amount': 257.61, 'subtotal': 216.0, 'tax_amount': 0.0, 'fees': 41.61, 'document_type': 'ticket confirmation', 'description': 'Music festival ticket purchase', 'line_items': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'entertainment', 'object_type': 'service', 'confidence': 0.95}], 'digital_assets': {'qr_codes': ['present in image'], 'urls': ['2361 Wells Corners Rd, Sherman, 14781, United States']}, 'event_details': {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}, 'vendor_details': {'business_address': '2361 Wells Corners Rd, Sherman, 14781, United States'}, 'overall_confidence': 0.95, 'image_quality': 'high', 'extraction_notes': 'Clear ticket confirmation email with complete event and payment details'}, 'provider': 'claude', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 8.842727184295654, 'timestamp': '2025-05-25T13:28:35.831154', 'tokens_used': 3266, 'cost_estimate': 0.015318}
2025-05-25 13:28:35,852 - routes - INFO - Receipt queued for review: Task ID 7
2025-05-25 13:28:35,859 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:28:35,860 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-25 13:28:35,861 - routes - INFO - DEBUG: Task 7 using legacy structure
2025-05-25 13:28:35,862 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-25 13:28:35,862 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-25 13:28:35,863 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:28:35,864 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:29:05,150 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:29:05,150 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-25 13:29:05,151 - routes - INFO - DEBUG: Task 7 using legacy structure
2025-05-25 13:29:05,152 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-25 13:29:05,153 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-25 13:29:05,154 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:29:05,155 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:29:36,474 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:29:36,475 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-25 13:29:36,475 - routes - INFO - DEBUG: Task 7 using legacy structure
2025-05-25 13:29:36,476 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-25 13:29:36,477 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-25 13:29:36,478 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:29:36,479 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:30:06,591 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:30:06,592 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-25 13:30:06,594 - routes - INFO - DEBUG: Task 7 using legacy structure
2025-05-25 13:30:06,595 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-25 13:30:06,597 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-25 13:30:06,598 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:30:06,599 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:30:36,918 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:30:36,919 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-25 13:30:36,920 - routes - INFO - DEBUG: Task 7 using legacy structure
2025-05-25 13:30:36,921 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-25 13:30:36,922 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-25 13:30:36,922 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:30:36,923 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:31:07,227 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:31:07,228 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-25 13:31:07,228 - routes - INFO - DEBUG: Task 7 using legacy structure
2025-05-25 13:31:07,229 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-25 13:31:07,230 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-25 13:31:07,231 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:31:07,231 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:31:37,440 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:31:37,442 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-25 13:31:37,443 - routes - INFO - DEBUG: Task 7 using legacy structure
2025-05-25 13:31:37,444 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-25 13:31:37,445 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-25 13:31:37,446 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:31:37,447 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:32:07,685 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:32:07,687 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-25 13:32:07,688 - routes - INFO - DEBUG: Task 7 using legacy structure
2025-05-25 13:32:07,688 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-25 13:32:07,689 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-25 13:32:07,690 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:32:07,691 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:32:35,982 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:32:35,983 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-25 13:32:35,984 - routes - INFO - DEBUG: Task 7 using legacy structure
2025-05-25 13:32:35,984 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-25 13:32:35,985 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-25 13:32:35,986 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:32:35,987 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:33:06,207 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:33:06,209 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-25 13:33:06,209 - routes - INFO - DEBUG: Task 7 using legacy structure
2025-05-25 13:33:06,210 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-25 13:33:06,211 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-25 13:33:06,212 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:33:06,213 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:33:36,487 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:33:36,489 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-25 13:33:36,490 - routes - INFO - DEBUG: Task 7 using legacy structure
2025-05-25 13:33:36,491 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-25 13:33:36,492 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-25 13:33:36,492 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:33:36,493 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:34:06,713 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:34:06,714 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-25 13:34:06,715 - routes - INFO - DEBUG: Task 7 using legacy structure
2025-05-25 13:34:06,716 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-25 13:34:06,717 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-25 13:34:06,718 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:34:06,719 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:34:38,929 - app - INFO - Creating database tables...
2025-05-25 13:34:38,931 - app - INFO - Creating database tables...
2025-05-25 13:34:38,948 - app - INFO - Database tables created successfully
2025-05-25 13:34:38,949 - app - INFO - Creating database tables...
2025-05-25 13:34:38,950 - app - INFO - Database tables created successfully
2025-05-25 13:34:38,967 - app - INFO - Database tables created successfully
2025-05-25 13:34:39,020 - app - INFO - Creating database tables...
2025-05-25 13:34:39,045 - app - INFO - Database tables created successfully
2025-05-25 13:34:39,930 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:34:39,932 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:34:39,935 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:34:39,939 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:34:48,480 - app - INFO - Creating database tables...
2025-05-25 13:34:48,496 - app - INFO - Database tables created successfully
2025-05-25 13:34:48,509 - app - INFO - Creating database tables...
2025-05-25 13:34:48,525 - app - INFO - Database tables created successfully
2025-05-25 13:34:48,602 - app - INFO - Creating database tables...
2025-05-25 13:34:48,619 - app - INFO - Database tables created successfully
2025-05-25 13:34:48,639 - app - INFO - Creating database tables...
2025-05-25 13:34:48,655 - app - INFO - Database tables created successfully
2025-05-25 13:34:49,040 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:34:49,062 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:34:49,170 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:34:49,188 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:34:50,553 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:34:50,554 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-25 13:34:50,555 - routes - INFO - DEBUG: Task 7 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:34:50,555 - routes - INFO - DEBUG: Task 7 - using legacy structure, ai_analysis: {'content': {'date': '2025-07-03', 'fees': 41.61, 'subtotal': 216.0, 'line_items': [{'category': 'entertainment', 'quantity': 1.0, 'confidence': 0.95, 'unit_price': 216.0, 'description': 'Weekend Pass Thursday Entry', 'object_type': 'service', 'total_price': 216.0}], 'tax_amount': 0.0, 'description': 'Music festival ticket purchase', 'vendor_name': 'Great Blue Heron Music Festival', 'total_amount': 257.61, 'document_type': 'ticket confirmation', 'event_details': {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}, 'image_quality': 'high', 'digital_assets': {'urls': ['2361 Wells Corners Rd, Sherman, 14781, United States'], 'qr_codes': ['present in image']}, 'vendor_details': {'business_address': '2361 Wells Corners Rd, Sherman, 14781, United States'}, 'extraction_notes': 'Clear ticket confirmation email with complete event and payment details', 'overall_confidence': 0.95}, 'provider': 'claude', 'timestamp': '2025-05-25T13:28:35.831154', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 3266, 'cost_estimate': 0.015318, 'processing_time': 8.842727184295654}
2025-05-25 13:34:50,556 - routes - INFO - DEBUG: Task 7 using legacy structure, vendor=
2025-05-25 13:34:50,557 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-25 13:34:50,558 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-25 13:34:50,558 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:34:50,559 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:34:57,862 - routes - INFO - Receipt task 7 rejected: 
2025-05-25 13:34:57,868 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 13:34:57,869 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 13:34:57,870 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 13:35:02,667 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 13:35:02,668 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 13:35:02,669 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpkvwq1et8.pdf
2025-05-25 13:35:02,670 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 13:35:03,105 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 13:35:03,105 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 13:35:03,180 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 13:35:03,181 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 13:35:03,542 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 13:35:03,544 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 13:35:03,545 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 13:35:13,461 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 13:35:13,462 - mcp_client - INFO - Receipt analyzed successfully with claude
2025-05-25 13:35:13,463 - routes - INFO - MCP analysis successful: {'content': {'vendor_name': 'Great Blue Heron Music Festival', 'date': '2025-07-03', 'total_amount': 257.61, 'subtotal': 216.0, 'tax_amount': 0.0, 'fees': 41.61, 'document_type': 'ticket confirmation', 'description': 'Music festival ticket purchase', 'line_items': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'entertainment', 'object_type': 'service', 'confidence': 0.95}], 'event_details': {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}, 'digital_assets': {'qr_codes': ['present in image'], 'urls': ['your event schedule']}, 'vendor_details': {'business_address': '2361 Waits Corners Rd, Sherman, 14781, United States'}, 'overall_confidence': 0.95, 'image_quality': 'high', 'extraction_notes': 'This is a ticket confirmation email from Eventeny for a music festival event'}, 'provider': 'claude', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 9.876890659332275, 'timestamp': '2025-05-25T13:35:13.460188', 'tokens_used': 3263, 'cost_estimate': 0.015273}
2025-05-25 13:35:13,479 - routes - INFO - Receipt queued for review: Task ID 8
2025-05-25 13:35:13,486 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:35:13,487 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-25 13:35:13,488 - routes - INFO - DEBUG: Task 8 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:35:13,489 - routes - INFO - DEBUG: Task 8 - using legacy structure, ai_analysis: {'content': {'date': '2025-07-03', 'fees': 41.61, 'subtotal': 216.0, 'line_items': [{'category': 'entertainment', 'quantity': 1.0, 'confidence': 0.95, 'unit_price': 216.0, 'description': 'Weekend Pass Thursday Entry', 'object_type': 'service', 'total_price': 216.0}], 'tax_amount': 0.0, 'description': 'Music festival ticket purchase', 'vendor_name': 'Great Blue Heron Music Festival', 'total_amount': 257.61, 'document_type': 'ticket confirmation', 'event_details': {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}, 'image_quality': 'high', 'digital_assets': {'urls': ['your event schedule'], 'qr_codes': ['present in image']}, 'vendor_details': {'business_address': '2361 Waits Corners Rd, Sherman, 14781, United States'}, 'extraction_notes': 'This is a ticket confirmation email from Eventeny for a music festival event', 'overall_confidence': 0.95}, 'provider': 'claude', 'timestamp': '2025-05-25T13:35:13.460188', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 3263, 'cost_estimate': 0.015273, 'processing_time': 9.876890659332275}
2025-05-25 13:35:13,489 - routes - INFO - DEBUG: Task 8 using legacy structure, vendor=
2025-05-25 13:35:13,490 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-25 13:35:13,491 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 1 items
2025-05-25 13:35:13,492 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:35:13,493 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:35:43,745 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:35:43,746 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-25 13:35:43,747 - routes - INFO - DEBUG: Task 8 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:35:43,748 - routes - INFO - DEBUG: Task 8 - using legacy structure, ai_analysis: {'content': {'date': '2025-07-03', 'fees': 41.61, 'subtotal': 216.0, 'line_items': [{'category': 'entertainment', 'quantity': 1.0, 'confidence': 0.95, 'unit_price': 216.0, 'description': 'Weekend Pass Thursday Entry', 'object_type': 'service', 'total_price': 216.0}], 'tax_amount': 0.0, 'description': 'Music festival ticket purchase', 'vendor_name': 'Great Blue Heron Music Festival', 'total_amount': 257.61, 'document_type': 'ticket confirmation', 'event_details': {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}, 'image_quality': 'high', 'digital_assets': {'urls': ['your event schedule'], 'qr_codes': ['present in image']}, 'vendor_details': {'business_address': '2361 Waits Corners Rd, Sherman, 14781, United States'}, 'extraction_notes': 'This is a ticket confirmation email from Eventeny for a music festival event', 'overall_confidence': 0.95}, 'provider': 'claude', 'timestamp': '2025-05-25T13:35:13.460188', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 3263, 'cost_estimate': 0.015273, 'processing_time': 9.876890659332275}
2025-05-25 13:35:43,749 - routes - INFO - DEBUG: Task 8 using legacy structure, vendor=
2025-05-25 13:35:43,750 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-25 13:35:43,751 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 1 items
2025-05-25 13:35:43,752 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:35:43,752 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:36:13,931 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:36:13,932 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-25 13:36:13,933 - routes - INFO - DEBUG: Task 8 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:36:13,934 - routes - INFO - DEBUG: Task 8 - using legacy structure, ai_analysis: {'content': {'date': '2025-07-03', 'fees': 41.61, 'subtotal': 216.0, 'line_items': [{'category': 'entertainment', 'quantity': 1.0, 'confidence': 0.95, 'unit_price': 216.0, 'description': 'Weekend Pass Thursday Entry', 'object_type': 'service', 'total_price': 216.0}], 'tax_amount': 0.0, 'description': 'Music festival ticket purchase', 'vendor_name': 'Great Blue Heron Music Festival', 'total_amount': 257.61, 'document_type': 'ticket confirmation', 'event_details': {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}, 'image_quality': 'high', 'digital_assets': {'urls': ['your event schedule'], 'qr_codes': ['present in image']}, 'vendor_details': {'business_address': '2361 Waits Corners Rd, Sherman, 14781, United States'}, 'extraction_notes': 'This is a ticket confirmation email from Eventeny for a music festival event', 'overall_confidence': 0.95}, 'provider': 'claude', 'timestamp': '2025-05-25T13:35:13.460188', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 3263, 'cost_estimate': 0.015273, 'processing_time': 9.876890659332275}
2025-05-25 13:36:13,935 - routes - INFO - DEBUG: Task 8 using legacy structure, vendor=
2025-05-25 13:36:13,936 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-25 13:36:13,937 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 1 items
2025-05-25 13:36:13,938 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:36:13,938 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:36:44,345 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:36:44,346 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-25 13:36:44,346 - routes - INFO - DEBUG: Task 8 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:36:44,347 - routes - INFO - DEBUG: Task 8 - using legacy structure, ai_analysis: {'content': {'date': '2025-07-03', 'fees': 41.61, 'subtotal': 216.0, 'line_items': [{'category': 'entertainment', 'quantity': 1.0, 'confidence': 0.95, 'unit_price': 216.0, 'description': 'Weekend Pass Thursday Entry', 'object_type': 'service', 'total_price': 216.0}], 'tax_amount': 0.0, 'description': 'Music festival ticket purchase', 'vendor_name': 'Great Blue Heron Music Festival', 'total_amount': 257.61, 'document_type': 'ticket confirmation', 'event_details': {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}, 'image_quality': 'high', 'digital_assets': {'urls': ['your event schedule'], 'qr_codes': ['present in image']}, 'vendor_details': {'business_address': '2361 Waits Corners Rd, Sherman, 14781, United States'}, 'extraction_notes': 'This is a ticket confirmation email from Eventeny for a music festival event', 'overall_confidence': 0.95}, 'provider': 'claude', 'timestamp': '2025-05-25T13:35:13.460188', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 3263, 'cost_estimate': 0.015273, 'processing_time': 9.876890659332275}
2025-05-25 13:36:44,348 - routes - INFO - DEBUG: Task 8 using legacy structure, vendor=
2025-05-25 13:36:44,349 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-25 13:36:44,350 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 1 items
2025-05-25 13:36:44,350 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:36:44,351 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:37:14,628 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:37:14,628 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-25 13:37:14,629 - routes - INFO - DEBUG: Task 8 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:37:14,630 - routes - INFO - DEBUG: Task 8 - using legacy structure, ai_analysis: {'content': {'date': '2025-07-03', 'fees': 41.61, 'subtotal': 216.0, 'line_items': [{'category': 'entertainment', 'quantity': 1.0, 'confidence': 0.95, 'unit_price': 216.0, 'description': 'Weekend Pass Thursday Entry', 'object_type': 'service', 'total_price': 216.0}], 'tax_amount': 0.0, 'description': 'Music festival ticket purchase', 'vendor_name': 'Great Blue Heron Music Festival', 'total_amount': 257.61, 'document_type': 'ticket confirmation', 'event_details': {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}, 'image_quality': 'high', 'digital_assets': {'urls': ['your event schedule'], 'qr_codes': ['present in image']}, 'vendor_details': {'business_address': '2361 Waits Corners Rd, Sherman, 14781, United States'}, 'extraction_notes': 'This is a ticket confirmation email from Eventeny for a music festival event', 'overall_confidence': 0.95}, 'provider': 'claude', 'timestamp': '2025-05-25T13:35:13.460188', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 3263, 'cost_estimate': 0.015273, 'processing_time': 9.876890659332275}
2025-05-25 13:37:14,631 - routes - INFO - DEBUG: Task 8 using legacy structure, vendor=
2025-05-25 13:37:14,632 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-25 13:37:14,633 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 1 items
2025-05-25 13:37:14,633 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:37:14,634 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:38:06,074 - app - INFO - Creating database tables...
2025-05-25 13:38:06,075 - app - INFO - Creating database tables...
2025-05-25 13:38:06,079 - app - INFO - Creating database tables...
2025-05-25 13:38:06,081 - app - INFO - Creating database tables...
2025-05-25 13:38:06,093 - app - INFO - Database tables created successfully
2025-05-25 13:38:06,094 - app - INFO - Database tables created successfully
2025-05-25 13:38:06,096 - app - INFO - Database tables created successfully
2025-05-25 13:38:06,098 - app - INFO - Database tables created successfully
2025-05-25 13:38:07,031 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:38:07,032 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:38:07,032 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:38:07,033 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:38:07,045 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:38:07,046 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-25 13:38:07,047 - routes - INFO - DEBUG: Task 8 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:38:07,047 - routes - INFO - DEBUG: Task 8 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:38:07,048 - routes - INFO - DEBUG: Task 8 - using CURRENT format, vendor_name found in content
2025-05-25 13:38:07,049 - routes - INFO - DEBUG: Task 8 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:38:07,050 - routes - INFO - DEBUG: Task 8 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:38:07,050 - routes - INFO - Task 8 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:38:07,051 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-25 13:38:07,052 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 1 items
2025-05-25 13:38:07,053 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:38:07,054 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:38:37,307 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:38:37,308 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-25 13:38:37,309 - routes - INFO - DEBUG: Task 8 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:38:37,310 - routes - INFO - DEBUG: Task 8 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:38:37,310 - routes - INFO - DEBUG: Task 8 - using CURRENT format, vendor_name found in content
2025-05-25 13:38:37,311 - routes - INFO - DEBUG: Task 8 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:38:37,312 - routes - INFO - DEBUG: Task 8 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:38:37,313 - routes - INFO - Task 8 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:38:37,314 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-25 13:38:37,314 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 1 items
2025-05-25 13:38:37,315 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:38:37,316 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:39:07,605 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:39:07,606 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-25 13:39:07,607 - routes - INFO - DEBUG: Task 8 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:39:07,608 - routes - INFO - DEBUG: Task 8 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:39:07,608 - routes - INFO - DEBUG: Task 8 - using CURRENT format, vendor_name found in content
2025-05-25 13:39:07,609 - routes - INFO - DEBUG: Task 8 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:39:07,610 - routes - INFO - DEBUG: Task 8 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:39:07,610 - routes - INFO - Task 8 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:39:07,611 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-25 13:39:07,612 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 1 items
2025-05-25 13:39:07,613 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:39:07,614 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:39:15,870 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:39:15,871 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-25 13:39:15,872 - routes - INFO - DEBUG: Task 8 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:39:15,873 - routes - INFO - DEBUG: Task 8 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:39:15,874 - routes - INFO - DEBUG: Task 8 - using CURRENT format, vendor_name found in content
2025-05-25 13:39:15,874 - routes - INFO - DEBUG: Task 8 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:39:15,875 - routes - INFO - DEBUG: Task 8 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:39:15,876 - routes - INFO - Task 8 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:39:15,876 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-25 13:39:15,877 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 1 items
2025-05-25 13:39:15,878 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:39:15,879 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:39:46,298 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:39:46,299 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-25 13:39:46,300 - routes - INFO - DEBUG: Task 8 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:39:46,301 - routes - INFO - DEBUG: Task 8 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:39:46,302 - routes - INFO - DEBUG: Task 8 - using CURRENT format, vendor_name found in content
2025-05-25 13:39:46,303 - routes - INFO - DEBUG: Task 8 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:39:46,303 - routes - INFO - DEBUG: Task 8 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:39:46,304 - routes - INFO - Task 8 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:39:46,305 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-25 13:39:46,306 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 1 items
2025-05-25 13:39:46,307 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:39:46,307 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:40:12,802 - routes - INFO - Auto-classified 'Weekend Pass Thursday Entry' as consumable event ticket
2025-05-25 13:40:12,812 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from task 8
2025-05-25 13:40:13,796 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:40:13,797 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-25 13:40:13,798 - routes - INFO - DEBUG: Task 8 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:40:13,799 - routes - INFO - DEBUG: Task 8 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:40:13,799 - routes - INFO - DEBUG: Task 8 - using CURRENT format, vendor_name found in content
2025-05-25 13:40:13,800 - routes - INFO - DEBUG: Task 8 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:40:13,801 - routes - INFO - DEBUG: Task 8 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:40:13,802 - routes - INFO - Task 8 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:40:13,802 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-25 13:40:13,803 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 1 items
2025-05-25 13:40:13,804 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:40:13,804 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:40:34,077 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 13:40:34,078 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 13:40:34,081 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpmsaol1w5.pdf
2025-05-25 13:40:34,082 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 13:40:34,540 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 13:40:34,541 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 13:40:34,618 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 13:40:34,619 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 13:40:34,944 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 13:40:34,946 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 13:40:34,947 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 13:40:43,839 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 13:40:43,841 - mcp_client - INFO - Receipt analyzed successfully with claude
2025-05-25 13:40:43,843 - routes - INFO - MCP analysis successful: {'content': {'vendor_name': 'Great Blue Heron Music Festival', 'date': '2025-07-03', 'total_amount': 257.61, 'subtotal': 216.0, 'tax_amount': 0.0, 'fees': 41.61, 'document_type': 'ticket confirmation', 'description': 'Music festival ticket purchase', 'line_items': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'entertainment', 'object_type': 'service', 'confidence': 0.95}], 'digital_assets': {'qr_codes': ['present in image'], 'urls': ['2361 Wells Corners Rd, Sherman, 14781, United States']}, 'event_details': {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}, 'vendor_details': {'business_address': '2361 Wells Corners Rd, Sherman, 14781, United States'}, 'overall_confidence': 0.95, 'image_quality': 'high', 'extraction_notes': 'Clear ticket confirmation email with complete event and payment details'}, 'provider': 'claude', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 8.853455305099487, 'timestamp': '2025-05-25T13:40:43.836750', 'tokens_used': 3266, 'cost_estimate': 0.015318}
2025-05-25 13:40:43,856 - routes - INFO - Receipt queued for review: Task ID 9
2025-05-25 13:40:43,864 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 13:40:43,865 - routes - INFO - DEBUG: Processing task 9, type=receipt_processing, status=pending_review
2025-05-25 13:40:43,865 - routes - INFO - DEBUG: Task 9 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:40:43,866 - routes - INFO - DEBUG: Task 9 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:40:43,867 - routes - INFO - DEBUG: Task 9 - using CURRENT format, vendor_name found in content
2025-05-25 13:40:43,867 - routes - INFO - DEBUG: Task 9 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:40:43,868 - routes - INFO - DEBUG: Task 9 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:40:43,869 - routes - INFO - Task 9 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:40:43,870 - routes - INFO - DEBUG: Task 9 has AI analysis
2025-05-25 13:40:43,871 - routes - INFO - DEBUG: Added task 9 to receipt_tasks, now has 1 items
2025-05-25 13:40:43,871 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-25 13:40:43,872 - routes - INFO - DEBUG: Task 8 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:40:43,873 - routes - INFO - DEBUG: Task 8 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:40:43,874 - routes - INFO - DEBUG: Task 8 - using CURRENT format, vendor_name found in content
2025-05-25 13:40:43,874 - routes - INFO - DEBUG: Task 8 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:40:43,875 - routes - INFO - DEBUG: Task 8 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:40:43,876 - routes - INFO - Task 8 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:40:43,876 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-25 13:40:43,877 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 2 items
2025-05-25 13:40:43,878 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 13:40:43,878 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 13:41:02,751 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 13:41:02,752 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 13:41:02,753 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpw_35wwuj.pdf
2025-05-25 13:41:02,754 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 13:41:03,158 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 13:41:03,159 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 13:41:03,237 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 13:41:03,238 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 13:41:03,567 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 13:41:03,569 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 13:41:03,570 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 13:41:13,660 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 13:41:13,661 - mcp_client - INFO - Receipt analyzed successfully with claude
2025-05-25 13:41:13,662 - routes - INFO - MCP analysis successful: {'content': {'vendor_name': 'Great Blue Heron Music Festival', 'date': '2025-07-03', 'total_amount': 257.61, 'subtotal': 216.0, 'tax_amount': 0.0, 'fees': 41.61, 'receipt_number': None, 'document_type': 'ticket confirmation', 'description': 'Music festival ticket purchase', 'line_items': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'entertainment', 'object_type': 'service', 'confidence': 0.95}], 'event_details': {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}, 'digital_assets': {'qr_codes': ['present in image'], 'urls': ['your event schedule']}, 'vendor_details': {'business_address': '2361 Waits Corners Rd, Sherman, 14781, United States'}, 'overall_confidence': 0.95, 'image_quality': 'high', 'extraction_notes': 'This is a ticket confirmation email from Eventeny for a music festival event'}, 'provider': 'claude', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 10.05049204826355, 'timestamp': '2025-05-25T13:41:13.659237', 'tokens_used': 3272, 'cost_estimate': 0.015408000000000002}
2025-05-25 13:41:13,675 - routes - INFO - Receipt queued for review: Task ID 10
2025-05-25 13:41:13,682 - routes - INFO - DEBUG: Found 3 total tasks
2025-05-25 13:41:13,682 - routes - INFO - DEBUG: Processing task 10, type=receipt_processing, status=pending_review
2025-05-25 13:41:13,683 - routes - INFO - DEBUG: Task 10 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:41:13,684 - routes - INFO - DEBUG: Task 10 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:13,685 - routes - INFO - DEBUG: Task 10 - using CURRENT format, vendor_name found in content
2025-05-25 13:41:13,686 - routes - INFO - DEBUG: Task 10 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:13,686 - routes - INFO - DEBUG: Task 10 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:41:13,687 - routes - INFO - Task 10 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:41:13,688 - routes - INFO - DEBUG: Task 10 has AI analysis
2025-05-25 13:41:13,689 - routes - INFO - DEBUG: Added task 10 to receipt_tasks, now has 1 items
2025-05-25 13:41:13,690 - routes - INFO - DEBUG: Processing task 9, type=receipt_processing, status=pending_review
2025-05-25 13:41:13,691 - routes - INFO - DEBUG: Task 9 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:41:13,691 - routes - INFO - DEBUG: Task 9 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:13,692 - routes - INFO - DEBUG: Task 9 - using CURRENT format, vendor_name found in content
2025-05-25 13:41:13,693 - routes - INFO - DEBUG: Task 9 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:13,694 - routes - INFO - DEBUG: Task 9 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:41:13,694 - routes - INFO - Task 9 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:41:13,695 - routes - INFO - DEBUG: Task 9 has AI analysis
2025-05-25 13:41:13,696 - routes - INFO - DEBUG: Added task 9 to receipt_tasks, now has 2 items
2025-05-25 13:41:13,697 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-25 13:41:13,697 - routes - INFO - DEBUG: Task 8 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:41:13,698 - routes - INFO - DEBUG: Task 8 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:13,699 - routes - INFO - DEBUG: Task 8 - using CURRENT format, vendor_name found in content
2025-05-25 13:41:13,699 - routes - INFO - DEBUG: Task 8 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:13,700 - routes - INFO - DEBUG: Task 8 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:41:13,701 - routes - INFO - Task 8 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:41:13,702 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-25 13:41:13,702 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 3 items
2025-05-25 13:41:13,703 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 3, ai_evaluations: 0
2025-05-25 13:41:13,704 - routes - INFO - AI Queue loaded: 3 tasks (3 pending review, 0 failed)
2025-05-25 13:41:16,357 - routes - INFO - DEBUG: Found 3 total tasks
2025-05-25 13:41:16,358 - routes - INFO - DEBUG: Processing task 10, type=receipt_processing, status=pending_review
2025-05-25 13:41:16,359 - routes - INFO - DEBUG: Task 10 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:41:16,359 - routes - INFO - DEBUG: Task 10 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:16,360 - routes - INFO - DEBUG: Task 10 - using CURRENT format, vendor_name found in content
2025-05-25 13:41:16,361 - routes - INFO - DEBUG: Task 10 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:16,362 - routes - INFO - DEBUG: Task 10 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:41:16,362 - routes - INFO - Task 10 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:41:16,363 - routes - INFO - DEBUG: Task 10 has AI analysis
2025-05-25 13:41:16,364 - routes - INFO - DEBUG: Added task 10 to receipt_tasks, now has 1 items
2025-05-25 13:41:16,365 - routes - INFO - DEBUG: Processing task 9, type=receipt_processing, status=pending_review
2025-05-25 13:41:16,365 - routes - INFO - DEBUG: Task 9 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:41:16,366 - routes - INFO - DEBUG: Task 9 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:16,367 - routes - INFO - DEBUG: Task 9 - using CURRENT format, vendor_name found in content
2025-05-25 13:41:16,367 - routes - INFO - DEBUG: Task 9 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:16,368 - routes - INFO - DEBUG: Task 9 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:41:16,369 - routes - INFO - Task 9 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:41:16,369 - routes - INFO - DEBUG: Task 9 has AI analysis
2025-05-25 13:41:16,370 - routes - INFO - DEBUG: Added task 9 to receipt_tasks, now has 2 items
2025-05-25 13:41:16,371 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-25 13:41:16,372 - routes - INFO - DEBUG: Task 8 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:41:16,372 - routes - INFO - DEBUG: Task 8 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:16,373 - routes - INFO - DEBUG: Task 8 - using CURRENT format, vendor_name found in content
2025-05-25 13:41:16,374 - routes - INFO - DEBUG: Task 8 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:16,375 - routes - INFO - DEBUG: Task 8 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:41:16,375 - routes - INFO - Task 8 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:41:16,376 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-25 13:41:16,377 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 3 items
2025-05-25 13:41:16,377 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 3, ai_evaluations: 0
2025-05-25 13:41:16,378 - routes - INFO - AI Queue loaded: 3 tasks (3 pending review, 0 failed)
2025-05-25 13:41:21,289 - routes - INFO - Receipt task 8 rejected: 
2025-05-25 13:41:21,294 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 13:41:21,295 - routes - INFO - DEBUG: Processing task 10, type=receipt_processing, status=pending_review
2025-05-25 13:41:21,295 - routes - INFO - DEBUG: Task 10 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:41:21,296 - routes - INFO - DEBUG: Task 10 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:21,297 - routes - INFO - DEBUG: Task 10 - using CURRENT format, vendor_name found in content
2025-05-25 13:41:21,297 - routes - INFO - DEBUG: Task 10 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:21,298 - routes - INFO - DEBUG: Task 10 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:41:21,299 - routes - INFO - Task 10 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:41:21,300 - routes - INFO - DEBUG: Task 10 has AI analysis
2025-05-25 13:41:21,300 - routes - INFO - DEBUG: Added task 10 to receipt_tasks, now has 1 items
2025-05-25 13:41:21,301 - routes - INFO - DEBUG: Processing task 9, type=receipt_processing, status=pending_review
2025-05-25 13:41:21,302 - routes - INFO - DEBUG: Task 9 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:41:21,303 - routes - INFO - DEBUG: Task 9 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:21,304 - routes - INFO - DEBUG: Task 9 - using CURRENT format, vendor_name found in content
2025-05-25 13:41:21,305 - routes - INFO - DEBUG: Task 9 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:21,305 - routes - INFO - DEBUG: Task 9 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:41:21,306 - routes - INFO - Task 9 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:41:21,307 - routes - INFO - DEBUG: Task 9 has AI analysis
2025-05-25 13:41:21,308 - routes - INFO - DEBUG: Added task 9 to receipt_tasks, now has 2 items
2025-05-25 13:41:21,308 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 13:41:21,309 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 13:41:27,828 - routes - INFO - Successfully processed receipt task: Invoice INV-20250525-65220ED2, 0 objects created
2025-05-25 13:41:27,834 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:41:27,835 - routes - INFO - DEBUG: Processing task 10, type=receipt_processing, status=pending_review
2025-05-25 13:41:27,836 - routes - INFO - DEBUG: Task 10 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:41:27,837 - routes - INFO - DEBUG: Task 10 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:27,838 - routes - INFO - DEBUG: Task 10 - using CURRENT format, vendor_name found in content
2025-05-25 13:41:27,839 - routes - INFO - DEBUG: Task 10 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:27,840 - routes - INFO - DEBUG: Task 10 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:41:27,840 - routes - INFO - Task 10 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, New York 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:41:27,841 - routes - INFO - DEBUG: Task 10 has AI analysis
2025-05-25 13:41:27,842 - routes - INFO - DEBUG: Added task 10 to receipt_tasks, now has 1 items
2025-05-25 13:41:27,843 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:41:27,843 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:41:36,795 - routes - INFO - Receipt task 10 rejected: 
2025-05-25 13:41:36,800 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 13:41:36,801 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 13:41:36,801 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 13:41:42,784 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 13:41:42,785 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 13:41:42,787 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpuqcojprn.pdf
2025-05-25 13:41:42,788 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 13:41:43,212 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 13:41:43,213 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 13:41:43,289 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 13:41:43,290 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 13:41:43,621 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 13:41:43,623 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 13:41:43,624 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 13:41:52,640 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 13:41:52,641 - mcp_client - INFO - Receipt analyzed successfully with claude
2025-05-25 13:41:52,642 - routes - INFO - MCP analysis successful: {'content': {'vendor_name': 'Great Blue Heron Music Festival', 'date': '2025-07-03', 'total_amount': 257.61, 'subtotal': 216.0, 'tax_amount': 0.0, 'fees': 41.61, 'document_type': 'ticket confirmation', 'description': 'Music festival ticket purchase', 'line_items': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'entertainment', 'object_type': 'service', 'confidence': 0.95}], 'digital_assets': {'qr_codes': ['present in image'], 'urls': ['2361 Wells Corners Rd, Sherman, 14781, United States']}, 'event_details': {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}, 'vendor_details': {'business_address': '2361 Wells Corners Rd, Sherman, 14781, United States'}, 'overall_confidence': 0.95, 'image_quality': 'high', 'extraction_notes': 'Clear ticket confirmation email with complete event and payment details'}, 'provider': 'claude', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 8.98002290725708, 'timestamp': '2025-05-25T13:41:52.639223', 'tokens_used': 3266, 'cost_estimate': 0.015318}
2025-05-25 13:41:52,648 - routes - INFO - Receipt queued for review: Task ID 11
2025-05-25 13:41:52,655 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:41:52,655 - routes - INFO - DEBUG: Processing task 11, type=receipt_processing, status=pending_review
2025-05-25 13:41:52,656 - routes - INFO - DEBUG: Task 11 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:41:52,657 - routes - INFO - DEBUG: Task 11 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:52,658 - routes - INFO - DEBUG: Task 11 - using CURRENT format, vendor_name found in content
2025-05-25 13:41:52,659 - routes - INFO - DEBUG: Task 11 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:41:52,660 - routes - INFO - DEBUG: Task 11 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:41:52,660 - routes - INFO - Task 11 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:41:52,661 - routes - INFO - DEBUG: Task 11 has AI analysis
2025-05-25 13:41:52,662 - routes - INFO - DEBUG: Added task 11 to receipt_tasks, now has 1 items
2025-05-25 13:41:52,663 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:41:52,663 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:42:22,854 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:42:22,855 - routes - INFO - DEBUG: Processing task 11, type=receipt_processing, status=pending_review
2025-05-25 13:42:22,857 - routes - INFO - DEBUG: Task 11 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:42:22,857 - routes - INFO - DEBUG: Task 11 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:42:22,858 - routes - INFO - DEBUG: Task 11 - using CURRENT format, vendor_name found in content
2025-05-25 13:42:22,859 - routes - INFO - DEBUG: Task 11 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:42:22,859 - routes - INFO - DEBUG: Task 11 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:42:22,860 - routes - INFO - Task 11 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:42:22,861 - routes - INFO - DEBUG: Task 11 has AI analysis
2025-05-25 13:42:22,862 - routes - INFO - DEBUG: Added task 11 to receipt_tasks, now has 1 items
2025-05-25 13:42:22,863 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:42:22,863 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:42:39,345 - routes - INFO - Deleting receipt INV-20250525-65220ED2: 0 line items, 0 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-25 13:42:43,464 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:42:43,465 - routes - INFO - DEBUG: Processing task 11, type=receipt_processing, status=pending_review
2025-05-25 13:42:43,466 - routes - INFO - DEBUG: Task 11 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:42:43,467 - routes - INFO - DEBUG: Task 11 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:42:43,468 - routes - INFO - DEBUG: Task 11 - using CURRENT format, vendor_name found in content
2025-05-25 13:42:43,469 - routes - INFO - DEBUG: Task 11 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:42:43,469 - routes - INFO - DEBUG: Task 11 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:42:43,470 - routes - INFO - Task 11 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:42:43,471 - routes - INFO - DEBUG: Task 11 has AI analysis
2025-05-25 13:42:43,472 - routes - INFO - DEBUG: Added task 11 to receipt_tasks, now has 1 items
2025-05-25 13:42:43,473 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:42:43,473 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:42:45,377 - routes - INFO - Successfully processed receipt task: Invoice INV-20250525-1FEF600A, 0 objects created
2025-05-25 13:42:45,383 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 13:42:45,384 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 13:42:45,385 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 13:43:45,697 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 13:43:45,698 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 13:43:45,700 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpodyecnbi.pdf
2025-05-25 13:43:45,700 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 13:43:46,089 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 13:43:46,090 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 13:43:46,182 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 13:43:46,183 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 13:43:46,544 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 13:43:46,546 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 13:43:46,546 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-25 13:44:04,641 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 13:44:04,643 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-25 13:44:04,644 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-05-17",\n  "total_amount": 257.61,\n  "subtotal": 216.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 216.00,\n      "total_price": 216.00,\n      "item_details": "Entry on 1:00 pm",\n      "create_object": false,\n      "object_type": "service",\n      "category": "event",\n      "expiration_info": {\n        "expiration_date": "2025-07-06",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": ""\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": false,\n      "person_name": "Nate Smith",\n      "role": "Attendee",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://www.eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 pm",\n    "venue_location": "2361 Waits Corners Rd, Sherman 14781, United States",\n    "seat_info": "",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "",\n    "business_phone": "",\n    "business_email": "express@eventeny.com",\n    "business_website": "https://www.eventeny.com",\n    "business_hours": "",\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "Extracted from email receipt for event ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 18.06832790374756, 'timestamp': '2025-05-25T13:44:04.641045', 'tokens_used': 3656, 'cost_estimate': 0.02445}
2025-05-25 13:44:04,660 - routes - INFO - Receipt queued for review: Task ID 12
2025-05-25 13:44:04,667 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:44:04,668 - routes - INFO - DEBUG: Processing task 12, type=receipt_processing, status=pending_review
2025-05-25 13:44:04,669 - routes - INFO - DEBUG: Task 12 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:44:04,670 - routes - INFO - DEBUG: Task 12 - content type: <class 'dict'>, keys: ['response']
2025-05-25 13:44:04,670 - routes - INFO - DEBUG: Task 12 - using LEGACY format, response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDV...
2025-05-25 13:44:04,671 - routes - INFO - DEBUG: Task 12 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "p...
2025-05-25 13:44:04,672 - routes - INFO - DEBUG: Task 12 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'tip_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 13:44:04,673 - routes - INFO - DEBUG: Task 12 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 13:44:04,674 - routes - INFO - Task 12 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman 14781, United States', 'seat_info': '', 'additional_details': {}}
2025-05-25 13:44:04,675 - routes - INFO - DEBUG: Task 12 has AI analysis
2025-05-25 13:44:04,675 - routes - INFO - DEBUG: Added task 12 to receipt_tasks, now has 1 items
2025-05-25 13:44:04,676 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:44:04,677 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:44:34,927 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:44:34,928 - routes - INFO - DEBUG: Processing task 12, type=receipt_processing, status=pending_review
2025-05-25 13:44:34,929 - routes - INFO - DEBUG: Task 12 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:44:34,929 - routes - INFO - DEBUG: Task 12 - content type: <class 'dict'>, keys: ['response']
2025-05-25 13:44:34,930 - routes - INFO - DEBUG: Task 12 - using LEGACY format, response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDV...
2025-05-25 13:44:34,931 - routes - INFO - DEBUG: Task 12 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "p...
2025-05-25 13:44:34,932 - routes - INFO - DEBUG: Task 12 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'tip_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 13:44:34,932 - routes - INFO - DEBUG: Task 12 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 13:44:34,933 - routes - INFO - Task 12 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman 14781, United States', 'seat_info': '', 'additional_details': {}}
2025-05-25 13:44:34,934 - routes - INFO - DEBUG: Task 12 has AI analysis
2025-05-25 13:44:34,935 - routes - INFO - DEBUG: Added task 12 to receipt_tasks, now has 1 items
2025-05-25 13:44:34,935 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:44:34,936 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:45:05,202 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:45:05,203 - routes - INFO - DEBUG: Processing task 12, type=receipt_processing, status=pending_review
2025-05-25 13:45:05,204 - routes - INFO - DEBUG: Task 12 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:45:05,205 - routes - INFO - DEBUG: Task 12 - content type: <class 'dict'>, keys: ['response']
2025-05-25 13:45:05,206 - routes - INFO - DEBUG: Task 12 - using LEGACY format, response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDV...
2025-05-25 13:45:05,207 - routes - INFO - DEBUG: Task 12 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "p...
2025-05-25 13:45:05,207 - routes - INFO - DEBUG: Task 12 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'tip_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 13:45:05,208 - routes - INFO - DEBUG: Task 12 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 13:45:05,209 - routes - INFO - Task 12 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman 14781, United States', 'seat_info': '', 'additional_details': {}}
2025-05-25 13:45:05,210 - routes - INFO - DEBUG: Task 12 has AI analysis
2025-05-25 13:45:05,210 - routes - INFO - DEBUG: Added task 12 to receipt_tasks, now has 1 items
2025-05-25 13:45:05,211 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:45:05,212 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:45:32,690 - routes - INFO - Created person object 'Nate Smith' from task 12
2025-05-25 13:45:33,784 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:45:33,785 - routes - INFO - DEBUG: Processing task 12, type=receipt_processing, status=pending_review
2025-05-25 13:45:33,787 - routes - INFO - DEBUG: Task 12 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:45:33,788 - routes - INFO - DEBUG: Task 12 - content type: <class 'dict'>, keys: ['response']
2025-05-25 13:45:33,788 - routes - INFO - DEBUG: Task 12 - using LEGACY format, response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDV...
2025-05-25 13:45:33,789 - routes - INFO - DEBUG: Task 12 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "p...
2025-05-25 13:45:33,790 - routes - INFO - DEBUG: Task 12 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'tip_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 13:45:33,791 - routes - INFO - DEBUG: Task 12 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 13:45:33,791 - routes - INFO - Task 12 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman 14781, United States', 'seat_info': '', 'additional_details': {}}
2025-05-25 13:45:33,792 - routes - INFO - DEBUG: Task 12 has AI analysis
2025-05-25 13:45:33,793 - routes - INFO - DEBUG: Added task 12 to receipt_tasks, now has 1 items
2025-05-25 13:45:33,793 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:45:33,794 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:45:35,779 - routes - INFO - Created calendar event 'Great Blue Heron Music Festival 2025' from task 12
2025-05-25 13:45:36,923 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:45:36,924 - routes - INFO - DEBUG: Processing task 12, type=receipt_processing, status=pending_review
2025-05-25 13:45:36,925 - routes - INFO - DEBUG: Task 12 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:45:36,926 - routes - INFO - DEBUG: Task 12 - content type: <class 'dict'>, keys: ['response']
2025-05-25 13:45:36,926 - routes - INFO - DEBUG: Task 12 - using LEGACY format, response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDV...
2025-05-25 13:45:36,927 - routes - INFO - DEBUG: Task 12 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "p...
2025-05-25 13:45:36,928 - routes - INFO - DEBUG: Task 12 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'tip_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 13:45:36,929 - routes - INFO - DEBUG: Task 12 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 13:45:36,929 - routes - INFO - Task 12 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman 14781, United States', 'seat_info': '', 'additional_details': {}}
2025-05-25 13:45:36,930 - routes - INFO - DEBUG: Task 12 has AI analysis
2025-05-25 13:45:36,931 - routes - INFO - DEBUG: Added task 12 to receipt_tasks, now has 1 items
2025-05-25 13:45:36,932 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:45:36,932 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:45:52,827 - routes - INFO - Auto-classified 'Weekend Pass Thursday Entry' as consumable event ticket
2025-05-25 13:45:52,839 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from task 12
2025-05-25 13:45:53,666 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:45:53,667 - routes - INFO - DEBUG: Processing task 12, type=receipt_processing, status=pending_review
2025-05-25 13:45:53,668 - routes - INFO - DEBUG: Task 12 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:45:53,668 - routes - INFO - DEBUG: Task 12 - content type: <class 'dict'>, keys: ['response']
2025-05-25 13:45:53,669 - routes - INFO - DEBUG: Task 12 - using LEGACY format, response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDV...
2025-05-25 13:45:53,670 - routes - INFO - DEBUG: Task 12 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "p...
2025-05-25 13:45:53,671 - routes - INFO - DEBUG: Task 12 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'tip_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 13:45:53,672 - routes - INFO - DEBUG: Task 12 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 13:45:53,672 - routes - INFO - Task 12 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman 14781, United States', 'seat_info': '', 'additional_details': {}}
2025-05-25 13:45:53,673 - routes - INFO - DEBUG: Task 12 has AI analysis
2025-05-25 13:45:53,674 - routes - INFO - DEBUG: Added task 12 to receipt_tasks, now has 1 items
2025-05-25 13:45:53,675 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:45:53,676 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:46:04,376 - routes - INFO - Deleted consumable object: Weekend Pass Thursday Entry (ID: 1)
2025-05-25 13:48:06,937 - routes - INFO - Deleting receipt INV-20250525-1FEF600A: 0 line items, 0 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-25 13:48:16,002 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:48:16,003 - routes - INFO - DEBUG: Processing task 12, type=receipt_processing, status=pending_review
2025-05-25 13:48:16,004 - routes - INFO - DEBUG: Task 12 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:48:16,005 - routes - INFO - DEBUG: Task 12 - content type: <class 'dict'>, keys: ['response']
2025-05-25 13:48:16,005 - routes - INFO - DEBUG: Task 12 - using LEGACY format, response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDV...
2025-05-25 13:48:16,006 - routes - INFO - DEBUG: Task 12 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "p...
2025-05-25 13:48:16,007 - routes - INFO - DEBUG: Task 12 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'tip_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 13:48:16,008 - routes - INFO - DEBUG: Task 12 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 13:48:16,009 - routes - INFO - Task 12 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 pm', 'venue_location': '2361 Waits Corners Rd, Sherman 14781, United States', 'seat_info': '', 'additional_details': {}}
2025-05-25 13:48:16,010 - routes - INFO - DEBUG: Task 12 has AI analysis
2025-05-25 13:48:16,011 - routes - INFO - DEBUG: Added task 12 to receipt_tasks, now has 1 items
2025-05-25 13:48:16,011 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:48:16,012 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:48:18,962 - routes - INFO - Receipt task 12 rejected: 
2025-05-25 13:48:18,967 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 13:48:18,968 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 13:48:18,969 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 13:48:31,415 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 13:48:31,415 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 13:48:31,416 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 13:49:59,096 - app - INFO - Creating database tables...
2025-05-25 13:49:59,097 - app - INFO - Creating database tables...
2025-05-25 13:49:59,100 - app - INFO - Creating database tables...
2025-05-25 13:49:59,101 - app - INFO - Creating database tables...
2025-05-25 13:49:59,114 - app - INFO - Database tables created successfully
2025-05-25 13:49:59,114 - app - INFO - Database tables created successfully
2025-05-25 13:49:59,117 - app - INFO - Database tables created successfully
2025-05-25 13:49:59,118 - app - INFO - Database tables created successfully
2025-05-25 13:50:00,018 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:50:00,021 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:50:00,022 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:50:00,024 - routes - INFO - AI Settings initialized successfully
2025-05-25 13:50:39,437 - routes - INFO - Deleted consumable object: Weekend Pass Thursday Entry (ID: 3)
2025-05-25 13:50:41,204 - routes - INFO - Deleted person object: Nate Smith (ID: 2)
2025-05-25 13:50:48,617 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 13:50:48,618 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 13:50:48,628 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpr0w8b974.pdf
2025-05-25 13:50:48,629 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 13:50:49,083 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 13:50:49,084 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 13:50:49,161 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 13:50:49,162 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 13:50:49,483 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 13:50:49,485 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 13:50:49,486 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 13:50:57,633 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 13:50:57,634 - mcp_client - INFO - Receipt analyzed successfully with claude
2025-05-25 13:50:57,636 - routes - INFO - MCP analysis successful: {'content': {'vendor_name': 'Great Blue Heron Music Festival', 'date': '2025-07-03', 'total_amount': 257.61, 'subtotal': 216.0, 'tax_amount': 0.0, 'fees': 41.61, 'document_type': 'ticket confirmation', 'description': 'Music festival ticket purchase', 'line_items': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'entertainment', 'object_type': 'service', 'confidence': 0.95}], 'digital_assets': {'qr_codes': ['present in image'], 'urls': ['2361 Wells Corners Rd, Sherman, 14781, United States']}, 'event_details': {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}, 'vendor_details': {'business_address': '2361 Wells Corners Rd, Sherman, 14781, United States'}, 'overall_confidence': 0.95, 'image_quality': 'high', 'extraction_notes': 'Clear ticket confirmation email with complete event and payment details'}, 'provider': 'claude', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 8.106740236282349, 'timestamp': '2025-05-25T13:50:57.631829', 'tokens_used': 3266, 'cost_estimate': 0.015318}
2025-05-25 13:50:57,636 - routes - INFO - Duplicate check - using direct JSON format, vendor: Great Blue Heron Music Festival
2025-05-25 13:50:57,658 - routes - INFO - Receipt queued for review: Task ID 13
2025-05-25 13:50:57,667 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:50:57,668 - routes - INFO - DEBUG: Processing task 13, type=receipt_processing, status=pending_review
2025-05-25 13:50:57,668 - routes - INFO - DEBUG: Task 13 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:50:57,670 - routes - INFO - DEBUG: Task 13 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:50:57,670 - routes - INFO - DEBUG: Task 13 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 13:50:57,671 - routes - INFO - DEBUG: Task 13 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:50:57,672 - routes - INFO - DEBUG: Task 13 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:50:57,673 - routes - INFO - Task 13 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:50:57,674 - routes - INFO - DEBUG: Task 13 has AI analysis
2025-05-25 13:50:57,675 - routes - INFO - DEBUG: Added task 13 to receipt_tasks, now has 1 items
2025-05-25 13:50:57,676 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:50:57,676 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:51:17,522 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 13:51:17,523 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 13:51:17,524 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpcc153_bi.pdf
2025-05-25 13:51:17,525 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 13:51:17,918 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 13:51:17,919 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 13:51:17,998 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 13:51:17,999 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 13:51:18,334 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 13:51:18,335 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 13:51:18,336 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-25 13:51:36,069 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 13:51:36,070 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-25 13:51:36,072 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-05-17",\n  "total_amount": 257.61,\n  "subtotal": 216.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 216.00,\n      "total_price": 216.00,\n      "item_details": "Non-refundable ticket for festival entry",\n      "create_object": false,\n      "object_type": "service",\n      "category": "events",\n      "expiration_info": {\n        "expiration_date": "2025-07-06",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": ["TDSLVDVJ"],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 PM",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": null,\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": null,\n    "business_phone": null,\n    "business_email": "express@eventeny.com",\n    "business_website": null,\n    "business_hours": null,\n    "business_type": "event management"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from email confirmation for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 17.704792261123657, 'timestamp': '2025-05-25T13:51:36.068463', 'tokens_used': 3586, 'cost_estimate': 0.023400000000000004}
2025-05-25 13:51:36,072 - routes - INFO - Duplicate check - using text response format, vendor: Eventeny
2025-05-25 13:51:36,087 - routes - INFO - Receipt queued for review: Task ID 14
2025-05-25 13:51:36,095 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 13:51:36,096 - routes - INFO - DEBUG: Processing task 14, type=receipt_processing, status=pending_review
2025-05-25 13:51:36,096 - routes - INFO - DEBUG: Task 14 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:51:36,097 - routes - INFO - DEBUG: Task 14 - content type: <class 'dict'>, keys: ['response']
2025-05-25 13:51:36,098 - routes - INFO - DEBUG: Task 14 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDV...
2025-05-25 13:51:36,099 - routes - INFO - DEBUG: Task 14 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "p...
2025-05-25 13:51:36,100 - routes - INFO - DEBUG: Task 14 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'tip_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 13:51:36,101 - routes - INFO - DEBUG: Task 14 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 13:51:36,101 - routes - INFO - Task 14 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': None, 'additional_details': {}}
2025-05-25 13:51:36,102 - routes - INFO - DEBUG: Task 14 has AI analysis
2025-05-25 13:51:36,103 - routes - INFO - DEBUG: Added task 14 to receipt_tasks, now has 1 items
2025-05-25 13:51:36,104 - routes - INFO - DEBUG: Processing task 13, type=receipt_processing, status=pending_review
2025-05-25 13:51:36,105 - routes - INFO - DEBUG: Task 13 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:51:36,105 - routes - INFO - DEBUG: Task 13 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:51:36,106 - routes - INFO - DEBUG: Task 13 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 13:51:36,108 - routes - INFO - DEBUG: Task 13 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:51:36,108 - routes - INFO - DEBUG: Task 13 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:51:36,109 - routes - INFO - Task 13 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:51:36,110 - routes - INFO - DEBUG: Task 13 has AI analysis
2025-05-25 13:51:36,111 - routes - INFO - DEBUG: Added task 13 to receipt_tasks, now has 2 items
2025-05-25 13:51:36,112 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 13:51:36,113 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 13:52:06,420 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 13:52:06,421 - routes - INFO - DEBUG: Processing task 14, type=receipt_processing, status=pending_review
2025-05-25 13:52:06,422 - routes - INFO - DEBUG: Task 14 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:52:06,423 - routes - INFO - DEBUG: Task 14 - content type: <class 'dict'>, keys: ['response']
2025-05-25 13:52:06,424 - routes - INFO - DEBUG: Task 14 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDV...
2025-05-25 13:52:06,425 - routes - INFO - DEBUG: Task 14 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "p...
2025-05-25 13:52:06,425 - routes - INFO - DEBUG: Task 14 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'tip_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 13:52:06,426 - routes - INFO - DEBUG: Task 14 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 13:52:06,427 - routes - INFO - Task 14 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': None, 'additional_details': {}}
2025-05-25 13:52:06,428 - routes - INFO - DEBUG: Task 14 has AI analysis
2025-05-25 13:52:06,428 - routes - INFO - DEBUG: Added task 14 to receipt_tasks, now has 1 items
2025-05-25 13:52:06,429 - routes - INFO - DEBUG: Processing task 13, type=receipt_processing, status=pending_review
2025-05-25 13:52:06,430 - routes - INFO - DEBUG: Task 13 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:52:06,431 - routes - INFO - DEBUG: Task 13 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:52:06,431 - routes - INFO - DEBUG: Task 13 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 13:52:06,432 - routes - INFO - DEBUG: Task 13 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:52:06,433 - routes - INFO - DEBUG: Task 13 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:52:06,434 - routes - INFO - Task 13 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:52:06,434 - routes - INFO - DEBUG: Task 13 has AI analysis
2025-05-25 13:52:06,435 - routes - INFO - DEBUG: Added task 13 to receipt_tasks, now has 2 items
2025-05-25 13:52:06,436 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 13:52:06,437 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 13:52:36,784 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 13:52:36,785 - routes - INFO - DEBUG: Processing task 14, type=receipt_processing, status=pending_review
2025-05-25 13:52:36,786 - routes - INFO - DEBUG: Task 14 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:52:36,787 - routes - INFO - DEBUG: Task 14 - content type: <class 'dict'>, keys: ['response']
2025-05-25 13:52:36,788 - routes - INFO - DEBUG: Task 14 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDV...
2025-05-25 13:52:36,788 - routes - INFO - DEBUG: Task 14 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "tip_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "p...
2025-05-25 13:52:36,789 - routes - INFO - DEBUG: Task 14 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'tip_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 13:52:36,790 - routes - INFO - DEBUG: Task 14 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 13:52:36,791 - routes - INFO - Task 14 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': None, 'additional_details': {}}
2025-05-25 13:52:36,791 - routes - INFO - DEBUG: Task 14 has AI analysis
2025-05-25 13:52:36,792 - routes - INFO - DEBUG: Added task 14 to receipt_tasks, now has 1 items
2025-05-25 13:52:36,793 - routes - INFO - DEBUG: Processing task 13, type=receipt_processing, status=pending_review
2025-05-25 13:52:36,794 - routes - INFO - DEBUG: Task 13 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:52:36,795 - routes - INFO - DEBUG: Task 13 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:52:36,795 - routes - INFO - DEBUG: Task 13 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 13:52:36,796 - routes - INFO - DEBUG: Task 13 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:52:36,797 - routes - INFO - DEBUG: Task 13 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:52:36,798 - routes - INFO - Task 13 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:52:36,799 - routes - INFO - DEBUG: Task 13 has AI analysis
2025-05-25 13:52:36,799 - routes - INFO - DEBUG: Added task 13 to receipt_tasks, now has 2 items
2025-05-25 13:52:36,800 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 13:52:36,801 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 13:52:48,203 - routes - INFO - Process receipt - using text response format, vendor: Eventeny
2025-05-25 13:52:48,208 - routes - INFO - Created new vendor: Eventeny
2025-05-25 13:52:48,210 - routes - INFO - Successfully processed receipt task: Invoice INV-20250525-968022A9, 0 objects created
2025-05-25 13:52:48,219 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:52:48,220 - routes - INFO - DEBUG: Processing task 13, type=receipt_processing, status=pending_review
2025-05-25 13:52:48,220 - routes - INFO - DEBUG: Task 13 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:52:48,221 - routes - INFO - DEBUG: Task 13 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:52:48,222 - routes - INFO - DEBUG: Task 13 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 13:52:48,223 - routes - INFO - DEBUG: Task 13 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:52:48,224 - routes - INFO - DEBUG: Task 13 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:52:48,225 - routes - INFO - Task 13 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:52:48,225 - routes - INFO - DEBUG: Task 13 has AI analysis
2025-05-25 13:52:48,226 - routes - INFO - DEBUG: Added task 13 to receipt_tasks, now has 1 items
2025-05-25 13:52:48,227 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:52:48,228 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:53:07,169 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 13:53:07,170 - routes - INFO - DEBUG: Processing task 13, type=receipt_processing, status=pending_review
2025-05-25 13:53:07,171 - routes - INFO - DEBUG: Task 13 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 13:53:07,172 - routes - INFO - DEBUG: Task 13 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:53:07,172 - routes - INFO - DEBUG: Task 13 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 13:53:07,173 - routes - INFO - DEBUG: Task 13 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 13:53:07,174 - routes - INFO - DEBUG: Task 13 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 13:53:07,175 - routes - INFO - Task 13 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 13:53:07,175 - routes - INFO - DEBUG: Task 13 has AI analysis
2025-05-25 13:53:07,176 - routes - INFO - DEBUG: Added task 13 to receipt_tasks, now has 1 items
2025-05-25 13:53:07,177 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 13:53:07,178 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 13:53:08,955 - routes - INFO - Process receipt - using direct JSON format, vendor: Great Blue Heron Music Festival
2025-05-25 13:53:08,958 - routes - INFO - Created new vendor: Great Blue Heron Music Festival
2025-05-25 13:53:08,959 - routes - INFO - Successfully processed receipt task: Invoice INV-20250525-369CF808, 0 objects created
2025-05-25 13:53:08,967 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 13:53:08,968 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 13:53:08,969 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 13:55:56,837 - app - INFO - Creating database tables...
2025-05-25 13:55:56,844 - app - INFO - Database tables created successfully
2025-05-25 13:56:07,308 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 13:56:07,309 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 13:56:07,310 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 14:02:37,355 - app - INFO - Creating database tables...
2025-05-25 14:02:37,373 - app - INFO - Database tables created successfully
2025-05-25 14:02:37,444 - app - INFO - Creating database tables...
2025-05-25 14:02:37,461 - app - INFO - Database tables created successfully
2025-05-25 14:02:37,557 - app - INFO - Creating database tables...
2025-05-25 14:02:37,575 - app - INFO - Database tables created successfully
2025-05-25 14:02:37,602 - app - INFO - Creating database tables...
2025-05-25 14:02:37,621 - app - INFO - Database tables created successfully
2025-05-25 14:02:38,089 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:02:38,098 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:02:38,150 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:02:38,224 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:02:41,374 - app - INFO - Creating database tables...
2025-05-25 14:02:41,390 - app - INFO - Database tables created successfully
2025-05-25 14:02:41,893 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:03:33,560 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 14:03:33,561 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 14:03:33,562 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpq7d7dwuh.pdf
2025-05-25 14:03:33,563 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 14:03:33,954 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 14:03:33,955 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 14:03:34,038 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 14:03:34,039 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 14:03:34,390 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 14:03:34,392 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 14:03:34,393 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 14:03:34,422 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 14:03:34,424 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 14:03:43,596 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 14:03:43,598 - mcp_client - INFO - Receipt analyzed successfully with claude
2025-05-25 14:03:43,599 - routes - INFO - MCP analysis successful: {'content': {'vendor_name': 'Great Blue Heron Music Festival', 'date': '2025-07-03', 'total_amount': 257.61, 'subtotal': 216.0, 'tax_amount': 0.0, 'fees': 41.61, 'document_type': 'ticket confirmation', 'description': 'Music festival ticket purchase', 'line_items': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'entertainment', 'object_type': 'service', 'confidence': 0.95}], 'digital_assets': {'qr_codes': ['present in image'], 'urls': ['2361 Wells Corners Rd, Sherman, 14781, United States']}, 'event_details': {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}, 'vendor_details': {'business_address': '2361 Wells Corners Rd, Sherman, 14781, United States'}, 'overall_confidence': 0.95, 'image_quality': 'high', 'extraction_notes': 'Clear ticket confirmation email with complete event and payment details'}, 'provider': 'claude', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 9.160027503967285, 'timestamp': '2025-05-25T14:03:43.595346', 'tokens_used': 3266, 'cost_estimate': 0.015318}
2025-05-25 14:03:43,600 - routes - INFO - Duplicate check - using direct JSON format, vendor: Great Blue Heron Music Festival
2025-05-25 14:03:43,613 - routes - WARNING - Potential duplicate receipt detected: Great Blue Heron Music Festival on 2025-07-03 for $257.61
2025-05-25 14:03:43,623 - routes - INFO - Receipt queued for review: Task ID 15
2025-05-25 14:03:43,633 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 14:03:43,634 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:03:43,635 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:03:43,635 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:03:43,636 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:03:43,637 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:03:43,638 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:03:43,639 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:03:43,640 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:03:43,642 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 1 items
2025-05-25 14:03:43,643 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 14:03:43,644 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 14:04:00,744 - routes - INFO - Auto-classified 'Weekend Pass Thursday Entry' as consumable event ticket
2025-05-25 14:04:00,755 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from task 15
2025-05-25 14:04:01,819 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 14:04:01,820 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:04:01,821 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:04:01,822 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:04:01,822 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:04:01,823 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:04:01,824 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:04:01,825 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:04:01,826 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:04:01,826 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 1 items
2025-05-25 14:04:01,827 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 14:04:01,828 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 14:04:06,715 - routes - INFO - Task 15 calendar - using direct JSON format, vendor: Great Blue Heron Music Festival
2025-05-25 14:04:06,723 - routes - INFO - Created calendar event 'Great Blue Heron Music Festival 2025' from task 15
2025-05-25 14:04:07,846 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 14:04:07,847 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:04:07,848 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:04:07,849 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:04:07,850 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:04:07,850 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:04:07,851 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:04:07,852 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:04:07,852 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:04:07,853 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 1 items
2025-05-25 14:04:07,854 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 14:04:07,855 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 14:04:19,902 - routes - INFO - Deleting receipt INV-20250525-968022A9: 1 line items, 0 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-25 14:04:19,544 - routes - INFO - Deleting receipt INV-20250525-369CF808: 1 line items, 0 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-25 14:04:27,993 - routes - INFO - Deleted consumable object: Weekend Pass Thursday Entry (ID: 4)
2025-05-25 14:04:43,221 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 14:04:43,222 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 14:04:43,224 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpgrljtoud.pdf
2025-05-25 14:04:43,225 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 14:04:43,661 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 14:04:43,661 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 14:04:43,735 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 14:04:43,736 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 14:04:44,079 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 14:04:44,081 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 14:04:44,082 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-25 14:04:44,102 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 14:04:44,104 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 14:04:50,099 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 14:04:50,100 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-25 14:04:50,101 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-05-17",\n  "total_amount": 257.61,\n  "subtotal": 216.00,\n  "tax_amount": 0.00,\n  "receipt_number": "TDSLVDVJ",\n  "description": "Great Blue Heron Music Festival 2025 Ticket",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "receipt",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 216.00,\n      "total_price": 216.00,\n      "category": "event",\n      "suggested_object_type": "service",\n      "confidence": 0.95\n    }\n  ],\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt for a music festival ticket purchase. No taxes applied."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 5.981800556182861, 'timestamp': '2025-05-25T14:04:50.098324', 'tokens_used': 3267, 'cost_estimate': 0.018615000000000003}
2025-05-25 14:04:50,102 - routes - INFO - Duplicate check - using text response format, vendor: Eventeny
2025-05-25 14:04:50,116 - routes - INFO - Receipt queued for review: Task ID 16
2025-05-25 14:04:50,123 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:04:50,123 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:04:50,124 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:04:50,125 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:04:50,126 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:04:50,127 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:04:50,128 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:04:50,128 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:04:50,129 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:04:50,130 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:04:50,131 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:04:50,132 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:04:50,132 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:04:50,133 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:04:50,133 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:04:50,134 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:04:50,135 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:04:50,136 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:04:50,136 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:04:50,137 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:04:50,138 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:04:50,138 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:04:50,139 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:04:50,140 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:04:50,141 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:05:20,349 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:05:20,350 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:05:20,351 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:05:20,352 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:05:20,353 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:05:20,353 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:05:20,354 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:05:20,355 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:05:20,355 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:05:20,356 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:05:20,357 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:05:20,358 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:05:20,359 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:05:20,359 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:05:20,360 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:05:20,361 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:05:20,362 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:05:20,362 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:05:20,363 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:05:20,364 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:05:20,364 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:05:20,365 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:05:20,366 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:05:20,367 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:05:20,367 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:05:50,636 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:05:50,638 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:05:50,639 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:05:50,639 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:05:50,640 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:05:50,641 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:05:50,642 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:05:50,642 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:05:50,643 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:05:50,644 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:05:50,645 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:05:50,646 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:05:50,646 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:05:50,647 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:05:50,648 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:05:50,648 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:05:50,649 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:05:50,650 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:05:50,650 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:05:50,651 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:05:50,652 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:05:50,653 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:05:50,653 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:05:50,654 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:05:50,655 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:06:05,582 - routes - INFO - Auto-classified 'Weekend Pass Thursday Entry' as consumable event ticket
2025-05-25 14:06:05,585 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from task 16
2025-05-25 14:06:06,893 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:06:06,894 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:06:06,896 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:06:06,900 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:06:06,902 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:06:06,903 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:06:06,905 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:06:06,906 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:06:06,907 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:06:06,908 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:06:06,909 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:06:06,910 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:06:06,911 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:06:06,912 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:06:06,913 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:06:06,916 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:06:06,917 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:06:06,919 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:06:06,920 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:06:06,922 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:06:06,925 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:06:06,926 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:06:06,927 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:06:06,928 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:06:06,929 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:10:38,117 - app - INFO - Creating database tables...
2025-05-25 14:10:38,120 - app - INFO - Creating database tables...
2025-05-25 14:10:38,122 - app - INFO - Creating database tables...
2025-05-25 14:10:38,122 - app - INFO - Creating database tables...
2025-05-25 14:10:38,135 - app - INFO - Database tables created successfully
2025-05-25 14:10:38,137 - app - INFO - Database tables created successfully
2025-05-25 14:10:38,139 - app - INFO - Database tables created successfully
2025-05-25 14:10:38,139 - app - INFO - Database tables created successfully
2025-05-25 14:10:39,047 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:10:39,048 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:10:39,050 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:10:39,052 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:10:57,619 - app - INFO - Creating database tables...
2025-05-25 14:10:57,625 - app - INFO - Database tables created successfully
2025-05-25 14:12:39,763 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:12:39,764 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:12:39,765 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:12:39,766 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:12:39,767 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:12:39,768 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:12:39,769 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:12:39,770 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:12:39,771 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:12:39,771 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:12:39,772 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:12:39,773 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:12:39,774 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:12:39,775 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:12:39,775 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:12:39,776 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:12:39,777 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:12:39,778 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:12:39,778 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:12:39,779 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:12:39,780 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:12:39,781 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:12:39,781 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:12:39,782 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:12:39,783 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:12:40,084 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:12:40,085 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:12:40,086 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:12:40,087 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:12:40,088 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:12:40,088 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:12:40,089 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:12:40,090 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:12:40,091 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:12:40,092 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:12:40,092 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:12:40,093 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:12:40,094 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:12:40,095 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:12:40,096 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:12:40,097 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:12:40,098 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:12:40,098 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:12:40,099 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:12:40,100 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:12:40,101 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:12:40,102 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:12:40,103 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:12:40,104 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:12:40,104 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:13:10,417 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:13:10,418 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:13:10,419 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:13:10,420 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:13:10,420 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:13:10,421 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:13:10,422 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:13:10,423 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:13:10,424 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:13:10,425 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:13:10,425 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:13:10,426 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:13:10,427 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:13:10,428 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:13:10,428 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:13:10,429 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:13:10,430 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:13:10,431 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:13:10,431 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:13:10,432 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:13:10,433 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:13:10,433 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:13:10,434 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:13:10,435 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:13:10,435 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:13:48,424 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:13:48,425 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:13:48,426 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:13:48,426 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:13:48,427 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:13:48,428 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:13:48,429 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:13:48,430 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:13:48,430 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:13:48,431 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:13:48,432 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:13:48,433 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:13:48,434 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:13:48,435 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:13:48,435 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:13:48,436 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:13:48,437 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:13:48,438 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:13:48,439 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:13:48,440 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:13:48,440 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:13:48,441 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:13:48,442 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:13:48,442 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:13:48,443 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:14:18,687 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:14:18,688 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:14:18,689 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:14:18,690 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:14:18,691 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:14:18,692 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:14:18,693 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:14:18,694 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:14:18,694 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:14:18,695 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:14:18,696 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:14:18,697 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:14:18,698 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:14:18,698 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:14:18,699 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:14:18,700 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:14:18,701 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:14:18,701 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:14:18,702 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:14:18,703 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:14:18,704 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:14:18,704 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:14:18,705 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:14:18,706 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:14:18,706 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:14:48,939 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:14:48,940 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:14:48,940 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:14:48,941 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:14:48,942 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:14:48,943 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:14:48,943 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:14:48,944 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:14:48,945 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:14:48,946 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:14:48,946 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:14:48,947 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:14:48,948 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:14:48,949 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:14:48,949 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:14:48,950 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:14:48,951 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:14:48,952 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:14:48,952 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:14:48,953 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:14:48,954 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:14:48,955 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:14:48,955 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:14:48,956 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:14:48,957 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:16:47,973 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:16:47,974 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:16:47,975 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:16:47,976 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:16:47,977 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:16:47,978 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:16:47,979 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:16:47,980 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:16:47,980 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:16:47,981 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:16:47,982 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:16:47,983 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:16:47,984 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:16:47,986 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:16:47,987 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:16:47,988 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:16:47,989 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:16:47,990 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:16:47,991 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:16:47,992 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:16:47,993 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:16:47,994 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:16:47,995 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:16:47,996 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:16:47,996 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:17:13,920 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:17:13,921 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:17:13,922 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:17:13,923 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:17:13,923 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:17:13,924 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:17:13,925 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:17:13,926 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:17:13,926 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:17:13,927 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:17:13,928 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:17:13,929 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:17:13,929 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:17:13,930 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:17:13,931 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:17:13,932 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:17:13,933 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:17:13,934 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:17:13,935 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:17:13,936 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:17:13,937 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:17:13,937 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:17:13,938 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:17:13,939 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:17:13,939 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:17:44,255 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:17:44,256 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:17:44,256 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:17:44,257 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:17:44,258 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:17:44,259 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:17:44,260 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:17:44,260 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:17:44,261 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:17:44,262 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:17:44,263 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:17:44,264 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:17:44,265 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:17:44,266 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:17:44,267 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:17:44,267 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:17:44,268 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:17:44,269 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:17:44,270 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:17:44,271 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:17:44,271 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:17:44,272 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:17:44,273 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:17:44,274 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:17:44,274 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:18:10,000 - app - INFO - Creating database tables...
2025-05-25 14:18:10,001 - app - INFO - Creating database tables...
2025-05-25 14:18:10,004 - app - INFO - Creating database tables...
2025-05-25 14:18:10,037 - app - INFO - Database tables created successfully
2025-05-25 14:18:10,037 - app - INFO - Database tables created successfully
2025-05-25 14:18:10,037 - app - INFO - Database tables created successfully
2025-05-25 14:18:10,047 - app - INFO - Creating database tables...
2025-05-25 14:18:10,066 - app - INFO - Database tables created successfully
2025-05-25 14:18:10,991 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:18:10,991 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:18:10,991 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:18:10,998 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:18:32,284 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:18:32,285 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:18:32,286 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:18:32,287 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:18:32,287 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:18:32,288 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:18:32,289 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:18:32,290 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:18:32,291 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:18:32,291 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:18:32,292 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:18:32,293 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:18:32,294 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:18:32,295 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:18:32,295 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:18:32,296 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:18:32,297 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:18:32,298 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:18:32,299 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:18:32,299 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:18:32,300 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:18:32,301 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:18:32,302 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:18:32,303 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:18:32,304 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:18:46,702 - routes - INFO - Task 16 calendar - using text response format, vendor: Eventeny
2025-05-25 14:18:46,703 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:18:46,704 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:18:46,705 - routes - INFO - Task 16 - Using smart-detected event details for calendar creation
2025-05-25 14:18:46,717 - routes - INFO - Created calendar event 'Heron Music Festival 2025 Ticket' from task 16
2025-05-25 14:18:47,619 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:18:47,620 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:18:47,621 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:18:47,622 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:18:47,623 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:18:47,624 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:18:47,624 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:18:47,625 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:18:47,626 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:18:47,627 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:18:47,628 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:18:47,629 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:18:47,629 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:18:47,630 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:18:47,631 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:18:47,632 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:18:47,632 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:18:47,633 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:18:47,634 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:18:47,635 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:18:47,636 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:18:47,637 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:18:47,637 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:18:47,638 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:18:47,639 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:19:18,057 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:19:18,058 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:19:18,059 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:19:18,060 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:19:18,061 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:19:18,062 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:19:18,064 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:19:18,065 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:19:18,066 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:19:18,067 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:19:18,068 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:19:18,069 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:19:18,070 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:19:18,070 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:19:18,071 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:19:18,072 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:19:18,073 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:19:18,074 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:19:18,075 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:19:18,076 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:19:18,077 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:19:18,077 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:19:18,078 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:19:18,079 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:19:18,080 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:19:48,354 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:19:48,354 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:19:48,355 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:19:48,356 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:19:48,357 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:19:48,358 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:19:48,359 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:19:48,359 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:19:48,360 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:19:48,361 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:19:48,363 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:19:48,363 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:19:48,364 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:19:48,365 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:19:48,366 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:19:48,367 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:19:48,367 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:19:48,368 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:19:48,369 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:19:48,370 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:19:48,370 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:19:48,371 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:19:48,372 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:19:48,373 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:19:48,373 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:20:18,643 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:20:18,644 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:20:18,645 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:20:18,646 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:20:18,646 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:20:18,647 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:20:18,649 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:20:18,650 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:20:18,651 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:20:18,651 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:20:18,652 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:20:18,653 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:20:18,654 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:20:18,655 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:20:18,655 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:20:18,656 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:20:18,657 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:20:18,658 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:20:18,659 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:20:18,659 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:20:18,660 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:20:18,661 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:20:18,662 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:20:18,663 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:20:18,663 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:20:48,951 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 14:20:48,952 - routes - INFO - DEBUG: Processing task 16, type=receipt_processing, status=pending_review
2025-05-25 14:20:48,953 - routes - INFO - DEBUG: Task 16 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:20:48,953 - routes - INFO - DEBUG: Task 16 - content type: <class 'dict'>, keys: ['response']
2025-05-25 14:20:48,954 - routes - INFO - DEBUG: Task 16 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron ...
2025-05-25 14:20:48,955 - routes - INFO - DEBUG: Task 16 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 257.61,
  "subtotal": 216.00,
  "tax_amount": 0.00,
  "receipt_number": "TDSLVDVJ",
  "description": "Great Blue Heron Music Fe...
2025-05-25 14:20:48,956 - routes - INFO - DEBUG: Task 16 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'receipt_number', 'description', 'due_date', 'is_bill', 'document_type', 'line_items', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 14:20:48,957 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-25 14:20:48,958 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-25 14:20:48,959 - routes - INFO - Task 16 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-25 14:20:48,959 - routes - INFO - DEBUG: Task 16 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 14:20:48,960 - routes - INFO - Task 16 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-05-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'event_ticket', 'suggested_object_type': 'service', 'confidence': 0.95, 'object_type': 'consumable', 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-05-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-25 14:20:48,961 - routes - INFO - DEBUG: Task 16 has AI analysis
2025-05-25 14:20:48,962 - routes - INFO - DEBUG: Added task 16 to receipt_tasks, now has 1 items
2025-05-25 14:20:48,963 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:20:48,963 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:20:48,964 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:20:48,965 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:20:48,966 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:20:48,966 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:20:48,967 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:20:48,968 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:20:48,969 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 2 items
2025-05-25 14:20:48,969 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 14:20:48,970 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 14:20:54,347 - routes - INFO - Receipt task 16 rejected: 
2025-05-25 14:20:54,352 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 14:20:54,353 - routes - INFO - DEBUG: Processing task 15, type=receipt_processing, status=pending_review
2025-05-25 14:20:54,354 - routes - INFO - DEBUG: Task 15 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:20:54,354 - routes - INFO - DEBUG: Task 15 - content type: <class 'dict'>, keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:20:54,355 - routes - INFO - DEBUG: Task 15 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:20:54,356 - routes - INFO - DEBUG: Task 15 - parsed receipt_data keys: ['date', 'fees', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:20:54,357 - routes - INFO - DEBUG: Task 15 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:20:54,357 - routes - INFO - Task 15 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 pm', 'venue_location': '2361 Wells Corners Rd, Sherman, 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:20:54,358 - routes - INFO - DEBUG: Task 15 has AI analysis
2025-05-25 14:20:54,359 - routes - INFO - DEBUG: Added task 15 to receipt_tasks, now has 1 items
2025-05-25 14:20:54,360 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 14:20:54,361 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 14:20:56,284 - routes - INFO - Receipt task 15 rejected: 
2025-05-25 14:20:56,290 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 14:20:56,291 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 14:20:56,292 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 14:20:59,231 - routes - INFO - Deleted consumable object: Weekend Pass Thursday Entry (ID: 5)
2025-05-25 14:28:01,386 - app - INFO - Creating database tables...
2025-05-25 14:28:01,388 - app - INFO - Creating database tables...
2025-05-25 14:28:01,389 - app - INFO - Creating database tables...
2025-05-25 14:28:01,423 - app - INFO - Database tables created successfully
2025-05-25 14:28:01,423 - app - INFO - Database tables created successfully
2025-05-25 14:28:01,423 - app - INFO - Database tables created successfully
2025-05-25 14:28:01,430 - app - INFO - Creating database tables...
2025-05-25 14:28:01,445 - app - INFO - Database tables created successfully
2025-05-25 14:28:02,333 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:28:02,333 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:28:02,333 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:28:02,338 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:28:14,490 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 14:28:14,491 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 14:28:14,493 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpd8mrma49.pdf
2025-05-25 14:28:14,493 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 14:28:14,928 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 14:28:14,929 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 14:28:15,015 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 14:28:15,016 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 14:28:15,344 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 14:28:15,345 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 14:28:15,346 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 14:28:15,374 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 14:28:15,376 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 14:28:26,254 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 14:28:26,255 - mcp_client - INFO - Receipt analyzed successfully with claude
2025-05-25 14:28:26,256 - routes - INFO - MCP analysis successful: {'content': {'vendor_name': 'Great Blue Heron Music Festival', 'date': '2023-05-17', 'total_amount': 257.61, 'subtotal': 216.0, 'tax_amount': 0.0, 'fees': 41.61, 'receipt_number': 'TD8LVDVJ', 'document_type': 'ticket confirmation', 'description': 'Music festival ticket purchase', 'is_bill': False, 'line_items': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'Event Tickets', 'object_type': 'consumable', 'create_object': False, 'expiration_info': {'event_date': '2025-07-03'}, 'confidence': 0.95}], 'digital_assets': {'qr_codes': ['QR code present in image'], 'confirmation_codes': ['TD8LVDVJ']}, 'event_details': {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00)', 'entry_type': 'Weekend Pass Thursday Entry'}}, 'vendor_details': {'business_address': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'business_website': 'eventeny.com'}, 'overall_confidence': 0.95, 'image_quality': 'high', 'extraction_notes': 'Clear digital ticket confirmation email with complete event details and pricing information'}, 'provider': 'claude', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 10.860319137573242, 'timestamp': '2025-05-25T14:28:26.252871', 'tokens_used': 4006, 'cost_estimate': 0.018582}
2025-05-25 14:28:26,282 - routes - INFO - Receipt queued for review: Task ID 17
2025-05-25 14:28:26,291 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 14:28:26,291 - routes - INFO - DEBUG: Processing task 17, type=receipt_processing, status=pending_review
2025-05-25 14:28:26,292 - routes - INFO - DEBUG: Task 17 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:28:26,293 - routes - INFO - DEBUG: Task 17 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:28:26,294 - routes - INFO - DEBUG: Task 17 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:28:26,294 - routes - INFO - DEBUG: Task 17 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:28:26,295 - routes - INFO - DEBUG: Task 17 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:28:26,296 - routes - INFO - Task 17 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00)', 'entry_type': 'Weekend Pass Thursday Entry'}}
2025-05-25 14:28:26,297 - routes - INFO - DEBUG: Task 17 has AI analysis
2025-05-25 14:28:26,297 - routes - INFO - DEBUG: Added task 17 to receipt_tasks, now has 1 items
2025-05-25 14:28:26,298 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 14:28:26,299 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 14:28:56,675 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 14:28:56,676 - routes - INFO - DEBUG: Processing task 17, type=receipt_processing, status=pending_review
2025-05-25 14:28:56,677 - routes - INFO - DEBUG: Task 17 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:28:56,678 - routes - INFO - DEBUG: Task 17 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:28:56,678 - routes - INFO - DEBUG: Task 17 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:28:56,679 - routes - INFO - DEBUG: Task 17 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:28:56,680 - routes - INFO - DEBUG: Task 17 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:28:56,681 - routes - INFO - Task 17 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00)', 'entry_type': 'Weekend Pass Thursday Entry'}}
2025-05-25 14:28:56,682 - routes - INFO - DEBUG: Task 17 has AI analysis
2025-05-25 14:28:56,683 - routes - INFO - DEBUG: Added task 17 to receipt_tasks, now has 1 items
2025-05-25 14:28:56,683 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 14:28:56,684 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 14:28:59,711 - routes - INFO - Task 17 calendar - using direct JSON format, vendor: Great Blue Heron Music Festival
2025-05-25 14:28:59,723 - routes - INFO - Created calendar event 'Great Blue Heron Music Festival 2025' from task 17
2025-05-25 14:29:00,573 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 14:29:00,574 - routes - INFO - DEBUG: Processing task 17, type=receipt_processing, status=pending_review
2025-05-25 14:29:00,575 - routes - INFO - DEBUG: Task 17 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:29:00,576 - routes - INFO - DEBUG: Task 17 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:29:00,577 - routes - INFO - DEBUG: Task 17 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:29:00,578 - routes - INFO - DEBUG: Task 17 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:29:00,578 - routes - INFO - DEBUG: Task 17 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:29:00,579 - routes - INFO - Task 17 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00)', 'entry_type': 'Weekend Pass Thursday Entry'}}
2025-05-25 14:29:00,580 - routes - INFO - DEBUG: Task 17 has AI analysis
2025-05-25 14:29:00,581 - routes - INFO - DEBUG: Added task 17 to receipt_tasks, now has 1 items
2025-05-25 14:29:00,582 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 14:29:00,583 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 14:29:12,426 - routes - INFO - Auto-classified 'Weekend Pass Thursday Entry' as consumable event ticket
2025-05-25 14:29:12,438 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from task 17
2025-05-25 14:29:13,284 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 14:29:13,285 - routes - INFO - DEBUG: Processing task 17, type=receipt_processing, status=pending_review
2025-05-25 14:29:13,286 - routes - INFO - DEBUG: Task 17 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:29:13,287 - routes - INFO - DEBUG: Task 17 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:29:13,287 - routes - INFO - DEBUG: Task 17 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:29:13,288 - routes - INFO - DEBUG: Task 17 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:29:13,290 - routes - INFO - DEBUG: Task 17 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:29:13,292 - routes - INFO - Task 17 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00)', 'entry_type': 'Weekend Pass Thursday Entry'}}
2025-05-25 14:29:13,292 - routes - INFO - DEBUG: Task 17 has AI analysis
2025-05-25 14:29:13,293 - routes - INFO - DEBUG: Added task 17 to receipt_tasks, now has 1 items
2025-05-25 14:29:13,294 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 14:29:13,295 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 14:29:16,066 - routes - INFO - Process receipt - using direct JSON format, vendor: Great Blue Heron Music Festival
2025-05-25 14:29:16,076 - routes - INFO - Using existing vendor: Great Blue Heron Music Festival
2025-05-25 14:29:16,084 - routes - INFO - Processed 1 AI-suggested categories: ['Event Tickets']
2025-05-25 14:29:16,085 - routes - INFO - Created 1 new categories from AI suggestions: ['Event Tickets']
2025-05-25 14:29:16,086 - routes - INFO - Successfully processed receipt task: Invoice INV-20250525-53B0FA4B, 0 objects created
2025-05-25 14:29:16,098 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 14:29:16,099 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 14:29:16,100 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 14:34:16,557 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 14:34:16,558 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 14:34:16,558 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 14:34:27,699 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 14:34:27,700 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 14:34:27,703 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmph46us_28.pdf
2025-05-25 14:34:27,704 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 14:34:28,164 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 14:34:28,165 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 14:34:28,241 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 14:34:28,242 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 14:34:28,584 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 14:34:28,586 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 14:34:28,586 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 14:34:28,611 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 14:34:28,613 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 14:34:37,029 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 14:34:37,030 - mcp_client - INFO - Receipt analyzed successfully with claude
2025-05-25 14:34:37,032 - routes - INFO - MCP analysis successful: {'content': {'vendor_name': 'Great Blue Heron Music Festival', 'date': '2023-05-17', 'total_amount': 257.61, 'subtotal': 216.0, 'tax_amount': 0.0, 'fees': 41.61, 'receipt_number': 'TD8LVDVJ', 'document_type': 'ticket confirmation', 'description': 'Weekend Pass Thursday Entry ticket purchase', 'is_bill': False, 'line_items': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'Event Tickets', 'object_type': 'consumable', 'create_object': False, 'confidence': 0.98, 'expiration_info': {'event_date': '2025-07-03'}}], 'digital_assets': {'qr_codes': ['Present your QR code at check-in'], 'confirmation_codes': ['TD8LVDVJ']}, 'event_details': {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00) Eastern Time (US & Canada)'}}, 'vendor_details': {'business_address': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'business_website': 'eventeny.com'}, 'overall_confidence': 0.95, 'image_quality': 'high', 'extraction_notes': 'Clear ticket confirmation email with complete event details and pricing information'}, 'provider': 'claude', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 8.401748895645142, 'timestamp': '2025-05-25T14:34:37.028162', 'tokens_used': 4005, 'cost_estimate': 0.018567}
2025-05-25 14:34:37,036 - routes - WARNING - Potential duplicate receipt detected: Great Blue Heron Music Festival on 2023-05-17 for $257.61
2025-05-25 14:34:37,041 - routes - INFO - Receipt queued for review: Task ID 18
2025-05-25 14:34:37,047 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 14:34:37,049 - routes - INFO - DEBUG: Processing task 18, type=receipt_processing, status=pending_review
2025-05-25 14:34:37,050 - routes - INFO - DEBUG: Task 18 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:34:37,051 - routes - INFO - DEBUG: Task 18 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:34:37,052 - routes - INFO - DEBUG: Task 18 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:34:37,053 - routes - INFO - DEBUG: Task 18 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:34:37,054 - routes - INFO - DEBUG: Task 18 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:34:37,055 - routes - INFO - Task 18 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:34:37,056 - routes - INFO - DEBUG: Task 18 has AI analysis
2025-05-25 14:34:37,056 - routes - INFO - DEBUG: Added task 18 to receipt_tasks, now has 1 items
2025-05-25 14:34:37,057 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 14:34:37,058 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 14:35:07,296 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 14:35:07,296 - routes - INFO - DEBUG: Processing task 18, type=receipt_processing, status=pending_review
2025-05-25 14:35:07,297 - routes - INFO - DEBUG: Task 18 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:35:07,298 - routes - INFO - DEBUG: Task 18 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:35:07,299 - routes - INFO - DEBUG: Task 18 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:35:07,300 - routes - INFO - DEBUG: Task 18 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:35:07,301 - routes - INFO - DEBUG: Task 18 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:35:07,301 - routes - INFO - Task 18 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:35:07,302 - routes - INFO - DEBUG: Task 18 has AI analysis
2025-05-25 14:35:07,303 - routes - INFO - DEBUG: Added task 18 to receipt_tasks, now has 1 items
2025-05-25 14:35:07,304 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 14:35:07,305 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 14:53:04,492 - app - INFO - Creating database tables...
2025-05-25 14:53:04,493 - app - INFO - Creating database tables...
2025-05-25 14:53:04,495 - app - INFO - Creating database tables...
2025-05-25 14:53:04,495 - app - INFO - Creating database tables...
2025-05-25 14:53:04,528 - app - INFO - Database tables created successfully
2025-05-25 14:53:04,528 - app - INFO - Database tables created successfully
2025-05-25 14:53:04,528 - app - INFO - Database tables created successfully
2025-05-25 14:53:04,528 - app - INFO - Database tables created successfully
2025-05-25 14:53:05,458 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:53:05,458 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:53:05,462 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:53:05,462 - routes - INFO - AI Settings initialized successfully
2025-05-25 14:53:13,254 - routes - INFO - Auto-classified 'Weekend Pass Thursday Entry' as consumable event ticket
2025-05-25 14:53:13,267 - routes - INFO - Processing digital assets for manually created event ticket 7: ['qr_codes', 'confirmation_codes']
2025-05-25 14:53:13,268 - routes - INFO - Attached QR code #1 to event ticket 7
2025-05-25 14:53:13,269 - routes - INFO - Attached confirmation code #1 to event ticket 7
2025-05-25 14:53:13,275 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from receipt INV-20250525-53B0FA4B
2025-05-25 14:53:13,279 - routes - INFO - Auto-suggesting event creation for event ticket 7
2025-05-25 14:53:35,053 - routes - INFO - Deleted consumable object: Weekend Pass Thursday Entry (ID: 6)
2025-05-25 14:55:55,481 - routes - INFO - Deleted consumable object: Weekend Pass Thursday Entry (ID: 7)
2025-05-25 14:55:57,989 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 14:55:57,990 - routes - INFO - DEBUG: Processing task 18, type=receipt_processing, status=pending_review
2025-05-25 14:55:57,991 - routes - INFO - DEBUG: Task 18 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:55:57,991 - routes - INFO - DEBUG: Task 18 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:55:57,992 - routes - INFO - DEBUG: Task 18 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:55:57,993 - routes - INFO - DEBUG: Task 18 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:55:57,993 - routes - INFO - DEBUG: Task 18 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:55:57,994 - routes - INFO - Task 18 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:55:57,995 - routes - INFO - DEBUG: Task 18 has AI analysis
2025-05-25 14:55:57,996 - routes - INFO - DEBUG: Added task 18 to receipt_tasks, now has 1 items
2025-05-25 14:55:57,997 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 14:55:57,997 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 14:56:00,000 - routes - INFO - Receipt task 18 rejected: 
2025-05-25 14:56:00,006 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 14:56:00,007 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 14:56:00,009 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 14:56:08,169 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 14:56:08,170 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 14:56:08,173 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmphx7qis4d.pdf
2025-05-25 14:56:08,174 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 14:56:08,679 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 14:56:08,681 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 14:56:08,767 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 14:56:08,768 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 14:56:09,113 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 14:56:09,115 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 14:56:09,116 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 14:56:09,145 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 14:56:09,148 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 14:56:20,029 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 14:56:20,031 - mcp_client - INFO - Receipt analyzed successfully with claude
2025-05-25 14:56:20,032 - routes - INFO - MCP analysis successful: {'content': {'vendor_name': 'Great Blue Heron Music Festival', 'date': '2023-05-17', 'total_amount': 257.61, 'subtotal': 216.0, 'tax_amount': 0.0, 'fees': 41.61, 'receipt_number': 'TD8LVDVJ', 'document_type': 'ticket confirmation', 'description': 'Weekend Pass Thursday Entry ticket purchase', 'is_bill': False, 'line_items': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'Event Tickets', 'object_type': 'consumable', 'create_object': False, 'confidence': 0.98, 'expiration_info': {'event_date': '2025-07-03'}}], 'digital_assets': {'qr_codes': ['Present your QR code at check-in'], 'confirmation_codes': ['TD8LVDVJ']}, 'event_details': {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00) Eastern Time (US & Canada)'}}, 'vendor_details': {'business_address': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'business_website': 'eventeny.com'}, 'overall_confidence': 0.95, 'image_quality': 'high', 'extraction_notes': 'Clear ticket confirmation email with complete event details and pricing information'}, 'provider': 'claude', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 10.860175609588623, 'timestamp': '2025-05-25T14:56:20.028023', 'tokens_used': 4005, 'cost_estimate': 0.018567}
2025-05-25 14:56:20,038 - routes - WARNING - Potential duplicate receipt detected: Great Blue Heron Music Festival on 2023-05-17 for $257.61
2025-05-25 14:56:20,048 - routes - INFO - Receipt queued for review: Task ID 19
2025-05-25 14:56:20,056 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 14:56:20,056 - routes - INFO - DEBUG: Processing task 19, type=receipt_processing, status=pending_review
2025-05-25 14:56:20,058 - routes - INFO - DEBUG: Task 19 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:56:20,058 - routes - INFO - DEBUG: Task 19 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:56:20,059 - routes - INFO - DEBUG: Task 19 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:56:20,060 - routes - INFO - DEBUG: Task 19 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:56:20,061 - routes - INFO - DEBUG: Task 19 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:56:20,062 - routes - INFO - Task 19 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:56:20,063 - routes - INFO - DEBUG: Task 19 has AI analysis
2025-05-25 14:56:20,064 - routes - INFO - DEBUG: Added task 19 to receipt_tasks, now has 1 items
2025-05-25 14:56:20,065 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 14:56:20,066 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 14:56:33,498 - routes - INFO - Deleting receipt INV-20250525-53B0FA4B: 1 line items, 0 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-25 14:56:35,802 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 14:56:35,804 - routes - INFO - DEBUG: Processing task 19, type=receipt_processing, status=pending_review
2025-05-25 14:56:35,805 - routes - INFO - DEBUG: Task 19 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:56:35,805 - routes - INFO - DEBUG: Task 19 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:56:35,806 - routes - INFO - DEBUG: Task 19 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:56:35,807 - routes - INFO - DEBUG: Task 19 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:56:35,808 - routes - INFO - DEBUG: Task 19 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:56:35,808 - routes - INFO - Task 19 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:56:35,809 - routes - INFO - DEBUG: Task 19 has AI analysis
2025-05-25 14:56:35,810 - routes - INFO - DEBUG: Added task 19 to receipt_tasks, now has 1 items
2025-05-25 14:56:35,811 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 14:56:35,811 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 14:56:51,741 - routes - INFO - Auto-classified 'Weekend Pass Thursday Entry' as consumable event ticket
2025-05-25 14:56:51,744 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from task 19
2025-05-25 14:56:52,571 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 14:56:52,572 - routes - INFO - DEBUG: Processing task 19, type=receipt_processing, status=pending_review
2025-05-25 14:56:52,573 - routes - INFO - DEBUG: Task 19 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:56:52,574 - routes - INFO - DEBUG: Task 19 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:56:52,575 - routes - INFO - DEBUG: Task 19 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:56:52,576 - routes - INFO - DEBUG: Task 19 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:56:52,576 - routes - INFO - DEBUG: Task 19 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:56:52,577 - routes - INFO - Task 19 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:56:52,578 - routes - INFO - DEBUG: Task 19 has AI analysis
2025-05-25 14:56:52,578 - routes - INFO - DEBUG: Added task 19 to receipt_tasks, now has 1 items
2025-05-25 14:56:52,579 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 14:56:52,580 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 14:57:02,873 - routes - INFO - Auto-classified 'Weekend Pass Thursday Entry' as consumable event ticket
2025-05-25 14:57:02,882 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from task 19
2025-05-25 14:57:03,844 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 14:57:03,845 - routes - INFO - DEBUG: Processing task 19, type=receipt_processing, status=pending_review
2025-05-25 14:57:03,845 - routes - INFO - DEBUG: Task 19 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:57:03,846 - routes - INFO - DEBUG: Task 19 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:57:03,847 - routes - INFO - DEBUG: Task 19 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:57:03,848 - routes - INFO - DEBUG: Task 19 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:57:03,849 - routes - INFO - DEBUG: Task 19 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:57:03,849 - routes - INFO - Task 19 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:57:03,850 - routes - INFO - DEBUG: Task 19 has AI analysis
2025-05-25 14:57:03,851 - routes - INFO - DEBUG: Added task 19 to receipt_tasks, now has 1 items
2025-05-25 14:57:03,851 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 14:57:03,852 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 14:57:07,539 - routes - INFO - Task 19 calendar - using direct JSON format, vendor: Great Blue Heron Music Festival
2025-05-25 14:57:07,556 - routes - INFO - Created calendar event 'Great Blue Heron Music Festival 2025' from task 19
2025-05-25 14:57:08,362 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 14:57:08,364 - routes - INFO - DEBUG: Processing task 19, type=receipt_processing, status=pending_review
2025-05-25 14:57:08,365 - routes - INFO - DEBUG: Task 19 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 14:57:08,366 - routes - INFO - DEBUG: Task 19 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:57:08,367 - routes - INFO - DEBUG: Task 19 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 14:57:08,368 - routes - INFO - DEBUG: Task 19 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 14:57:08,368 - routes - INFO - DEBUG: Task 19 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 14:57:08,369 - routes - INFO - Task 19 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 14:57:08,370 - routes - INFO - DEBUG: Task 19 has AI analysis
2025-05-25 14:57:08,371 - routes - INFO - DEBUG: Added task 19 to receipt_tasks, now has 1 items
2025-05-25 14:57:08,372 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 14:57:08,372 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 14:57:10,131 - routes - INFO - Process receipt - using direct JSON format, vendor: Great Blue Heron Music Festival
2025-05-25 14:57:10,134 - routes - INFO - Using existing vendor: Great Blue Heron Music Festival
2025-05-25 14:57:10,138 - routes - INFO - Processed 1 AI-suggested categories: ['Event Tickets']
2025-05-25 14:57:10,138 - routes - INFO - Created 1 new categories from AI suggestions: ['Event Tickets']
2025-05-25 14:57:10,139 - routes - INFO - Successfully processed receipt task: Invoice INV-20250525-8BFBBC37, 0 objects created
2025-05-25 14:57:10,148 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 14:57:10,149 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 14:57:10,150 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 14:57:16,850 - routes - INFO - Deleted consumable object: Weekend Pass Thursday Entry (ID: 8)
2025-05-25 14:57:24,719 - routes - INFO - Deleted consumable object: Weekend Pass Thursday Entry (ID: 9)
2025-05-25 14:57:33,607 - routes - INFO - Auto-classified 'Weekend Pass Thursday Entry' as consumable event ticket
2025-05-25 14:57:33,609 - routes - INFO - Processing digital assets for manually created event ticket 10: ['qr_codes', 'confirmation_codes']
2025-05-25 14:57:33,610 - routes - INFO - Attached QR code #1 to event ticket 10
2025-05-25 14:57:33,611 - routes - INFO - Attached confirmation code #1 to event ticket 10
2025-05-25 14:57:33,623 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from receipt INV-20250525-8BFBBC37
2025-05-25 14:57:33,626 - routes - INFO - Auto-suggesting event creation for event ticket 10
2025-05-25 15:06:00,782 - routes - INFO - Deleted consumable object: Weekend Pass Thursday Entry (ID: 10)
2025-05-25 15:06:04,625 - routes - INFO - Deleting receipt INV-20250525-8BFBBC37: 1 line items, 0 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-25 15:08:54,100 - app - INFO - Creating database tables...
2025-05-25 15:08:54,101 - app - INFO - Creating database tables...
2025-05-25 15:08:54,103 - app - INFO - Creating database tables...
2025-05-25 15:08:54,107 - app - INFO - Creating database tables...
2025-05-25 15:08:54,138 - app - INFO - Database tables created successfully
2025-05-25 15:08:54,138 - app - INFO - Database tables created successfully
2025-05-25 15:08:54,138 - app - INFO - Database tables created successfully
2025-05-25 15:08:54,138 - app - INFO - Database tables created successfully
2025-05-25 15:08:55,124 - routes - INFO - AI Settings initialized successfully
2025-05-25 15:08:55,125 - routes - INFO - AI Settings initialized successfully
2025-05-25 15:08:55,126 - routes - INFO - AI Settings initialized successfully
2025-05-25 15:08:55,129 - routes - INFO - AI Settings initialized successfully
2025-05-25 15:15:42,687 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 15:15:42,688 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 15:15:42,690 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpm8cfamv4.pdf
2025-05-25 15:15:42,691 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 15:15:43,154 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 15:15:43,155 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 15:15:43,235 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 15:15:43,236 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 15:15:43,593 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 15:15:43,596 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 15:15:43,597 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 15:15:43,631 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 15:15:43,633 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 15:15:51,760 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 15:15:51,761 - mcp_client - INFO - Receipt analyzed successfully with claude
2025-05-25 15:15:51,762 - routes - INFO - MCP analysis successful: {'content': {'vendor_name': 'Great Blue Heron Music Festival', 'date': '2025-07-03', 'total_amount': 257.61, 'subtotal': 216.0, 'tax_amount': 0.0, 'fees': 41.61, 'receipt_number': 'TD8LVDVJ', 'document_type': 'ticket confirmation', 'description': 'Weekend Pass Thursday Entry ticket purchase', 'is_bill': False, 'line_items': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'Event Tickets', 'object_type': 'consumable', 'create_object': False, 'confidence': 0.98, 'expiration_info': {'event_date': '2025-07-03'}}], 'digital_assets': {'qr_codes': ['Present your QR code at check-in'], 'confirmation_codes': ['TD8LVDVJ']}, 'event_details': {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781', 'additional_details': {'entry_time': '1:00 pm', 'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)'}}, 'vendor_details': {'business_address': '2361 Waits Corners Rd, Sherman, NY 14781'}, 'overall_confidence': 0.95, 'image_quality': 'high', 'extraction_notes': 'Clear ticket confirmation email with complete event details and pricing breakdown'}, 'provider': 'claude', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 8.105355262756348, 'timestamp': '2025-05-25T15:15:51.758901', 'tokens_used': 4000, 'cost_estimate': 0.018492}
2025-05-25 15:15:51,791 - routes - INFO - Receipt queued for review: Task ID 20
2025-05-25 15:15:51,801 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 15:15:51,802 - routes - INFO - DEBUG: Processing task 20, type=receipt_processing, status=pending_review
2025-05-25 15:15:51,802 - routes - INFO - DEBUG: Task 20 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 15:15:51,803 - routes - INFO - DEBUG: Task 20 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 15:15:51,804 - routes - INFO - DEBUG: Task 20 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 15:15:51,805 - routes - INFO - DEBUG: Task 20 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 15:15:51,805 - routes - INFO - DEBUG: Task 20 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 15:15:51,807 - routes - INFO - Task 20 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)', 'entry_time': '1:00 pm'}}
2025-05-25 15:15:51,807 - routes - INFO - DEBUG: Task 20 has AI analysis
2025-05-25 15:15:51,808 - routes - INFO - DEBUG: Added task 20 to receipt_tasks, now has 1 items
2025-05-25 15:15:51,809 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 15:15:51,810 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 15:16:22,349 - routes - INFO - Auto-classified 'Weekend Pass Thursday Entry' as consumable event ticket
2025-05-25 15:16:22,356 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from task 20
2025-05-25 15:16:22,360 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 15:16:22,361 - routes - INFO - DEBUG: Processing task 20, type=receipt_processing, status=pending_review
2025-05-25 15:16:22,362 - routes - INFO - DEBUG: Task 20 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 15:16:22,363 - routes - INFO - DEBUG: Task 20 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 15:16:22,364 - routes - INFO - DEBUG: Task 20 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 15:16:22,364 - routes - INFO - DEBUG: Task 20 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 15:16:22,365 - routes - INFO - DEBUG: Task 20 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 15:16:22,366 - routes - INFO - Task 20 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)', 'entry_time': '1:00 pm'}}
2025-05-25 15:16:22,367 - routes - INFO - DEBUG: Task 20 has AI analysis
2025-05-25 15:16:22,367 - routes - INFO - DEBUG: Added task 20 to receipt_tasks, now has 1 items
2025-05-25 15:16:22,368 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 15:16:22,369 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 15:16:23,464 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 15:16:23,465 - routes - INFO - DEBUG: Processing task 20, type=receipt_processing, status=pending_review
2025-05-25 15:16:23,466 - routes - INFO - DEBUG: Task 20 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 15:16:23,467 - routes - INFO - DEBUG: Task 20 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 15:16:23,468 - routes - INFO - DEBUG: Task 20 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 15:16:23,469 - routes - INFO - DEBUG: Task 20 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 15:16:23,469 - routes - INFO - DEBUG: Task 20 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 15:16:23,470 - routes - INFO - Task 20 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781', 'additional_details': {'duration': 'July 03, 2025 1:00 pm - July 06, 2025 10:00 pm (EDT-04:00) Eastern Time (US & Canada)', 'entry_time': '1:00 pm'}}
2025-05-25 15:16:23,471 - routes - INFO - DEBUG: Task 20 has AI analysis
2025-05-25 15:16:23,472 - routes - INFO - DEBUG: Added task 20 to receipt_tasks, now has 1 items
2025-05-25 15:16:23,472 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 15:16:23,473 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 15:16:28,729 - routes - INFO - Process receipt - using direct JSON format, vendor: Great Blue Heron Music Festival
2025-05-25 15:16:28,731 - routes - INFO - Using existing vendor: Great Blue Heron Music Festival
2025-05-25 15:16:28,740 - routes - INFO - Processed 1 AI-suggested categories: ['Event Tickets']
2025-05-25 15:16:28,741 - routes - INFO - Created 1 new categories from AI suggestions: ['Event Tickets']
2025-05-25 15:16:28,741 - routes - INFO - Successfully processed receipt task: Invoice INV-20250525-D5B47D48, 0 objects created
2025-05-25 15:16:28,754 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 15:16:28,755 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 15:16:28,756 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 15:17:06,549 - routes - INFO - Auto-classified 'Weekend Pass Thursday Entry' as consumable event ticket
2025-05-25 15:17:06,551 - routes - INFO - Processing digital assets for manually created event ticket 12: ['qr_codes', 'confirmation_codes']
2025-05-25 15:17:06,552 - routes - INFO - Attached QR code #1 to event ticket 12
2025-05-25 15:17:06,553 - routes - INFO - Attached confirmation code #1 to event ticket 12
2025-05-25 15:17:06,566 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from receipt INV-20250525-D5B47D48
2025-05-25 15:17:06,570 - routes - INFO - Auto-suggesting event creation for event ticket 12
2025-05-25 15:17:22,354 - routes - INFO - Deleted consumable object: Weekend Pass Thursday Entry (ID: 11)
2025-05-25 15:20:17,349 - app - INFO - Creating database tables...
2025-05-25 15:20:17,349 - app - INFO - Creating database tables...
2025-05-25 15:20:17,353 - app - INFO - Creating database tables...
2025-05-25 15:20:17,388 - app - INFO - Database tables created successfully
2025-05-25 15:20:17,388 - app - INFO - Database tables created successfully
2025-05-25 15:20:17,388 - app - INFO - Database tables created successfully
2025-05-25 15:20:17,425 - app - INFO - Creating database tables...
2025-05-25 15:20:17,444 - app - INFO - Database tables created successfully
2025-05-25 15:20:18,374 - routes - INFO - AI Settings initialized successfully
2025-05-25 15:20:18,374 - routes - INFO - AI Settings initialized successfully
2025-05-25 15:20:18,374 - routes - INFO - AI Settings initialized successfully
2025-05-25 15:20:18,374 - routes - INFO - AI Settings initialized successfully
2025-05-25 15:21:08,129 - routes - INFO - Processing receipt file: RECEIPT PAePay DUI Fine Nate Smith.pdf
2025-05-25 15:21:08,130 - routes - INFO - Processing PDF file: RECEIPT_PAePay_DUI_Fine_Nate_Smith.pdf
2025-05-25 15:21:08,133 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmphrlwaf6b.pdf
2025-05-25 15:21:08,134 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 15:21:08,272 - ocr_utils - INFO - Successfully converted 1 pages from PDF
2025-05-25 15:21:08,298 - ocr_utils - INFO - Successfully converted PDF (1 pages) to JPEG image using pdf2image
2025-05-25 15:21:08,299 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 15:21:08,300 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 15:21:08,329 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 15:21:08,331 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 15:21:18,499 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 15:21:18,500 - mcp_client - INFO - Receipt analyzed successfully with claude
2025-05-25 15:21:18,502 - routes - INFO - MCP analysis successful: {'content': {'vendor_name': 'PAePay', 'date': '2025-05-20', 'total_amount': 267.15, 'subtotal': 260.0, 'fees': 7.15, 'receipt_number': 'O1XF693J7H', 'due_date': '2025-05-24', 'is_bill': True, 'document_type': 'payment_plan_receipt', 'description': 'Traffic Ticket or Court Costs Payment', 'line_items': [{'description': 'Payment Plan 67-2018-P000007328', 'total_price': 260.0, 'unit_price': 260.0, 'quantity': 1.0, 'category': 'Professional Services', 'object_type': 'service', 'create_object': False, 'confidence': 0.95, 'item_details': 'Next payment amount due: $65.00, Overdue amount: $195.00, Current Balance: $1,337.65'}], 'digital_assets': {'confirmation_codes': ['O1XF693J7H'], 'account_numbers': ['67-2018-P000007328']}, 'people_found': [{'person_name': 'Smith, Nathaniel Foster', 'role': 'defendant', 'relationship_to_purchase': 'subject of court case', 'create_person_object': True, 'confidence': 0.95}], 'overall_confidence': 0.95, 'image_quality': 'high', 'extraction_notes': 'This is a court payment system receipt for a payment plan related to traffic ticket or court costs. The document includes service fees and has clear payment tracking information.', 'missing_information': [], 'vendor_details': {'business_website': 'https://ujsportal.pacourts.us'}}, 'provider': 'claude', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 10.151419639587402, 'timestamp': '2025-05-25T15:21:18.498343', 'tokens_used': 4617, 'cost_estimate': 0.019875}
2025-05-25 15:21:18,528 - routes - INFO - Receipt queued for review: Task ID 21
2025-05-25 15:21:18,537 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 15:21:18,537 - routes - INFO - DEBUG: Processing task 21, type=receipt_processing, status=pending_review
2025-05-25 15:21:18,538 - routes - INFO - DEBUG: Task 21 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 15:21:18,539 - routes - INFO - DEBUG: Task 21 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:21:18,540 - routes - INFO - DEBUG: Task 21 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 15:21:18,540 - routes - INFO - DEBUG: Task 21 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:21:18,541 - routes - INFO - Detected event from receipt: traffic ticket or court (confidence: 0.6, 0 consumable items)
2025-05-25 15:21:18,542 - routes - INFO - Task 21 - Detected event from receipt data: Traffic Ticket Or Court
2025-05-25 15:21:18,542 - routes - INFO - DEBUG: Task 21 SUCCESSFULLY extracted receipt data: vendor=PAePay, total=$267.15
2025-05-25 15:21:18,543 - routes - INFO - Task 21 has event details: {'event_name': 'Traffic Ticket Or Court', 'event_date': '2025-05-20', 'venue_location': '', 'description': 'traffic ticket or court costs payment', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 15:21:18,544 - routes - INFO - DEBUG: Task 21 has AI analysis
2025-05-25 15:21:18,545 - routes - INFO - DEBUG: Added task 21 to receipt_tasks, now has 1 items
2025-05-25 15:21:18,546 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 15:21:18,546 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 15:21:48,932 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 15:21:48,933 - routes - INFO - DEBUG: Processing task 21, type=receipt_processing, status=pending_review
2025-05-25 15:21:48,933 - routes - INFO - DEBUG: Task 21 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 15:21:48,934 - routes - INFO - DEBUG: Task 21 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:21:48,935 - routes - INFO - DEBUG: Task 21 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 15:21:48,936 - routes - INFO - DEBUG: Task 21 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:21:48,937 - routes - INFO - Detected event from receipt: traffic ticket or court (confidence: 0.6, 0 consumable items)
2025-05-25 15:21:48,938 - routes - INFO - Task 21 - Detected event from receipt data: Traffic Ticket Or Court
2025-05-25 15:21:48,939 - routes - INFO - DEBUG: Task 21 SUCCESSFULLY extracted receipt data: vendor=PAePay, total=$267.15
2025-05-25 15:21:48,940 - routes - INFO - Task 21 has event details: {'event_name': 'Traffic Ticket Or Court', 'event_date': '2025-05-20', 'venue_location': '', 'description': 'traffic ticket or court costs payment', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 15:21:48,940 - routes - INFO - DEBUG: Task 21 has AI analysis
2025-05-25 15:21:48,941 - routes - INFO - DEBUG: Added task 21 to receipt_tasks, now has 1 items
2025-05-25 15:21:48,942 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 15:21:48,943 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 15:21:50,878 - routes - INFO - Created person object 'Smith, Nathaniel Foster' from task 21
2025-05-25 15:21:52,607 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 15:21:52,608 - routes - INFO - DEBUG: Processing task 21, type=receipt_processing, status=pending_review
2025-05-25 15:21:52,610 - routes - INFO - DEBUG: Task 21 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 15:21:52,611 - routes - INFO - DEBUG: Task 21 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:21:52,611 - routes - INFO - DEBUG: Task 21 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 15:21:52,612 - routes - INFO - DEBUG: Task 21 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:21:52,613 - routes - INFO - Detected event from receipt: traffic ticket or court (confidence: 0.6, 0 consumable items)
2025-05-25 15:21:52,615 - routes - INFO - Task 21 - Detected event from receipt data: Traffic Ticket Or Court
2025-05-25 15:21:52,615 - routes - INFO - DEBUG: Task 21 SUCCESSFULLY extracted receipt data: vendor=PAePay, total=$267.15
2025-05-25 15:21:52,616 - routes - INFO - Task 21 has event details: {'event_name': 'Traffic Ticket Or Court', 'event_date': '2025-05-20', 'venue_location': '', 'description': 'traffic ticket or court costs payment', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 15:21:52,618 - routes - INFO - DEBUG: Task 21 has AI analysis
2025-05-25 15:21:52,619 - routes - INFO - DEBUG: Added task 21 to receipt_tasks, now has 1 items
2025-05-25 15:21:52,620 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 15:21:52,620 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 15:22:23,031 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 15:22:23,032 - routes - INFO - DEBUG: Processing task 21, type=receipt_processing, status=pending_review
2025-05-25 15:22:23,033 - routes - INFO - DEBUG: Task 21 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 15:22:23,034 - routes - INFO - DEBUG: Task 21 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:22:23,035 - routes - INFO - DEBUG: Task 21 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 15:22:23,035 - routes - INFO - DEBUG: Task 21 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:22:23,036 - routes - INFO - Detected event from receipt: traffic ticket or court (confidence: 0.6, 0 consumable items)
2025-05-25 15:22:23,037 - routes - INFO - Task 21 - Detected event from receipt data: Traffic Ticket Or Court
2025-05-25 15:22:23,038 - routes - INFO - DEBUG: Task 21 SUCCESSFULLY extracted receipt data: vendor=PAePay, total=$267.15
2025-05-25 15:22:23,039 - routes - INFO - Task 21 has event details: {'event_name': 'Traffic Ticket Or Court', 'event_date': '2025-05-20', 'venue_location': '', 'description': 'traffic ticket or court costs payment', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 15:22:23,039 - routes - INFO - DEBUG: Task 21 has AI analysis
2025-05-25 15:22:23,040 - routes - INFO - DEBUG: Added task 21 to receipt_tasks, now has 1 items
2025-05-25 15:22:23,041 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 15:22:23,042 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 15:22:53,524 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 15:22:53,525 - routes - INFO - DEBUG: Processing task 21, type=receipt_processing, status=pending_review
2025-05-25 15:22:53,526 - routes - INFO - DEBUG: Task 21 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 15:22:53,526 - routes - INFO - DEBUG: Task 21 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:22:53,527 - routes - INFO - DEBUG: Task 21 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 15:22:53,528 - routes - INFO - DEBUG: Task 21 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:22:53,529 - routes - INFO - Detected event from receipt: traffic ticket or court (confidence: 0.6, 0 consumable items)
2025-05-25 15:22:53,530 - routes - INFO - Task 21 - Detected event from receipt data: Traffic Ticket Or Court
2025-05-25 15:22:53,530 - routes - INFO - DEBUG: Task 21 SUCCESSFULLY extracted receipt data: vendor=PAePay, total=$267.15
2025-05-25 15:22:53,531 - routes - INFO - Task 21 has event details: {'event_name': 'Traffic Ticket Or Court', 'event_date': '2025-05-20', 'venue_location': '', 'description': 'traffic ticket or court costs payment', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 15:22:53,532 - routes - INFO - DEBUG: Task 21 has AI analysis
2025-05-25 15:22:53,533 - routes - INFO - DEBUG: Added task 21 to receipt_tasks, now has 1 items
2025-05-25 15:22:53,533 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 15:22:53,534 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 15:23:24,031 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 15:23:24,031 - routes - INFO - DEBUG: Processing task 21, type=receipt_processing, status=pending_review
2025-05-25 15:23:24,032 - routes - INFO - DEBUG: Task 21 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 15:23:24,033 - routes - INFO - DEBUG: Task 21 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:23:24,034 - routes - INFO - DEBUG: Task 21 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 15:23:24,035 - routes - INFO - DEBUG: Task 21 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:23:24,036 - routes - INFO - Detected event from receipt: traffic ticket or court (confidence: 0.6, 0 consumable items)
2025-05-25 15:23:24,037 - routes - INFO - Task 21 - Detected event from receipt data: Traffic Ticket Or Court
2025-05-25 15:23:24,038 - routes - INFO - DEBUG: Task 21 SUCCESSFULLY extracted receipt data: vendor=PAePay, total=$267.15
2025-05-25 15:23:24,039 - routes - INFO - Task 21 has event details: {'event_name': 'Traffic Ticket Or Court', 'event_date': '2025-05-20', 'venue_location': '', 'description': 'traffic ticket or court costs payment', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 15:23:24,039 - routes - INFO - DEBUG: Task 21 has AI analysis
2025-05-25 15:23:24,040 - routes - INFO - DEBUG: Added task 21 to receipt_tasks, now has 1 items
2025-05-25 15:23:24,041 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 15:23:24,042 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 15:23:54,586 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 15:23:54,587 - routes - INFO - DEBUG: Processing task 21, type=receipt_processing, status=pending_review
2025-05-25 15:23:54,587 - routes - INFO - DEBUG: Task 21 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 15:23:54,588 - routes - INFO - DEBUG: Task 21 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:23:54,589 - routes - INFO - DEBUG: Task 21 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 15:23:54,590 - routes - INFO - DEBUG: Task 21 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:23:54,591 - routes - INFO - Detected event from receipt: traffic ticket or court (confidence: 0.6, 0 consumable items)
2025-05-25 15:23:54,592 - routes - INFO - Task 21 - Detected event from receipt data: Traffic Ticket Or Court
2025-05-25 15:23:54,593 - routes - INFO - DEBUG: Task 21 SUCCESSFULLY extracted receipt data: vendor=PAePay, total=$267.15
2025-05-25 15:23:54,594 - routes - INFO - Task 21 has event details: {'event_name': 'Traffic Ticket Or Court', 'event_date': '2025-05-20', 'venue_location': '', 'description': 'traffic ticket or court costs payment', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 15:23:54,595 - routes - INFO - DEBUG: Task 21 has AI analysis
2025-05-25 15:23:54,596 - routes - INFO - DEBUG: Added task 21 to receipt_tasks, now has 1 items
2025-05-25 15:23:54,597 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 15:23:54,598 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 15:24:25,163 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 15:24:25,164 - routes - INFO - DEBUG: Processing task 21, type=receipt_processing, status=pending_review
2025-05-25 15:24:25,165 - routes - INFO - DEBUG: Task 21 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 15:24:25,166 - routes - INFO - DEBUG: Task 21 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:24:25,167 - routes - INFO - DEBUG: Task 21 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 15:24:25,168 - routes - INFO - DEBUG: Task 21 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:24:25,169 - routes - INFO - Detected event from receipt: traffic ticket or court (confidence: 0.6, 0 consumable items)
2025-05-25 15:24:25,170 - routes - INFO - Task 21 - Detected event from receipt data: Traffic Ticket Or Court
2025-05-25 15:24:25,170 - routes - INFO - DEBUG: Task 21 SUCCESSFULLY extracted receipt data: vendor=PAePay, total=$267.15
2025-05-25 15:24:25,171 - routes - INFO - Task 21 has event details: {'event_name': 'Traffic Ticket Or Court', 'event_date': '2025-05-20', 'venue_location': '', 'description': 'traffic ticket or court costs payment', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 15:24:25,172 - routes - INFO - DEBUG: Task 21 has AI analysis
2025-05-25 15:24:25,173 - routes - INFO - DEBUG: Added task 21 to receipt_tasks, now has 1 items
2025-05-25 15:24:25,173 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 15:24:25,174 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 15:24:55,739 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 15:24:55,740 - routes - INFO - DEBUG: Processing task 21, type=receipt_processing, status=pending_review
2025-05-25 15:24:55,741 - routes - INFO - DEBUG: Task 21 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 15:24:55,742 - routes - INFO - DEBUG: Task 21 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:24:55,742 - routes - INFO - DEBUG: Task 21 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 15:24:55,743 - routes - INFO - DEBUG: Task 21 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:24:55,744 - routes - INFO - Detected event from receipt: traffic ticket or court (confidence: 0.6, 0 consumable items)
2025-05-25 15:24:55,745 - routes - INFO - Task 21 - Detected event from receipt data: Traffic Ticket Or Court
2025-05-25 15:24:55,746 - routes - INFO - DEBUG: Task 21 SUCCESSFULLY extracted receipt data: vendor=PAePay, total=$267.15
2025-05-25 15:24:55,747 - routes - INFO - Task 21 has event details: {'event_name': 'Traffic Ticket Or Court', 'event_date': '2025-05-20', 'venue_location': '', 'description': 'traffic ticket or court costs payment', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 15:24:55,747 - routes - INFO - DEBUG: Task 21 has AI analysis
2025-05-25 15:24:55,748 - routes - INFO - DEBUG: Added task 21 to receipt_tasks, now has 1 items
2025-05-25 15:24:55,749 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 15:24:55,750 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 15:25:26,241 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 15:25:26,242 - routes - INFO - DEBUG: Processing task 21, type=receipt_processing, status=pending_review
2025-05-25 15:25:26,243 - routes - INFO - DEBUG: Task 21 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 15:25:26,243 - routes - INFO - DEBUG: Task 21 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:25:26,244 - routes - INFO - DEBUG: Task 21 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 15:25:26,245 - routes - INFO - DEBUG: Task 21 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:25:26,246 - routes - INFO - Detected event from receipt: traffic ticket or court (confidence: 0.6, 0 consumable items)
2025-05-25 15:25:26,247 - routes - INFO - Task 21 - Detected event from receipt data: Traffic Ticket Or Court
2025-05-25 15:25:26,247 - routes - INFO - DEBUG: Task 21 SUCCESSFULLY extracted receipt data: vendor=PAePay, total=$267.15
2025-05-25 15:25:26,248 - routes - INFO - Task 21 has event details: {'event_name': 'Traffic Ticket Or Court', 'event_date': '2025-05-20', 'venue_location': '', 'description': 'traffic ticket or court costs payment', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 15:25:26,249 - routes - INFO - DEBUG: Task 21 has AI analysis
2025-05-25 15:25:26,250 - routes - INFO - DEBUG: Added task 21 to receipt_tasks, now has 1 items
2025-05-25 15:25:26,250 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 15:25:26,251 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 15:25:56,578 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 15:25:56,580 - routes - INFO - DEBUG: Processing task 21, type=receipt_processing, status=pending_review
2025-05-25 15:25:56,581 - routes - INFO - DEBUG: Task 21 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 15:25:56,582 - routes - INFO - DEBUG: Task 21 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:25:56,582 - routes - INFO - DEBUG: Task 21 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 15:25:56,583 - routes - INFO - DEBUG: Task 21 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:25:56,584 - routes - INFO - Detected event from receipt: traffic ticket or court (confidence: 0.6, 0 consumable items)
2025-05-25 15:25:56,585 - routes - INFO - Task 21 - Detected event from receipt data: Traffic Ticket Or Court
2025-05-25 15:25:56,586 - routes - INFO - DEBUG: Task 21 SUCCESSFULLY extracted receipt data: vendor=PAePay, total=$267.15
2025-05-25 15:25:56,586 - routes - INFO - Task 21 has event details: {'event_name': 'Traffic Ticket Or Court', 'event_date': '2025-05-20', 'venue_location': '', 'description': 'traffic ticket or court costs payment', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 15:25:56,587 - routes - INFO - DEBUG: Task 21 has AI analysis
2025-05-25 15:25:56,588 - routes - INFO - DEBUG: Added task 21 to receipt_tasks, now has 1 items
2025-05-25 15:25:56,589 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 15:25:56,589 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 15:26:24,730 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 15:26:24,731 - routes - INFO - DEBUG: Processing task 21, type=receipt_processing, status=pending_review
2025-05-25 15:26:24,732 - routes - INFO - DEBUG: Task 21 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 15:26:24,733 - routes - INFO - DEBUG: Task 21 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:26:24,734 - routes - INFO - DEBUG: Task 21 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 15:26:24,734 - routes - INFO - DEBUG: Task 21 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:26:24,735 - routes - INFO - Detected event from receipt: traffic ticket or court (confidence: 0.6, 0 consumable items)
2025-05-25 15:26:24,736 - routes - INFO - Task 21 - Detected event from receipt data: Traffic Ticket Or Court
2025-05-25 15:26:24,736 - routes - INFO - DEBUG: Task 21 SUCCESSFULLY extracted receipt data: vendor=PAePay, total=$267.15
2025-05-25 15:26:24,737 - routes - INFO - Task 21 has event details: {'event_name': 'Traffic Ticket Or Court', 'event_date': '2025-05-20', 'venue_location': '', 'description': 'traffic ticket or court costs payment', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 15:26:24,738 - routes - INFO - DEBUG: Task 21 has AI analysis
2025-05-25 15:26:24,739 - routes - INFO - DEBUG: Added task 21 to receipt_tasks, now has 1 items
2025-05-25 15:26:24,739 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 15:26:24,740 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 15:26:55,281 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 15:26:55,282 - routes - INFO - DEBUG: Processing task 21, type=receipt_processing, status=pending_review
2025-05-25 15:26:55,283 - routes - INFO - DEBUG: Task 21 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 15:26:55,283 - routes - INFO - DEBUG: Task 21 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:26:55,284 - routes - INFO - DEBUG: Task 21 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 15:26:55,285 - routes - INFO - DEBUG: Task 21 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:26:55,286 - routes - INFO - Detected event from receipt: traffic ticket or court (confidence: 0.6, 0 consumable items)
2025-05-25 15:26:55,286 - routes - INFO - Task 21 - Detected event from receipt data: Traffic Ticket Or Court
2025-05-25 15:26:55,287 - routes - INFO - DEBUG: Task 21 SUCCESSFULLY extracted receipt data: vendor=PAePay, total=$267.15
2025-05-25 15:26:55,288 - routes - INFO - Task 21 has event details: {'event_name': 'Traffic Ticket Or Court', 'event_date': '2025-05-20', 'venue_location': '', 'description': 'traffic ticket or court costs payment', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 15:26:55,289 - routes - INFO - DEBUG: Task 21 has AI analysis
2025-05-25 15:26:55,290 - routes - INFO - DEBUG: Added task 21 to receipt_tasks, now has 1 items
2025-05-25 15:26:55,290 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 15:26:55,291 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 15:27:25,806 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 15:27:25,807 - routes - INFO - DEBUG: Processing task 21, type=receipt_processing, status=pending_review
2025-05-25 15:27:25,808 - routes - INFO - DEBUG: Task 21 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 15:27:25,810 - routes - INFO - DEBUG: Task 21 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:27:25,811 - routes - INFO - DEBUG: Task 21 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 15:27:25,813 - routes - INFO - DEBUG: Task 21 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 15:27:25,815 - routes - INFO - Detected event from receipt: traffic ticket or court (confidence: 0.6, 0 consumable items)
2025-05-25 15:27:25,816 - routes - INFO - Task 21 - Detected event from receipt data: Traffic Ticket Or Court
2025-05-25 15:27:25,817 - routes - INFO - DEBUG: Task 21 SUCCESSFULLY extracted receipt data: vendor=PAePay, total=$267.15
2025-05-25 15:27:25,818 - routes - INFO - Task 21 has event details: {'event_name': 'Traffic Ticket Or Court', 'event_date': '2025-05-20', 'venue_location': '', 'description': 'traffic ticket or court costs payment', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 15:27:25,819 - routes - INFO - DEBUG: Task 21 has AI analysis
2025-05-25 15:27:25,820 - routes - INFO - DEBUG: Added task 21 to receipt_tasks, now has 1 items
2025-05-25 15:27:25,821 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 15:27:25,822 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 15:55:37,888 - routes - ERROR - Error loading settings: Could not build url for endpoint 'update_ai_settings' with values ['provider']. Did you mean 'settings' instead?
2025-05-25 16:03:53,872 - app - INFO - Creating database tables...
2025-05-25 16:03:53,900 - app - INFO - Creating database tables...
2025-05-25 16:03:53,912 - app - INFO - Database tables created successfully
2025-05-25 16:03:53,918 - app - INFO - Database tables created successfully
2025-05-25 16:03:53,958 - app - INFO - Creating database tables...
2025-05-25 16:03:53,976 - app - INFO - Database tables created successfully
2025-05-25 16:03:53,986 - app - INFO - Creating database tables...
2025-05-25 16:03:54,004 - app - INFO - Database tables created successfully
2025-05-25 16:03:54,875 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:03:54,875 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:03:54,876 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:03:54,879 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:04:17,690 - routes - INFO - Deleted consumable object: Weekend Pass Thursday Entry (ID: 12)
2025-05-25 16:04:19,733 - routes - INFO - Deleted person object: Smith, Nathaniel Foster (ID: 13)
2025-05-25 16:04:23,409 - routes - INFO - Deleting receipt INV-20250525-D5B47D48: 1 line items, 0 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-25 16:04:23,415 - routes - ERROR - Error deleting receipt: (psycopg2.errors.UndefinedColumn) column receipt_creation_tracking.creation_metadata does not exist
LINE 1: ... AS receipt_creation_tracking_created_by_task_id, receipt_cr...
                                                             ^

[SQL: SELECT receipt_creation_tracking.id AS receipt_creation_tracking_id, receipt_creation_tracking.invoice_id AS receipt_creation_tracking_invoice_id, receipt_creation_tracking.line_item_index AS receipt_creation_tracking_line_item_index, receipt_creation_tracking.creation_type AS receipt_creation_tracking_creation_type, receipt_creation_tracking.creation_id AS receipt_creation_tracking_creation_id, receipt_creation_tracking.created_at AS receipt_creation_tracking_created_at, receipt_creation_tracking.created_by_task_id AS receipt_creation_tracking_created_by_task_id, receipt_creation_tracking.creation_metadata AS receipt_creation_tracking_creation_metadata 
FROM receipt_creation_tracking 
WHERE %(param_1)s = receipt_creation_tracking.invoice_id]
[parameters: {'param_1': 7}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column receipt_creation_tracking.creation_metadata does not exist
LINE 1: ... AS receipt_creation_tracking_created_by_task_id, receipt_cr...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1288, in delete_receipt
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 442, in execute
    postsort_actions = self._generate_actions()
                       ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 400, in _generate_actions
    if action.execute(self):
       ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 532, in execute
    self.dependency_processor.presort_deletes(uow, delete_states)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/dependency.py", line 448, in presort_deletes
    history = uowcommit.get_attribute_history(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 283, in get_attribute_history
    history = impl.get_history(
              ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1683, in get_history
    current = self.get(state, dict_, passive=passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column receipt_creation_tracking.creation_metadata does not exist
LINE 1: ... AS receipt_creation_tracking_created_by_task_id, receipt_cr...
                                                             ^

[SQL: SELECT receipt_creation_tracking.id AS receipt_creation_tracking_id, receipt_creation_tracking.invoice_id AS receipt_creation_tracking_invoice_id, receipt_creation_tracking.line_item_index AS receipt_creation_tracking_line_item_index, receipt_creation_tracking.creation_type AS receipt_creation_tracking_creation_type, receipt_creation_tracking.creation_id AS receipt_creation_tracking_creation_id, receipt_creation_tracking.created_at AS receipt_creation_tracking_created_at, receipt_creation_tracking.created_by_task_id AS receipt_creation_tracking_created_by_task_id, receipt_creation_tracking.creation_metadata AS receipt_creation_tracking_creation_metadata 
FROM receipt_creation_tracking 
WHERE %(param_1)s = receipt_creation_tracking.invoice_id]
[parameters: {'param_1': 7}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-25 16:05:27,715 - app - INFO - Creating database tables...
2025-05-25 16:05:27,716 - app - INFO - Creating database tables...
2025-05-25 16:05:27,721 - app - INFO - Creating database tables...
2025-05-25 16:05:27,724 - app - INFO - Creating database tables...
2025-05-25 16:05:27,754 - app - INFO - Database tables created successfully
2025-05-25 16:05:27,754 - app - INFO - Database tables created successfully
2025-05-25 16:05:27,754 - app - INFO - Database tables created successfully
2025-05-25 16:05:27,754 - app - INFO - Database tables created successfully
2025-05-25 16:05:28,738 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:05:28,740 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:05:28,742 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:05:28,744 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:05:31,274 - routes - INFO - Deleting receipt INV-20250525-D5B47D48: 1 line items, 0 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-25 16:05:31,281 - routes - ERROR - Error deleting receipt: (psycopg2.errors.UndefinedColumn) column receipt_creation_tracking.creation_metadata does not exist
LINE 1: ... AS receipt_creation_tracking_created_by_task_id, receipt_cr...
                                                             ^

[SQL: SELECT receipt_creation_tracking.id AS receipt_creation_tracking_id, receipt_creation_tracking.invoice_id AS receipt_creation_tracking_invoice_id, receipt_creation_tracking.line_item_index AS receipt_creation_tracking_line_item_index, receipt_creation_tracking.creation_type AS receipt_creation_tracking_creation_type, receipt_creation_tracking.creation_id AS receipt_creation_tracking_creation_id, receipt_creation_tracking.created_at AS receipt_creation_tracking_created_at, receipt_creation_tracking.created_by_task_id AS receipt_creation_tracking_created_by_task_id, receipt_creation_tracking.creation_metadata AS receipt_creation_tracking_creation_metadata 
FROM receipt_creation_tracking 
WHERE %(param_1)s = receipt_creation_tracking.invoice_id]
[parameters: {'param_1': 7}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column receipt_creation_tracking.creation_metadata does not exist
LINE 1: ... AS receipt_creation_tracking_created_by_task_id, receipt_cr...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1288, in delete_receipt
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 442, in execute
    postsort_actions = self._generate_actions()
                       ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 400, in _generate_actions
    if action.execute(self):
       ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 532, in execute
    self.dependency_processor.presort_deletes(uow, delete_states)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/dependency.py", line 448, in presort_deletes
    history = uowcommit.get_attribute_history(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 283, in get_attribute_history
    history = impl.get_history(
              ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1683, in get_history
    current = self.get(state, dict_, passive=passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column receipt_creation_tracking.creation_metadata does not exist
LINE 1: ... AS receipt_creation_tracking_created_by_task_id, receipt_cr...
                                                             ^

[SQL: SELECT receipt_creation_tracking.id AS receipt_creation_tracking_id, receipt_creation_tracking.invoice_id AS receipt_creation_tracking_invoice_id, receipt_creation_tracking.line_item_index AS receipt_creation_tracking_line_item_index, receipt_creation_tracking.creation_type AS receipt_creation_tracking_creation_type, receipt_creation_tracking.creation_id AS receipt_creation_tracking_creation_id, receipt_creation_tracking.created_at AS receipt_creation_tracking_created_at, receipt_creation_tracking.created_by_task_id AS receipt_creation_tracking_created_by_task_id, receipt_creation_tracking.creation_metadata AS receipt_creation_tracking_creation_metadata 
FROM receipt_creation_tracking 
WHERE %(param_1)s = receipt_creation_tracking.invoice_id]
[parameters: {'param_1': 7}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-25 16:07:17,435 - routes - INFO - Deleting receipt INV-20250525-D5B47D48: 1 line items, 0 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-25 16:07:17,441 - routes - ERROR - Error deleting receipt: (psycopg2.errors.UndefinedColumn) column receipt_creation_tracking.creation_metadata does not exist
LINE 1: ... AS receipt_creation_tracking_created_by_task_id, receipt_cr...
                                                             ^

[SQL: SELECT receipt_creation_tracking.id AS receipt_creation_tracking_id, receipt_creation_tracking.invoice_id AS receipt_creation_tracking_invoice_id, receipt_creation_tracking.line_item_index AS receipt_creation_tracking_line_item_index, receipt_creation_tracking.creation_type AS receipt_creation_tracking_creation_type, receipt_creation_tracking.creation_id AS receipt_creation_tracking_creation_id, receipt_creation_tracking.created_at AS receipt_creation_tracking_created_at, receipt_creation_tracking.created_by_task_id AS receipt_creation_tracking_created_by_task_id, receipt_creation_tracking.creation_metadata AS receipt_creation_tracking_creation_metadata 
FROM receipt_creation_tracking 
WHERE %(param_1)s = receipt_creation_tracking.invoice_id]
[parameters: {'param_1': 7}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column receipt_creation_tracking.creation_metadata does not exist
LINE 1: ... AS receipt_creation_tracking_created_by_task_id, receipt_cr...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1288, in delete_receipt
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 442, in execute
    postsort_actions = self._generate_actions()
                       ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 400, in _generate_actions
    if action.execute(self):
       ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 532, in execute
    self.dependency_processor.presort_deletes(uow, delete_states)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/dependency.py", line 448, in presort_deletes
    history = uowcommit.get_attribute_history(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 283, in get_attribute_history
    history = impl.get_history(
              ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1683, in get_history
    current = self.get(state, dict_, passive=passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column receipt_creation_tracking.creation_metadata does not exist
LINE 1: ... AS receipt_creation_tracking_created_by_task_id, receipt_cr...
                                                             ^

[SQL: SELECT receipt_creation_tracking.id AS receipt_creation_tracking_id, receipt_creation_tracking.invoice_id AS receipt_creation_tracking_invoice_id, receipt_creation_tracking.line_item_index AS receipt_creation_tracking_line_item_index, receipt_creation_tracking.creation_type AS receipt_creation_tracking_creation_type, receipt_creation_tracking.creation_id AS receipt_creation_tracking_creation_id, receipt_creation_tracking.created_at AS receipt_creation_tracking_created_at, receipt_creation_tracking.created_by_task_id AS receipt_creation_tracking_created_by_task_id, receipt_creation_tracking.creation_metadata AS receipt_creation_tracking_creation_metadata 
FROM receipt_creation_tracking 
WHERE %(param_1)s = receipt_creation_tracking.invoice_id]
[parameters: {'param_1': 7}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-25 16:08:03,465 - routes - INFO - Deleting receipt INV-20250525-D5B47D48: 1 line items, 0 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-25 16:08:11,349 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 16:08:11,350 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 16:08:11,353 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp33azwdz8.pdf
2025-05-25 16:08:11,353 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 16:08:11,822 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 16:08:11,823 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 16:08:11,901 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 16:08:11,902 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 16:08:12,245 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 16:08:12,247 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 16:08:12,248 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 16:08:12,285 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 16:08:12,287 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 16:08:22,849 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 16:08:22,851 - mcp_client - INFO - Receipt analyzed successfully with claude
2025-05-25 16:08:22,853 - routes - INFO - MCP analysis successful: {'content': {'vendor_name': 'Great Blue Heron Music Festival', 'date': '2023-05-17', 'total_amount': 257.61, 'subtotal': 216.0, 'tax_amount': 0.0, 'fees': 41.61, 'receipt_number': 'TD8LVDVJ', 'document_type': 'ticket confirmation', 'description': 'Music festival ticket purchase', 'is_bill': False, 'line_items': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'Event Tickets', 'object_type': 'consumable', 'create_object': False, 'expiration_info': {'event_date': '2025-07-03'}, 'confidence': 0.95}], 'digital_assets': {'qr_codes': ['QR code present in image'], 'confirmation_codes': ['TD8LVDVJ']}, 'event_details': {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00)', 'entry_type': 'Weekend Pass Thursday Entry', 'ticket_status': 'non-refundable'}}, 'vendor_details': {'business_address': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'business_website': 'eventeny.com'}, 'overall_confidence': 0.95, 'image_quality': 'high', 'extraction_notes': 'Clear digital ticket confirmation email with complete event details and pricing information'}, 'provider': 'claude', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 10.538071632385254, 'timestamp': '2025-05-25T16:08:22.844772', 'tokens_used': 4020, 'cost_estimate': 0.018792000000000003}
2025-05-25 16:08:22,888 - routes - INFO - Receipt queued for review: Task ID 22
2025-05-25 16:08:22,899 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-25 16:08:22,900 - routes - INFO - DEBUG: Processing task 22, type=receipt_processing, status=pending_review
2025-05-25 16:08:22,900 - routes - INFO - DEBUG: Task 22 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 16:08:22,901 - routes - INFO - DEBUG: Task 22 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 16:08:22,902 - routes - INFO - DEBUG: Task 22 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 16:08:22,903 - routes - INFO - DEBUG: Task 22 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 16:08:22,903 - routes - INFO - DEBUG: Task 22 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 16:08:22,904 - routes - INFO - Task 22 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00)', 'entry_type': 'Weekend Pass Thursday Entry', 'ticket_status': 'non-refundable'}}
2025-05-25 16:08:22,905 - routes - INFO - DEBUG: Task 22 has AI analysis
2025-05-25 16:08:22,906 - routes - INFO - DEBUG: Added task 22 to receipt_tasks, now has 1 items
2025-05-25 16:08:22,906 - routes - INFO - DEBUG: Processing task 21, type=receipt_processing, status=pending_review
2025-05-25 16:08:22,907 - routes - INFO - DEBUG: Task 21 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 16:08:22,908 - routes - INFO - DEBUG: Task 21 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 16:08:22,909 - routes - INFO - DEBUG: Task 21 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 16:08:22,909 - routes - INFO - DEBUG: Task 21 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'due_date', 'subtotal', 'line_items', 'description', 'vendor_name', 'people_found', 'total_amount', 'document_type', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence', 'missing_information']
2025-05-25 16:08:22,910 - routes - INFO - Detected event from receipt: traffic ticket or court (confidence: 0.6, 0 consumable items)
2025-05-25 16:08:22,911 - routes - INFO - Task 21 - Detected event from receipt data: Traffic Ticket Or Court
2025-05-25 16:08:22,912 - routes - INFO - DEBUG: Task 21 SUCCESSFULLY extracted receipt data: vendor=PAePay, total=$267.15
2025-05-25 16:08:22,912 - routes - INFO - Task 21 has event details: {'event_name': 'Traffic Ticket Or Court', 'event_date': '2025-05-20', 'venue_location': '', 'description': 'traffic ticket or court costs payment', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 16:08:22,913 - routes - INFO - DEBUG: Task 21 has AI analysis
2025-05-25 16:08:22,914 - routes - INFO - DEBUG: Added task 21 to receipt_tasks, now has 2 items
2025-05-25 16:08:22,915 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-25 16:08:22,915 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-25 16:08:30,498 - routes - INFO - Receipt task 21 rejected: 
2025-05-25 16:08:30,507 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 16:08:30,507 - routes - INFO - DEBUG: Processing task 22, type=receipt_processing, status=pending_review
2025-05-25 16:08:30,508 - routes - INFO - DEBUG: Task 22 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 16:08:30,509 - routes - INFO - DEBUG: Task 22 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 16:08:30,510 - routes - INFO - DEBUG: Task 22 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 16:08:30,510 - routes - INFO - DEBUG: Task 22 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 16:08:30,511 - routes - INFO - DEBUG: Task 22 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 16:08:30,512 - routes - INFO - Task 22 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00)', 'entry_type': 'Weekend Pass Thursday Entry', 'ticket_status': 'non-refundable'}}
2025-05-25 16:08:30,513 - routes - INFO - DEBUG: Task 22 has AI analysis
2025-05-25 16:08:30,514 - routes - INFO - DEBUG: Added task 22 to receipt_tasks, now has 1 items
2025-05-25 16:08:30,514 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 16:08:30,515 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 16:08:42,050 - routes - INFO - Processing receipt 22 with selections: invoice=True, objects=['0'], people=[], events=True, org=True
2025-05-25 16:08:42,059 - routes - ERROR - Error in process_receipt_task_enhanced: name 'create_object_from_line_item' is not defined
2025-05-25 16:08:42,069 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 16:08:42,070 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 16:08:42,071 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 16:09:00,191 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 16:09:00,192 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 16:09:00,193 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpx3tyxuqy.pdf
2025-05-25 16:09:00,194 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 16:09:00,598 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 16:09:00,599 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 16:09:00,677 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 16:09:00,678 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 16:09:01,033 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 16:09:01,034 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 16:09:01,035 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 16:09:01,055 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 16:09:01,057 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 16:09:09,002 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 16:09:09,003 - mcp_client - INFO - Receipt analyzed successfully with claude
2025-05-25 16:09:09,005 - routes - INFO - MCP analysis successful: {'content': {'vendor_name': 'Great Blue Heron Music Festival', 'date': '2023-05-17', 'total_amount': 257.61, 'subtotal': 216.0, 'tax_amount': 0.0, 'fees': 41.61, 'receipt_number': 'TD8LVDVJ', 'document_type': 'ticket confirmation', 'description': 'Music festival ticket purchase', 'is_bill': False, 'line_items': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'Event Tickets', 'object_type': 'consumable', 'create_object': False, 'expiration_info': {'event_date': '2025-07-03'}, 'confidence': 0.95}], 'digital_assets': {'qr_codes': ['Present your QR code at check-in'], 'confirmation_codes': ['TD8LVDVJ']}, 'event_details': {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00) Eastern Time (US & Canada)'}}, 'vendor_details': {'business_address': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'business_website': 'eventeny.com'}, 'overall_confidence': 0.95, 'image_quality': 'high', 'extraction_notes': 'Clear ticket confirmation email with complete event details and pricing information'}, 'provider': 'claude', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 7.928752422332764, 'timestamp': '2025-05-25T16:09:09.001335', 'tokens_used': 4002, 'cost_estimate': 0.018522}
2025-05-25 16:09:09,013 - routes - INFO - Receipt queued for review: Task ID 23
2025-05-25 16:09:09,019 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 16:09:09,020 - routes - INFO - DEBUG: Processing task 23, type=receipt_processing, status=pending_review
2025-05-25 16:09:09,021 - routes - INFO - DEBUG: Task 23 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 16:09:09,022 - routes - INFO - DEBUG: Task 23 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 16:09:09,023 - routes - INFO - DEBUG: Task 23 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 16:09:09,023 - routes - INFO - DEBUG: Task 23 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 16:09:09,024 - routes - INFO - DEBUG: Task 23 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 16:09:09,025 - routes - INFO - Task 23 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 16:09:09,026 - routes - INFO - DEBUG: Task 23 has AI analysis
2025-05-25 16:09:09,026 - routes - INFO - DEBUG: Added task 23 to receipt_tasks, now has 1 items
2025-05-25 16:09:09,027 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 16:09:09,028 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 16:09:09,046 - app - INFO - Creating database tables...
2025-05-25 16:09:09,069 - app - INFO - Database tables created successfully
2025-05-25 16:09:09,977 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:09:30,383 - routes - INFO - Processing receipt 23 with selections: invoice=True, objects=['0'], people=[], events=True, org=False
2025-05-25 16:09:30,387 - routes - ERROR - Error in process_receipt_task_enhanced: name 'create_object_from_line_item' is not defined
2025-05-25 16:09:30,396 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 16:09:30,397 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 16:09:30,398 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 16:10:00,912 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 16:10:00,913 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 16:10:00,914 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 16:10:21,997 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 16:10:21,997 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 16:10:21,999 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpjjr8oypw.pdf
2025-05-25 16:10:21,999 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 16:10:22,405 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 16:10:22,406 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 16:10:22,486 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 16:10:22,487 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 16:10:22,830 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 16:10:22,832 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 16:10:22,833 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 16:10:22,860 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 16:10:22,861 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 16:10:32,570 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 16:10:32,572 - mcp_client - INFO - Receipt analyzed successfully with claude
2025-05-25 16:10:32,573 - routes - INFO - MCP analysis successful: {'content': {'vendor_name': 'Great Blue Heron Music Festival', 'date': '2023-05-17', 'total_amount': 257.61, 'subtotal': 216.0, 'tax_amount': 0.0, 'fees': 41.61, 'receipt_number': 'TD8LVDVJ', 'document_type': 'ticket confirmation', 'description': 'Weekend Pass Thursday Entry ticket purchase', 'is_bill': False, 'line_items': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'Event Tickets', 'object_type': 'consumable', 'create_object': False, 'confidence': 0.98, 'expiration_info': {'event_date': '2025-07-03'}}], 'digital_assets': {'qr_codes': ['Present your QR code at check-in'], 'confirmation_codes': ['TD8LVDVJ']}, 'event_details': {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00) Eastern Time (US & Canada)'}}, 'vendor_details': {'business_address': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'business_website': 'eventeny.com'}, 'overall_confidence': 0.95, 'image_quality': 'high', 'extraction_notes': 'Clear ticket confirmation email with complete event details and pricing information'}, 'provider': 'claude', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 9.694649457931519, 'timestamp': '2025-05-25T16:10:32.568814', 'tokens_used': 4005, 'cost_estimate': 0.018567}
2025-05-25 16:10:32,594 - routes - INFO - Receipt queued for review: Task ID 24
2025-05-25 16:10:32,603 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 16:10:32,603 - routes - INFO - DEBUG: Processing task 24, type=receipt_processing, status=pending_review
2025-05-25 16:10:32,604 - routes - INFO - DEBUG: Task 24 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 16:10:32,605 - routes - INFO - DEBUG: Task 24 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 16:10:32,606 - routes - INFO - DEBUG: Task 24 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 16:10:32,607 - routes - INFO - DEBUG: Task 24 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 16:10:32,608 - routes - INFO - DEBUG: Task 24 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 16:10:32,608 - routes - INFO - Task 24 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 16:10:32,609 - routes - INFO - DEBUG: Task 24 has AI analysis
2025-05-25 16:10:32,610 - routes - INFO - DEBUG: Added task 24 to receipt_tasks, now has 1 items
2025-05-25 16:10:32,611 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 16:10:32,611 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 16:10:55,702 - routes - INFO - Processing receipt 24 with selections: invoice=True, objects=['0'], people=[], events=True, org=True
2025-05-25 16:10:55,708 - routes - ERROR - Error in process_receipt_task_enhanced: name 'create_object_from_line_item' is not defined
2025-05-25 16:10:55,724 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 16:10:55,725 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 16:10:55,726 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 16:11:26,151 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 16:11:26,152 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 16:11:26,152 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 16:11:54,275 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 16:11:54,276 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 16:11:54,276 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 16:12:24,756 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 16:12:24,757 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 16:12:24,758 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 16:12:55,425 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 16:12:55,426 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 16:12:55,427 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 16:13:25,893 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 16:13:25,894 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 16:13:25,896 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 16:13:56,400 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 16:13:56,401 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 16:13:56,402 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 16:15:46,587 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 16:15:46,590 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 16:15:46,591 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 16:16:00,592 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 16:16:00,594 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 16:16:00,596 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmphl67svrb.pdf
2025-05-25 16:16:00,597 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 16:16:01,040 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 16:16:01,041 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 16:16:01,121 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 16:16:01,122 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 16:16:01,466 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 16:16:01,469 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 16:16:01,469 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 16:16:01,487 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 16:16:01,489 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 16:16:09,477 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 16:16:09,479 - mcp_client - INFO - Receipt analyzed successfully with claude
2025-05-25 16:16:09,480 - routes - INFO - MCP analysis successful: {'content': {'vendor_name': 'Great Blue Heron Music Festival', 'date': '2023-05-17', 'total_amount': 257.61, 'subtotal': 216.0, 'tax_amount': 0.0, 'fees': 41.61, 'receipt_number': 'TD8LVDVJ', 'document_type': 'ticket confirmation', 'description': 'Music festival ticket purchase', 'is_bill': False, 'line_items': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'Event Tickets', 'object_type': 'consumable', 'create_object': False, 'expiration_info': {'event_date': '2025-07-03'}, 'confidence': 0.95}], 'digital_assets': {'qr_codes': ['Present your QR code at check-in'], 'confirmation_codes': ['TD8LVDVJ']}, 'event_details': {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00) Eastern Time (US & Canada)'}}, 'vendor_details': {'business_address': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'business_website': 'eventeny.com'}, 'overall_confidence': 0.95, 'image_quality': 'high', 'extraction_notes': 'Clear ticket confirmation email with complete event details and pricing information'}, 'provider': 'claude', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 7.97452187538147, 'timestamp': '2025-05-25T16:16:09.477089', 'tokens_used': 4002, 'cost_estimate': 0.018522}
2025-05-25 16:16:09,495 - routes - INFO - Receipt queued for review: Task ID 25
2025-05-25 16:16:09,502 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 16:16:09,503 - routes - INFO - DEBUG: Processing task 25, type=receipt_processing, status=pending_review
2025-05-25 16:16:09,503 - routes - INFO - DEBUG: Task 25 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 16:16:09,504 - routes - INFO - DEBUG: Task 25 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 16:16:09,505 - routes - INFO - DEBUG: Task 25 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 16:16:09,506 - routes - INFO - DEBUG: Task 25 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 16:16:09,506 - routes - INFO - DEBUG: Task 25 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 16:16:09,507 - routes - INFO - Task 25 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 16:16:09,508 - routes - INFO - DEBUG: Task 25 has AI analysis
2025-05-25 16:16:09,509 - routes - INFO - DEBUG: Added task 25 to receipt_tasks, now has 1 items
2025-05-25 16:16:09,510 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 16:16:09,510 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 16:16:40,058 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 16:16:40,059 - routes - INFO - DEBUG: Processing task 25, type=receipt_processing, status=pending_review
2025-05-25 16:16:40,060 - routes - INFO - DEBUG: Task 25 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 16:16:40,061 - routes - INFO - DEBUG: Task 25 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 16:16:40,061 - routes - INFO - DEBUG: Task 25 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 16:16:40,062 - routes - INFO - DEBUG: Task 25 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 16:16:40,063 - routes - INFO - DEBUG: Task 25 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 16:16:40,064 - routes - INFO - Task 25 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00) Eastern Time (US & Canada)'}}
2025-05-25 16:16:40,065 - routes - INFO - DEBUG: Task 25 has AI analysis
2025-05-25 16:16:40,065 - routes - INFO - DEBUG: Added task 25 to receipt_tasks, now has 1 items
2025-05-25 16:16:40,066 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 16:16:40,067 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 16:17:08,398 - routes - INFO - Processing receipt 25 with selections: invoice=True, objects=['0'], people=[], events=True, org=True
2025-05-25 16:17:08,402 - routes - ERROR - Error in process_receipt_task_enhanced: name 'create_object_from_line_item' is not defined
2025-05-25 16:17:08,417 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 16:17:08,417 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 16:17:08,418 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 16:17:41,828 - app - INFO - Creating database tables...
2025-05-25 16:17:41,829 - app - INFO - Creating database tables...
2025-05-25 16:17:41,856 - app - INFO - Creating database tables...
2025-05-25 16:17:41,867 - app - INFO - Database tables created successfully
2025-05-25 16:17:41,868 - app - INFO - Database tables created successfully
2025-05-25 16:17:41,875 - app - INFO - Database tables created successfully
2025-05-25 16:17:41,936 - app - INFO - Creating database tables...
2025-05-25 16:17:41,954 - app - INFO - Database tables created successfully
2025-05-25 16:17:42,812 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:17:42,813 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:17:42,820 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:17:42,821 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:17:49,230 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 16:17:49,231 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 16:17:49,233 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpb01f9q4g.pdf
2025-05-25 16:17:49,234 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 16:17:49,663 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 16:17:49,664 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 16:17:49,743 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 16:17:49,744 - ocr_utils - INFO - Resizing image from 2550x9900 to 2060x8000 for Claude compatibility
2025-05-25 16:17:50,074 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 16:17:50,076 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 16:17:50,077 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-25 16:17:50,103 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 16:17:50,105 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 16:17:57,807 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 16:17:57,808 - mcp_client - INFO - Receipt analyzed successfully with claude
2025-05-25 16:17:57,809 - routes - INFO - MCP analysis successful: {'content': {'vendor_name': 'Great Blue Heron Music Festival', 'date': '2023-05-17', 'total_amount': 257.61, 'subtotal': 216.0, 'tax_amount': 0.0, 'fees': 41.61, 'receipt_number': 'TD8LVDVJ', 'document_type': 'ticket confirmation', 'description': 'Music festival ticket purchase', 'is_bill': False, 'line_items': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 216.0, 'total_price': 216.0, 'category': 'Event Tickets', 'object_type': 'consumable', 'create_object': False, 'expiration_info': {'event_date': '2025-07-03'}, 'confidence': 0.95}], 'digital_assets': {'qr_codes': ['Present your QR code at check-in'], 'confirmation_codes': ['TD8LVDVJ']}, 'event_details': {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00)'}}, 'vendor_details': {'business_address': '2361 Waits Corners Rd, Sherman, NY 14781, United States'}, 'overall_confidence': 0.95, 'image_quality': 'high', 'extraction_notes': 'Clear ticket confirmation email with complete event details and pricing information'}, 'provider': 'claude', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 7.682237863540649, 'timestamp': '2025-05-25T16:17:57.805962', 'tokens_used': 3982, 'cost_estimate': 0.018222000000000002}
2025-05-25 16:17:57,836 - routes - INFO - Receipt queued for review: Task ID 26
2025-05-25 16:17:57,846 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 16:17:57,846 - routes - INFO - DEBUG: Processing task 26, type=receipt_processing, status=pending_review
2025-05-25 16:17:57,847 - routes - INFO - DEBUG: Task 26 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 16:17:57,848 - routes - INFO - DEBUG: Task 26 - content type: <class 'dict'>, keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 16:17:57,849 - routes - INFO - DEBUG: Task 26 - using CURRENT format (valid JSON response), vendor_name found in content
2025-05-25 16:17:57,849 - routes - INFO - DEBUG: Task 26 - parsed receipt_data keys: ['date', 'fees', 'is_bill', 'subtotal', 'line_items', 'tax_amount', 'description', 'vendor_name', 'total_amount', 'document_type', 'event_details', 'image_quality', 'digital_assets', 'receipt_number', 'vendor_details', 'extraction_notes', 'overall_confidence']
2025-05-25 16:17:57,850 - routes - INFO - DEBUG: Task 26 SUCCESSFULLY extracted receipt data: vendor=Great Blue Heron Music Festival, total=$257.61
2025-05-25 16:17:57,851 - routes - INFO - Task 26 has event details: {'event_date': '2025-07-03', 'event_name': 'Great Blue Heron Music Festival 2025', 'event_time': '1:00 PM EDT', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'additional_details': {'duration': 'July 03, 2025 1:00 PM - July 06, 2025 10:00 PM (EDT-04:00)'}}
2025-05-25 16:17:57,852 - routes - INFO - DEBUG: Task 26 has AI analysis
2025-05-25 16:17:57,853 - routes - INFO - DEBUG: Added task 26 to receipt_tasks, now has 1 items
2025-05-25 16:17:57,853 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 16:17:57,854 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 16:18:15,811 - routes - INFO - Processing receipt 26 with selections: invoice=True, objects=['0'], people=[], events=True, org=True
2025-05-25 16:18:15,826 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from line item 0
2025-05-25 16:18:15,827 - routes - INFO - Created and tracked consumable object: Weekend Pass Thursday Entry for line item 0
2025-05-25 16:18:15,838 - routes - INFO - Created calendar event 'Great Blue Heron Music Festival 2025' from receipt INV-20250525-E05238BC
2025-05-25 16:18:15,839 - routes - INFO - Created and tracked event: Great Blue Heron Music Festival 2025
2025-05-25 16:18:15,849 - routes - INFO - Created/promoted and tracked organization: Great Blue Heron Music Festival
2025-05-25 16:18:15,850 - routes - INFO - Successfully processed receipt task with enhanced tracking: Invoice INV-20250525-E05238BC
2025-05-25 16:18:15,860 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 16:18:15,861 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 16:18:15,862 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 16:21:24,818 - routes - INFO - Deleted consumable object: Weekend Pass Thursday Entry (ID: 14)
2025-05-25 16:21:28,935 - routes - INFO - Deleting receipt INV-20250525-E05238BC: 1 line items, 0 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-25 16:21:28,949 - routes - ERROR - Error deleting receipt: (psycopg2.errors.NotNullViolation) null value in column "invoice_id" of relation "receipt_creation_tracking" violates not-null constraint
DETAIL:  Failing row contains (2, null, 0, object, 14, 2025-05-25 16:18:15.828946, 26, {"object_type": "consumable", "line_item_data": {"category": "Ev...).

[SQL: UPDATE receipt_creation_tracking SET invoice_id=%(invoice_id)s WHERE receipt_creation_tracking.id = %(receipt_creation_tracking_id)s]
[parameters: [{'invoice_id': None, 'receipt_creation_tracking_id': 2}, {'invoice_id': None, 'receipt_creation_tracking_id': 3}, {'invoice_id': None, 'receipt_creation_tracking_id': 4}]]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1938, in _exec_single_context
    self.dialect.do_executemany(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 794, in do_executemany
    cursor.executemany(statement, parameters)
psycopg2.errors.NotNullViolation: null value in column "invoice_id" of relation "receipt_creation_tracking" violates not-null constraint
DETAIL:  Failing row contains (2, null, 0, object, 14, 2025-05-25 16:18:15.828946, 26, {"object_type": "consumable", "line_item_data": {"category": "Ev...).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1288, in delete_receipt
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 909, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1938, in _exec_single_context
    self.dialect.do_executemany(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 794, in do_executemany
    cursor.executemany(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.NotNullViolation) null value in column "invoice_id" of relation "receipt_creation_tracking" violates not-null constraint
DETAIL:  Failing row contains (2, null, 0, object, 14, 2025-05-25 16:18:15.828946, 26, {"object_type": "consumable", "line_item_data": {"category": "Ev...).

[SQL: UPDATE receipt_creation_tracking SET invoice_id=%(invoice_id)s WHERE receipt_creation_tracking.id = %(receipt_creation_tracking_id)s]
[parameters: [{'invoice_id': None, 'receipt_creation_tracking_id': 2}, {'invoice_id': None, 'receipt_creation_tracking_id': 3}, {'invoice_id': None, 'receipt_creation_tracking_id': 4}]]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 16:21:31,421 - routes - INFO - Deleting receipt INV-20250525-E05238BC: 1 line items, 0 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-25 16:21:31,430 - routes - ERROR - Error deleting receipt: (psycopg2.errors.NotNullViolation) null value in column "invoice_id" of relation "receipt_creation_tracking" violates not-null constraint
DETAIL:  Failing row contains (2, null, 0, object, 14, 2025-05-25 16:18:15.828946, 26, {"object_type": "consumable", "line_item_data": {"category": "Ev...).

[SQL: UPDATE receipt_creation_tracking SET invoice_id=%(invoice_id)s WHERE receipt_creation_tracking.id = %(receipt_creation_tracking_id)s]
[parameters: [{'invoice_id': None, 'receipt_creation_tracking_id': 2}, {'invoice_id': None, 'receipt_creation_tracking_id': 3}, {'invoice_id': None, 'receipt_creation_tracking_id': 4}]]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1938, in _exec_single_context
    self.dialect.do_executemany(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 794, in do_executemany
    cursor.executemany(statement, parameters)
psycopg2.errors.NotNullViolation: null value in column "invoice_id" of relation "receipt_creation_tracking" violates not-null constraint
DETAIL:  Failing row contains (2, null, 0, object, 14, 2025-05-25 16:18:15.828946, 26, {"object_type": "consumable", "line_item_data": {"category": "Ev...).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1288, in delete_receipt
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 909, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1938, in _exec_single_context
    self.dialect.do_executemany(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 794, in do_executemany
    cursor.executemany(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.NotNullViolation) null value in column "invoice_id" of relation "receipt_creation_tracking" violates not-null constraint
DETAIL:  Failing row contains (2, null, 0, object, 14, 2025-05-25 16:18:15.828946, 26, {"object_type": "consumable", "line_item_data": {"category": "Ev...).

[SQL: UPDATE receipt_creation_tracking SET invoice_id=%(invoice_id)s WHERE receipt_creation_tracking.id = %(receipt_creation_tracking_id)s]
[parameters: [{'invoice_id': None, 'receipt_creation_tracking_id': 2}, {'invoice_id': None, 'receipt_creation_tracking_id': 3}, {'invoice_id': None, 'receipt_creation_tracking_id': 4}]]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 16:22:50,262 - app - INFO - Creating database tables...
2025-05-25 16:22:50,264 - app - INFO - Creating database tables...
2025-05-25 16:22:50,265 - app - INFO - Creating database tables...
2025-05-25 16:22:50,268 - app - INFO - Creating database tables...
2025-05-25 16:22:50,298 - app - INFO - Database tables created successfully
2025-05-25 16:22:50,298 - app - INFO - Database tables created successfully
2025-05-25 16:22:50,298 - app - INFO - Database tables created successfully
2025-05-25 16:22:50,299 - app - INFO - Database tables created successfully
2025-05-25 16:22:51,237 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:22:51,237 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:22:51,244 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:22:51,247 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:23:25,745 - routes - INFO - Deleting receipt INV-20250525-E05238BC: 1 line items, 0 objects, 0 attachments, 3 creation tracking records. Delete objects: False. Reason: 
2025-05-25 16:23:25,751 - routes - ERROR - Error deleting receipt: (psycopg2.errors.NotNullViolation) null value in column "invoice_id" of relation "receipt_creation_tracking" violates not-null constraint
DETAIL:  Failing row contains (2, null, 0, object, 14, 2025-05-25 16:18:15.828946, 26, {"object_type": "consumable", "line_item_data": {"category": "Ev...).

[SQL: UPDATE receipt_creation_tracking SET invoice_id=%(invoice_id)s WHERE receipt_creation_tracking.id = %(receipt_creation_tracking_id)s]
[parameters: [{'invoice_id': None, 'receipt_creation_tracking_id': 2}, {'invoice_id': None, 'receipt_creation_tracking_id': 3}, {'invoice_id': None, 'receipt_creation_tracking_id': 4}]]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1938, in _exec_single_context
    self.dialect.do_executemany(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 794, in do_executemany
    cursor.executemany(statement, parameters)
psycopg2.errors.NotNullViolation: null value in column "invoice_id" of relation "receipt_creation_tracking" violates not-null constraint
DETAIL:  Failing row contains (2, null, 0, object, 14, 2025-05-25 16:18:15.828946, 26, {"object_type": "consumable", "line_item_data": {"category": "Ev...).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1289, in delete_receipt
    logger.info(f"Deleted creation tracking record: {tracking.creation_type} ID {tracking.creation_id}")
    ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 909, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1938, in _exec_single_context
    self.dialect.do_executemany(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 794, in do_executemany
    cursor.executemany(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.NotNullViolation) null value in column "invoice_id" of relation "receipt_creation_tracking" violates not-null constraint
DETAIL:  Failing row contains (2, null, 0, object, 14, 2025-05-25 16:18:15.828946, 26, {"object_type": "consumable", "line_item_data": {"category": "Ev...).

[SQL: UPDATE receipt_creation_tracking SET invoice_id=%(invoice_id)s WHERE receipt_creation_tracking.id = %(receipt_creation_tracking_id)s]
[parameters: [{'invoice_id': None, 'receipt_creation_tracking_id': 2}, {'invoice_id': None, 'receipt_creation_tracking_id': 3}, {'invoice_id': None, 'receipt_creation_tracking_id': 4}]]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 16:23:47,989 - app - INFO - Creating database tables...
2025-05-25 16:23:47,995 - app - INFO - Creating database tables...
2025-05-25 16:23:48,007 - app - INFO - Database tables created successfully
2025-05-25 16:23:48,013 - app - INFO - Database tables created successfully
2025-05-25 16:23:48,084 - app - INFO - Creating database tables...
2025-05-25 16:23:48,100 - app - INFO - Database tables created successfully
2025-05-25 16:23:48,170 - app - INFO - Creating database tables...
2025-05-25 16:23:48,187 - app - INFO - Database tables created successfully
2025-05-25 16:23:48,599 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:23:48,604 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:23:48,680 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:23:48,774 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:24:06,266 - routes - INFO - Deleting receipt INV-20250525-E05238BC: 1 line items, 0 objects, 0 attachments, 3 creation tracking records. Delete objects: False. Reason: 
2025-05-25 16:24:06,267 - routes - INFO - Deleted creation tracking record for unlinked object ID 14
2025-05-25 16:24:06,268 - routes - INFO - Deleted creation tracking record for unlinked calendar_event ID 6
2025-05-25 16:24:06,269 - routes - INFO - Deleted creation tracking record for unlinked organization ID 1
2025-05-25 16:24:15,253 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-25 16:24:15,256 - openai_utils - INFO - OpenAI API connection test successful
2025-05-25 16:33:22,173 - app - INFO - Creating database tables...
2025-05-25 16:33:22,176 - app - INFO - Creating database tables...
2025-05-25 16:33:22,176 - app - INFO - Creating database tables...
2025-05-25 16:33:22,177 - app - INFO - Creating database tables...
2025-05-25 16:33:22,211 - app - INFO - Database tables created successfully
2025-05-25 16:33:22,211 - app - INFO - Database tables created successfully
2025-05-25 16:33:22,211 - app - INFO - Database tables created successfully
2025-05-25 16:33:22,211 - app - INFO - Database tables created successfully
2025-05-25 16:33:22,914 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:33:22,914 - routes - ERROR - Error initializing AI settings: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ai_settings_provider_key"
DETAIL:  Key (provider)=(openai) already exists.

[SQL: INSERT INTO ai_settings (provider, is_enabled, is_default, api_key, api_endpoint, config, created_at, updated_at) VALUES (%(provider)s, %(is_enabled)s, %(is_default)s, %(api_key)s, %(api_endpoint)s, %(config)s, %(created_at)s, %(updated_at)s) RETURNING ai_settings.id]
[parameters: {'provider': 'openai', 'is_enabled': True, 'is_default': True, 'api_key': None, 'api_endpoint': None, 'config': '{"default_model": "gpt-4o", "vision_model": "gpt-4o", "timeout": 180, "max_tokens": 4096, "temperature": 0.1}', 'created_at': datetime.datetime(2025, 5, 25, 16, 33, 22, 910306), 'updated_at': datetime.datetime(2025, 5, 25, 16, 33, 22, 910308)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 16:33:22,914 - routes - ERROR - Error initializing AI settings: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ai_settings_provider_key"
DETAIL:  Key (provider)=(openai) already exists.

[SQL: INSERT INTO ai_settings (provider, is_enabled, is_default, api_key, api_endpoint, config, created_at, updated_at) VALUES (%(provider)s, %(is_enabled)s, %(is_default)s, %(api_key)s, %(api_endpoint)s, %(config)s, %(created_at)s, %(updated_at)s) RETURNING ai_settings.id]
[parameters: {'provider': 'openai', 'is_enabled': True, 'is_default': True, 'api_key': None, 'api_endpoint': None, 'config': '{"default_model": "gpt-4o", "vision_model": "gpt-4o", "timeout": 180, "max_tokens": 4096, "temperature": 0.1}', 'created_at': datetime.datetime(2025, 5, 25, 16, 33, 22, 911242), 'updated_at': datetime.datetime(2025, 5, 25, 16, 33, 22, 911244)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 16:33:22,914 - routes - ERROR - Error initializing AI settings: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ai_settings_provider_key"
DETAIL:  Key (provider)=(openai) already exists.

[SQL: INSERT INTO ai_settings (provider, is_enabled, is_default, api_key, api_endpoint, config, created_at, updated_at) VALUES (%(provider)s, %(is_enabled)s, %(is_default)s, %(api_key)s, %(api_endpoint)s, %(config)s, %(created_at)s, %(updated_at)s) RETURNING ai_settings.id]
[parameters: {'provider': 'openai', 'is_enabled': True, 'is_default': True, 'api_key': None, 'api_endpoint': None, 'config': '{"default_model": "gpt-4o", "vision_model": "gpt-4o", "timeout": 180, "max_tokens": 4096, "temperature": 0.1}', 'created_at': datetime.datetime(2025, 5, 25, 16, 33, 22, 906150), 'updated_at': datetime.datetime(2025, 5, 25, 16, 33, 22, 906153)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 16:33:31,806 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-25 16:33:31,809 - openai_utils - INFO - OpenAI API connection test successful
2025-05-25 16:40:32,104 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-25 16:40:32,109 - openai_utils - INFO - OpenAI API connection test successful
2025-05-25 16:41:58,843 - app - INFO - Creating database tables...
2025-05-25 16:41:58,843 - app - INFO - Creating database tables...
2025-05-25 16:41:58,844 - app - INFO - Creating database tables...
2025-05-25 16:41:58,872 - app - INFO - Creating database tables...
2025-05-25 16:41:58,880 - app - INFO - Database tables created successfully
2025-05-25 16:41:58,880 - app - INFO - Database tables created successfully
2025-05-25 16:41:58,880 - app - INFO - Database tables created successfully
2025-05-25 16:41:58,889 - app - INFO - Database tables created successfully
2025-05-25 16:42:05,678 - app - INFO - Creating database tables...
2025-05-25 16:42:05,697 - app - INFO - Database tables created successfully
2025-05-25 16:42:05,756 - app - INFO - Creating database tables...
2025-05-25 16:42:05,775 - app - INFO - Database tables created successfully
2025-05-25 16:42:05,834 - app - INFO - Creating database tables...
2025-05-25 16:42:05,851 - app - INFO - Database tables created successfully
2025-05-25 16:42:05,888 - app - INFO - Creating database tables...
2025-05-25 16:42:05,906 - app - INFO - Database tables created successfully
2025-05-25 16:42:09,756 - app - INFO - Creating database tables...
2025-05-25 16:42:09,757 - app - INFO - Creating database tables...
2025-05-25 16:42:09,774 - app - INFO - Database tables created successfully
2025-05-25 16:42:09,774 - app - INFO - Database tables created successfully
2025-05-25 16:42:09,802 - app - INFO - Creating database tables...
2025-05-25 16:42:09,820 - app - INFO - Database tables created successfully
2025-05-25 16:42:09,832 - app - INFO - Creating database tables...
2025-05-25 16:42:09,849 - app - INFO - Database tables created successfully
2025-05-25 16:42:16,489 - app - INFO - Creating database tables...
2025-05-25 16:42:16,507 - app - INFO - Database tables created successfully
2025-05-25 16:42:16,533 - app - INFO - Creating database tables...
2025-05-25 16:42:16,551 - app - INFO - Database tables created successfully
2025-05-25 16:42:16,578 - app - INFO - Creating database tables...
2025-05-25 16:42:16,596 - app - INFO - Database tables created successfully
2025-05-25 16:42:16,613 - app - INFO - Creating database tables...
2025-05-25 16:42:16,632 - app - INFO - Database tables created successfully
2025-05-25 16:43:44,174 - app - INFO - Creating database tables...
2025-05-25 16:43:44,176 - app - INFO - Creating database tables...
2025-05-25 16:43:44,178 - app - INFO - Creating database tables...
2025-05-25 16:43:44,181 - app - INFO - Creating database tables...
2025-05-25 16:43:44,223 - app - INFO - Database tables created successfully
2025-05-25 16:43:44,223 - app - INFO - Database tables created successfully
2025-05-25 16:43:44,223 - app - INFO - Database tables created successfully
2025-05-25 16:43:44,223 - app - INFO - Database tables created successfully
2025-05-25 16:43:44,931 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:43:44,931 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:43:44,931 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:43:44,932 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:43:49,722 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-25 16:43:49,728 - openai_utils - INFO - OpenAI API connection test successful
2025-05-25 16:43:55,048 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 16:43:55,048 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 16:43:55,050 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpyoe7_llr.pdf
2025-05-25 16:43:55,050 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 16:43:55,498 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 16:43:55,499 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 16:43:55,578 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 16:43:55,579 - ocr_utils - INFO - Using original image size: 2550x9900 pixels for OpenAI processing
2025-05-25 16:43:55,618 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 16:43:55,619 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 16:43:55,620 - routes - INFO - Sending receipt to MCP server for analysis with OpenAI
2025-05-25 16:43:55,650 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 16:43:55,652 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 16:44:10,864 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 16:44:10,865 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-25 16:44:10,866 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for festival entry",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": ["TDSLVDVJ"],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 PM",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": null,\n    "business_phone": null,\n    "business_email": "express@eventeny.com",\n    "business_website": null,\n    "business_hours": null,\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "Extracted data from email receipt for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 15.190095901489258, 'timestamp': '2025-05-25T16:44:10.862444', 'tokens_used': 4240, 'cost_estimate': 0.02719}
2025-05-25 16:44:10,885 - routes - ERROR - MCP server analysis failed: name 'selected_provider' is not defined
2025-05-25 16:44:10,886 - routes - ERROR - Error processing receipt: name 'selected_provider' is not defined
Traceback (most recent call last):
  File "/app/routes.py", line 220, in receipt_upload
    'ai_provider': 'openai',
                   ^^^^^^^^^^
NameError: name 'selected_provider' is not defined

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/app/routes.py", line 263, in receipt_upload
    'ai_provider': 'openai',
                   ^^^^^^^^^^
NameError: name 'selected_provider' is not defined
2025-05-25 16:44:11,514 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-25 16:44:11,522 - openai_utils - INFO - OpenAI API connection test successful
2025-05-25 16:46:11,367 - app - INFO - Creating database tables...
2025-05-25 16:46:11,368 - app - INFO - Creating database tables...
2025-05-25 16:46:11,369 - app - INFO - Creating database tables...
2025-05-25 16:46:11,371 - app - INFO - Creating database tables...
2025-05-25 16:46:11,521 - app - INFO - Database tables created successfully
2025-05-25 16:46:11,522 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(vendors_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 16:46:11,522 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(vendors_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 16:46:11,522 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(vendors_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 16:46:12,233 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:46:12,234 - routes - ERROR - Error initializing AI settings: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ai_settings_provider_key"
DETAIL:  Key (provider)=(openai) already exists.

[SQL: INSERT INTO ai_settings (provider, is_enabled, is_default, api_key, api_endpoint, config, created_at, updated_at) VALUES (%(provider)s, %(is_enabled)s, %(is_default)s, %(api_key)s, %(api_endpoint)s, %(config)s, %(created_at)s, %(updated_at)s) RETURNING ai_settings.id]
[parameters: {'provider': 'openai', 'is_enabled': True, 'is_default': True, 'api_key': None, 'api_endpoint': None, 'config': '{"default_model": "gpt-4o", "vision_model": "gpt-4o", "timeout": 180, "max_tokens": 4096, "temperature": 0.1}', 'created_at': datetime.datetime(2025, 5, 25, 16, 46, 12, 231757), 'updated_at': datetime.datetime(2025, 5, 25, 16, 46, 12, 231759)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 16:46:12,235 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:46:12,236 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:46:14,475 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-25 16:46:14,478 - openai_utils - INFO - OpenAI API connection test successful
2025-05-25 16:46:18,194 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 16:46:18,195 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 16:46:18,196 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpb5nodvw0.pdf
2025-05-25 16:46:18,197 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 16:46:18,647 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 16:46:18,648 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 16:46:18,722 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 16:46:18,723 - ocr_utils - INFO - Using original image size: 2550x9900 pixels for OpenAI processing
2025-05-25 16:46:18,761 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 16:46:18,763 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 16:46:18,763 - routes - INFO - Sending receipt to MCP server for analysis with OpenAI
2025-05-25 16:46:18,792 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 16:46:18,794 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 16:46:36,046 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 16:46:36,048 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-25 16:46:36,049 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for festival entry",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.95\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://www.eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "business_phone": null,\n    "business_email": "express@eventeny.com",\n    "business_website": "https://www.eventeny.com",\n    "business_hours": null,\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "Extracted from email receipt for festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 17.2320556640625, 'timestamp': '2025-05-25T16:46:36.045834', 'tokens_used': 4274, 'cost_estimate': 0.0277}
2025-05-25 16:46:36,062 - routes - INFO - Receipt queued for review: Task ID 1
2025-05-25 16:46:36,071 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 16:46:36,071 - routes - INFO - DEBUG: Processing task 1, type=receipt_processing, status=pending_review
2025-05-25 16:46:36,072 - routes - INFO - DEBUG: Task 1 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 16:46:36,073 - routes - INFO - DEBUG: Task 1 - content type: <class 'dict'>, keys: ['response']
2025-05-25 16:46:36,074 - routes - INFO - DEBUG: Task 1 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 16:46:36,074 - routes - INFO - DEBUG: Task 1 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 16:46:36,075 - routes - INFO - DEBUG: Task 1 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 16:46:36,076 - routes - INFO - DEBUG: Task 1 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 16:46:36,077 - routes - INFO - Task 1 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '13:00', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 16:46:36,077 - routes - INFO - DEBUG: Task 1 has AI analysis
2025-05-25 16:46:36,078 - routes - INFO - DEBUG: Added task 1 to receipt_tasks, now has 1 items
2025-05-25 16:46:36,079 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 16:46:36,079 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 16:46:52,751 - routes - INFO - Processing receipt 1 with selections: invoice=True, objects=['0'], people=['0'], events=True, org=True
2025-05-25 16:46:52,769 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from line item 0 with category 'Uncategorized'
2025-05-25 16:46:52,771 - routes - INFO - Created and tracked consumable object: Weekend Pass Thursday Entry for line item 0
2025-05-25 16:46:52,775 - routes - INFO - Created person object 'Nate Smith' from receipt INV-20250525-96E16DDF
2025-05-25 16:46:52,776 - routes - INFO - Created and tracked person: Nate Smith
2025-05-25 16:46:52,782 - routes - INFO - Created calendar event 'Great Blue Heron Music Festival 2025' from receipt INV-20250525-96E16DDF
2025-05-25 16:46:52,783 - routes - INFO - Created and tracked event: Great Blue Heron Music Festival 2025
2025-05-25 16:46:52,790 - routes - INFO - Created/promoted and tracked organization: Eventeny
2025-05-25 16:46:52,791 - routes - INFO - Successfully processed receipt task with enhanced tracking: Invoice INV-20250525-96E16DDF
2025-05-25 16:46:52,800 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 16:46:52,801 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 16:46:52,802 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 16:52:41,837 - routes - INFO - Deleting receipt INV-20250525-96E16DDF: 1 line items, 2 objects, 0 attachments, 4 creation tracking records. Delete objects: True. Reason: 
2025-05-25 16:52:41,846 - routes - INFO - Deleted object: Weekend Pass Thursday Entry (ID: 1)
2025-05-25 16:52:41,863 - routes - INFO - Deleted object: Nate Smith (ID: 2)
2025-05-25 16:52:41,864 - routes - INFO - Deleted creation tracking record: object ID 1
2025-05-25 16:52:41,864 - routes - INFO - Deleted creation tracking record: object ID 2
2025-05-25 16:52:41,865 - routes - INFO - Deleted creation tracking record: calendar_event ID 1
2025-05-25 16:52:41,865 - routes - INFO - Deleted creation tracking record: organization ID 1
2025-05-25 16:54:44,956 - app - INFO - Creating database tables...
2025-05-25 16:54:44,957 - app - INFO - Creating database tables...
2025-05-25 16:54:44,993 - app - INFO - Database tables created successfully
2025-05-25 16:54:44,993 - app - INFO - Database tables created successfully
2025-05-25 16:54:45,018 - app - INFO - Creating database tables...
2025-05-25 16:54:45,035 - app - INFO - Database tables created successfully
2025-05-25 16:54:45,120 - app - INFO - Creating database tables...
2025-05-25 16:54:45,138 - app - INFO - Database tables created successfully
2025-05-25 16:54:45,652 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:54:45,656 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:54:45,658 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:54:45,659 - routes - INFO - AI Settings initialized successfully
2025-05-25 16:54:48,005 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-25 16:54:48,008 - openai_utils - INFO - OpenAI API connection test successful
2025-05-25 16:54:51,327 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 16:54:51,328 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 16:54:51,329 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpjua52z7l.pdf
2025-05-25 16:54:51,330 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 16:54:51,787 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 16:54:51,788 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 16:54:51,871 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 16:54:51,872 - ocr_utils - INFO - Using original image size: 2550x9900 pixels for OpenAI processing
2025-05-25 16:54:51,908 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 16:54:51,909 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 16:54:51,910 - routes - INFO - Sending receipt to MCP server for analysis with OpenAI
2025-05-25 16:54:51,938 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 16:54:51,940 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 16:55:11,137 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 16:55:11,139 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-25 16:55:11,141 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Tickets for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for festival entry",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": ["TDSLVDVJ"],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 PM",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": null,\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": null,\n    "business_phone": null,\n    "business_email": "express@eventeny.com",\n    "business_website": null,\n    "business_hours": null,\n    "business_type": null\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "Extracted from email receipt for event tickets."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 19.172815084457397, 'timestamp': '2025-05-25T16:55:11.133575', 'tokens_used': 4231, 'cost_estimate': 0.027054999999999996}
2025-05-25 16:55:11,183 - routes - INFO - Receipt queued for review: Task ID 27
2025-05-25 16:55:11,194 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 16:55:11,194 - routes - INFO - DEBUG: Processing task 27, type=receipt_processing, status=pending_review
2025-05-25 16:55:11,195 - routes - INFO - DEBUG: Task 27 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 16:55:11,196 - routes - INFO - DEBUG: Task 27 - content type: <class 'dict'>, keys: ['response']
2025-05-25 16:55:11,196 - routes - INFO - DEBUG: Task 27 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 16:55:11,197 - routes - INFO - DEBUG: Task 27 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 16:55:11,198 - routes - INFO - DEBUG: Task 27 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 16:55:11,199 - routes - INFO - DEBUG: Task 27 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 16:55:11,199 - routes - INFO - Task 27 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': None, 'additional_details': {}}
2025-05-25 16:55:11,200 - routes - INFO - DEBUG: Task 27 has AI analysis
2025-05-25 16:55:11,201 - routes - INFO - DEBUG: Added task 27 to receipt_tasks, now has 1 items
2025-05-25 16:55:11,202 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 16:55:11,203 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 16:55:41,682 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 16:55:41,683 - routes - INFO - DEBUG: Processing task 27, type=receipt_processing, status=pending_review
2025-05-25 16:55:41,684 - routes - INFO - DEBUG: Task 27 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 16:55:41,684 - routes - INFO - DEBUG: Task 27 - content type: <class 'dict'>, keys: ['response']
2025-05-25 16:55:41,685 - routes - INFO - DEBUG: Task 27 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 16:55:41,686 - routes - INFO - DEBUG: Task 27 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 16:55:41,687 - routes - INFO - DEBUG: Task 27 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 16:55:41,688 - routes - INFO - DEBUG: Task 27 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 16:55:41,689 - routes - INFO - Task 27 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': None, 'additional_details': {}}
2025-05-25 16:55:41,690 - routes - INFO - DEBUG: Task 27 has AI analysis
2025-05-25 16:55:41,691 - routes - INFO - DEBUG: Added task 27 to receipt_tasks, now has 1 items
2025-05-25 16:55:41,691 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 16:55:41,692 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 16:56:12,124 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 16:56:12,126 - routes - INFO - DEBUG: Processing task 27, type=receipt_processing, status=pending_review
2025-05-25 16:56:12,127 - routes - INFO - DEBUG: Task 27 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 16:56:12,128 - routes - INFO - DEBUG: Task 27 - content type: <class 'dict'>, keys: ['response']
2025-05-25 16:56:12,129 - routes - INFO - DEBUG: Task 27 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 16:56:12,129 - routes - INFO - DEBUG: Task 27 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 16:56:12,130 - routes - INFO - DEBUG: Task 27 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 16:56:12,131 - routes - INFO - DEBUG: Task 27 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 16:56:12,132 - routes - INFO - Task 27 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': None, 'additional_details': {}}
2025-05-25 16:56:12,133 - routes - INFO - DEBUG: Task 27 has AI analysis
2025-05-25 16:56:12,133 - routes - INFO - DEBUG: Added task 27 to receipt_tasks, now has 1 items
2025-05-25 16:56:12,134 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 16:56:12,135 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 16:56:27,180 - routes - INFO - Processing receipt 27 with selections: invoice=True, objects=['0'], people=['0'], events=True, org=True
2025-05-25 16:56:27,210 - routes - INFO - Linked object 15 to category 'Uncategorized' (ID: 56)
2025-05-25 16:56:27,214 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from line item 0 with category 'Uncategorized'
2025-05-25 16:56:27,215 - routes - INFO - Created and tracked consumable object: Weekend Pass Thursday Entry for line item 0
2025-05-25 16:56:27,220 - routes - INFO - Created person object 'Nate Smith' from receipt INV-20250525-F8EB537B
2025-05-25 16:56:27,221 - routes - INFO - Created and tracked person: Nate Smith
2025-05-25 16:56:27,230 - routes - INFO - Created calendar event 'Great Blue Heron Music Festival 2025' from receipt INV-20250525-F8EB537B
2025-05-25 16:56:27,231 - routes - INFO - Created and tracked event: Great Blue Heron Music Festival 2025
2025-05-25 16:56:27,240 - routes - INFO - Created/promoted and tracked organization: Eventeny
2025-05-25 16:56:27,241 - routes - INFO - Successfully processed receipt task with enhanced tracking: Invoice INV-20250525-F8EB537B
2025-05-25 16:56:27,250 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 16:56:27,251 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 16:56:27,252 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 16:56:58,060 - routes - ERROR - Error getting receipt details for 13: Object of type ReceiptCreationTracking is not JSON serializable
Traceback (most recent call last):
  File "/app/routes.py", line 1209, in get_receipt_details
    return jsonify({
           ^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type ReceiptCreationTracking is not JSON serializable
2025-05-25 16:56:58,083 - routes - ERROR - Error getting receipt details for 13: Object of type ReceiptCreationTracking is not JSON serializable
Traceback (most recent call last):
  File "/app/routes.py", line 1209, in get_receipt_details
    return jsonify({
           ^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type ReceiptCreationTracking is not JSON serializable
2025-05-25 16:57:31,141 - routes - ERROR - Error getting receipt details for 13: Object of type ReceiptCreationTracking is not JSON serializable
Traceback (most recent call last):
  File "/app/routes.py", line 1209, in get_receipt_details
    return jsonify({
           ^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type ReceiptCreationTracking is not JSON serializable
2025-05-25 16:57:34,710 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 16:57:34,711 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 16:57:34,712 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 16:57:37,293 - routes - ERROR - Error getting receipt details for 13: Object of type ReceiptCreationTracking is not JSON serializable
Traceback (most recent call last):
  File "/app/routes.py", line 1209, in get_receipt_details
    return jsonify({
           ^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type ReceiptCreationTracking is not JSON serializable
2025-05-25 16:59:44,695 - routes - ERROR - Error getting receipt details for 13: Object of type ReceiptCreationTracking is not JSON serializable
Traceback (most recent call last):
  File "/app/routes.py", line 1209, in get_receipt_details
    return jsonify({
           ^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type ReceiptCreationTracking is not JSON serializable
2025-05-25 16:59:47,086 - routes - INFO - Deleting receipt INV-20250525-F8EB537B: 1 line items, 2 objects, 0 attachments, 4 creation tracking records. Delete objects: False. Reason: 
2025-05-25 16:59:47,087 - routes - INFO - Unlinked object: Weekend Pass Thursday Entry (ID: 15) from receipt
2025-05-25 16:59:47,088 - routes - INFO - Unlinked object: Nate Smith (ID: 16) from receipt
2025-05-25 16:59:47,089 - routes - INFO - Deleted creation tracking record for unlinked object ID 15
2025-05-25 16:59:47,090 - routes - INFO - Deleted creation tracking record for unlinked object ID 16
2025-05-25 16:59:47,091 - routes - INFO - Deleted creation tracking record for unlinked calendar_event ID 7
2025-05-25 16:59:47,091 - routes - INFO - Deleted creation tracking record for unlinked organization ID 2
2025-05-25 16:59:50,542 - routes - INFO - Deleted person object: Nate Smith (ID: 16)
2025-05-25 16:59:52,430 - routes - INFO - Deleted consumable object: Weekend Pass Thursday Entry (ID: 15)
2025-05-25 16:59:55,795 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-25 16:59:55,797 - openai_utils - INFO - OpenAI API connection test successful
2025-05-25 17:00:22,733 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-25 17:00:22,734 - openai_utils - INFO - OpenAI API connection test successful
2025-05-25 17:01:17,881 - app - INFO - Creating database tables...
2025-05-25 17:01:17,882 - app - INFO - Creating database tables...
2025-05-25 17:01:17,884 - app - INFO - Creating database tables...
2025-05-25 17:01:17,888 - app - INFO - Creating database tables...
2025-05-25 17:01:18,037 - app - INFO - Database tables created successfully
2025-05-25 17:01:18,038 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(vendors_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 17:01:18,038 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(vendors_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 17:01:18,038 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(vendors_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 17:01:18,773 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:01:18,773 - routes - ERROR - Error initializing AI settings: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ai_settings_provider_key"
DETAIL:  Key (provider)=(openai) already exists.

[SQL: INSERT INTO ai_settings (provider, is_enabled, is_default, api_key, api_endpoint, config, created_at, updated_at) VALUES (%(provider)s, %(is_enabled)s, %(is_default)s, %(api_key)s, %(api_endpoint)s, %(config)s, %(created_at)s, %(updated_at)s) RETURNING ai_settings.id]
[parameters: {'provider': 'openai', 'is_enabled': True, 'is_default': True, 'api_key': None, 'api_endpoint': None, 'config': '{"default_model": "gpt-4o", "vision_model": "gpt-4o", "timeout": 180, "max_tokens": 4096, "temperature": 0.1}', 'created_at': datetime.datetime(2025, 5, 25, 17, 1, 18, 770432), 'updated_at': datetime.datetime(2025, 5, 25, 17, 1, 18, 770436)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 17:01:18,777 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:01:18,782 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:01:57,610 - app - INFO - Creating database tables...
2025-05-25 17:01:57,629 - app - INFO - Database tables created successfully
2025-05-25 17:01:57,672 - app - INFO - Creating database tables...
2025-05-25 17:01:57,690 - app - INFO - Database tables created successfully
2025-05-25 17:01:57,774 - app - INFO - Creating database tables...
2025-05-25 17:01:57,792 - app - INFO - Database tables created successfully
2025-05-25 17:01:57,811 - app - INFO - Creating database tables...
2025-05-25 17:01:57,830 - app - INFO - Database tables created successfully
2025-05-25 17:01:58,057 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:01:58,111 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:01:58,193 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:01:58,238 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:02:03,080 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-25 17:02:03,083 - openai_utils - INFO - OpenAI API connection test successful
2025-05-25 17:02:06,976 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 17:02:06,976 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 17:02:06,978 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpfeurrwl6.pdf
2025-05-25 17:02:06,979 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 17:02:07,442 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 17:02:07,443 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 17:02:07,528 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 17:02:07,529 - ocr_utils - INFO - Using original image size: 2550x9900 pixels for OpenAI processing
2025-05-25 17:02:07,567 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 17:02:07,568 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 17:02:07,569 - routes - INFO - Sending receipt to MCP server for analysis with OpenAI
2025-05-25 17:02:07,601 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 17:02:07,603 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 17:02:25,137 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 17:02:25,139 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-25 17:02:25,140 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for entry on Thursday",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://www.eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 PM",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": null,\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": null,\n    "business_phone": null,\n    "business_email": "express@eventeny.com",\n    "business_website": "https://www.eventeny.com",\n    "business_hours": null,\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.92,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "Extracted details from an email receipt for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 17.510801315307617, 'timestamp': '2025-05-25T17:02:25.136409', 'tokens_used': 4261, 'cost_estimate': 0.027504999999999998}
2025-05-25 17:02:25,160 - routes - INFO - Receipt queued for review: Task ID 1
2025-05-25 17:02:25,168 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:02:25,169 - routes - INFO - DEBUG: Processing task 1, type=receipt_processing, status=pending_review
2025-05-25 17:02:25,170 - routes - INFO - DEBUG: Task 1 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:02:25,171 - routes - INFO - DEBUG: Task 1 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:02:25,172 - routes - INFO - DEBUG: Task 1 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:02:25,173 - routes - INFO - DEBUG: Task 1 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:02:25,174 - routes - INFO - DEBUG: Task 1 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:02:25,175 - routes - INFO - DEBUG: Task 1 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:02:25,175 - routes - INFO - Task 1 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': None, 'additional_details': {}}
2025-05-25 17:02:25,176 - routes - INFO - DEBUG: Task 1 has AI analysis
2025-05-25 17:02:25,177 - routes - INFO - DEBUG: Added task 1 to receipt_tasks, now has 1 items
2025-05-25 17:02:25,178 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:02:25,179 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:02:44,172 - routes - INFO - Processing receipt 1 with selections: invoice=True, objects=['0'], people=['0'], events=True, org=True
2025-05-25 17:02:44,199 - routes - INFO - Linked object 1 to category 'Uncategorized' (ID: 1)
2025-05-25 17:02:44,203 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from line item 0 with category 'Uncategorized'
2025-05-25 17:02:44,205 - routes - INFO - Created and tracked consumable object: Weekend Pass Thursday Entry for line item 0
2025-05-25 17:02:44,210 - routes - INFO - Created person object 'Nate Smith' from receipt INV-20250525-7205C6D0
2025-05-25 17:02:44,211 - routes - INFO - Created and tracked person: Nate Smith
2025-05-25 17:02:44,220 - routes - INFO - Created calendar event 'Great Blue Heron Music Festival 2025' from receipt INV-20250525-7205C6D0
2025-05-25 17:02:44,220 - routes - INFO - Created and tracked event: Great Blue Heron Music Festival 2025
2025-05-25 17:02:44,229 - routes - INFO - Created/promoted and tracked organization: Eventeny
2025-05-25 17:02:44,230 - routes - INFO - Successfully processed receipt task with enhanced tracking: Invoice INV-20250525-7205C6D0
2025-05-25 17:02:44,242 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 17:02:44,242 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 17:02:44,243 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 17:05:38,901 - routes - INFO - Deleting receipt INV-20250525-7205C6D0: 1 line items, 2 objects, 0 attachments, 4 creation tracking records. Delete objects: True. Reason: 
2025-05-25 17:05:38,916 - routes - INFO - Deleted object: Weekend Pass Thursday Entry (ID: 1)
2025-05-25 17:05:38,937 - routes - INFO - Deleted object: Nate Smith (ID: 2)
2025-05-25 17:05:38,938 - routes - INFO - Deleted creation tracking record: object ID 1
2025-05-25 17:05:38,939 - routes - INFO - Deleted creation tracking record: object ID 2
2025-05-25 17:05:38,939 - routes - INFO - Deleted creation tracking record: calendar_event ID 1
2025-05-25 17:05:38,940 - routes - INFO - Deleted creation tracking record: organization ID 1
2025-05-25 17:11:15,680 - app - INFO - Creating database tables...
2025-05-25 17:11:15,682 - app - INFO - Creating database tables...
2025-05-25 17:11:15,684 - app - INFO - Creating database tables...
2025-05-25 17:11:15,687 - app - INFO - Creating database tables...
2025-05-25 17:11:15,707 - app - INFO - Database tables created successfully
2025-05-25 17:11:15,707 - app - INFO - Database tables created successfully
2025-05-25 17:11:15,707 - app - INFO - Database tables created successfully
2025-05-25 17:11:15,707 - app - INFO - Database tables created successfully
2025-05-25 17:11:16,388 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:11:16,389 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:11:16,393 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:11:16,399 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:11:25,822 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-25 17:11:25,825 - openai_utils - INFO - OpenAI API connection test successful
2025-05-25 17:11:29,238 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 17:11:29,239 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 17:11:29,240 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmptiwpjmk_.pdf
2025-05-25 17:11:29,241 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 17:11:29,719 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 17:11:29,720 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 17:11:29,797 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 17:11:29,798 - ocr_utils - INFO - Using original image size: 2550x9900 pixels for OpenAI processing
2025-05-25 17:11:29,837 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 17:11:29,838 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 17:11:29,839 - routes - INFO - Sending receipt to MCP server for analysis with OpenAI
2025-05-25 17:11:29,870 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 17:11:29,872 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 17:11:52,665 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 17:11:52,666 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-25 17:11:52,667 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for entry on Thursday",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "Not specified",\n    "business_phone": "Not specified",\n    "business_email": "express@eventeny.com",\n    "business_website": "https://eventeny.com",\n    "business_hours": "Not specified",\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.92,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "The receipt is an email confirmation for a music festival ticket purchase. All relevant details have been extracted with high confidence."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 22.77421545982361, 'timestamp': '2025-05-25T17:11:52.664127', 'tokens_used': 4275, 'cost_estimate': 0.027714999999999997}
2025-05-25 17:11:52,688 - routes - INFO - Receipt queued for review: Task ID 2
2025-05-25 17:11:52,697 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:11:52,698 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending_review
2025-05-25 17:11:52,698 - routes - INFO - DEBUG: Task 2 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:11:52,699 - routes - INFO - DEBUG: Task 2 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:11:52,700 - routes - INFO - DEBUG: Task 2 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:11:52,701 - routes - INFO - DEBUG: Task 2 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:11:52,702 - routes - INFO - DEBUG: Task 2 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:11:52,703 - routes - INFO - DEBUG: Task 2 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:11:52,704 - routes - INFO - Task 2 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '13:00', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:11:52,705 - routes - ERROR - DEBUG: Task 2 extraction error: Incompatible collection type: dict is not list-like
2025-05-25 17:11:52,706 - routes - ERROR - DEBUG: Task 2 ai_analysis structure: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for entry on Thursday",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "Not specified",\n    "business_phone": "Not specified",\n    "business_email": "express@eventeny.com",\n    "business_website": "https://eventeny.com",\n    "business_hours": "Not specified",\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.92,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "The receipt is an email confirmation for a music festival ticket purchase. All relevant details have been extracted with high confidence."\n}\n```'}, 'provider': 'openai', 'timestamp': '2025-05-25T17:11:52.664127', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 4275, 'cost_estimate': 0.027714999999999997, 'processing_time': 22.77421545982361}
2025-05-25 17:11:52,707 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-25 17:11:52,708 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 1 items
2025-05-25 17:11:52,709 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:11:52,709 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:12:23,121 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:12:23,121 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending_review
2025-05-25 17:12:23,122 - routes - INFO - DEBUG: Task 2 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:12:23,123 - routes - INFO - DEBUG: Task 2 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:12:23,125 - routes - INFO - DEBUG: Task 2 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:12:23,126 - routes - INFO - DEBUG: Task 2 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:12:23,127 - routes - INFO - DEBUG: Task 2 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:12:23,127 - routes - INFO - DEBUG: Task 2 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:12:23,128 - routes - INFO - Task 2 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '13:00', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:12:23,129 - routes - ERROR - DEBUG: Task 2 extraction error: Incompatible collection type: dict is not list-like
2025-05-25 17:12:23,130 - routes - ERROR - DEBUG: Task 2 ai_analysis structure: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for entry on Thursday",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "Not specified",\n    "business_phone": "Not specified",\n    "business_email": "express@eventeny.com",\n    "business_website": "https://eventeny.com",\n    "business_hours": "Not specified",\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.92,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "The receipt is an email confirmation for a music festival ticket purchase. All relevant details have been extracted with high confidence."\n}\n```'}, 'provider': 'openai', 'timestamp': '2025-05-25T17:11:52.664127', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 4275, 'cost_estimate': 0.027714999999999997, 'processing_time': 22.77421545982361}
2025-05-25 17:12:23,131 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-25 17:12:23,131 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 1 items
2025-05-25 17:12:23,132 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:12:23,133 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:12:53,534 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:12:53,535 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending_review
2025-05-25 17:12:53,536 - routes - INFO - DEBUG: Task 2 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:12:53,537 - routes - INFO - DEBUG: Task 2 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:12:53,538 - routes - INFO - DEBUG: Task 2 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:12:53,538 - routes - INFO - DEBUG: Task 2 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:12:53,539 - routes - INFO - DEBUG: Task 2 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:12:53,540 - routes - INFO - DEBUG: Task 2 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:12:53,541 - routes - INFO - Task 2 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '13:00', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:12:53,542 - routes - ERROR - DEBUG: Task 2 extraction error: Incompatible collection type: dict is not list-like
2025-05-25 17:12:53,543 - routes - ERROR - DEBUG: Task 2 ai_analysis structure: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for entry on Thursday",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "Not specified",\n    "business_phone": "Not specified",\n    "business_email": "express@eventeny.com",\n    "business_website": "https://eventeny.com",\n    "business_hours": "Not specified",\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.92,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "The receipt is an email confirmation for a music festival ticket purchase. All relevant details have been extracted with high confidence."\n}\n```'}, 'provider': 'openai', 'timestamp': '2025-05-25T17:11:52.664127', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 4275, 'cost_estimate': 0.027714999999999997, 'processing_time': 22.77421545982361}
2025-05-25 17:12:53,543 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-25 17:12:53,544 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 1 items
2025-05-25 17:12:53,545 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:12:53,546 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:13:23,915 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:13:23,916 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending_review
2025-05-25 17:13:23,917 - routes - INFO - DEBUG: Task 2 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:13:23,918 - routes - INFO - DEBUG: Task 2 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:13:23,919 - routes - INFO - DEBUG: Task 2 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:13:23,920 - routes - INFO - DEBUG: Task 2 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:13:23,921 - routes - INFO - DEBUG: Task 2 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:13:23,922 - routes - INFO - DEBUG: Task 2 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:13:23,922 - routes - INFO - Task 2 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '13:00', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:13:23,923 - routes - ERROR - DEBUG: Task 2 extraction error: Incompatible collection type: dict is not list-like
2025-05-25 17:13:23,924 - routes - ERROR - DEBUG: Task 2 ai_analysis structure: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for entry on Thursday",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "Not specified",\n    "business_phone": "Not specified",\n    "business_email": "express@eventeny.com",\n    "business_website": "https://eventeny.com",\n    "business_hours": "Not specified",\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.92,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "The receipt is an email confirmation for a music festival ticket purchase. All relevant details have been extracted with high confidence."\n}\n```'}, 'provider': 'openai', 'timestamp': '2025-05-25T17:11:52.664127', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 4275, 'cost_estimate': 0.027714999999999997, 'processing_time': 22.77421545982361}
2025-05-25 17:13:23,925 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-25 17:13:23,925 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 1 items
2025-05-25 17:13:23,926 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:13:23,927 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:13:54,281 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:13:54,283 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending_review
2025-05-25 17:13:54,283 - routes - INFO - DEBUG: Task 2 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:13:54,284 - routes - INFO - DEBUG: Task 2 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:13:54,285 - routes - INFO - DEBUG: Task 2 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:13:54,286 - routes - INFO - DEBUG: Task 2 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:13:54,287 - routes - INFO - DEBUG: Task 2 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:13:54,288 - routes - INFO - DEBUG: Task 2 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:13:54,288 - routes - INFO - Task 2 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '13:00', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:13:54,289 - routes - ERROR - DEBUG: Task 2 extraction error: Incompatible collection type: dict is not list-like
2025-05-25 17:13:54,290 - routes - ERROR - DEBUG: Task 2 ai_analysis structure: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for entry on Thursday",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "Not specified",\n    "business_phone": "Not specified",\n    "business_email": "express@eventeny.com",\n    "business_website": "https://eventeny.com",\n    "business_hours": "Not specified",\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.92,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "The receipt is an email confirmation for a music festival ticket purchase. All relevant details have been extracted with high confidence."\n}\n```'}, 'provider': 'openai', 'timestamp': '2025-05-25T17:11:52.664127', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 4275, 'cost_estimate': 0.027714999999999997, 'processing_time': 22.77421545982361}
2025-05-25 17:13:54,291 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-25 17:13:54,292 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 1 items
2025-05-25 17:13:54,292 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:13:54,293 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:13:54,864 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:13:54,866 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending_review
2025-05-25 17:13:54,867 - routes - INFO - DEBUG: Task 2 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:13:54,868 - routes - INFO - DEBUG: Task 2 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:13:54,869 - routes - INFO - DEBUG: Task 2 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:13:54,870 - routes - INFO - DEBUG: Task 2 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:13:54,871 - routes - INFO - DEBUG: Task 2 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:13:54,872 - routes - INFO - DEBUG: Task 2 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:13:54,874 - routes - INFO - Task 2 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '13:00', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:13:54,875 - routes - ERROR - DEBUG: Task 2 extraction error: Incompatible collection type: dict is not list-like
2025-05-25 17:13:54,876 - routes - ERROR - DEBUG: Task 2 ai_analysis structure: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for entry on Thursday",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "Not specified",\n    "business_phone": "Not specified",\n    "business_email": "express@eventeny.com",\n    "business_website": "https://eventeny.com",\n    "business_hours": "Not specified",\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.92,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "The receipt is an email confirmation for a music festival ticket purchase. All relevant details have been extracted with high confidence."\n}\n```'}, 'provider': 'openai', 'timestamp': '2025-05-25T17:11:52.664127', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 4275, 'cost_estimate': 0.027714999999999997, 'processing_time': 22.77421545982361}
2025-05-25 17:13:54,877 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-25 17:13:54,878 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 1 items
2025-05-25 17:13:54,879 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:13:54,880 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:13:56,578 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:13:56,579 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending_review
2025-05-25 17:13:56,580 - routes - INFO - DEBUG: Task 2 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:13:56,580 - routes - INFO - DEBUG: Task 2 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:13:56,581 - routes - INFO - DEBUG: Task 2 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:13:56,582 - routes - INFO - DEBUG: Task 2 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:13:56,583 - routes - INFO - DEBUG: Task 2 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:13:56,583 - routes - INFO - DEBUG: Task 2 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:13:56,584 - routes - INFO - Task 2 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '13:00', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:13:56,585 - routes - ERROR - DEBUG: Task 2 extraction error: Incompatible collection type: dict is not list-like
2025-05-25 17:13:56,586 - routes - ERROR - DEBUG: Task 2 ai_analysis structure: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for entry on Thursday",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "Not specified",\n    "business_phone": "Not specified",\n    "business_email": "express@eventeny.com",\n    "business_website": "https://eventeny.com",\n    "business_hours": "Not specified",\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.92,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "The receipt is an email confirmation for a music festival ticket purchase. All relevant details have been extracted with high confidence."\n}\n```'}, 'provider': 'openai', 'timestamp': '2025-05-25T17:11:52.664127', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 4275, 'cost_estimate': 0.027714999999999997, 'processing_time': 22.77421545982361}
2025-05-25 17:13:56,587 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-25 17:13:56,588 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 1 items
2025-05-25 17:13:56,589 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:13:56,589 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:14:19,189 - app - INFO - Creating database tables...
2025-05-25 17:14:19,192 - app - INFO - Creating database tables...
2025-05-25 17:14:19,194 - app - INFO - Creating database tables...
2025-05-25 17:14:19,226 - app - INFO - Database tables created successfully
2025-05-25 17:14:19,226 - app - INFO - Database tables created successfully
2025-05-25 17:14:19,226 - app - INFO - Database tables created successfully
2025-05-25 17:14:19,273 - app - INFO - Creating database tables...
2025-05-25 17:14:19,291 - app - INFO - Database tables created successfully
2025-05-25 17:14:19,891 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:14:19,892 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:14:19,895 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:14:19,898 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:14:21,041 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:14:21,042 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending_review
2025-05-25 17:14:21,043 - routes - INFO - DEBUG: Task 2 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:14:21,044 - routes - INFO - DEBUG: Task 2 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:14:21,045 - routes - INFO - DEBUG: Task 2 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:14:21,046 - routes - INFO - DEBUG: Task 2 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:14:21,047 - routes - INFO - DEBUG: Task 2 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:14:21,048 - routes - INFO - DEBUG: Task 2 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:14:21,049 - routes - INFO - Task 2 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '13:00', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:14:21,050 - routes - ERROR - Task 2 creation tracking error: Incompatible collection type: dict is not list-like
2025-05-25 17:14:21,051 - routes - ERROR - DEBUG: Task 2 extraction error: Incompatible collection type: dict is not list-like
2025-05-25 17:14:21,052 - routes - ERROR - DEBUG: Task 2 ai_analysis structure: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for entry on Thursday",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "Not specified",\n    "business_phone": "Not specified",\n    "business_email": "express@eventeny.com",\n    "business_website": "https://eventeny.com",\n    "business_hours": "Not specified",\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.92,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "The receipt is an email confirmation for a music festival ticket purchase. All relevant details have been extracted with high confidence."\n}\n```'}, 'provider': 'openai', 'timestamp': '2025-05-25T17:11:52.664127', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 4275, 'cost_estimate': 0.027714999999999997, 'processing_time': 22.77421545982361}
2025-05-25 17:14:21,053 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-25 17:14:21,054 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 1 items
2025-05-25 17:14:21,055 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:14:21,055 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:14:22,339 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:14:22,339 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending_review
2025-05-25 17:14:22,340 - routes - INFO - DEBUG: Task 2 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:14:22,341 - routes - INFO - DEBUG: Task 2 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:14:22,342 - routes - INFO - DEBUG: Task 2 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:14:22,343 - routes - INFO - DEBUG: Task 2 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:14:22,344 - routes - INFO - DEBUG: Task 2 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:14:22,344 - routes - INFO - DEBUG: Task 2 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:14:22,345 - routes - INFO - Task 2 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '13:00', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:14:22,346 - routes - ERROR - Task 2 creation tracking error: Incompatible collection type: dict is not list-like
2025-05-25 17:14:22,347 - routes - ERROR - DEBUG: Task 2 extraction error: Incompatible collection type: dict is not list-like
2025-05-25 17:14:22,348 - routes - ERROR - DEBUG: Task 2 ai_analysis structure: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for entry on Thursday",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "Not specified",\n    "business_phone": "Not specified",\n    "business_email": "express@eventeny.com",\n    "business_website": "https://eventeny.com",\n    "business_hours": "Not specified",\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.92,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "The receipt is an email confirmation for a music festival ticket purchase. All relevant details have been extracted with high confidence."\n}\n```'}, 'provider': 'openai', 'timestamp': '2025-05-25T17:11:52.664127', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 4275, 'cost_estimate': 0.027714999999999997, 'processing_time': 22.77421545982361}
2025-05-25 17:14:22,348 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-25 17:14:22,349 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 1 items
2025-05-25 17:14:22,350 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:14:22,351 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:14:23,011 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:14:23,012 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending_review
2025-05-25 17:14:23,013 - routes - INFO - DEBUG: Task 2 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:14:23,014 - routes - INFO - DEBUG: Task 2 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:14:23,014 - routes - INFO - DEBUG: Task 2 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:14:23,015 - routes - INFO - DEBUG: Task 2 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:14:23,016 - routes - INFO - DEBUG: Task 2 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:14:23,017 - routes - INFO - DEBUG: Task 2 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:14:23,018 - routes - INFO - Task 2 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '13:00', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:14:23,018 - routes - ERROR - Task 2 creation tracking error: Incompatible collection type: dict is not list-like
2025-05-25 17:14:23,019 - routes - ERROR - DEBUG: Task 2 extraction error: Incompatible collection type: dict is not list-like
2025-05-25 17:14:23,020 - routes - ERROR - DEBUG: Task 2 ai_analysis structure: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for entry on Thursday",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "Not specified",\n    "business_phone": "Not specified",\n    "business_email": "express@eventeny.com",\n    "business_website": "https://eventeny.com",\n    "business_hours": "Not specified",\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.92,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "The receipt is an email confirmation for a music festival ticket purchase. All relevant details have been extracted with high confidence."\n}\n```'}, 'provider': 'openai', 'timestamp': '2025-05-25T17:11:52.664127', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 4275, 'cost_estimate': 0.027714999999999997, 'processing_time': 22.77421545982361}
2025-05-25 17:14:23,021 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-25 17:14:23,021 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 1 items
2025-05-25 17:14:23,022 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:14:23,023 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:14:27,117 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:14:27,118 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending_review
2025-05-25 17:14:27,119 - routes - INFO - DEBUG: Task 2 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:14:27,119 - routes - INFO - DEBUG: Task 2 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:14:27,120 - routes - INFO - DEBUG: Task 2 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:14:27,121 - routes - INFO - DEBUG: Task 2 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:14:27,122 - routes - INFO - DEBUG: Task 2 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:14:27,123 - routes - INFO - DEBUG: Task 2 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:14:27,124 - routes - INFO - Task 2 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '13:00', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:14:27,125 - routes - ERROR - Task 2 creation tracking error: Incompatible collection type: dict is not list-like
2025-05-25 17:14:27,126 - routes - ERROR - DEBUG: Task 2 extraction error: Incompatible collection type: dict is not list-like
2025-05-25 17:14:27,127 - routes - ERROR - DEBUG: Task 2 ai_analysis structure: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for entry on Thursday",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "Not specified",\n    "business_phone": "Not specified",\n    "business_email": "express@eventeny.com",\n    "business_website": "https://eventeny.com",\n    "business_hours": "Not specified",\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.92,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "The receipt is an email confirmation for a music festival ticket purchase. All relevant details have been extracted with high confidence."\n}\n```'}, 'provider': 'openai', 'timestamp': '2025-05-25T17:11:52.664127', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 4275, 'cost_estimate': 0.027714999999999997, 'processing_time': 22.77421545982361}
2025-05-25 17:14:27,127 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-25 17:14:27,128 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 1 items
2025-05-25 17:14:27,129 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:14:27,130 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:14:27,243 - routes - INFO - Receipt task 2 rejected: 
2025-05-25 17:14:27,249 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 17:14:27,250 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 17:14:27,250 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 17:14:29,514 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-25 17:14:29,520 - openai_utils - INFO - OpenAI API connection test successful
2025-05-25 17:14:33,194 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 17:14:33,195 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 17:14:33,196 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp9d40lgri.pdf
2025-05-25 17:14:33,197 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 17:14:33,659 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 17:14:33,660 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 17:14:33,737 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 17:14:33,738 - ocr_utils - INFO - Using original image size: 2550x9900 pixels for OpenAI processing
2025-05-25 17:14:33,775 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 17:14:33,776 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 17:14:33,777 - routes - INFO - Sending receipt to MCP server for analysis with OpenAI
2025-05-25 17:14:33,808 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 17:14:33,810 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 17:14:54,825 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 17:14:54,826 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-25 17:14:54,827 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for festival entry",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03"\n      },\n      "object_details": {},\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": ["TDSLVDVJ"],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 PM",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "",\n    "business_phone": "",\n    "business_email": "express@eventeny.com",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "Extracted from email receipt for event ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 20.995250701904297, 'timestamp': '2025-05-25T17:14:54.824463', 'tokens_used': 4188, 'cost_estimate': 0.02641}
2025-05-25 17:14:54,853 - routes - INFO - Receipt queued for review: Task ID 3
2025-05-25 17:14:54,863 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:14:54,864 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 17:14:54,865 - routes - INFO - DEBUG: Task 3 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:14:54,865 - routes - INFO - DEBUG: Task 3 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:14:54,867 - routes - INFO - DEBUG: Task 3 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:14:54,868 - routes - INFO - DEBUG: Task 3 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:14:54,869 - routes - INFO - DEBUG: Task 3 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:14:54,870 - routes - INFO - DEBUG: Task 3 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:14:54,871 - routes - INFO - Task 3 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:14:54,872 - routes - ERROR - Task 3 creation tracking error: Incompatible collection type: dict is not list-like
2025-05-25 17:14:54,873 - routes - ERROR - DEBUG: Task 3 extraction error: Incompatible collection type: dict is not list-like
2025-05-25 17:14:54,874 - routes - ERROR - DEBUG: Task 3 ai_analysis structure: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for festival entry",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03"\n      },\n      "object_details": {},\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": ["TDSLVDVJ"],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 PM",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "",\n    "business_phone": "",\n    "business_email": "express@eventeny.com",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "Extracted from email receipt for event ticket purchase."\n}\n```'}, 'provider': 'openai', 'timestamp': '2025-05-25T17:14:54.824463', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 4188, 'cost_estimate': 0.02641, 'processing_time': 20.995250701904297}
2025-05-25 17:14:54,876 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 17:14:54,877 - routes - INFO - DEBUG: Added task 3 to receipt_tasks, now has 1 items
2025-05-25 17:14:54,878 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:14:54,879 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:15:22,569 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:15:22,570 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 17:15:22,571 - routes - INFO - DEBUG: Task 3 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:15:22,572 - routes - INFO - DEBUG: Task 3 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:15:22,572 - routes - INFO - DEBUG: Task 3 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:15:22,573 - routes - INFO - DEBUG: Task 3 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:15:22,574 - routes - INFO - DEBUG: Task 3 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:15:22,575 - routes - INFO - DEBUG: Task 3 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:15:22,576 - routes - INFO - Task 3 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:15:22,577 - routes - ERROR - Task 3 creation tracking error: Incompatible collection type: dict is not list-like
2025-05-25 17:15:22,577 - routes - ERROR - DEBUG: Task 3 extraction error: Incompatible collection type: dict is not list-like
2025-05-25 17:15:22,578 - routes - ERROR - DEBUG: Task 3 ai_analysis structure: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for festival entry",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03"\n      },\n      "object_details": {},\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": ["TDSLVDVJ"],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 PM",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "",\n    "business_phone": "",\n    "business_email": "express@eventeny.com",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "Extracted from email receipt for event ticket purchase."\n}\n```'}, 'provider': 'openai', 'timestamp': '2025-05-25T17:14:54.824463', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 4188, 'cost_estimate': 0.02641, 'processing_time': 20.995250701904297}
2025-05-25 17:15:22,579 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 17:15:22,580 - routes - INFO - DEBUG: Added task 3 to receipt_tasks, now has 1 items
2025-05-25 17:15:22,581 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:15:22,582 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:15:52,955 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:15:52,956 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 17:15:52,957 - routes - INFO - DEBUG: Task 3 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:15:52,958 - routes - INFO - DEBUG: Task 3 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:15:52,959 - routes - INFO - DEBUG: Task 3 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:15:52,959 - routes - INFO - DEBUG: Task 3 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:15:52,961 - routes - INFO - DEBUG: Task 3 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:15:52,961 - routes - INFO - DEBUG: Task 3 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:15:52,962 - routes - INFO - Task 3 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:15:52,963 - routes - ERROR - Task 3 creation tracking error: Incompatible collection type: dict is not list-like
2025-05-25 17:15:52,964 - routes - ERROR - DEBUG: Task 3 extraction error: Incompatible collection type: dict is not list-like
2025-05-25 17:15:52,965 - routes - ERROR - DEBUG: Task 3 ai_analysis structure: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for festival entry",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03"\n      },\n      "object_details": {},\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": ["TDSLVDVJ"],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 PM",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "",\n    "business_phone": "",\n    "business_email": "express@eventeny.com",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "Extracted from email receipt for event ticket purchase."\n}\n```'}, 'provider': 'openai', 'timestamp': '2025-05-25T17:14:54.824463', 'confidence': None, 'prompt_type': 'unknown', 'tokens_used': 4188, 'cost_estimate': 0.02641, 'processing_time': 20.995250701904297}
2025-05-25 17:15:52,966 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 17:15:52,967 - routes - INFO - DEBUG: Added task 3 to receipt_tasks, now has 1 items
2025-05-25 17:15:52,967 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:15:52,968 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:16:27,230 - app - INFO - Creating database tables...
2025-05-25 17:16:27,230 - app - INFO - Creating database tables...
2025-05-25 17:16:27,231 - app - INFO - Creating database tables...
2025-05-25 17:16:27,237 - app - INFO - Creating database tables...
2025-05-25 17:16:27,266 - app - INFO - Database tables created successfully
2025-05-25 17:16:27,266 - app - INFO - Database tables created successfully
2025-05-25 17:16:27,266 - app - INFO - Database tables created successfully
2025-05-25 17:16:27,266 - app - INFO - Database tables created successfully
2025-05-25 17:16:27,936 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:16:27,936 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:16:27,936 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:16:27,946 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:16:30,007 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:16:30,008 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 17:16:30,009 - routes - INFO - DEBUG: Task 3 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:16:30,010 - routes - INFO - DEBUG: Task 3 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:16:30,010 - routes - INFO - DEBUG: Task 3 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:16:30,011 - routes - INFO - DEBUG: Task 3 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:16:30,012 - routes - INFO - DEBUG: Task 3 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:16:30,013 - routes - INFO - DEBUG: Task 3 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:16:30,014 - routes - INFO - Task 3 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:16:30,014 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 17:16:30,015 - routes - ERROR - Task 3 creation tracking error: Incompatible collection type: dict is not list-like
2025-05-25 17:16:30,016 - routes - ERROR - Error loading AI queue: Incompatible collection type: dict is not list-like
Traceback (most recent call last):
  File "/app/routes.py", line 1772, in ai_queue
    task.creation_tracking = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/app/routes.py", line 1783, in ai_queue
    task.creation_tracking = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like
2025-05-25 17:16:30,133 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:16:30,136 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 17:16:30,139 - routes - INFO - DEBUG: Task 3 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:16:30,141 - routes - INFO - DEBUG: Task 3 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:16:30,143 - routes - INFO - DEBUG: Task 3 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:16:30,145 - routes - INFO - DEBUG: Task 3 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:16:30,146 - routes - INFO - DEBUG: Task 3 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:16:30,147 - routes - INFO - DEBUG: Task 3 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:16:30,148 - routes - INFO - Task 3 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:16:30,149 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 17:16:30,151 - routes - ERROR - Task 3 creation tracking error: Incompatible collection type: dict is not list-like
2025-05-25 17:16:30,151 - routes - ERROR - Error loading AI queue: Incompatible collection type: dict is not list-like
Traceback (most recent call last):
  File "/app/routes.py", line 1772, in ai_queue
    task.creation_tracking = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/app/routes.py", line 1783, in ai_queue
    task.creation_tracking = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like
2025-05-25 17:16:41,590 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:16:41,591 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 17:16:41,593 - routes - INFO - DEBUG: Task 3 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:16:41,594 - routes - INFO - DEBUG: Task 3 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:16:41,595 - routes - INFO - DEBUG: Task 3 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:16:41,595 - routes - INFO - DEBUG: Task 3 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:16:41,596 - routes - INFO - DEBUG: Task 3 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:16:41,597 - routes - INFO - DEBUG: Task 3 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:16:41,598 - routes - INFO - Task 3 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:16:41,599 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 17:16:41,600 - routes - ERROR - Task 3 creation tracking error: Incompatible collection type: dict is not list-like
2025-05-25 17:16:41,601 - routes - ERROR - Error loading AI queue: Incompatible collection type: dict is not list-like
Traceback (most recent call last):
  File "/app/routes.py", line 1772, in ai_queue
    task.creation_tracking = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/app/routes.py", line 1783, in ai_queue
    task.creation_tracking = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like
2025-05-25 17:17:09,234 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:17:09,235 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 17:17:09,236 - routes - INFO - DEBUG: Task 3 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:17:09,237 - routes - INFO - DEBUG: Task 3 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:17:09,238 - routes - INFO - DEBUG: Task 3 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:17:09,239 - routes - INFO - DEBUG: Task 3 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:17:09,239 - routes - INFO - DEBUG: Task 3 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:17:09,240 - routes - INFO - DEBUG: Task 3 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:17:09,241 - routes - INFO - Task 3 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:17:09,242 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 17:17:09,243 - routes - ERROR - Task 3 creation tracking error: Incompatible collection type: dict is not list-like
2025-05-25 17:17:09,244 - routes - ERROR - Error loading AI queue: Incompatible collection type: dict is not list-like
Traceback (most recent call last):
  File "/app/routes.py", line 1772, in ai_queue
    task.creation_tracking = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/app/routes.py", line 1783, in ai_queue
    task.creation_tracking = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like
2025-05-25 17:17:39,620 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:17:39,621 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 17:17:39,622 - routes - INFO - DEBUG: Task 3 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:17:39,623 - routes - INFO - DEBUG: Task 3 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:17:39,624 - routes - INFO - DEBUG: Task 3 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:17:39,625 - routes - INFO - DEBUG: Task 3 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:17:39,626 - routes - INFO - DEBUG: Task 3 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:17:39,627 - routes - INFO - DEBUG: Task 3 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:17:39,628 - routes - INFO - Task 3 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:17:39,630 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 17:17:39,631 - routes - ERROR - Task 3 creation tracking error: Incompatible collection type: dict is not list-like
2025-05-25 17:17:39,632 - routes - ERROR - Error loading AI queue: Incompatible collection type: dict is not list-like
Traceback (most recent call last):
  File "/app/routes.py", line 1772, in ai_queue
    task.creation_tracking_info = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/app/routes.py", line 1783, in ai_queue
    task.creation_tracking = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like
2025-05-25 17:18:10,171 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:18:10,172 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 17:18:10,173 - routes - INFO - DEBUG: Task 3 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:18:10,174 - routes - INFO - DEBUG: Task 3 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:18:10,175 - routes - INFO - DEBUG: Task 3 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:18:10,176 - routes - INFO - DEBUG: Task 3 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:18:10,177 - routes - INFO - DEBUG: Task 3 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:18:10,178 - routes - INFO - DEBUG: Task 3 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:18:10,178 - routes - INFO - Task 3 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:18:10,179 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 17:18:10,181 - routes - ERROR - Task 3 creation tracking error: Incompatible collection type: dict is not list-like
2025-05-25 17:18:10,182 - routes - ERROR - Error loading AI queue: Incompatible collection type: dict is not list-like
Traceback (most recent call last):
  File "/app/routes.py", line 1772, in ai_queue
    task.creation_tracking_info = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/app/routes.py", line 1783, in ai_queue
    task.creation_tracking_info = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like
2025-05-25 17:18:40,621 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:18:40,622 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 17:18:40,623 - routes - INFO - DEBUG: Task 3 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:18:40,624 - routes - INFO - DEBUG: Task 3 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:18:40,625 - routes - INFO - DEBUG: Task 3 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:18:40,625 - routes - INFO - DEBUG: Task 3 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:18:40,626 - routes - INFO - DEBUG: Task 3 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:18:40,627 - routes - INFO - DEBUG: Task 3 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:18:40,628 - routes - INFO - Task 3 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:18:40,629 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 17:18:40,630 - routes - ERROR - Task 3 creation tracking error: Incompatible collection type: dict is not list-like
2025-05-25 17:18:40,631 - routes - ERROR - Error loading AI queue: Incompatible collection type: dict is not list-like
Traceback (most recent call last):
  File "/app/routes.py", line 1772, in ai_queue
    task.creation_tracking_info = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/app/routes.py", line 1783, in ai_queue
    task.creation_tracking_info = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like
2025-05-25 17:19:11,070 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:19:11,071 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 17:19:11,072 - routes - INFO - DEBUG: Task 3 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:19:11,073 - routes - INFO - DEBUG: Task 3 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:19:11,074 - routes - INFO - DEBUG: Task 3 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:19:11,074 - routes - INFO - DEBUG: Task 3 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:19:11,075 - routes - INFO - DEBUG: Task 3 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:19:11,076 - routes - INFO - DEBUG: Task 3 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:19:11,077 - routes - INFO - Task 3 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:19:11,078 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 17:19:11,079 - routes - ERROR - Task 3 creation tracking error: Incompatible collection type: dict is not list-like
2025-05-25 17:19:11,079 - routes - ERROR - Error loading AI queue: Incompatible collection type: dict is not list-like
Traceback (most recent call last):
  File "/app/routes.py", line 1772, in ai_queue
    task.creation_tracking_info = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/app/routes.py", line 1783, in ai_queue
    task.creation_tracking_info = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like
2025-05-25 17:19:41,495 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:19:41,496 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 17:19:41,497 - routes - INFO - DEBUG: Task 3 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:19:41,498 - routes - INFO - DEBUG: Task 3 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:19:41,498 - routes - INFO - DEBUG: Task 3 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:19:41,499 - routes - INFO - DEBUG: Task 3 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:19:41,500 - routes - INFO - DEBUG: Task 3 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:19:41,501 - routes - INFO - DEBUG: Task 3 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:19:41,502 - routes - INFO - Task 3 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:19:41,503 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 17:19:41,504 - routes - ERROR - Task 3 creation tracking error: Incompatible collection type: dict is not list-like
2025-05-25 17:19:41,504 - routes - ERROR - Error loading AI queue: Incompatible collection type: dict is not list-like
Traceback (most recent call last):
  File "/app/routes.py", line 1772, in ai_queue
    task.creation_tracking_info = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/app/routes.py", line 1783, in ai_queue
    task.creation_tracking_info = {
    ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 537, in __set__
    self.impl.set(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1945, in set
    raise TypeError(
TypeError: Incompatible collection type: dict is not list-like
2025-05-25 17:22:49,124 - app - INFO - Creating database tables...
2025-05-25 17:22:49,126 - app - INFO - Creating database tables...
2025-05-25 17:22:49,127 - app - INFO - Creating database tables...
2025-05-25 17:22:49,128 - app - INFO - Creating database tables...
2025-05-25 17:22:49,172 - app - INFO - Database tables created successfully
2025-05-25 17:22:49,172 - app - INFO - Database tables created successfully
2025-05-25 17:22:49,172 - app - INFO - Database tables created successfully
2025-05-25 17:22:49,172 - app - INFO - Database tables created successfully
2025-05-25 17:22:49,868 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:22:49,868 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:22:49,868 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:22:49,873 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:22:50,959 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:22:50,959 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 17:22:50,960 - routes - INFO - DEBUG: Task 3 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:22:50,961 - routes - INFO - DEBUG: Task 3 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:22:50,962 - routes - INFO - DEBUG: Task 3 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:22:50,963 - routes - INFO - DEBUG: Task 3 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:22:50,964 - routes - INFO - DEBUG: Task 3 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:22:50,965 - routes - INFO - DEBUG: Task 3 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:22:50,966 - routes - INFO - Task 3 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:22:50,967 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 17:22:50,968 - routes - INFO - DEBUG: Added task 3 to receipt_tasks, now has 1 items
2025-05-25 17:22:50,969 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:22:50,969 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:23:00,123 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:23:00,124 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending_review
2025-05-25 17:23:00,126 - routes - INFO - DEBUG: Task 3 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:23:00,126 - routes - INFO - DEBUG: Task 3 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:23:00,127 - routes - INFO - DEBUG: Task 3 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:23:00,128 - routes - INFO - DEBUG: Task 3 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:23:00,129 - routes - INFO - DEBUG: Task 3 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:23:00,130 - routes - INFO - DEBUG: Task 3 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:23:00,130 - routes - INFO - Task 3 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '1:00 PM', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:23:00,131 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-25 17:23:00,132 - routes - INFO - DEBUG: Added task 3 to receipt_tasks, now has 1 items
2025-05-25 17:23:00,133 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:23:00,133 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:23:07,406 - routes - INFO - Processing receipt 3 with selections: invoice=True, objects=['0'], people=['0'], events=True, org=True
2025-05-25 17:23:07,420 - routes - ERROR - Error creating object from line item 0: cannot access local variable 'extracted_metadata' where it is not associated with a value
2025-05-25 17:23:07,424 - routes - INFO - Created person object 'Nate Smith' from receipt INV-20250525-48B4F141
2025-05-25 17:23:07,425 - routes - INFO - Created and tracked person: Nate Smith
2025-05-25 17:23:07,435 - routes - INFO - Created calendar event 'Great Blue Heron Music Festival 2025' from receipt INV-20250525-48B4F141
2025-05-25 17:23:07,436 - routes - INFO - Created and tracked event: Great Blue Heron Music Festival 2025
2025-05-25 17:23:07,441 - routes - INFO - Created/promoted and tracked organization: Eventeny
2025-05-25 17:23:07,442 - routes - INFO - Successfully processed receipt task with enhanced tracking: Invoice INV-20250525-48B4F141
2025-05-25 17:23:07,453 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 17:23:07,453 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 17:23:07,454 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 17:23:25,578 - routes - INFO - Created person object 'Nate Smith' from receipt INV-20250525-48B4F141
2025-05-25 17:23:42,559 - routes - INFO - Deleting receipt INV-20250525-48B4F141: 1 line items, 2 objects, 0 attachments, 3 creation tracking records. Delete objects: True. Reason: 
2025-05-25 17:23:42,573 - routes - INFO - Deleted object: Nate Smith (ID: 3)
2025-05-25 17:23:42,595 - routes - INFO - Deleted object: Nate Smith (ID: 4)
2025-05-25 17:23:42,596 - routes - INFO - Deleted creation tracking record: object ID 3
2025-05-25 17:23:42,596 - routes - INFO - Deleted creation tracking record: calendar_event ID 2
2025-05-25 17:23:42,597 - routes - INFO - Deleted creation tracking record: organization ID 1
2025-05-25 17:30:53,019 - app - INFO - Creating database tables...
2025-05-25 17:30:53,021 - app - INFO - Creating database tables...
2025-05-25 17:30:53,021 - app - INFO - Creating database tables...
2025-05-25 17:30:53,025 - app - INFO - Creating database tables...
2025-05-25 17:30:53,061 - app - INFO - Database tables created successfully
2025-05-25 17:30:53,061 - app - INFO - Database tables created successfully
2025-05-25 17:30:53,061 - app - INFO - Database tables created successfully
2025-05-25 17:30:53,061 - app - INFO - Database tables created successfully
2025-05-25 17:30:53,785 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:30:53,787 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:30:53,789 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:30:53,793 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:30:57,824 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 17:30:57,825 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 17:30:57,826 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 17:31:03,147 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-25 17:31:03,161 - openai_utils - INFO - OpenAI API connection test successful
2025-05-25 17:31:06,285 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-25 17:31:06,286 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-25 17:31:06,288 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp_byn4310.pdf
2025-05-25 17:31:06,289 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 17:31:06,752 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-25 17:31:06,752 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-25 17:31:06,841 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-25 17:31:06,843 - ocr_utils - INFO - Using original image size: 2550x9900 pixels for OpenAI processing
2025-05-25 17:31:06,882 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-25 17:31:06,884 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 17:31:06,884 - routes - INFO - Sending receipt to MCP server for analysis with OpenAI
2025-05-25 17:31:06,914 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 17:31:06,916 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 17:31:22,789 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 17:31:22,791 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-25 17:31:22,792 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Non-refundable ticket for festival entry",\n      "create_object": false,\n      "object_type": "consumable",\n      "category": "Event Tickets",\n      "expiration_info": {\n        "expiration_date": "2025-07-03",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nate Smith",\n      "role": "customer",\n      "relationship_to_purchase": "Ticket holder",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "General Admission",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": null,\n    "business_phone": null,\n    "business_email": "express@eventeny.com",\n    "business_website": "https://eventeny.com",\n    "business_hours": null,\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "Extracted from email receipt for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 15.850128173828125, 'timestamp': '2025-05-25T17:31:22.786923', 'tokens_used': 4257, 'cost_estimate': 0.027444999999999997}
2025-05-25 17:31:22,825 - routes - INFO - Receipt queued for review: Task ID 4
2025-05-25 17:31:22,834 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:31:22,835 - routes - INFO - DEBUG: Processing task 4, type=receipt_processing, status=pending_review
2025-05-25 17:31:22,835 - routes - INFO - DEBUG: Task 4 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:31:22,836 - routes - INFO - DEBUG: Task 4 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:31:22,837 - routes - INFO - DEBUG: Task 4 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method"...
2025-05-25 17:31:22,838 - routes - INFO - DEBUG: Task 4 - cleaned response_str preview: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.00,
  "tax_amount": 0.00,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not s...
2025-05-25 17:31:22,839 - routes - INFO - DEBUG: Task 4 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'tax_amount', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:31:22,840 - routes - INFO - DEBUG: Task 4 SUCCESSFULLY extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-25 17:31:22,840 - routes - INFO - Task 4 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '13:00', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': 'General Admission', 'additional_details': {}}
2025-05-25 17:31:22,841 - routes - INFO - DEBUG: Task 4 has AI analysis
2025-05-25 17:31:22,842 - routes - INFO - DEBUG: Added task 4 to receipt_tasks, now has 1 items
2025-05-25 17:31:22,843 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:31:22,844 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:31:34,707 - routes - INFO - Processing receipt 4 with selections: invoice=True, objects=['0'], people=['0'], events=True, org=True
2025-05-25 17:31:34,728 - routes - ERROR - Error creating object from line item 0: cannot access local variable 'extracted_metadata' where it is not associated with a value
2025-05-25 17:31:34,732 - routes - INFO - Created person object 'Nate Smith' from receipt INV-20250525-EB64AA10
2025-05-25 17:31:34,734 - routes - INFO - Created and tracked person: Nate Smith
2025-05-25 17:31:34,744 - routes - INFO - Created calendar event 'Great Blue Heron Music Festival 2025' from receipt INV-20250525-EB64AA10
2025-05-25 17:31:34,745 - routes - INFO - Created and tracked event: Great Blue Heron Music Festival 2025
2025-05-25 17:31:34,750 - routes - INFO - Created/promoted and tracked organization: Eventeny
2025-05-25 17:31:34,750 - routes - INFO - Successfully processed receipt task with enhanced tracking: Invoice INV-20250525-EB64AA10
2025-05-25 17:31:34,764 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 17:31:34,765 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 17:31:34,765 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 17:31:48,530 - routes - INFO - Auto-classified 'Weekend Pass Thursday Entry' as consumable event ticket
2025-05-25 17:31:48,534 - routes - INFO - Processing digital assets for manually created event ticket 6: ['qr_codes', 'barcodes', 'urls', 'confirmation_codes', 'ticket_numbers', 'account_numbers']
2025-05-25 17:31:48,535 - routes - INFO - Attached confirmation code #1 to event ticket 6
2025-05-25 17:31:48,543 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from receipt INV-20250525-EB64AA10 line 0
2025-05-25 17:35:34,530 - app - INFO - Creating database tables...
2025-05-25 17:35:34,531 - app - INFO - Creating database tables...
2025-05-25 17:35:34,534 - app - INFO - Creating database tables...
2025-05-25 17:35:34,566 - app - INFO - Database tables created successfully
2025-05-25 17:35:34,566 - app - INFO - Database tables created successfully
2025-05-25 17:35:34,566 - app - INFO - Database tables created successfully
2025-05-25 17:35:34,576 - app - INFO - Creating database tables...
2025-05-25 17:35:34,593 - app - INFO - Database tables created successfully
2025-05-25 17:35:35,236 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:35:35,236 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:35:35,236 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:35:35,236 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:36:28,402 - routes - ERROR - Error loading settings: Could not build url for endpoint 'update_ai_settings' with values ['provider']. Did you mean 'settings' instead?
2025-05-25 17:36:38,998 - routes - ERROR - Error loading reminders: Entity namespace for "reminders" has no property "is_completed"
2025-05-25 17:36:39,694 - routes - ERROR - Error loading reports: 'paid_invoices_total' is undefined
2025-05-25 17:37:43,916 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-25 17:37:43,920 - openai_utils - INFO - OpenAI API connection test successful
2025-05-25 17:37:51,889 - routes - INFO - Processing receipt file: RECEIPT PAePay DUI Fine Nate Smith.pdf
2025-05-25 17:37:51,890 - routes - INFO - Processing PDF file: RECEIPT_PAePay_DUI_Fine_Nate_Smith.pdf
2025-05-25 17:37:51,892 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpoyvl_gx0.pdf
2025-05-25 17:37:51,893 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-25 17:37:52,026 - ocr_utils - INFO - Successfully converted 1 pages from PDF
2025-05-25 17:37:52,027 - ocr_utils - INFO - Using original image size: 2550x3300 pixels for OpenAI processing
2025-05-25 17:37:52,053 - ocr_utils - INFO - Successfully converted PDF (1 pages) to JPEG image using pdf2image
2025-05-25 17:37:52,054 - routes - INFO - Successfully converted PDF to image for processing
2025-05-25 17:37:52,055 - routes - INFO - Sending receipt to MCP server for analysis with OpenAI
2025-05-25 17:37:52,083 - mcp_client - WARNING - Could not get object types from API: All connection attempts failed, using defaults
2025-05-25 17:37:52,085 - mcp_client - WARNING - Could not get categories from API: All connection attempts failed, using defaults
2025-05-25 17:38:02,768 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-25 17:38:02,770 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-25 17:38:02,771 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "PAePay",\n  "date": "2025-05-20",\n  "total_amount": 267.15,\n  "subtotal": 260.00,\n  "fees": 7.15,\n  "receipt_number": "01XF693J7H",\n  "payment_method": "Online Payment",\n  "due_date": "2025-05-24",\n  "is_bill": false,\n  "document_type": "Receipt",\n  "description": "Traffic Ticket or Court Costs Payment",\n  "line_items": [\n    {\n      "description": "Payment Plan 67-2018-P000007328",\n      "quantity": 1.0,\n      "unit_price": 260.00,\n      "total_price": 260.00,\n      "item_details": "Next payment amount due: $65.00, Overdue amount: $195.00",\n      "create_object": false,\n      "object_type": "service",\n      "category": "Professional Services",\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": true,\n      "person_name": "Nathaniel Foster",\n      "role": "customer",\n      "relationship_to_purchase": "Defendant",\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "confirmation_codes": [\n      "01XF693J7H"\n    ]\n  },\n  "event_details": {},\n  "vendor_details": {\n    "business_address": "https://ujsportal.pacourts.us",\n    "business_phone": "",\n    "business_email": "",\n    "business_website": "https://ujsportal.pacourts.us",\n    "business_hours": "",\n    "business_type": "Government"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "Receipt for court costs payment with confirmation number and due date."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 10.668657064437866, 'timestamp': '2025-05-25T17:38:02.768033', 'tokens_used': 3394, 'cost_estimate': 0.0213}
2025-05-25 17:38:02,791 - routes - INFO - Receipt queued for review: Task ID 5
2025-05-25 17:38:02,799 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-25 17:38:02,799 - routes - INFO - DEBUG: Processing task 5, type=receipt_processing, status=pending_review
2025-05-25 17:38:02,800 - routes - INFO - DEBUG: Task 5 - ai_analysis keys: ['content', 'provider', 'timestamp', 'confidence', 'prompt_type', 'tokens_used', 'cost_estimate', 'processing_time']
2025-05-25 17:38:02,801 - routes - INFO - DEBUG: Task 5 - content type: <class 'dict'>, keys: ['response']
2025-05-25 17:38:02,801 - routes - INFO - DEBUG: Task 5 - using LEGACY format (text response), response_str preview: ```json
{
  "vendor_name": "PAePay",
  "date": "2025-05-20",
  "total_amount": 267.15,
  "subtotal": 260.00,
  "fees": 7.15,
  "receipt_number": "01XF693J7H",
  "payment_method": "Online Payment",
  "...
2025-05-25 17:38:02,802 - routes - INFO - DEBUG: Task 5 - cleaned response_str preview: {
  "vendor_name": "PAePay",
  "date": "2025-05-20",
  "total_amount": 267.15,
  "subtotal": 260.00,
  "fees": 7.15,
  "receipt_number": "01XF693J7H",
  "payment_method": "Online Payment",
  "due_date...
2025-05-25 17:38:02,803 - routes - INFO - DEBUG: Task 5 - parsed receipt_data keys: ['vendor_name', 'date', 'total_amount', 'subtotal', 'fees', 'receipt_number', 'payment_method', 'due_date', 'is_bill', 'document_type', 'description', 'line_items', 'people_found', 'digital_assets', 'event_details', 'vendor_details', 'overall_confidence', 'image_quality', 'missing_information', 'extraction_notes']
2025-05-25 17:38:02,803 - routes - INFO - Detected event from receipt: traffic ticket or court (confidence: 0.6, 0 consumable items)
2025-05-25 17:38:02,804 - routes - INFO - Task 5 - Detected event from receipt data: Traffic Ticket Or Court
2025-05-25 17:38:02,805 - routes - INFO - DEBUG: Task 5 SUCCESSFULLY extracted receipt data: vendor=PAePay, total=$267.15
2025-05-25 17:38:02,805 - routes - INFO - Task 5 has event details: {'event_name': 'Traffic Ticket Or Court', 'event_date': '2025-05-20', 'venue_location': '', 'description': 'traffic ticket or court costs payment', 'event_type': 'detected_from_receipt', 'confidence': 0.6, 'detection_method': 'smart_analysis', 'consumable_items_detected': 0, 'tickets_and_passes': [], 'indicators': {'description_match': True, 'line_items_match': False, 'vendor_match': False, 'matching_line_items': 0}}
2025-05-25 17:38:02,806 - routes - INFO - DEBUG: Task 5 has AI analysis
2025-05-25 17:38:02,807 - routes - INFO - DEBUG: Added task 5 to receipt_tasks, now has 1 items
2025-05-25 17:38:02,807 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-25 17:38:02,808 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-25 17:38:27,705 - routes - INFO - Processing receipt 5 with selections: invoice=True, objects=['0'], people=['0'], events=False, org=False
2025-05-25 17:38:27,716 - routes - ERROR - Error creating object from line item 0: cannot access local variable 'extracted_metadata' where it is not associated with a value
2025-05-25 17:38:27,720 - routes - INFO - Created person object 'Nathaniel Foster' from receipt INV-20250525-97B22AE5
2025-05-25 17:38:27,720 - routes - INFO - Created and tracked person: Nathaniel Foster
2025-05-25 17:38:27,721 - routes - INFO - Successfully processed receipt task with enhanced tracking: Invoice INV-20250525-97B22AE5
2025-05-25 17:38:27,734 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 17:38:27,735 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 17:38:27,736 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 17:38:58,342 - app - INFO - Creating database tables...
2025-05-25 17:38:58,344 - app - INFO - Creating database tables...
2025-05-25 17:38:58,347 - app - INFO - Creating database tables...
2025-05-25 17:38:58,356 - app - INFO - Creating database tables...
2025-05-25 17:38:58,385 - app - INFO - Database tables created successfully
2025-05-25 17:38:58,385 - app - INFO - Database tables created successfully
2025-05-25 17:38:58,386 - app - INFO - Database tables created successfully
2025-05-25 17:38:58,386 - app - INFO - Database tables created successfully
2025-05-25 17:38:59,098 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:38:59,098 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:38:59,098 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:38:59,111 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:39:46,746 - app - INFO - Creating database tables...
2025-05-25 17:39:46,764 - app - INFO - Database tables created successfully
2025-05-25 17:39:46,795 - app - INFO - Creating database tables...
2025-05-25 17:39:46,813 - app - INFO - Database tables created successfully
2025-05-25 17:39:46,851 - app - INFO - Creating database tables...
2025-05-25 17:39:46,868 - app - INFO - Database tables created successfully
2025-05-25 17:39:46,885 - app - INFO - Creating database tables...
2025-05-25 17:39:46,903 - app - INFO - Database tables created successfully
2025-05-25 17:39:47,191 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:39:47,240 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:39:47,277 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:39:47,327 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:39:48,249 - routes - ERROR - Error loading settings: Could not build url for endpoint 'update_ai_features'. Did you mean 'update_due_date' instead?
2025-05-25 17:39:53,316 - routes - ERROR - Error loading reports: 'paid_invoices_total' is undefined
2025-05-25 17:41:12,755 - app - INFO - Creating database tables...
2025-05-25 17:41:12,757 - app - INFO - Creating database tables...
2025-05-25 17:41:12,794 - app - INFO - Database tables created successfully
2025-05-25 17:41:12,794 - app - INFO - Database tables created successfully
2025-05-25 17:41:12,817 - app - INFO - Creating database tables...
2025-05-25 17:41:12,836 - app - INFO - Database tables created successfully
2025-05-25 17:41:12,875 - app - INFO - Creating database tables...
2025-05-25 17:41:12,894 - app - INFO - Database tables created successfully
2025-05-25 17:41:13,471 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:41:13,471 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:41:13,472 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:41:13,477 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:41:15,231 - routes - ERROR - Error loading settings: 'features' is undefined
2025-05-25 17:41:33,678 - routes - ERROR - Error loading reports: 'Invoice' object has no attribute 'total_amount'
2025-05-25 17:43:05,127 - app - INFO - Creating database tables...
2025-05-25 17:43:05,146 - app - INFO - Database tables created successfully
2025-05-25 17:43:05,192 - app - INFO - Creating database tables...
2025-05-25 17:43:05,210 - app - INFO - Database tables created successfully
2025-05-25 17:43:05,229 - app - INFO - Creating database tables...
2025-05-25 17:43:05,248 - app - INFO - Database tables created successfully
2025-05-25 17:43:05,257 - app - INFO - Creating database tables...
2025-05-25 17:43:05,276 - app - INFO - Database tables created successfully
2025-05-25 17:43:05,583 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:43:05,633 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:43:05,662 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:43:05,689 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:43:06,711 - routes - ERROR - Error loading reports: 'assets_estimated_value' is undefined
2025-05-25 17:43:07,375 - routes - ERROR - Error loading reports: 'assets_estimated_value' is undefined
2025-05-25 17:45:39,644 - app - INFO - Creating database tables...
2025-05-25 17:45:39,663 - app - INFO - Database tables created successfully
2025-05-25 17:45:39,663 - app - INFO - Creating database tables...
2025-05-25 17:45:39,682 - app - INFO - Database tables created successfully
2025-05-25 17:45:39,710 - app - INFO - Creating database tables...
2025-05-25 17:45:39,729 - app - INFO - Database tables created successfully
2025-05-25 17:45:39,760 - app - INFO - Creating database tables...
2025-05-25 17:45:39,779 - app - INFO - Database tables created successfully
2025-05-25 17:45:40,104 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:45:40,114 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:45:40,151 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:45:40,202 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:47:11,658 - app - INFO - Creating database tables...
2025-05-25 17:47:11,676 - app - INFO - Database tables created successfully
2025-05-25 17:47:11,728 - app - INFO - Creating database tables...
2025-05-25 17:47:11,745 - app - INFO - Database tables created successfully
2025-05-25 17:47:11,783 - app - INFO - Creating database tables...
2025-05-25 17:47:11,801 - app - INFO - Database tables created successfully
2025-05-25 17:47:11,805 - app - INFO - Creating database tables...
2025-05-25 17:47:11,823 - app - INFO - Database tables created successfully
2025-05-25 17:47:12,159 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:47:12,225 - routes - ERROR - Error loading settings: Could not build url for endpoint 'update_ai_settings' with values ['provider']. Did you mean 'update_openai_settings' instead?
2025-05-25 17:47:12,248 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:47:12,323 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:47:12,361 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:47:11,419 - routes - ERROR - Error loading settings: Could not build url for endpoint 'update_ai_settings' with values ['provider']. Did you mean 'update_openai_settings' instead?
2025-05-25 17:48:24,915 - app - INFO - Creating database tables...
2025-05-25 17:48:24,944 - app - INFO - Database tables created successfully
2025-05-25 17:48:24,995 - app - INFO - Creating database tables...
2025-05-25 17:48:24,999 - app - INFO - Creating database tables...
2025-05-25 17:48:25,017 - app - INFO - Database tables created successfully
2025-05-25 17:48:25,019 - app - INFO - Database tables created successfully
2025-05-25 17:48:25,058 - app - INFO - Creating database tables...
2025-05-25 17:48:25,078 - app - INFO - Database tables created successfully
2025-05-25 17:48:25,454 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:48:25,508 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:48:25,520 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:48:25,572 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:55:04,247 - app - INFO - Creating database tables...
2025-05-25 17:55:04,252 - app - INFO - Creating database tables...
2025-05-25 17:55:04,253 - app - INFO - Creating database tables...
2025-05-25 17:55:04,294 - app - INFO - Database tables created successfully
2025-05-25 17:55:04,294 - app - INFO - Database tables created successfully
2025-05-25 17:55:04,294 - app - INFO - Database tables created successfully
2025-05-25 17:55:04,304 - app - INFO - Creating database tables...
2025-05-25 17:55:04,322 - app - INFO - Database tables created successfully
2025-05-25 17:55:05,012 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:55:05,012 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:55:05,016 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:55:05,018 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:57:43,542 - app - INFO - Creating database tables...
2025-05-25 17:57:43,543 - app - INFO - Creating database tables...
2025-05-25 17:57:43,546 - app - INFO - Creating database tables...
2025-05-25 17:57:43,548 - app - INFO - Creating database tables...
2025-05-25 17:57:43,580 - app - INFO - Database tables created successfully
2025-05-25 17:57:43,580 - app - INFO - Database tables created successfully
2025-05-25 17:57:43,580 - app - INFO - Database tables created successfully
2025-05-25 17:57:43,581 - app - INFO - Database tables created successfully
2025-05-25 17:57:44,273 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:57:44,273 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:57:44,273 - routes - INFO - AI Settings initialized successfully
2025-05-25 17:57:44,276 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:07:07,415 - app - INFO - Creating database tables...
2025-05-25 18:07:07,416 - app - INFO - Creating database tables...
2025-05-25 18:07:07,420 - app - INFO - Creating database tables...
2025-05-25 18:07:07,480 - app - INFO - Database tables created successfully
2025-05-25 18:07:07,481 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(user_aliases_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE user_aliases (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	alias_name VARCHAR(255) NOT NULL, 
	alias_type VARCHAR(50), 
	confidence FLOAT, 
	is_active BOOLEAN, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id), 
	UNIQUE (user_id, alias_name), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 18:07:07,481 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(user_aliases_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE user_aliases (
	id SERIAL NOT NULL, 
	user_id INTEGER NOT NULL, 
	alias_name VARCHAR(255) NOT NULL, 
	alias_type VARCHAR(50), 
	confidence FLOAT, 
	is_active BOOLEAN, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id), 
	UNIQUE (user_id, alias_name), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-25 18:07:07,522 - app - INFO - Creating database tables...
2025-05-25 18:07:07,543 - app - INFO - Database tables created successfully
2025-05-25 18:07:08,165 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:07:08,165 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:07:08,169 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:07:08,171 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:07:29,081 - routes - ERROR - Error loading users page: users.html
2025-05-25 18:07:29,102 - routes - ERROR - Error loading users page: users.html
2025-05-25 18:07:29,123 - routes - ERROR - Error loading users page: users.html
2025-05-25 18:07:30,267 - routes - ERROR - Error loading users page: users.html
2025-05-25 18:08:24,965 - app - INFO - Creating database tables...
2025-05-25 18:08:24,982 - app - INFO - Database tables created successfully
2025-05-25 18:08:25,625 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:08:57,392 - routes - ERROR - Error loading users page: users.html
2025-05-25 18:08:57,402 - routes - ERROR - Error loading users page: users.html
2025-05-25 18:08:57,413 - routes - ERROR - Error loading users page: users.html
2025-05-25 18:08:58,568 - routes - ERROR - Error loading users page: users.html
2025-05-25 18:09:00,955 - routes - ERROR - Error loading enhanced hybrid vendors: 'MetaData' object has no attribute 'get'
2025-05-25 18:09:00,761 - routes - ERROR - Error loading users page: users.html
2025-05-25 18:09:00,771 - routes - ERROR - Error loading users page: users.html
2025-05-25 18:09:00,783 - routes - ERROR - Error loading users page: users.html
2025-05-25 18:09:01,926 - routes - ERROR - Error loading users page: users.html
2025-05-25 18:09:03,201 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 18:09:03,201 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 18:09:03,202 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 18:09:07,019 - routes - ERROR - Error loading enhanced hybrid vendors: 'MetaData' object has no attribute 'get'
2025-05-25 18:10:20,867 - routes - ERROR - Error loading enhanced hybrid vendors: 'MetaData' object has no attribute 'get'
2025-05-25 18:13:41,738 - app - INFO - Creating database tables...
2025-05-25 18:13:41,755 - app - INFO - Database tables created successfully
2025-05-25 18:13:42,192 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:13:52,164 - routes - ERROR - Error loading enhanced hybrid vendors: 'MetaData' object has no attribute 'get'
2025-05-25 18:13:57,282 - routes - ERROR - Error loading enhanced hybrid vendors: 'MetaData' object has no attribute 'get'
2025-05-25 18:13:58,588 - routes - INFO - DEBUG: Found 0 total tasks
2025-05-25 18:13:58,589 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-25 18:13:58,590 - routes - INFO - AI Queue loaded: 0 tasks (0 pending review, 0 failed)
2025-05-25 18:13:59,221 - routes - ERROR - Error loading enhanced hybrid vendors: 'MetaData' object has no attribute 'get'
2025-05-25 18:15:02,295 - routes - ERROR - Error loading enhanced hybrid vendors: 'MetaData' object has no attribute 'get'
2025-05-25 18:15:02,919 - routes - ERROR - Error loading enhanced hybrid vendors: 'MetaData' object has no attribute 'get'
2025-05-25 18:15:24,670 - app - INFO - Creating database tables...
2025-05-25 18:15:24,711 - app - INFO - Database tables created successfully
2025-05-25 18:15:24,766 - app - INFO - Creating database tables...
2025-05-25 18:15:24,789 - app - INFO - Database tables created successfully
2025-05-25 18:15:24,812 - app - INFO - Creating database tables...
2025-05-25 18:15:24,831 - app - INFO - Database tables created successfully
2025-05-25 18:15:24,892 - app - INFO - Creating database tables...
2025-05-25 18:15:24,910 - app - INFO - Database tables created successfully
2025-05-25 18:15:25,176 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:15:25,243 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:15:25,272 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:15:25,354 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:15:46,712 - routes - ERROR - Error loading users page: 'int' object is not iterable
2025-05-25 18:15:51,102 - routes - ERROR - Error loading users page: 'int' object is not iterable
2025-05-25 18:15:54,248 - routes - ERROR - Error loading users page: 'int' object is not iterable
2025-05-25 18:24:07,379 - app - INFO - Creating database tables...
2025-05-25 18:24:07,380 - app - INFO - Creating database tables...
2025-05-25 18:24:07,384 - app - INFO - Creating database tables...
2025-05-25 18:24:07,384 - app - INFO - Creating database tables...
2025-05-25 18:24:07,417 - app - INFO - Database tables created successfully
2025-05-25 18:24:07,417 - app - INFO - Database tables created successfully
2025-05-25 18:24:07,417 - app - INFO - Database tables created successfully
2025-05-25 18:24:07,417 - app - INFO - Database tables created successfully
2025-05-25 18:24:08,203 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:24:08,206 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:24:08,208 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:24:08,210 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:30:04,684 - app - INFO - Creating database tables...
2025-05-25 18:30:04,687 - app - INFO - Creating database tables...
2025-05-25 18:30:04,691 - app - INFO - Creating database tables...
2025-05-25 18:30:04,716 - app - INFO - Creating database tables...
2025-05-25 18:30:04,724 - app - INFO - Database tables created successfully
2025-05-25 18:30:04,724 - app - INFO - Database tables created successfully
2025-05-25 18:30:04,724 - app - INFO - Database tables created successfully
2025-05-25 18:30:04,735 - app - INFO - Database tables created successfully
2025-05-25 18:30:05,420 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:30:05,420 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:30:05,420 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:30:05,422 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:33:14,156 - app - INFO - Creating database tables...
2025-05-25 18:33:14,156 - app - INFO - Creating database tables...
2025-05-25 18:33:14,195 - app - INFO - Database tables created successfully
2025-05-25 18:33:14,195 - app - INFO - Database tables created successfully
2025-05-25 18:33:14,246 - app - INFO - Creating database tables...
2025-05-25 18:33:14,269 - app - INFO - Database tables created successfully
2025-05-25 18:33:14,303 - app - INFO - Creating database tables...
2025-05-25 18:33:14,324 - app - INFO - Database tables created successfully
2025-05-25 18:33:14,898 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:33:14,898 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:33:14,898 - routes - INFO - AI Settings initialized successfully
2025-05-25 18:33:14,905 - routes - INFO - AI Settings initialized successfully
