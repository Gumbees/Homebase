2025-05-24 18:37:47,641 - app - INFO - Creating database tables...
2025-05-24 18:37:47,663 - app - INFO - Creating database tables...
2025-05-24 18:37:47,690 - app - INFO - Database tables created successfully
2025-05-24 18:37:47,690 - app - INFO - Database tables created successfully
2025-05-24 18:37:47,700 - app - INFO - Creating database tables...
2025-05-24 18:37:47,717 - app - INFO - Database tables created successfully
2025-05-24 18:37:47,793 - app - INFO - Creating database tables...
2025-05-24 18:37:47,808 - app - INFO - Database tables created successfully
2025-05-24 18:37:48,311 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:37:48,318 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:37:48,324 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:37:48,392 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:40:10,248 - app - INFO - Creating database tables...
2025-05-24 18:40:10,326 - app - INFO - Creating database tables...
2025-05-24 18:40:10,325 - app - INFO - Creating database tables...
2025-05-24 18:40:10,340 - app - INFO - Database tables created successfully
2025-05-24 18:40:10,341 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(vendors_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 18:40:10,341 - app - ERROR - Error creating database tables: (psycopg2.errors.DuplicateTable) relation "vendors" already exists

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 18:40:10,409 - app - INFO - Creating database tables...
2025-05-24 18:40:10,426 - app - INFO - Database tables created successfully
2025-05-24 18:40:10,884 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:40:10,884 - routes - ERROR - Error initializing AI settings: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ai_settings_provider_key"
DETAIL:  Key (provider)=(anthropic) already exists.

[SQL: INSERT INTO ai_settings (provider, is_enabled, is_default, api_key, api_endpoint, config, created_at, updated_at) VALUES (%(provider)s, %(is_enabled)s, %(is_default)s, %(api_key)s, %(api_endpoint)s, %(config)s, %(created_at)s, %(updated_at)s) RETURNING ai_settings.id]
[parameters: {'provider': 'anthropic', 'is_enabled': True, 'is_default': True, 'api_key': None, 'api_endpoint': None, 'config': '{"default_model": "claude-3-5-sonnet-20241022", "vision_model": "claude-3-opus-20240229", "timeout": 180}', 'created_at': datetime.datetime(2025, 5, 24, 18, 40, 10, 882866), 'updated_at': datetime.datetime(2025, 5, 24, 18, 40, 10, 882868)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 18:40:10,890 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:40:10,952 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:42:06,944 - app - INFO - Creating database tables...
2025-05-24 18:42:06,960 - app - INFO - Database tables created successfully
2025-05-24 18:42:06,981 - app - INFO - Creating database tables...
2025-05-24 18:42:06,995 - app - INFO - Database tables created successfully
2025-05-24 18:42:07,052 - app - INFO - Creating database tables...
2025-05-24 18:42:07,066 - app - INFO - Database tables created successfully
2025-05-24 18:42:07,105 - app - INFO - Creating database tables...
2025-05-24 18:42:07,118 - app - INFO - Database tables created successfully
2025-05-24 18:42:07,482 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:42:07,521 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:42:07,589 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:42:07,633 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:44:55,252 - app - INFO - Creating database tables...
2025-05-24 18:44:55,257 - app - INFO - Creating database tables...
2025-05-24 18:44:55,265 - app - INFO - Database tables created successfully
2025-05-24 18:44:55,270 - app - INFO - Database tables created successfully
2025-05-24 18:44:55,301 - app - INFO - Creating database tables...
2025-05-24 18:44:55,304 - app - INFO - Creating database tables...
2025-05-24 18:44:55,314 - app - INFO - Database tables created successfully
2025-05-24 18:44:55,317 - app - INFO - Database tables created successfully
2025-05-24 18:44:55,784 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:44:55,788 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:44:55,837 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:44:55,873 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:45:43,549 - app - INFO - Creating database tables...
2025-05-24 18:45:43,564 - app - INFO - Database tables created successfully
2025-05-24 18:45:43,629 - app - INFO - Creating database tables...
2025-05-24 18:45:43,643 - app - INFO - Database tables created successfully
2025-05-24 18:45:43,650 - app - INFO - Creating database tables...
2025-05-24 18:45:43,652 - app - INFO - Creating database tables...
2025-05-24 18:45:43,665 - app - INFO - Database tables created successfully
2025-05-24 18:45:43,665 - app - INFO - Database tables created successfully
2025-05-24 18:45:44,127 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:45:44,202 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:45:44,218 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:45:44,236 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:46:47,569 - routes - INFO - Processing receipt file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf, auto_analyze=True
2025-05-24 18:46:47,570 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 18:46:47,571 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp768eiyab.pdf
2025-05-24 18:46:47,758 - ocr_utils - INFO - Successfully converted PDF to JPEG image using pdf2image
2025-05-24 18:46:47,759 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 18:46:47,760 - routes - INFO - Processing receipt with AI (auto_analyze=True, auto_link=True)
2025-05-24 18:46:47,761 - routes - INFO - Processing receipt with OpenAI
2025-05-24 18:46:47,761 - ocr_utils - INFO - Processing receipt 'RECEIPT_Blue_Heron_Music_Festival_July_2025.jpg' using OpenAI
2025-05-24 18:46:47,791 - openai_utils - INFO - Successfully converted image to JPEG for OpenAI API
2025-05-24 18:46:47,792 - openai_utils - INFO - Extracting receipt data with OpenAI (attempt 1/3)
2025-05-24 18:46:48,486 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-05-24 18:46:48,488 - openai_utils - ERROR - Error in receipt data extraction with OpenAI: Error code: 401 - {'error': {'message': 'Incorrect API key provided: your_ope************here. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-05-24 18:46:48,489 - openai_utils - ERROR - Non-retriable error in receipt extraction: unknown
2025-05-24 18:46:48,489 - openai_utils - INFO - Analyzing line items...
2025-05-24 18:46:48,490 - routes - WARNING - Missing required fields for receipt processing
2025-05-24 18:50:15,411 - app - INFO - Creating database tables...
2025-05-24 18:50:15,446 - app - INFO - Database tables created successfully
2025-05-24 18:50:15,463 - app - INFO - Creating database tables...
2025-05-24 18:50:15,481 - app - INFO - Database tables created successfully
2025-05-24 18:50:15,521 - app - INFO - Creating database tables...
2025-05-24 18:50:15,540 - app - INFO - Database tables created successfully
2025-05-24 18:50:15,546 - app - INFO - Creating database tables...
2025-05-24 18:50:15,567 - app - INFO - Database tables created successfully
2025-05-24 18:50:16,179 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:50:16,191 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:50:16,206 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:50:16,234 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:50:42,246 - routes - INFO - Processing receipt file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf, auto_analyze=True
2025-05-24 18:50:42,246 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 18:50:42,247 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpmooh684g.pdf
2025-05-24 18:50:42,461 - ocr_utils - INFO - Successfully converted PDF to JPEG image using pdf2image
2025-05-24 18:50:42,462 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 18:50:42,463 - routes - INFO - Processing receipt with AI (auto_analyze=True, auto_link=True)
2025-05-24 18:50:42,463 - routes - INFO - Processing receipt with OpenAI
2025-05-24 18:50:42,464 - ocr_utils - INFO - Processing receipt 'RECEIPT_Blue_Heron_Music_Festival_July_2025.jpg' using OpenAI
2025-05-24 18:50:42,493 - openai_utils - INFO - Successfully converted image to JPEG for OpenAI API
2025-05-24 18:50:42,494 - openai_utils - INFO - Extracting receipt data with OpenAI (attempt 1/3)
2025-05-24 18:50:42,899 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-24 18:50:42,913 - openai_utils - INFO - Successfully extracted and validated receipt data with OpenAI: {'vendor_name': 'Eventeny', 'date': '2025-05-17', 'total_amount': 0.0, 'receipt_number': None, 'due_date': None, 'line_items': [], 'is_bill': False}
2025-05-24 18:50:42,914 - openai_utils - INFO - Analyzing line items...
2025-05-24 18:50:42,915 - routes - WARNING - Missing required fields for receipt processing
2025-05-24 18:56:37,284 - app - INFO - Creating database tables...
2025-05-24 18:56:37,285 - app - INFO - Creating database tables...
2025-05-24 18:56:37,316 - app - INFO - Database tables created successfully
2025-05-24 18:56:37,316 - app - INFO - Database tables created successfully
2025-05-24 18:56:37,323 - app - INFO - Creating database tables...
2025-05-24 18:56:37,336 - app - INFO - Database tables created successfully
2025-05-24 18:56:37,413 - app - INFO - Creating database tables...
2025-05-24 18:56:37,427 - app - INFO - Database tables created successfully
2025-05-24 18:56:38,170 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:56:38,170 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:56:38,172 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:56:38,174 - routes - INFO - AI Settings initialized successfully
2025-05-24 18:56:44,703 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:14:12,362 - app - INFO - Creating database tables...
2025-05-24 19:14:12,362 - app - INFO - Creating database tables...
2025-05-24 19:14:12,362 - app - INFO - Creating database tables...
2025-05-24 19:14:12,362 - app - INFO - Creating database tables...
2025-05-24 19:14:12,401 - app - INFO - Database tables created successfully
2025-05-24 19:14:12,401 - app - INFO - Database tables created successfully
2025-05-24 19:14:12,402 - app - INFO - Database tables created successfully
2025-05-24 19:14:12,402 - app - INFO - Database tables created successfully
2025-05-24 19:14:13,306 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:14:13,306 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:14:13,308 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:14:13,308 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:14:28,014 - routes - INFO - Processing receipt file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 19:14:28,015 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 19:14:28,016 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpq4tltj_1.pdf
2025-05-24 19:14:28,240 - ocr_utils - INFO - Successfully converted PDF to JPEG image using pdf2image
2025-05-24 19:14:28,240 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 19:14:28,241 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 19:14:28,271 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/receipt/analyze "HTTP/1.1 422 Unprocessable Entity"
2025-05-24 19:14:28,272 - mcp_client - ERROR - Receipt analysis failed: Client error '422 Unprocessable Entity' for url 'http://mcp-server:8080/ai/receipt/analyze'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
2025-05-24 19:14:28,273 - routes - ERROR - MCP server analysis failed: Client error '422 Unprocessable Entity' for url 'http://mcp-server:8080/ai/receipt/analyze'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
2025-05-24 19:14:28,274 - routes - ERROR - Error processing receipt: cannot access local variable 'TaskQueue' where it is not associated with a value
Traceback (most recent call last):
  File "/app/routes.py", line 138, in receipt_upload
    mcp_result = analyze_receipt_sync(
                 ^^^^^^^^^^^^^^^^^^^^^
  File "/app/mcp_client.py", line 345, in analyze_receipt_sync
    return run_async_in_thread(
           ^^^^^^^^^^^^^^^^^^^^
  File "/app/mcp_client.py", line 336, in run_async_in_thread
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 456, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/usr/local/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/mcp_client.py", line 330, in run_in_thread
    return loop.run_until_complete(coro)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/app/mcp_client.py", line 299, in analyze_receipt_async
    return await client.analyze_receipt(image_data, filename, provider)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/mcp_client.py", line 83, in analyze_receipt
    response.raise_for_status()
  File "/usr/local/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://mcp-server:8080/ai/receipt/analyze'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/app/routes.py", line 201, in receipt_upload
    receipt_task = TaskQueue.queue_task({
                   ^^^^^^^^^
UnboundLocalError: cannot access local variable 'TaskQueue' where it is not associated with a value
2025-05-24 19:20:04,240 - app - INFO - Creating database tables...
2025-05-24 19:20:04,240 - app - INFO - Creating database tables...
2025-05-24 19:20:04,260 - app - INFO - Creating database tables...
2025-05-24 19:20:04,271 - app - INFO - Database tables created successfully
2025-05-24 19:20:04,271 - app - INFO - Database tables created successfully
2025-05-24 19:20:04,274 - app - INFO - Database tables created successfully
2025-05-24 19:20:04,321 - app - INFO - Creating database tables...
2025-05-24 19:20:04,335 - app - INFO - Database tables created successfully
2025-05-24 19:20:05,132 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:20:05,132 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:20:05,132 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:20:05,132 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:20:54,867 - app - INFO - Creating database tables...
2025-05-24 19:20:54,883 - app - INFO - Database tables created successfully
2025-05-24 19:20:54,940 - app - INFO - Creating database tables...
2025-05-24 19:20:54,955 - app - INFO - Database tables created successfully
2025-05-24 19:20:55,039 - app - INFO - Creating database tables...
2025-05-24 19:20:55,053 - app - INFO - Database tables created successfully
2025-05-24 19:20:55,056 - app - INFO - Creating database tables...
2025-05-24 19:20:55,071 - app - INFO - Database tables created successfully
2025-05-24 19:20:55,434 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:20:55,489 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:20:55,569 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:20:55,589 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:27:40,117 - app - INFO - Creating database tables...
2025-05-24 19:27:40,118 - app - INFO - Creating database tables...
2025-05-24 19:27:40,121 - app - INFO - Creating database tables...
2025-05-24 19:27:40,205 - app - INFO - Creating database tables...
2025-05-24 19:27:40,222 - app - INFO - Database tables created successfully
2025-05-24 19:27:40,223 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(organizations_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE organizations (
	id SERIAL NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	organization_type VARCHAR(50), 
	data JSONB NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	is_active BOOLEAN, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 19:27:40,223 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(organizations_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE organizations (
	id SERIAL NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	organization_type VARCHAR(50), 
	data JSONB NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	is_active BOOLEAN, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 19:27:40,223 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(organizations_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE organizations (
	id SERIAL NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	organization_type VARCHAR(50), 
	data JSONB NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	is_active BOOLEAN, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 19:27:41,154 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:27:41,154 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:27:41,154 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:27:41,158 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:27:58,395 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 19:27:58,396 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 19:27:58,397 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp2n8xlvjm.pdf
2025-05-24 19:27:58,633 - ocr_utils - INFO - Successfully converted PDF to JPEG image using pdf2image
2025-05-24 19:27:58,635 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 19:27:58,636 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-24 19:27:58,714 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/receipt/analyze "HTTP/1.1 422 Unprocessable Entity"
2025-05-24 19:27:58,715 - mcp_client - ERROR - Receipt analysis failed: Client error '422 Unprocessable Entity' for url 'http://mcp-server:8080/ai/receipt/analyze'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
2025-05-24 19:27:58,716 - routes - ERROR - MCP server analysis failed: Client error '422 Unprocessable Entity' for url 'http://mcp-server:8080/ai/receipt/analyze'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
2025-05-24 19:27:58,737 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:28:29,152 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:28:53,996 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:29:48,873 - app - INFO - Creating database tables...
2025-05-24 19:29:48,873 - app - INFO - Creating database tables...
2025-05-24 19:29:48,873 - app - INFO - Creating database tables...
2025-05-24 19:29:48,880 - app - INFO - Creating database tables...
2025-05-24 19:29:48,906 - app - INFO - Database tables created successfully
2025-05-24 19:29:48,906 - app - INFO - Database tables created successfully
2025-05-24 19:29:48,906 - app - INFO - Database tables created successfully
2025-05-24 19:29:48,906 - app - INFO - Database tables created successfully
2025-05-24 19:29:49,828 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:29:49,828 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:29:49,828 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:29:49,828 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:29:49,839 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:30:10,214 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 19:30:10,215 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 19:30:10,216 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp9_piwu2j.pdf
2025-05-24 19:30:10,432 - ocr_utils - INFO - Successfully converted PDF to JPEG image using pdf2image
2025-05-24 19:30:10,433 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 19:30:10,433 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 19:30:16,905 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 19:30:16,906 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 19:30:16,907 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-05-17",\n  "total_amount": 0.0,\n  "subtotal": null,\n  "tax_amount": null,\n  "receipt_number": null,\n  "description": "Tickets for Great Blue Heron Music Festival 2025",\n  "due_date": null,\n  "is_bill": false,\n  "line_items": [\n    {\n      "description": "Great Blue Heron Music Festival 2025 Ticket",\n      "quantity": 1.0,\n      "unit_price": 0.0,\n      "total_price": 0.0,\n      "category": "entertainment",\n      "suggested_object_type": "service"\n    }\n  ],\n  "confidence": 0.8\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 6.437476634979248, 'timestamp': '2025-05-24T19:30:16.904008', 'tokens_used': 1565, 'cost_estimate': 0.009555}
2025-05-24 19:30:16,925 - routes - INFO - Receipt queued for review: Task ID 34
2025-05-24 19:30:16,935 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 19:30:44,591 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 19:31:14,968 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 19:31:26,170 - routes - INFO - Receipt rejected: Task 1, Reason: 
2025-05-24 19:31:26,176 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:31:37,079 - routes - INFO - Receipt rejected: Task 34, Reason: 
2025-05-24 19:31:37,085 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:32:06,808 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:32:46,443 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:33:16,794 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:33:45,438 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:34:17,547 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:34:47,892 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:35:18,260 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:35:19,137 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:35:43,468 - app - INFO - Creating database tables...
2025-05-24 19:35:43,468 - app - INFO - Creating database tables...
2025-05-24 19:35:43,469 - app - INFO - Creating database tables...
2025-05-24 19:35:43,475 - app - INFO - Creating database tables...
2025-05-24 19:35:43,503 - app - INFO - Database tables created successfully
2025-05-24 19:35:43,504 - app - INFO - Database tables created successfully
2025-05-24 19:35:43,504 - app - INFO - Database tables created successfully
2025-05-24 19:35:43,504 - app - INFO - Database tables created successfully
2025-05-24 19:35:44,421 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:35:44,421 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:35:44,422 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:35:44,429 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:35:46,679 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:35:44,550 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:35:44,835 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:35:45,042 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:35:45,544 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:35:53,724 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 19:35:53,725 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 19:35:53,726 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmplylmjivl.pdf
2025-05-24 19:35:53,947 - ocr_utils - INFO - Successfully converted PDF to JPEG image using pdf2image
2025-05-24 19:35:53,948 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 19:35:53,949 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 19:35:58,670 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 19:35:58,671 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 19:35:58,672 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-05-17",\n  "total_amount": 0.0,\n  "subtotal": null,\n  "tax_amount": null,\n  "receipt_number": null,\n  "description": "Tickets for Great Blue Heron Music Festival 2025",\n  "due_date": null,\n  "is_bill": false,\n  "line_items": [],\n  "confidence": 0.8\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 4.684763431549072, 'timestamp': '2025-05-24T19:35:58.668654', 'tokens_used': 1495, 'cost_estimate': 0.008505}
2025-05-24 19:35:58,684 - routes - INFO - Receipt queued for review: Task ID 35
2025-05-24 19:35:58,693 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:36:29,134 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:36:59,491 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:37:29,856 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:38:00,208 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:38:27,857 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:38:58,373 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:38:58,396 - routes - ERROR - Error loading AI queue: No filter named 'from_json' found.
2025-05-24 19:39:28,475 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:39:28,478 - routes - ERROR - Error loading AI queue: No filter named 'from_json' found.
2025-05-24 19:40:12,727 - app - INFO - Creating database tables...
2025-05-24 19:40:12,729 - app - INFO - Creating database tables...
2025-05-24 19:40:12,729 - app - INFO - Creating database tables...
2025-05-24 19:40:12,730 - app - INFO - Creating database tables...
2025-05-24 19:40:12,766 - app - INFO - Database tables created successfully
2025-05-24 19:40:12,766 - app - INFO - Database tables created successfully
2025-05-24 19:40:12,766 - app - INFO - Database tables created successfully
2025-05-24 19:40:12,766 - app - INFO - Database tables created successfully
2025-05-24 19:40:13,690 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:40:13,690 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:40:13,691 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:40:13,696 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:40:14,345 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:40:19,709 - routes - INFO - Receipt rejected: Task 35, Reason: 
2025-05-24 19:40:19,716 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 19:40:29,162 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 19:40:29,163 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 19:40:29,164 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp66kdub61.pdf
2025-05-24 19:40:29,400 - ocr_utils - INFO - Successfully converted PDF to JPEG image using pdf2image
2025-05-24 19:40:29,400 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 19:40:29,401 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 19:40:39,540 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 19:40:39,542 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 19:40:39,543 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-05-17",\n  "total_amount": 0.0,\n  "subtotal": null,\n  "tax_amount": null,\n  "receipt_number": null,\n  "description": "Tickets for Great Blue Heron Music Festival 2025",\n  "due_date": null,\n  "is_bill": false,\n  "line_items": [],\n  "confidence": 0.8\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 10.101931095123291, 'timestamp': '2025-05-24T19:40:39.539608', 'tokens_used': 1495, 'cost_estimate': 0.008505}
2025-05-24 19:40:39,552 - routes - INFO - Receipt queued for review: Task ID 68
2025-05-24 19:40:39,559 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 19:40:43,402 - routes - INFO - AI Analysis Structure for Task 68: {
  "content": {
    "response": "```json\n{\n  \"vendor_name\": \"Eventeny\",\n  \"date\": \"2025-05-17\",\n  \"total_amount\": 0.0,\n  \"subtotal\": null,\n  \"tax_amount\": null,\n  \"receipt_number\": null,\n  \"description\": \"Tickets for Great Blue Heron Music Festival 2025\",\n  \"due_date\": null,\n  \"is_bill\": false,\n  \"line_items\": [],\n  \"confidence\": 0.8\n}\n```"
  },
  "provider": "openai",
  "timestamp": "2025-05-24T19:40:39.539608",
  "confidence": null,
  "prompt_type": "unknown",
  "tokens_used": 1495,
  "cost_estimate": 0.008505,
  "processing_time": 10.101931095123291
}
2025-05-24 19:40:43,403 - routes - INFO - Extracted Receipt Data for Task 68: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": 0.0,
  "subtotal": null,
  "tax_amount": null,
  "receipt_number": null,
  "description": "Tickets for Great Blue Heron Music Festival 2025",
  "due_date": null,
  "is_bill": false,
  "line_items": [],
  "confidence": 0.8
}
2025-05-24 19:58:33,117 - app - INFO - Creating database tables...
2025-05-24 19:58:33,119 - app - INFO - Creating database tables...
2025-05-24 19:58:33,152 - app - INFO - Database tables created successfully
2025-05-24 19:58:33,152 - app - INFO - Database tables created successfully
2025-05-24 19:58:33,172 - app - INFO - Creating database tables...
2025-05-24 19:58:33,188 - app - INFO - Database tables created successfully
2025-05-24 19:58:33,208 - app - INFO - Creating database tables...
2025-05-24 19:58:33,224 - app - INFO - Database tables created successfully
2025-05-24 19:58:34,058 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:58:34,058 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:58:34,058 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:58:34,058 - routes - INFO - AI Settings initialized successfully
2025-05-24 19:58:42,187 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 19:58:42,188 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 19:58:42,189 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpiaprubtw.pdf
2025-05-24 19:58:42,418 - ocr_utils - INFO - Successfully converted PDF to JPEG image using pdf2image
2025-05-24 19:58:42,419 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 19:58:42,420 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 19:58:52,949 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 19:58:52,950 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 19:58:52,952 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-05-17",\n  "total_amount": null,\n  "subtotal": null,\n  "tax_amount": null,\n  "tip_amount": null,\n  "fees": null,\n  "receipt_number": null,\n  "payment_method": null,\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "ticket_confirmation",\n  "description": "Great Blue Heron Music Festival 2025 ticket confirmation",\n  "line_items": [],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 pm",\n    "venue_location": "2361 Waits Corners Rd, Sherman 14781, United States",\n    "seat_info": null,\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": null,\n    "business_phone": null,\n    "business_email": "express@eventeny.com",\n    "business_website": null,\n    "business_hours": null,\n    "business_type": null\n  },\n  "overall_confidence": 0.9,\n  "image_quality": "good",\n  "missing_information": [\n    "total_amount",\n    "subtotal",\n    "tax_amount",\n    "tip_amount",\n    "fees",\n    "receipt_number",\n    "payment_method"\n  ],\n  "extraction_notes": "This is a ticket confirmation email, not a traditional receipt."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 10.495326280593872, 'timestamp': '2025-05-24T19:58:52.948471', 'tokens_used': 2756, 'cost_estimate': 0.017750000000000002}
2025-05-24 19:58:52,975 - routes - INFO - Receipt queued for review: Task ID 69
2025-05-24 19:58:52,986 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 19:58:56,345 - routes - INFO - AI Analysis Structure for Task 69: {
  "content": {
    "response": "```json\n{\n  \"vendor_name\": \"Eventeny\",\n  \"date\": \"2025-05-17\",\n  \"total_amount\": null,\n  \"subtotal\": null,\n  \"tax_amount\": null,\n  \"tip_amount\": null,\n  \"fees\": null,\n  \"receipt_number\": null,\n  \"payment_method\": null,\n  \"due_date\": null,\n  \"is_bill\": false,\n  \"document_type\": \"ticket_confirmation\",\n  \"description\": \"Great Blue Heron Music Festival 2025 ticket confirmation\",\n  \"line_items\": [],\n  \"people_found\": [],\n  \"digital_assets\": {\n    \"qr_codes\": [],\n    \"barcodes\": [],\n    \"urls\": [],\n    \"confirmation_codes\": [\n      \"TDSLVDVJ\"\n    ],\n    \"ticket_numbers\": [],\n    \"account_numbers\": []\n  },\n  \"event_details\": {\n    \"event_name\": \"Great Blue Heron Music Festival 2025\",\n    \"event_date\": \"2025-07-03\",\n    \"event_time\": \"1:00 pm\",\n    \"venue_location\": \"2361 Waits Corners Rd, Sherman 14781, United States\",\n    \"seat_info\": null,\n    \"additional_details\": {}\n  },\n  \"vendor_details\": {\n    \"business_address\": null,\n    \"business_phone\": null,\n    \"business_email\": \"express@eventeny.com\",\n    \"business_website\": null,\n    \"business_hours\": null,\n    \"business_type\": null\n  },\n  \"overall_confidence\": 0.9,\n  \"image_quality\": \"good\",\n  \"missing_information\": [\n    \"total_amount\",\n    \"subtotal\",\n    \"tax_amount\",\n    \"tip_amount\",\n    \"fees\",\n    \"receipt_number\",\n    \"payment_method\"\n  ],\n  \"extraction_notes\": \"This is a ticket confirmation email, not a traditional receipt.\"\n}\n```"
  },
  "provider": "openai",
  "timestamp": "2025-05-24T19:58:52.948471",
  "confidence": null,
  "prompt_type": "unknown",
  "tokens_used": 2756,
  "cost_estimate": 0.017750000000000002,
  "processing_time": 10.495326280593872
}
2025-05-24 19:58:56,346 - routes - INFO - Extracted Receipt Data for Task 69: {
  "vendor_name": "Eventeny",
  "date": "2025-05-17",
  "total_amount": null,
  "subtotal": null,
  "tax_amount": null,
  "tip_amount": null,
  "fees": null,
  "receipt_number": null,
  "payment_method": null,
  "due_date": null,
  "is_bill": false,
  "document_type": "ticket_confirmation",
  "description": "Great Blue Heron Music Festival 2025 ticket confirmation",
  "line_items": [],
  "people_found": [],
  "digital_assets": {
    "qr_codes": [],
    "barcodes": [],
    "urls": [],
    "confirmation_codes": [
      "TDSLVDVJ"
    ],
    "ticket_numbers": [],
    "account_numbers": []
  },
  "event_details": {
    "event_name": "Great Blue Heron Music Festival 2025",
    "event_date": "2025-07-03",
    "event_time": "1:00 pm",
    "venue_location": "2361 Waits Corners Rd, Sherman 14781, United States",
    "seat_info": null,
    "additional_details": {}
  },
  "vendor_details": {
    "business_address": null,
    "business_phone": null,
    "business_email": "express@eventeny.com",
    "business_website": null,
    "business_hours": null,
    "business_type": null
  },
  "overall_confidence": 0.9,
  "image_quality": "good",
  "missing_information": [
    "total_amount",
    "subtotal",
    "tax_amount",
    "tip_amount",
    "fees",
    "receipt_number",
    "payment_method"
  ],
  "extraction_notes": "This is a ticket confirmation email, not a traditional receipt."
}
2025-05-24 19:59:29,015 - routes - ERROR - Error approving receipt: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "/app/routes.py", line 856, in approve_receipt
    total_amount = float(receipt_data.get('total_amount', 0))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-05-24 19:59:29,026 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 19:59:34,791 - routes - ERROR - Error approving receipt: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "/app/routes.py", line 856, in approve_receipt
    total_amount = float(receipt_data.get('total_amount', 0))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-05-24 19:59:34,802 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 20:00:05,186 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 20:00:35,554 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 20:01:05,922 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 20:01:36,290 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 20:02:06,544 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 20:02:34,533 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 20:03:04,893 - routes - INFO - AI Queue: 2 receipt tasks, 0 object evaluations
2025-05-24 20:03:23,070 - routes - INFO - Receipt rejected: Task 69, Reason: 
2025-05-24 20:03:23,076 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 20:03:25,217 - routes - INFO - Receipt rejected: Task 68, Reason: 
2025-05-24 20:03:25,224 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:03:55,592 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:04:32,399 - app - INFO - Creating database tables...
2025-05-24 20:04:32,404 - app - INFO - Creating database tables...
2025-05-24 20:04:32,404 - app - INFO - Creating database tables...
2025-05-24 20:04:32,435 - app - INFO - Database tables created successfully
2025-05-24 20:04:32,434 - app - INFO - Database tables created successfully
2025-05-24 20:04:32,434 - app - INFO - Database tables created successfully
2025-05-24 20:04:32,445 - app - INFO - Creating database tables...
2025-05-24 20:04:32,461 - app - INFO - Database tables created successfully
2025-05-24 20:04:33,340 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:04:33,340 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:04:33,340 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:04:33,345 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:04:33,353 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:04:42,089 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 20:04:42,089 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 20:04:42,090 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmphsfkc18z.pdf
2025-05-24 20:04:42,091 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 20:04:42,539 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 20:04:42,540 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 20:04:42,617 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 20:04:42,653 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 20:04:42,654 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 20:04:42,655 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 20:04:52,649 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 20:04:52,650 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 20:04:52,651 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Great Blue Heron Music Festival 2025 Ticket Purchase",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "category": "event",\n      "object_type": "service",\n      "confidence": 0.95\n    }\n  ],\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Processed from an email receipt for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 9.953361511230469, 'timestamp': '2025-05-24T20:04:52.647566', 'tokens_used': 3268, 'cost_estimate': 0.01863}
2025-05-24 20:04:52,671 - routes - INFO - Receipt queued for review: Task ID 70
2025-05-24 20:04:52,681 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 20:04:54,462 - routes - INFO - AI Analysis Structure for Task 70: {
  "content": {
    "response": "```json\n{\n  \"vendor_name\": \"Eventeny\",\n  \"date\": \"2025-03-17\",\n  \"total_amount\": 257.61,\n  \"subtotal\": 215.00,\n  \"tax_amount\": 0.00,\n  \"fees\": 41.61,\n  \"receipt_number\": \"TDSLVDVJ\",\n  \"is_bill\": false,\n  \"document_type\": \"receipt\",\n  \"description\": \"Great Blue Heron Music Festival 2025 Ticket Purchase\",\n  \"line_items\": [\n    {\n      \"description\": \"Weekend Pass Thursday Entry\",\n      \"quantity\": 1.0,\n      \"unit_price\": 215.00,\n      \"total_price\": 215.00,\n      \"category\": \"event\",\n      \"object_type\": \"service\",\n      \"confidence\": 0.95\n    }\n  ],\n  \"overall_confidence\": 0.95,\n  \"image_quality\": \"good\",\n  \"missing_information\": [],\n  \"extraction_notes\": \"Processed from an email receipt for a music festival ticket purchase.\"\n}\n```"
  },
  "provider": "openai",
  "timestamp": "2025-05-24T20:04:52.647566",
  "confidence": null,
  "prompt_type": "unknown",
  "tokens_used": 3268,
  "cost_estimate": 0.01863,
  "processing_time": 9.953361511230469
}
2025-05-24 20:04:54,463 - routes - INFO - Extracted Receipt Data for Task 70: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.0,
  "tax_amount": 0.0,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "is_bill": false,
  "document_type": "receipt",
  "description": "Great Blue Heron Music Festival 2025 Ticket Purchase",
  "line_items": [
    {
      "description": "Weekend Pass Thursday Entry",
      "quantity": 1.0,
      "unit_price": 215.0,
      "total_price": 215.0,
      "category": "event",
      "object_type": "service",
      "confidence": 0.95
    }
  ],
  "overall_confidence": 0.95,
  "image_quality": "good",
  "missing_information": [],
  "extraction_notes": "Processed from an email receipt for a music festival ticket purchase."
}
2025-05-24 20:05:25,597 - routes - INFO - Approving receipt: Eventeny, $257.61, 1 line items, confidence: 0.95
2025-05-24 20:05:25,605 - routes - INFO - Created new vendor: Eventeny with enhanced details
2025-05-24 20:05:25,616 - routes - INFO - Receipt approved and processed: Invoice #INV-20250524-7AEECBED created, 1 line items
2025-05-24 20:05:25,622 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:09:09,139 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:11:40,870 - app - INFO - Creating database tables...
2025-05-24 20:11:40,878 - app - INFO - Database tables created successfully
2025-05-24 20:14:54,269 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 20:14:54,270 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 20:14:54,272 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpvbvu911k.pdf
2025-05-24 20:14:54,273 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 20:14:54,694 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 20:14:54,695 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 20:14:54,769 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 20:14:54,806 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 20:14:54,808 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 20:14:54,808 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 20:15:10,896 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 20:15:10,897 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 20:15:10,898 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Entry on 1:00 pm",\n      "create_object": false,\n      "object_type": "service",\n      "category": "event",\n      "expiration_info": {\n        "expiration_date": "2025-07-08",\n        "event_date": "2025-07-03",\n        "shelf_life_days": 5\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": ""\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": [],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "",\n    "business_phone": "",\n    "business_email": "express@eventeny.com",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": "event management"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Extracted from email receipt for event ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 16.050493717193604, 'timestamp': '2025-05-24T20:15:10.895039', 'tokens_used': 3572, 'cost_estimate': 0.023190000000000002}
2025-05-24 20:15:10,910 - routes - INFO - Receipt queued for review: Task ID 71
2025-05-24 20:15:10,918 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 20:15:20,486 - routes - INFO - AI Analysis Structure for Task 71: {
  "content": {
    "response": "```json\n{\n  \"vendor_name\": \"Eventeny\",\n  \"date\": \"2025-03-17\",\n  \"total_amount\": 257.61,\n  \"subtotal\": 215.00,\n  \"tax_amount\": 0.00,\n  \"tip_amount\": 0.00,\n  \"fees\": 41.61,\n  \"receipt_number\": \"TDSLVDVJ\",\n  \"payment_method\": \"Not specified\",\n  \"due_date\": null,\n  \"is_bill\": false,\n  \"document_type\": \"receipt\",\n  \"description\": \"Ticket purchase for Great Blue Heron Music Festival 2025\",\n  \"line_items\": [\n    {\n      \"description\": \"Weekend Pass Thursday Entry\",\n      \"quantity\": 1.0,\n      \"unit_price\": 215.00,\n      \"total_price\": 215.00,\n      \"item_details\": \"Entry on 1:00 pm\",\n      \"create_object\": false,\n      \"object_type\": \"service\",\n      \"category\": \"event\",\n      \"expiration_info\": {\n        \"expiration_date\": \"2025-07-08\",\n        \"event_date\": \"2025-07-03\",\n        \"shelf_life_days\": 5\n      },\n      \"object_details\": {\n        \"serial_numbers\": [],\n        \"specifications\": {},\n        \"warranty_info\": \"\"\n      },\n      \"confidence\": 0.95\n    }\n  ],\n  \"people_found\": [],\n  \"digital_assets\": {\n    \"qr_codes\": [],\n    \"barcodes\": [],\n    \"urls\": [],\n    \"confirmation_codes\": [],\n    \"ticket_numbers\": [],\n    \"account_numbers\": []\n  },\n  \"event_details\": {\n    \"event_name\": \"Great Blue Heron Music Festival 2025\",\n    \"event_date\": \"2025-07-03\",\n    \"event_time\": \"13:00\",\n    \"venue_location\": \"2361 Waits Corners Rd, Sherman, NY 14781, United States\",\n    \"seat_info\": \"\",\n    \"additional_details\": {}\n  },\n  \"vendor_details\": {\n    \"business_address\": \"\",\n    \"business_phone\": \"\",\n    \"business_email\": \"express@eventeny.com\",\n    \"business_website\": \"\",\n    \"business_hours\": \"\",\n    \"business_type\": \"event management\"\n  },\n  \"overall_confidence\": 0.95,\n  \"image_quality\": \"good\",\n  \"missing_information\": [],\n  \"extraction_notes\": \"Extracted from email receipt for event ticket purchase.\"\n}\n```"
  },
  "provider": "openai",
  "timestamp": "2025-05-24T20:15:10.895039",
  "confidence": null,
  "prompt_type": "unknown",
  "tokens_used": 3572,
  "cost_estimate": 0.023190000000000002,
  "processing_time": 16.050493717193604
}
2025-05-24 20:15:20,487 - routes - INFO - Extracted Receipt Data for Task 71: {
  "vendor_name": "Eventeny",
  "date": "2025-03-17",
  "total_amount": 257.61,
  "subtotal": 215.0,
  "tax_amount": 0.0,
  "tip_amount": 0.0,
  "fees": 41.61,
  "receipt_number": "TDSLVDVJ",
  "payment_method": "Not specified",
  "due_date": null,
  "is_bill": false,
  "document_type": "receipt",
  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",
  "line_items": [
    {
      "description": "Weekend Pass Thursday Entry",
      "quantity": 1.0,
      "unit_price": 215.0,
      "total_price": 215.0,
      "item_details": "Entry on 1:00 pm",
      "create_object": false,
      "object_type": "service",
      "category": "event",
      "expiration_info": {
        "expiration_date": "2025-07-08",
        "event_date": "2025-07-03",
        "shelf_life_days": 5
      },
      "object_details": {
        "serial_numbers": [],
        "specifications": {},
        "warranty_info": ""
      },
      "confidence": 0.95
    }
  ],
  "people_found": [],
  "digital_assets": {
    "qr_codes": [],
    "barcodes": [],
    "urls": [],
    "confirmation_codes": [],
    "ticket_numbers": [],
    "account_numbers": []
  },
  "event_details": {
    "event_name": "Great Blue Heron Music Festival 2025",
    "event_date": "2025-07-03",
    "event_time": "13:00",
    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",
    "seat_info": "",
    "additional_details": {}
  },
  "vendor_details": {
    "business_address": "",
    "business_phone": "",
    "business_email": "express@eventeny.com",
    "business_website": "",
    "business_hours": "",
    "business_type": "event management"
  },
  "overall_confidence": 0.95,
  "image_quality": "good",
  "missing_information": [],
  "extraction_notes": "Extracted from email receipt for event ticket purchase."
}
2025-05-24 20:15:30,251 - routes - INFO - Approving receipt: Eventeny, $257.61, 1 line items, confidence: 0.95
2025-05-24 20:15:30,259 - routes - INFO - Receipt approved and processed: Invoice #INV-20250524-7FFF80DA created, 1 line items
2025-05-24 20:15:30,267 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:17:09,795 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:17:15,243 - routes - INFO - Processing receipt file: RECEIPT PAePay DUI Fine Nate Smith.pdf
2025-05-24 20:17:15,244 - routes - INFO - Processing PDF file: RECEIPT_PAePay_DUI_Fine_Nate_Smith.pdf
2025-05-24 20:17:15,246 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp725a_rnv.pdf
2025-05-24 20:17:15,246 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 20:17:15,481 - ocr_utils - INFO - Successfully converted 1 pages from PDF
2025-05-24 20:17:15,511 - ocr_utils - INFO - Successfully converted PDF (1 pages) to JPEG image using pdf2image
2025-05-24 20:17:15,512 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 20:17:15,513 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 20:17:29,877 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 20:17:29,878 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 20:17:29,879 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "PAePay",\n  "date": "2025-05-20",\n  "total_amount": 267.15,\n  "subtotal": 260.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 7.15,\n  "receipt_number": "01XF693J7H",\n  "payment_method": "unknown",\n  "due_date": "2025-05-24",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Traffic Ticket or Court Costs Payment",\n  "line_items": [\n    {\n      "description": "Payment Plan 67-2018-P000007328",\n      "quantity": 1.0,\n      "unit_price": 260.00,\n      "total_price": 260.00,\n      "item_details": "Next payment amount due: $65.00, Overdue amount: $195.00",\n      "create_object": false,\n      "object_type": "service",\n      "category": "legal",\n      "expiration_info": {\n        "expiration_date": "2025-05-24",\n        "event_date": "2025-05-24",\n        "shelf_life_days": 4\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": ""\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://ujsportal.pacourts.us/PAePayFCR/Receipt?shoppingCartID=814535c8-114d-4020-dad0-08dd94ab10d0"\n    ],\n    "confirmation_codes": [\n      "01XF693J7H"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {},\n  "vendor_details": {\n    "business_address": "",\n    "business_phone": "",\n    "business_email": "",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": "government"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt for a traffic ticket or court costs payment."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 14.31165623664856, 'timestamp': '2025-05-24T20:17:29.876334', 'tokens_used': 2886, 'cost_estimate': 0.019700000000000002}
2025-05-24 20:17:29,887 - routes - INFO - Receipt queued for review: Task ID 72
2025-05-24 20:17:29,895 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 20:18:00,372 - routes - INFO - AI Queue: 1 receipt tasks, 0 object evaluations
2025-05-24 20:18:10,604 - routes - INFO - AI Analysis Structure for Task 72: {
  "content": {
    "response": "```json\n{\n  \"vendor_name\": \"PAePay\",\n  \"date\": \"2025-05-20\",\n  \"total_amount\": 267.15,\n  \"subtotal\": 260.00,\n  \"tax_amount\": 0.00,\n  \"tip_amount\": 0.00,\n  \"fees\": 7.15,\n  \"receipt_number\": \"01XF693J7H\",\n  \"payment_method\": \"unknown\",\n  \"due_date\": \"2025-05-24\",\n  \"is_bill\": false,\n  \"document_type\": \"receipt\",\n  \"description\": \"Traffic Ticket or Court Costs Payment\",\n  \"line_items\": [\n    {\n      \"description\": \"Payment Plan 67-2018-P000007328\",\n      \"quantity\": 1.0,\n      \"unit_price\": 260.00,\n      \"total_price\": 260.00,\n      \"item_details\": \"Next payment amount due: $65.00, Overdue amount: $195.00\",\n      \"create_object\": false,\n      \"object_type\": \"service\",\n      \"category\": \"legal\",\n      \"expiration_info\": {\n        \"expiration_date\": \"2025-05-24\",\n        \"event_date\": \"2025-05-24\",\n        \"shelf_life_days\": 4\n      },\n      \"object_details\": {\n        \"serial_numbers\": [],\n        \"specifications\": {},\n        \"warranty_info\": \"\"\n      },\n      \"confidence\": 0.95\n    }\n  ],\n  \"people_found\": [],\n  \"digital_assets\": {\n    \"qr_codes\": [],\n    \"barcodes\": [],\n    \"urls\": [\n      \"https://ujsportal.pacourts.us/PAePayFCR/Receipt?shoppingCartID=814535c8-114d-4020-dad0-08dd94ab10d0\"\n    ],\n    \"confirmation_codes\": [\n      \"01XF693J7H\"\n    ],\n    \"ticket_numbers\": [],\n    \"account_numbers\": []\n  },\n  \"event_details\": {},\n  \"vendor_details\": {\n    \"business_address\": \"\",\n    \"business_phone\": \"\",\n    \"business_email\": \"\",\n    \"business_website\": \"\",\n    \"business_hours\": \"\",\n    \"business_type\": \"government\"\n  },\n  \"overall_confidence\": 0.95,\n  \"image_quality\": \"good\",\n  \"missing_information\": [],\n  \"extraction_notes\": \"Receipt for a traffic ticket or court costs payment.\"\n}\n```"
  },
  "provider": "openai",
  "timestamp": "2025-05-24T20:17:29.876334",
  "confidence": null,
  "prompt_type": "unknown",
  "tokens_used": 2886,
  "cost_estimate": 0.019700000000000002,
  "processing_time": 14.31165623664856
}
2025-05-24 20:18:10,605 - routes - INFO - Extracted Receipt Data for Task 72: {
  "vendor_name": "PAePay",
  "date": "2025-05-20",
  "total_amount": 267.15,
  "subtotal": 260.0,
  "tax_amount": 0.0,
  "tip_amount": 0.0,
  "fees": 7.15,
  "receipt_number": "01XF693J7H",
  "payment_method": "unknown",
  "due_date": "2025-05-24",
  "is_bill": false,
  "document_type": "receipt",
  "description": "Traffic Ticket or Court Costs Payment",
  "line_items": [
    {
      "description": "Payment Plan 67-2018-P000007328",
      "quantity": 1.0,
      "unit_price": 260.0,
      "total_price": 260.0,
      "item_details": "Next payment amount due: $65.00, Overdue amount: $195.00",
      "create_object": false,
      "object_type": "service",
      "category": "legal",
      "expiration_info": {
        "expiration_date": "2025-05-24",
        "event_date": "2025-05-24",
        "shelf_life_days": 4
      },
      "object_details": {
        "serial_numbers": [],
        "specifications": {},
        "warranty_info": ""
      },
      "confidence": 0.95
    }
  ],
  "people_found": [],
  "digital_assets": {
    "qr_codes": [],
    "barcodes": [],
    "urls": [
      "https://ujsportal.pacourts.us/PAePayFCR/Receipt?shoppingCartID=814535c8-114d-4020-dad0-08dd94ab10d0"
    ],
    "confirmation_codes": [
      "01XF693J7H"
    ],
    "ticket_numbers": [],
    "account_numbers": []
  },
  "event_details": {},
  "vendor_details": {
    "business_address": "",
    "business_phone": "",
    "business_email": "",
    "business_website": "",
    "business_hours": "",
    "business_type": "government"
  },
  "overall_confidence": 0.95,
  "image_quality": "good",
  "missing_information": [],
  "extraction_notes": "Receipt for a traffic ticket or court costs payment."
}
2025-05-24 20:18:27,857 - routes - INFO - Approving receipt: PAePay, $267.15, 1 line items, confidence: 0.95
2025-05-24 20:18:27,860 - routes - INFO - Created new vendor: PAePay with enhanced details
2025-05-24 20:18:27,861 - routes - INFO - Captured digital assets: 0 QR codes, 1 URLs, etc.
2025-05-24 20:18:27,866 - routes - INFO - Receipt approved and processed: Invoice #INV-20250524-B0546549 created, 1 line items, digital assets captured
2025-05-24 20:18:27,871 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:18:31,941 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:18:31,589 - routes - INFO - AI Queue: 0 receipt tasks, 0 object evaluations
2025-05-24 20:25:38,910 - app - INFO - Creating database tables...
2025-05-24 20:25:38,911 - app - INFO - Creating database tables...
2025-05-24 20:25:38,946 - app - INFO - Database tables created successfully
2025-05-24 20:25:38,946 - app - INFO - Database tables created successfully
2025-05-24 20:25:38,967 - app - INFO - Creating database tables...
2025-05-24 20:25:38,987 - app - INFO - Database tables created successfully
2025-05-24 20:25:39,087 - app - INFO - Creating database tables...
2025-05-24 20:25:39,105 - app - INFO - Database tables created successfully
2025-05-24 20:25:39,885 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:25:39,885 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:25:39,885 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:25:39,891 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:25:46,858 - routes - ERROR - Error loading bills: (psycopg2.errors.SyntaxError) syntax error at or near "json_extract"
LINE 3: WHERE invoices.is_paid = false OR (invoices.data json_extrac...
                                                         ^

[SQL: SELECT invoices.id AS invoices_id, invoices.invoice_number AS invoices_invoice_number, invoices.vendor_id AS invoices_vendor_id, invoices.created_at AS invoices_created_at, invoices.updated_at AS invoices_updated_at, invoices.is_paid AS invoices_is_paid, invoices.data AS invoices_data 
FROM invoices 
WHERE invoices.is_paid = false OR (invoices.data json_extract %(data_1)s) IS NOT NULL ORDER BY invoices.created_at DESC]
[parameters: {'data_1': '$.due_date'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 20:25:54,746 - routes - INFO - Deleting receipt INV-20250524-7FFF80DA: 1 line items, 0 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-24 20:25:54,753 - routes - ERROR - Error deleting receipt: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ..."business_address": "", "business_website": ""}}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "status": "approved", "vendor": "Eventeny", "is_bill": false, "due_date": null, "subtotal": 215.0, "tax_amount" ... (573 characters truncated) ... t management", "business_email": "express@eventeny.com", "business_hours": "", "business_phone": "", "business_address": "", "business_website": ""}}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.AmbiguousFunction: operator is not unique: unknown ->> unknown
LINE 3: ..."business_address": "", "business_website": ""}}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 966, in delete_receipt
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 442, in execute
    postsort_actions = self._generate_actions()
                       ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 400, in _generate_actions
    if action.execute(self):
       ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 540, in execute
    self.dependency_processor.prop_has_changes(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/dependency.py", line 254, in prop_has_changes
    history = uowcommit.get_attribute_history(s, self.key, passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 283, in get_attribute_history
    history = impl.get_history(
              ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1366, in get_history
    current = self.get(state, dict_, passive=passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ..."business_address": "", "business_website": ""}}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "status": "approved", "vendor": "Eventeny", "is_bill": false, "due_date": null, "subtotal": 215.0, "tax_amount" ... (573 characters truncated) ... t management", "business_email": "express@eventeny.com", "business_hours": "", "business_phone": "", "business_address": "", "business_website": ""}}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 20:31:10,724 - app - INFO - Creating database tables...
2025-05-24 20:31:10,724 - app - INFO - Creating database tables...
2025-05-24 20:31:10,727 - app - INFO - Creating database tables...
2025-05-24 20:31:10,728 - app - INFO - Creating database tables...
2025-05-24 20:31:10,760 - app - INFO - Database tables created successfully
2025-05-24 20:31:10,760 - app - INFO - Database tables created successfully
2025-05-24 20:31:10,760 - app - INFO - Database tables created successfully
2025-05-24 20:31:10,760 - app - INFO - Database tables created successfully
2025-05-24 20:31:11,678 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:31:11,678 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:31:11,678 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:31:11,686 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:36:07,769 - app - INFO - Creating database tables...
2025-05-24 20:36:07,770 - app - INFO - Creating database tables...
2025-05-24 20:36:07,770 - app - INFO - Creating database tables...
2025-05-24 20:36:07,788 - app - INFO - Database tables created successfully
2025-05-24 20:36:07,788 - app - INFO - Database tables created successfully
2025-05-24 20:36:07,788 - app - INFO - Database tables created successfully
2025-05-24 20:36:07,845 - app - INFO - Creating database tables...
2025-05-24 20:36:07,862 - app - INFO - Database tables created successfully
2025-05-24 20:36:08,732 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:36:08,732 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:36:08,737 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:36:08,739 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:36:19,558 - routes - ERROR - Error loading bills: (psycopg2.errors.SyntaxError) syntax error at or near "json_extract"
LINE 3: WHERE invoices.is_paid = false OR (invoices.data json_extrac...
                                                         ^

[SQL: SELECT invoices.id AS invoices_id, invoices.invoice_number AS invoices_invoice_number, invoices.vendor_id AS invoices_vendor_id, invoices.created_at AS invoices_created_at, invoices.updated_at AS invoices_updated_at, invoices.is_paid AS invoices_is_paid, invoices.data AS invoices_data 
FROM invoices 
WHERE invoices.is_paid = false OR (invoices.data json_extract %(data_1)s) IS NOT NULL ORDER BY invoices.created_at DESC]
[parameters: {'data_1': '$.due_date'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 20:36:28,499 - routes - INFO - Deleting receipt INV-20250524-7FFF80DA: 1 line items, 0 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-24 20:36:28,507 - routes - ERROR - Error deleting receipt: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ..."business_address": "", "business_website": ""}}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "status": "approved", "vendor": "Eventeny", "is_bill": false, "due_date": null, "subtotal": 215.0, "tax_amount" ... (573 characters truncated) ... t management", "business_email": "express@eventeny.com", "business_hours": "", "business_phone": "", "business_address": "", "business_website": ""}}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.AmbiguousFunction: operator is not unique: unknown ->> unknown
LINE 3: ..."business_address": "", "business_website": ""}}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1069, in delete_receipt
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 442, in execute
    postsort_actions = self._generate_actions()
                       ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 400, in _generate_actions
    if action.execute(self):
       ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 540, in execute
    self.dependency_processor.prop_has_changes(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/dependency.py", line 254, in prop_has_changes
    history = uowcommit.get_attribute_history(s, self.key, passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 283, in get_attribute_history
    history = impl.get_history(
              ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1366, in get_history
    current = self.get(state, dict_, passive=passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ..."business_address": "", "business_website": ""}}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "status": "approved", "vendor": "Eventeny", "is_bill": false, "due_date": null, "subtotal": 215.0, "tax_amount" ... (573 characters truncated) ... t management", "business_email": "express@eventeny.com", "business_hours": "", "business_phone": "", "business_address": "", "business_website": ""}}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 20:37:58,527 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 20:37:58,528 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 20:37:58,531 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmps_3z92g1.pdf
2025-05-24 20:37:58,531 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 20:37:59,015 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 20:37:59,016 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 20:37:59,101 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 20:37:59,143 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 20:37:59,144 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 20:37:59,145 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 20:38:12,479 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 20:38:12,481 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 20:38:12,482 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Entry on 1:00 pm",\n      "create_object": false,\n      "object_type": "service",\n      "category": "event",\n      "expiration_info": {\n        "expiration_date": "2025-07-08",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [\n    {\n      "create_person_object": false,\n      "person_name": "Nate Smith",\n      "role": "Attendee",\n      "relationship_to_purchase": "Purchaser",\n      "contact_info": {},\n      "confidence": 0.9\n    }\n  ],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://www.eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": null,\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "business_phone": null,\n    "business_email": "express@eventeny.com",\n    "business_website": "https://www.eventeny.com",\n    "business_hours": null,\n    "business_type": "Event Management"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "Good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from email confirmation for event ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 13.285435438156128, 'timestamp': '2025-05-24T20:38:12.478467', 'tokens_used': 3677, 'cost_estimate': 0.024765000000000002}
2025-05-24 20:38:12,510 - routes - INFO - Receipt queued for review: Task ID 73
2025-05-24 20:38:28,462 - routes - ERROR - Error loading bills: (psycopg2.errors.SyntaxError) syntax error at or near "json_extract"
LINE 3: WHERE invoices.is_paid = false OR (invoices.data json_extrac...
                                                         ^

[SQL: SELECT invoices.id AS invoices_id, invoices.invoice_number AS invoices_invoice_number, invoices.vendor_id AS invoices_vendor_id, invoices.created_at AS invoices_created_at, invoices.updated_at AS invoices_updated_at, invoices.is_paid AS invoices_is_paid, invoices.data AS invoices_data 
FROM invoices 
WHERE invoices.is_paid = false OR (invoices.data json_extract %(data_1)s) IS NOT NULL ORDER BY invoices.created_at DESC]
[parameters: {'data_1': '$.due_date'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 20:40:20,345 - app - INFO - Creating database tables...
2025-05-24 20:40:20,346 - app - INFO - Creating database tables...
2025-05-24 20:40:20,348 - app - INFO - Creating database tables...
2025-05-24 20:40:20,353 - app - INFO - Creating database tables...
2025-05-24 20:40:20,483 - app - INFO - Database tables created successfully
2025-05-24 20:40:20,483 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(vendors_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 20:40:20,483 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(vendors_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 20:40:20,483 - app - ERROR - Error creating database tables: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "pg_class_relname_nsp_index"
DETAIL:  Key (relname, relnamespace)=(vendors_id_seq, 2200) already exists.

[SQL: 
CREATE TABLE vendors (
	id SERIAL NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	contact_info JSONB, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	updated_at TIMESTAMP WITHOUT TIME ZONE, 
	needs_approval BOOLEAN, 
	approved_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 20:40:21,484 - routes - INFO - AI Settings initialized successfully
2025-05-24 20:40:21,484 - routes - ERROR - Error initializing AI settings: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ai_settings_provider_key"
DETAIL:  Key (provider)=(anthropic) already exists.

[SQL: INSERT INTO ai_settings (provider, is_enabled, is_default, api_key, api_endpoint, config, created_at, updated_at) VALUES (%(provider)s, %(is_enabled)s, %(is_default)s, %(api_key)s, %(api_endpoint)s, %(config)s, %(created_at)s, %(updated_at)s) RETURNING ai_settings.id]
[parameters: {'provider': 'anthropic', 'is_enabled': True, 'is_default': True, 'api_key': None, 'api_endpoint': None, 'config': '{"default_model": "claude-3-5-sonnet-20241022", "vision_model": "claude-3-opus-20240229", "timeout": 180}', 'created_at': datetime.datetime(2025, 5, 24, 20, 40, 21, 483231), 'updated_at': datetime.datetime(2025, 5, 24, 20, 40, 21, 483234)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 20:40:21,484 - routes - ERROR - Error initializing AI settings: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ai_settings_provider_key"
DETAIL:  Key (provider)=(anthropic) already exists.

[SQL: INSERT INTO ai_settings (provider, is_enabled, is_default, api_key, api_endpoint, config, created_at, updated_at) VALUES (%(provider)s, %(is_enabled)s, %(is_default)s, %(api_key)s, %(api_endpoint)s, %(config)s, %(created_at)s, %(updated_at)s) RETURNING ai_settings.id]
[parameters: {'provider': 'anthropic', 'is_enabled': True, 'is_default': True, 'api_key': None, 'api_endpoint': None, 'config': '{"default_model": "claude-3-5-sonnet-20241022", "vision_model": "claude-3-opus-20240229", "timeout": 180}', 'created_at': datetime.datetime(2025, 5, 24, 20, 40, 21, 483594), 'updated_at': datetime.datetime(2025, 5, 24, 20, 40, 21, 483596)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 20:40:21,488 - routes - ERROR - Error initializing AI settings: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ai_settings_provider_key"
DETAIL:  Key (provider)=(anthropic) already exists.

[SQL: INSERT INTO ai_settings (provider, is_enabled, is_default, api_key, api_endpoint, config, created_at, updated_at) VALUES (%(provider)s, %(is_enabled)s, %(is_default)s, %(api_key)s, %(api_endpoint)s, %(config)s, %(created_at)s, %(updated_at)s) RETURNING ai_settings.id]
[parameters: {'provider': 'anthropic', 'is_enabled': True, 'is_default': True, 'api_key': None, 'api_endpoint': None, 'config': '{"default_model": "claude-3-5-sonnet-20241022", "vision_model": "claude-3-opus-20240229", "timeout": 180}', 'created_at': datetime.datetime(2025, 5, 24, 20, 40, 21, 487323), 'updated_at': datetime.datetime(2025, 5, 24, 20, 40, 21, 487325)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 20:40:48,249 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 20:40:48,250 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 20:40:48,251 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpsy01_uk3.pdf
2025-05-24 20:40:48,252 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 20:40:48,694 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 20:40:48,695 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 20:40:48,781 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 20:40:48,820 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 20:40:48,821 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 20:40:48,822 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 20:41:03,379 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 20:41:03,380 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 20:41:03,382 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Entry on 1:00 pm",\n      "create_object": false,\n      "object_type": "service",\n      "category": "event",\n      "expiration_info": {\n        "expiration_date": null,\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": ["TDSLVDVJ"],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 pm",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": null,\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": null,\n    "business_phone": null,\n    "business_email": "express@eventeny.com",\n    "business_website": null,\n    "business_hours": null,\n    "business_type": null\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from email confirmation for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 14.507539749145508, 'timestamp': '2025-05-24T20:41:03.377820', 'tokens_used': 3579, 'cost_estimate': 0.023295000000000003}
2025-05-24 20:41:03,400 - routes - INFO - Receipt queued for review: Task ID 1
2025-05-24 20:49:55,066 - routes - ERROR - Error loading approvals queue: approvals_queue.html
2025-05-24 20:49:55,088 - routes - ERROR - Error loading approvals queue: approvals_queue.html
2025-05-24 20:49:55,107 - routes - ERROR - Error loading approvals queue: approvals_queue.html
2025-05-24 20:49:53,544 - routes - ERROR - Error loading approvals queue: approvals_queue.html
2025-05-24 21:06:45,019 - app - INFO - Creating database tables...
2025-05-24 21:06:45,076 - app - INFO - Database tables created successfully
2025-05-24 21:06:45,081 - app - INFO - Creating database tables...
2025-05-24 21:06:45,098 - app - INFO - Database tables created successfully
2025-05-24 21:06:45,142 - app - INFO - Creating database tables...
2025-05-24 21:06:45,160 - app - INFO - Database tables created successfully
2025-05-24 21:06:45,185 - app - INFO - Creating database tables...
2025-05-24 21:06:45,202 - app - INFO - Database tables created successfully
2025-05-24 21:06:45,993 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:06:45,993 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:06:45,999 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:06:46,001 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:08:15,426 - app - INFO - Creating database tables...
2025-05-24 21:08:15,429 - app - INFO - Creating database tables...
2025-05-24 21:08:15,433 - app - INFO - Creating database tables...
2025-05-24 21:08:15,433 - app - INFO - Creating database tables...
2025-05-24 21:08:15,460 - app - INFO - Database tables created successfully
2025-05-24 21:08:15,460 - app - INFO - Database tables created successfully
2025-05-24 21:08:15,460 - app - INFO - Database tables created successfully
2025-05-24 21:08:15,461 - app - INFO - Database tables created successfully
2025-05-24 21:08:16,359 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:08:16,359 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:08:16,359 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:08:16,360 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:08:36,577 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 21:08:36,578 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 21:08:36,579 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpj8g0dxxc.pdf
2025-05-24 21:08:36,580 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 21:08:37,048 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 21:08:37,049 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 21:08:37,129 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 21:08:37,166 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 21:08:37,167 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 21:08:37,168 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 21:08:46,222 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 21:08:46,224 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 21:08:46,225 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "category": "event",\n      "object_type": "service",\n      "confidence": 1.0\n    }\n  ],\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Extracted from an email receipt for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 9.00408148765564, 'timestamp': '2025-05-24T21:08:46.220783', 'tokens_used': 3270, 'cost_estimate': 0.018660000000000003}
2025-05-24 21:08:46,247 - routes - INFO - Receipt queued for review: Task ID 2
2025-05-24 21:11:06,862 - app - INFO - Creating database tables...
2025-05-24 21:11:06,872 - app - INFO - Creating database tables...
2025-05-24 21:11:06,880 - app - INFO - Database tables created successfully
2025-05-24 21:11:06,888 - app - INFO - Database tables created successfully
2025-05-24 21:11:06,950 - app - INFO - Creating database tables...
2025-05-24 21:11:06,968 - app - INFO - Database tables created successfully
2025-05-24 21:11:06,997 - app - INFO - Creating database tables...
2025-05-24 21:11:07,017 - app - INFO - Database tables created successfully
2025-05-24 21:11:07,462 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:11:07,466 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:11:07,567 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:11:07,633 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:11:08,038 - routes - INFO - AI Queue loaded: 2 tasks (0 pending review, 0 failed)
2025-05-24 21:11:11,349 - routes - INFO - AI Queue loaded: 2 tasks (0 pending review, 0 failed)
2025-05-24 21:11:17,610 - routes - INFO - Processing receipt file: RECEIPT PAePay DUI Fine Nate Smith.pdf
2025-05-24 21:11:17,611 - routes - INFO - Processing PDF file: RECEIPT_PAePay_DUI_Fine_Nate_Smith.pdf
2025-05-24 21:11:17,612 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpyen42ez8.pdf
2025-05-24 21:11:17,613 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 21:11:17,695 - ocr_utils - INFO - Successfully converted 1 pages from PDF
2025-05-24 21:11:17,717 - ocr_utils - INFO - Successfully converted PDF (1 pages) to JPEG image using pdf2image
2025-05-24 21:11:17,718 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 21:11:17,719 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 21:11:29,173 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 21:11:29,174 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 21:11:29,176 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "PAePay",\n  "date": "2025-05-20",\n  "total_amount": 267.15,\n  "subtotal": 260.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 7.15,\n  "receipt_number": "01XF693J7H",\n  "payment_method": "unknown",\n  "due_date": "2025-05-24",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Traffic Ticket or Court Costs Payment",\n  "line_items": [\n    {\n      "description": "Payment Plan 67-2018-P000007328",\n      "quantity": 1.0,\n      "unit_price": 260.00,\n      "total_price": 260.00,\n      "item_details": "Next payment amount due: $65.00, Overdue amount: $195.00",\n      "create_object": false,\n      "object_type": "service",\n      "category": "legal",\n      "expiration_info": {\n        "expiration_date": "2025-05-24",\n        "event_date": "2025-05-24",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": ""\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://ujsportal.pacourts.us/PAePayFCR/Receipt?shoppingCartID=814535c8-114d-4020-dad0-08dd94ab10d0"\n    ],\n    "confirmation_codes": [\n      "01XF693J7H"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {},\n  "vendor_details": {},\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt for traffic ticket or court costs payment."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 11.419824838638306, 'timestamp': '2025-05-24T21:11:29.172045', 'tokens_used': 2843, 'cost_estimate': 0.019055}
2025-05-24 21:11:29,192 - routes - INFO - Receipt queued for review: Task ID 3
2025-05-24 21:11:29,199 - routes - INFO - AI Queue loaded: 3 tasks (0 pending review, 0 failed)
2025-05-24 21:11:59,698 - routes - INFO - AI Queue loaded: 3 tasks (0 pending review, 0 failed)
2025-05-24 21:12:30,235 - routes - INFO - AI Queue loaded: 3 tasks (0 pending review, 0 failed)
2025-05-24 21:12:56,887 - routes - INFO - AI Queue loaded: 3 tasks (0 pending review, 0 failed)
2025-05-24 21:12:57,633 - routes - INFO - AI Queue loaded: 3 tasks (0 pending review, 0 failed)
2025-05-24 21:13:14,189 - routes - INFO - Processing receipt file: RECEIPT PAePay DUI Fine Nate Smith.pdf
2025-05-24 21:13:14,190 - routes - INFO - Processing PDF file: RECEIPT_PAePay_DUI_Fine_Nate_Smith.pdf
2025-05-24 21:13:14,191 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpzpwbri0s.pdf
2025-05-24 21:13:14,192 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 21:13:14,269 - ocr_utils - INFO - Successfully converted 1 pages from PDF
2025-05-24 21:13:14,298 - ocr_utils - INFO - Successfully converted PDF (1 pages) to JPEG image using pdf2image
2025-05-24 21:13:14,299 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 21:13:14,300 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 21:13:28,722 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 21:13:28,723 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 21:13:28,725 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "PAePay Traffic Ticket or Court Costs",\n  "date": "2025-05-20",\n  "total_amount": 267.15,\n  "subtotal": 260.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 7.15,\n  "receipt_number": "01XF693J7H",\n  "payment_method": "unknown",\n  "due_date": "2025-05-24",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Payment for traffic ticket or court costs",\n  "line_items": [\n    {\n      "description": "Payment Plan 67-2018-P000007328",\n      "quantity": 1.0,\n      "unit_price": 260.00,\n      "total_price": 260.00,\n      "item_details": "Next payment amount due: $65.00, Overdue amount: $195.00",\n      "create_object": false,\n      "object_type": "service",\n      "category": "legal",\n      "expiration_info": {\n        "expiration_date": "2025-05-24",\n        "event_date": "2025-05-24",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": ""\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://ujsportal.pacourts.us/PAePayFCR/Receipt?shoppingCartID=814535c8-114d-4020-dad0-08dd94ab10d0"\n    ],\n    "confirmation_codes": [\n      "01XF693J7H"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "",\n    "event_date": "",\n    "event_time": "",\n    "venue_location": "",\n    "seat_info": "",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "",\n    "business_phone": "",\n    "business_email": "",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": "government"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt for payment of traffic ticket or court costs."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 14.398568153381348, 'timestamp': '2025-05-24T21:13:28.721878', 'tokens_used': 2929, 'cost_estimate': 0.020345}
2025-05-24 21:13:28,738 - routes - INFO - Receipt queued for review: Task ID 4
2025-05-24 21:13:28,744 - routes - INFO - AI Queue loaded: 4 tasks (0 pending review, 0 failed)
2025-05-24 21:13:59,106 - routes - INFO - AI Queue loaded: 4 tasks (0 pending review, 0 failed)
2025-05-24 21:14:26,757 - routes - INFO - AI Queue loaded: 4 tasks (0 pending review, 0 failed)
2025-05-24 21:14:54,035 - routes - INFO - AI Queue loaded: 4 tasks (0 pending review, 0 failed)
2025-05-24 21:15:27,695 - routes - INFO - AI Queue loaded: 4 tasks (0 pending review, 0 failed)
2025-05-24 21:15:34,841 - app - INFO - Creating database tables...
2025-05-24 21:15:34,859 - app - INFO - Database tables created successfully
2025-05-24 21:15:35,380 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:15:58,076 - routes - INFO - AI Queue loaded: 4 tasks (0 pending review, 0 failed)
2025-05-24 21:15:58,134 - app - INFO - Creating database tables...
2025-05-24 21:15:58,151 - app - INFO - Database tables created successfully
2025-05-24 21:15:58,674 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:16:28,493 - routes - INFO - AI Queue loaded: 4 tasks (0 pending review, 0 failed)
2025-05-24 21:16:31,192 - app - INFO - Creating database tables...
2025-05-24 21:16:31,209 - app - INFO - Database tables created successfully
2025-05-24 21:16:31,730 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:16:58,862 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:17:29,232 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:17:45,338 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:17:52,905 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:18:23,263 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:18:53,791 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:18:57,697 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:18:58,317 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:19:28,666 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:19:24,930 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:19:58,405 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:20:01,579 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:20:02,187 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:20:20,135 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 21:20:20,136 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 21:20:20,139 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpimn7_xbm.pdf
2025-05-24 21:20:20,140 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 21:20:20,577 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 21:20:20,578 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 21:20:20,662 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 21:20:20,699 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 21:20:20,700 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 21:20:20,701 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 21:20:36,107 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 21:20:36,108 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 21:20:36,109 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Great Blue Heron Music Festival 2025 ticket purchase",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Entry on 1:00 pm",\n      "create_object": false,\n      "object_type": "service",\n      "category": "event",\n      "expiration_info": {\n        "expiration_date": "2025-07-06",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": ""\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": ["TDSLVDVJ"],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 pm",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "",\n    "business_phone": "",\n    "business_email": "express@eventeny.com",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": ""\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from email confirmation for event ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 15.370657682418823, 'timestamp': '2025-05-24T21:20:36.105966', 'tokens_used': 3556, 'cost_estimate': 0.02295}
2025-05-24 21:20:36,124 - routes - INFO - Receipt queued for review: Task ID 6
2025-05-24 21:20:36,131 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:21:06,491 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:21:23,336 - app - INFO - Creating database tables...
2025-05-24 21:21:23,354 - app - INFO - Database tables created successfully
2025-05-24 21:21:24,193 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:21:36,861 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:21:54,626 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:22:25,050 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:22:55,506 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:22:59,765 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:23:00,486 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:23:09,300 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:23:39,462 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:23:44,785 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:24:04,850 - app - INFO - Creating database tables...
2025-05-24 21:24:04,858 - app - INFO - Creating database tables...
2025-05-24 21:24:04,868 - app - INFO - Database tables created successfully
2025-05-24 21:24:04,874 - app - INFO - Database tables created successfully
2025-05-24 21:24:04,911 - app - INFO - Creating database tables...
2025-05-24 21:24:04,927 - app - INFO - Database tables created successfully
2025-05-24 21:24:04,944 - app - INFO - Creating database tables...
2025-05-24 21:24:04,962 - app - INFO - Database tables created successfully
2025-05-24 21:24:05,411 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:24:05,420 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:24:05,468 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:24:05,471 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:24:08,539 - routes - INFO - DEBUG: Found 6 total tasks
2025-05-24 21:24:08,540 - routes - INFO - DEBUG: Processing task 6, type=receipt_processing, status=pending
2025-05-24 21:24:08,541 - routes - INFO - DEBUG: Task 6 has AI analysis
2025-05-24 21:24:08,541 - routes - INFO - DEBUG: Added task 6 to receipt_tasks, now has 1 items
2025-05-24 21:24:08,542 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:24:08,543 - routes - INFO - DEBUG: Processing task 4, type=receipt_processing, status=pending
2025-05-24 21:24:08,543 - routes - INFO - DEBUG: Task 4 has AI analysis
2025-05-24 21:24:08,544 - routes - INFO - DEBUG: Added task 4 to receipt_tasks, now has 2 items
2025-05-24 21:24:08,545 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending
2025-05-24 21:24:08,546 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-24 21:24:08,546 - routes - INFO - DEBUG: Added task 3 to receipt_tasks, now has 3 items
2025-05-24 21:24:08,547 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending
2025-05-24 21:24:08,548 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-24 21:24:08,549 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 4 items
2025-05-24 21:24:08,549 - routes - INFO - DEBUG: Processing task 1, type=receipt_processing, status=pending
2025-05-24 21:24:08,550 - routes - INFO - DEBUG: Task 1 has AI analysis
2025-05-24 21:24:08,551 - routes - INFO - DEBUG: Added task 1 to receipt_tasks, now has 5 items
2025-05-24 21:24:08,551 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 5, ai_evaluations: 0
2025-05-24 21:24:08,552 - routes - INFO - AI Queue loaded: 6 tasks (1 pending review, 0 failed)
2025-05-24 21:24:14,888 - routes - INFO - Receipt task 1 rejected: 
2025-05-24 21:24:14,895 - routes - INFO - DEBUG: Found 5 total tasks
2025-05-24 21:24:14,895 - routes - INFO - DEBUG: Processing task 6, type=receipt_processing, status=pending
2025-05-24 21:24:14,896 - routes - INFO - DEBUG: Task 6 has AI analysis
2025-05-24 21:24:14,897 - routes - INFO - DEBUG: Added task 6 to receipt_tasks, now has 1 items
2025-05-24 21:24:14,898 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:24:14,898 - routes - INFO - DEBUG: Processing task 4, type=receipt_processing, status=pending
2025-05-24 21:24:14,899 - routes - INFO - DEBUG: Task 4 has AI analysis
2025-05-24 21:24:14,900 - routes - INFO - DEBUG: Added task 4 to receipt_tasks, now has 2 items
2025-05-24 21:24:14,901 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending
2025-05-24 21:24:14,902 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-24 21:24:14,902 - routes - INFO - DEBUG: Added task 3 to receipt_tasks, now has 3 items
2025-05-24 21:24:14,903 - routes - INFO - DEBUG: Processing task 2, type=receipt_processing, status=pending
2025-05-24 21:24:14,904 - routes - INFO - DEBUG: Task 2 has AI analysis
2025-05-24 21:24:14,904 - routes - INFO - DEBUG: Added task 2 to receipt_tasks, now has 4 items
2025-05-24 21:24:14,905 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 4, ai_evaluations: 0
2025-05-24 21:24:14,906 - routes - INFO - AI Queue loaded: 5 tasks (1 pending review, 0 failed)
2025-05-24 21:24:20,553 - routes - INFO - Receipt task 2 rejected: 
2025-05-24 21:24:20,560 - routes - INFO - DEBUG: Found 4 total tasks
2025-05-24 21:24:20,561 - routes - INFO - DEBUG: Processing task 6, type=receipt_processing, status=pending
2025-05-24 21:24:20,561 - routes - INFO - DEBUG: Task 6 has AI analysis
2025-05-24 21:24:20,562 - routes - INFO - DEBUG: Added task 6 to receipt_tasks, now has 1 items
2025-05-24 21:24:20,563 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:24:20,563 - routes - INFO - DEBUG: Processing task 4, type=receipt_processing, status=pending
2025-05-24 21:24:20,564 - routes - INFO - DEBUG: Task 4 has AI analysis
2025-05-24 21:24:20,565 - routes - INFO - DEBUG: Added task 4 to receipt_tasks, now has 2 items
2025-05-24 21:24:20,566 - routes - INFO - DEBUG: Processing task 3, type=receipt_processing, status=pending
2025-05-24 21:24:20,566 - routes - INFO - DEBUG: Task 3 has AI analysis
2025-05-24 21:24:20,567 - routes - INFO - DEBUG: Added task 3 to receipt_tasks, now has 3 items
2025-05-24 21:24:20,568 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 3, ai_evaluations: 0
2025-05-24 21:24:20,569 - routes - INFO - AI Queue loaded: 4 tasks (1 pending review, 0 failed)
2025-05-24 21:24:23,369 - routes - INFO - Receipt task 3 rejected: 
2025-05-24 21:24:23,375 - routes - INFO - DEBUG: Found 3 total tasks
2025-05-24 21:24:23,376 - routes - INFO - DEBUG: Processing task 6, type=receipt_processing, status=pending
2025-05-24 21:24:23,377 - routes - INFO - DEBUG: Task 6 has AI analysis
2025-05-24 21:24:23,378 - routes - INFO - DEBUG: Added task 6 to receipt_tasks, now has 1 items
2025-05-24 21:24:23,378 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:24:23,379 - routes - INFO - DEBUG: Processing task 4, type=receipt_processing, status=pending
2025-05-24 21:24:23,380 - routes - INFO - DEBUG: Task 4 has AI analysis
2025-05-24 21:24:23,381 - routes - INFO - DEBUG: Added task 4 to receipt_tasks, now has 2 items
2025-05-24 21:24:23,382 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-24 21:24:23,382 - routes - INFO - AI Queue loaded: 3 tasks (1 pending review, 0 failed)
2025-05-24 21:24:32,636 - routes - INFO - Receipt task 4 rejected: 
2025-05-24 21:24:32,641 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:24:32,642 - routes - INFO - DEBUG: Processing task 6, type=receipt_processing, status=pending
2025-05-24 21:24:32,643 - routes - INFO - DEBUG: Task 6 has AI analysis
2025-05-24 21:24:32,645 - routes - INFO - DEBUG: Added task 6 to receipt_tasks, now has 1 items
2025-05-24 21:24:32,645 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:24:32,647 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:24:32,648 - routes - INFO - AI Queue loaded: 2 tasks (1 pending review, 0 failed)
2025-05-24 21:24:35,753 - routes - INFO - Receipt task 6 rejected: 
2025-05-24 21:24:35,758 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 21:24:35,759 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:24:35,760 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 21:24:35,761 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 21:24:44,812 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 21:24:44,813 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 21:24:44,814 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp56dnpk8l.pdf
2025-05-24 21:24:44,815 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 21:24:45,231 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 21:24:45,232 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 21:24:45,316 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 21:24:45,352 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 21:24:45,353 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 21:24:45,354 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 21:25:01,724 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 21:25:01,725 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 21:25:01,726 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Entry on 1:00 pm",\n      "create_object": false,\n      "object_type": "service",\n      "category": "event",\n      "expiration_info": {\n        "expiration_date": "2025-07-06",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": ""\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": ["TDSLVDVJ"],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 pm",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "business_phone": "",\n    "business_email": "express@eventeny.com",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": "event management"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from email confirmation for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 16.32852077484131, 'timestamp': '2025-05-24T21:25:01.722890', 'tokens_used': 3587, 'cost_estimate': 0.023415000000000002}
2025-05-24 21:25:01,737 - routes - INFO - Receipt queued for review: Task ID 7
2025-05-24 21:25:01,745 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:25:01,746 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:25:01,746 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:25:01,747 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:25:01,748 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:25:01,749 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:25:01,750 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:26:18,484 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:26:18,485 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:26:18,486 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:26:18,487 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:26:18,488 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:26:18,489 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:26:18,490 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:26:52,243 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:26:52,244 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:26:52,245 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:26:52,247 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:26:52,247 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:26:52,248 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:26:52,249 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:27:18,719 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:27:18,721 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:27:18,722 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:27:18,723 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:27:18,724 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:27:18,725 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:27:18,726 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:27:53,116 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:27:53,119 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:27:53,121 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:27:53,123 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:27:53,124 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:27:53,125 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:27:53,126 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:27:57,372 - app - INFO - Creating database tables...
2025-05-24 21:27:57,390 - app - INFO - Database tables created successfully
2025-05-24 21:27:58,230 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:28:23,670 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:28:23,671 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:28:23,672 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:28:23,673 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:28:23,674 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:28:23,674 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:28:23,675 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:28:54,039 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:28:54,040 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:28:54,041 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:28:54,043 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:28:54,044 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:28:54,045 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:28:54,046 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:29:24,418 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:29:24,419 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:29:24,420 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:29:24,421 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:29:24,422 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:29:24,423 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:29:24,424 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:29:54,783 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:29:54,784 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:29:54,785 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:29:54,786 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:29:54,788 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:29:54,788 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:29:54,789 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:30:22,444 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:30:22,445 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:30:22,446 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:30:22,447 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:30:22,448 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:30:22,449 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:30:22,449 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:30:52,814 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:30:52,817 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:30:52,818 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:30:52,820 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:30:52,821 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:30:52,822 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:30:52,823 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:31:12,680 - app - INFO - Creating database tables...
2025-05-24 21:31:12,699 - app - INFO - Database tables created successfully
2025-05-24 21:31:12,799 - app - INFO - Creating database tables...
2025-05-24 21:31:12,818 - app - INFO - Database tables created successfully
2025-05-24 21:31:12,839 - app - INFO - Creating database tables...
2025-05-24 21:31:12,857 - app - INFO - Database tables created successfully
2025-05-24 21:31:12,923 - app - INFO - Creating database tables...
2025-05-24 21:31:12,943 - app - INFO - Database tables created successfully
2025-05-24 21:31:13,341 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:31:13,435 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:31:13,477 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:31:13,553 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:31:15,280 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:31:15,281 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:31:15,282 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:31:15,284 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:31:15,285 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:31:15,286 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:31:15,287 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:31:15,288 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:31:25,855 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:31:25,856 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:31:25,857 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:31:25,858 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:31:25,859 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:31:25,860 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:31:25,860 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:31:25,861 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:31:39,252 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:31:39,253 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:31:39,254 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:31:39,255 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:31:39,256 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:31:39,257 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:31:39,258 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:31:39,259 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:32:07,964 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:32:07,965 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:32:07,966 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:32:07,967 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:32:07,968 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:32:07,968 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:32:07,970 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:32:07,970 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:32:39,980 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:32:39,981 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:32:39,981 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:32:39,982 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:32:39,983 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:32:39,984 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:32:39,985 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:32:39,986 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:33:07,633 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:33:07,633 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:33:07,634 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:33:07,635 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:33:07,637 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:33:07,639 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:33:07,640 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:33:07,640 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:33:13,274 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:33:13,275 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:33:13,276 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:33:13,277 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:33:13,278 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:33:13,279 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:33:13,279 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:33:13,280 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:33:43,636 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:33:43,637 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:33:43,638 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:33:43,639 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:33:43,640 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:33:43,641 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:33:43,642 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:33:43,642 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:34:14,009 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:34:14,010 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:34:14,011 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:34:14,012 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:34:14,013 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:34:14,013 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:34:14,014 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:34:14,015 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:34:44,575 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:34:44,576 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:34:44,577 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:34:44,578 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:34:44,579 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:34:44,579 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:34:44,580 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:34:44,581 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:35:08,215 - app - INFO - Creating database tables...
2025-05-24 21:35:08,232 - app - INFO - Database tables created successfully
2025-05-24 21:35:09,081 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:35:14,956 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:35:14,958 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:35:14,959 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:35:14,959 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:35:14,960 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:35:14,961 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:35:14,962 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:35:14,962 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:35:45,334 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:35:45,335 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:35:45,336 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:35:45,337 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:35:45,338 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:35:45,339 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:35:45,339 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:35:45,340 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:36:15,731 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:36:15,732 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:36:15,733 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:36:15,734 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:36:15,735 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:36:15,735 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:36:15,736 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:36:15,737 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:36:46,104 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:36:46,106 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:36:46,107 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:36:46,107 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:36:46,108 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:36:46,109 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:36:46,110 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:36:46,111 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:37:10,597 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:37:10,598 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:37:10,598 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:37:10,599 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:37:10,600 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:37:10,601 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:37:10,602 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:37:10,602 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:37:43,910 - app - INFO - Creating database tables...
2025-05-24 21:37:43,929 - app - INFO - Database tables created successfully
2025-05-24 21:37:43,937 - app - INFO - Creating database tables...
2025-05-24 21:37:43,955 - app - INFO - Database tables created successfully
2025-05-24 21:37:44,021 - app - INFO - Creating database tables...
2025-05-24 21:37:44,038 - app - INFO - Database tables created successfully
2025-05-24 21:37:44,071 - app - INFO - Creating database tables...
2025-05-24 21:37:44,088 - app - INFO - Database tables created successfully
2025-05-24 21:37:44,495 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:37:44,507 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:37:44,508 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:37:44,509 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:37:44,510 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:37:44,511 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:37:44,512 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:37:44,512 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:37:44,513 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:37:44,517 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:37:44,586 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:37:44,639 - routes - INFO - AI Settings initialized successfully
2025-05-24 21:38:14,915 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 21:38:14,916 - routes - INFO - DEBUG: Processing task 7, type=receipt_processing, status=pending_review
2025-05-24 21:38:14,917 - routes - INFO - DEBUG: Task 7 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 21:38:14,917 - routes - INFO - DEBUG: Task 7 has AI analysis
2025-05-24 21:38:14,918 - routes - INFO - DEBUG: Added task 7 to receipt_tasks, now has 1 items
2025-05-24 21:38:14,919 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:38:14,920 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 21:38:14,920 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 21:38:30,939 - routes - INFO - Successfully processed receipt task: Invoice INV-20250524-E365142C, 0 objects created
2025-05-24 21:38:30,952 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 21:38:30,953 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:38:30,954 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 21:38:30,955 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 21:38:39,695 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 21:38:39,696 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:38:39,697 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 21:38:39,697 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 21:46:53,184 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 21:46:53,185 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 21:46:53,186 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 21:46:53,187 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:04:20,464 - app - INFO - Creating database tables...
2025-05-24 22:04:20,464 - app - INFO - Creating database tables...
2025-05-24 22:04:20,464 - app - INFO - Creating database tables...
2025-05-24 22:04:20,465 - app - INFO - Creating database tables...
2025-05-24 22:04:20,498 - app - INFO - Database tables created successfully
2025-05-24 22:04:20,498 - app - INFO - Database tables created successfully
2025-05-24 22:04:20,498 - app - INFO - Database tables created successfully
2025-05-24 22:04:20,499 - app - INFO - Database tables created successfully
2025-05-24 22:04:21,436 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:04:21,435 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:04:21,435 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:04:21,440 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:04:56,531 - routes - INFO - Processing receipt file: RECEIPT PAePay DUI Fine Nate Smith.pdf
2025-05-24 22:04:56,532 - routes - INFO - Processing PDF file: RECEIPT_PAePay_DUI_Fine_Nate_Smith.pdf
2025-05-24 22:04:56,533 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmptwyx_goh.pdf
2025-05-24 22:04:56,534 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:04:56,664 - ocr_utils - INFO - Successfully converted 1 pages from PDF
2025-05-24 22:04:56,689 - ocr_utils - INFO - Successfully converted PDF (1 pages) to JPEG image using pdf2image
2025-05-24 22:04:56,690 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:04:56,690 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 22:05:08,105 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 22:05:08,107 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 22:05:08,108 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "PAePay",\n  "date": "2025-05-20",\n  "total_amount": 267.15,\n  "subtotal": 260.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 7.15,\n  "receipt_number": "01XF693J7H",\n  "payment_method": "",\n  "due_date": "2025-05-24",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Traffic Ticket or Court Costs Payment",\n  "line_items": [\n    {\n      "description": "Payment Plan 67-2018-P000007328",\n      "quantity": 1.0,\n      "unit_price": 260.00,\n      "total_price": 260.00,\n      "item_details": "Next payment amount due: $65.00, Overdue amount: $195.00",\n      "create_object": false,\n      "object_type": "service",\n      "category": "legal",\n      "expiration_info": {\n        "expiration_date": "",\n        "event_date": "",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": ""\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://ujsportal.pacourts.us/PAePayFCR/Receipt?shoppingCartID=814535c8-114d-4020-dad0-08dd94ab10d0"\n    ],\n    "confirmation_codes": [],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "",\n    "event_date": "",\n    "event_time": "",\n    "venue_location": "",\n    "seat_info": "",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "",\n    "business_phone": "",\n    "business_email": "",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": ""\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt for traffic ticket or court costs payment."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 11.379912853240967, 'timestamp': '2025-05-24T22:05:08.104457', 'tokens_used': 2893, 'cost_estimate': 0.019805}
2025-05-24 22:05:08,130 - routes - INFO - Receipt queued for review: Task ID 8
2025-05-24 22:05:08,139 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:05:08,140 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-24 22:05:08,141 - routes - INFO - DEBUG: Task 8 extracted receipt data: vendor=PAePay, total=$267.15
2025-05-24 22:05:08,141 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-24 22:05:08,143 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 1 items
2025-05-24 22:05:08,143 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:05:08,144 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:05:08,145 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:05:38,538 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:05:38,539 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-24 22:05:38,540 - routes - INFO - DEBUG: Task 8 extracted receipt data: vendor=PAePay, total=$267.15
2025-05-24 22:05:38,541 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-24 22:05:38,542 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 1 items
2025-05-24 22:05:38,543 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:05:38,543 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:05:38,544 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:05:58,950 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 22:05:58,951 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 22:05:58,953 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpqgybvete.pdf
2025-05-24 22:05:58,953 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:05:59,386 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 22:05:59,387 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 22:05:59,473 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 22:05:59,512 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 22:05:59,514 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:05:59,514 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 22:06:17,601 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 22:06:17,602 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 22:06:17,604 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Entry on 1:00 pm",\n      "create_object": false,\n      "object_type": "service",\n      "category": "event",\n      "expiration_info": {\n        "expiration_date": "2025-07-06",\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": ""\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [],\n    "confirmation_codes": ["TDSLVDVJ"],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "1:00 pm",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": "",\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": "",\n    "business_phone": "",\n    "business_email": "express@eventeny.com",\n    "business_website": "",\n    "business_hours": "",\n    "business_type": ""\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from an email confirmation for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 18.052536249160767, 'timestamp': '2025-05-24T22:06:17.600250', 'tokens_used': 3579, 'cost_estimate': 0.023295000000000003}
2025-05-24 22:06:17,615 - routes - WARNING - Potential duplicate receipt detected: Eventeny on 2025-03-17 for $257.61
2025-05-24 22:06:17,620 - routes - INFO - Receipt queued for review: Task ID 9
2025-05-24 22:06:17,627 - routes - INFO - DEBUG: Found 3 total tasks
2025-05-24 22:06:17,628 - routes - INFO - DEBUG: Processing task 9, type=receipt_processing, status=pending_review
2025-05-24 22:06:17,629 - routes - INFO - DEBUG: Task 9 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:06:17,629 - routes - INFO - DEBUG: Task 9 has AI analysis
2025-05-24 22:06:17,630 - routes - INFO - DEBUG: Added task 9 to receipt_tasks, now has 1 items
2025-05-24 22:06:17,631 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-24 22:06:17,632 - routes - INFO - DEBUG: Task 8 extracted receipt data: vendor=PAePay, total=$267.15
2025-05-24 22:06:17,632 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-24 22:06:17,633 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 2 items
2025-05-24 22:06:17,634 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:06:17,635 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-24 22:06:17,635 - routes - INFO - AI Queue loaded: 3 tasks (3 pending review, 0 failed)
2025-05-24 22:06:47,987 - routes - INFO - DEBUG: Found 3 total tasks
2025-05-24 22:06:47,988 - routes - INFO - DEBUG: Processing task 9, type=receipt_processing, status=pending_review
2025-05-24 22:06:47,989 - routes - INFO - DEBUG: Task 9 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:06:47,990 - routes - INFO - DEBUG: Task 9 has AI analysis
2025-05-24 22:06:47,991 - routes - INFO - DEBUG: Added task 9 to receipt_tasks, now has 1 items
2025-05-24 22:06:47,991 - routes - INFO - DEBUG: Processing task 8, type=receipt_processing, status=pending_review
2025-05-24 22:06:47,992 - routes - INFO - DEBUG: Task 8 extracted receipt data: vendor=PAePay, total=$267.15
2025-05-24 22:06:47,993 - routes - INFO - DEBUG: Task 8 has AI analysis
2025-05-24 22:06:47,994 - routes - INFO - DEBUG: Added task 8 to receipt_tasks, now has 2 items
2025-05-24 22:06:47,995 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:06:47,996 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-24 22:06:47,996 - routes - INFO - AI Queue loaded: 3 tasks (3 pending review, 0 failed)
2025-05-24 22:07:03,983 - routes - INFO - Receipt task 8 rejected: 
2025-05-24 22:07:03,990 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:07:03,991 - routes - INFO - DEBUG: Processing task 9, type=receipt_processing, status=pending_review
2025-05-24 22:07:03,992 - routes - INFO - DEBUG: Task 9 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:07:03,993 - routes - INFO - DEBUG: Task 9 has AI analysis
2025-05-24 22:07:03,994 - routes - INFO - DEBUG: Added task 9 to receipt_tasks, now has 1 items
2025-05-24 22:07:03,994 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:07:03,995 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:07:03,996 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:07:10,859 - routes - ERROR - Error creating calendar event from task: 'event_date' is an invalid keyword argument for CalendarEvent
2025-05-24 22:07:16,482 - routes - INFO - Receipt task 9 rejected: 
2025-05-24 22:07:16,487 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:07:16,488 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:07:16,489 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:07:16,490 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:09:14,863 - app - INFO - Creating database tables...
2025-05-24 22:09:14,864 - app - INFO - Creating database tables...
2025-05-24 22:09:14,868 - app - INFO - Creating database tables...
2025-05-24 22:09:14,888 - app - INFO - Creating database tables...
2025-05-24 22:09:14,899 - app - INFO - Database tables created successfully
2025-05-24 22:09:14,899 - app - INFO - Database tables created successfully
2025-05-24 22:09:14,899 - app - INFO - Database tables created successfully
2025-05-24 22:09:14,906 - app - INFO - Database tables created successfully
2025-05-24 22:09:15,832 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:09:15,833 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:09:15,833 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:09:15,835 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:12:26,600 - app - INFO - Creating database tables...
2025-05-24 22:12:26,601 - app - INFO - Creating database tables...
2025-05-24 22:12:26,601 - app - INFO - Creating database tables...
2025-05-24 22:12:26,601 - app - INFO - Creating database tables...
2025-05-24 22:12:26,639 - app - INFO - Database tables created successfully
2025-05-24 22:12:26,639 - app - INFO - Database tables created successfully
2025-05-24 22:12:26,639 - app - INFO - Database tables created successfully
2025-05-24 22:12:26,639 - app - INFO - Database tables created successfully
2025-05-24 22:12:27,580 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:12:27,580 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:12:27,580 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:12:27,581 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:12:38,922 - routes - INFO - Created service object 'Weekend Pass Thursday Entry' from receipt INV-20250524-E365142C
2025-05-24 22:12:58,670 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 22:12:58,671 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 22:12:58,672 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpjgq16jo2.pdf
2025-05-24 22:12:58,673 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:12:59,130 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 22:12:59,131 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 22:12:59,218 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 22:12:59,256 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 22:12:59,257 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:12:59,258 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 22:13:05,489 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 22:13:05,490 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 22:13:05,492 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "category": "event",\n      "object_type": "service",\n      "confidence": 0.95\n    }\n  ],\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from an email confirmation for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 6.184553384780884, 'timestamp': '2025-05-24T22:13:05.488083', 'tokens_used': 3269, 'cost_estimate': 0.018645000000000002}
2025-05-24 22:13:05,502 - routes - WARNING - Potential duplicate receipt detected: Eventeny on 2025-03-17 for $257.61
2025-05-24 22:13:05,513 - routes - INFO - Receipt queued for review: Task ID 41
2025-05-24 22:13:05,521 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:13:05,522 - routes - INFO - DEBUG: Processing task 41, type=receipt_processing, status=pending_review
2025-05-24 22:13:05,523 - routes - INFO - DEBUG: Task 41 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:13:05,523 - routes - INFO - DEBUG: Task 41 has AI analysis
2025-05-24 22:13:05,524 - routes - INFO - DEBUG: Added task 41 to receipt_tasks, now has 1 items
2025-05-24 22:13:05,525 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:13:05,526 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:13:05,526 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:13:39,180 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:13:39,183 - routes - INFO - DEBUG: Processing task 41, type=receipt_processing, status=pending_review
2025-05-24 22:13:39,184 - routes - INFO - DEBUG: Task 41 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:13:39,185 - routes - INFO - DEBUG: Task 41 has AI analysis
2025-05-24 22:13:39,185 - routes - INFO - DEBUG: Added task 41 to receipt_tasks, now has 1 items
2025-05-24 22:13:39,186 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:13:39,187 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:13:39,187 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:15:30,482 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 22:15:30,483 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 22:15:30,486 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp2ab__2np.pdf
2025-05-24 22:15:30,487 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:15:30,943 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 22:15:30,945 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 22:15:31,025 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 22:15:31,065 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 22:15:31,067 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:15:31,068 - routes - INFO - Sending receipt to MCP server for analysis with claude
2025-05-24 22:15:32,253 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 500 Internal Server Error"
2025-05-24 22:15:32,254 - mcp_client - ERROR - Receipt analysis failed: Server error '500 Internal Server Error' for url 'http://mcp-server:8080/ai/process'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500
2025-05-24 22:15:32,255 - routes - ERROR - MCP server analysis failed: Server error '500 Internal Server Error' for url 'http://mcp-server:8080/ai/process'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500
2025-05-24 22:15:32,275 - routes - INFO - DEBUG: Found 3 total tasks
2025-05-24 22:15:32,276 - routes - INFO - DEBUG: Processing task 42, type=receipt_processing, status=ai_analysis_failed
2025-05-24 22:15:32,277 - routes - INFO - DEBUG: Task 42 has no AI analysis
2025-05-24 22:15:32,278 - routes - INFO - DEBUG: Added task 42 to receipt_tasks, now has 1 items
2025-05-24 22:15:32,278 - routes - INFO - DEBUG: Processing task 41, type=receipt_processing, status=pending_review
2025-05-24 22:15:32,279 - routes - INFO - DEBUG: Task 41 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:15:32,280 - routes - INFO - DEBUG: Task 41 has AI analysis
2025-05-24 22:15:32,280 - routes - INFO - DEBUG: Added task 41 to receipt_tasks, now has 2 items
2025-05-24 22:15:32,281 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:15:32,282 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-24 22:15:32,283 - routes - INFO - AI Queue loaded: 3 tasks (2 pending review, 1 failed)
2025-05-24 22:15:42,673 - routes - INFO - Receipt task 42 rejected: 
2025-05-24 22:15:42,679 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:15:42,680 - routes - INFO - DEBUG: Processing task 41, type=receipt_processing, status=pending_review
2025-05-24 22:15:42,681 - routes - INFO - DEBUG: Task 41 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:15:42,681 - routes - INFO - DEBUG: Task 41 has AI analysis
2025-05-24 22:15:42,682 - routes - INFO - DEBUG: Added task 41 to receipt_tasks, now has 1 items
2025-05-24 22:15:42,683 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:15:42,684 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:15:42,685 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:15:45,960 - routes - INFO - Receipt task 41 rejected: 
2025-05-24 22:15:45,966 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:15:45,967 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:15:45,967 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:15:45,968 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:15:51,235 - routes - INFO - Deleting receipt INV-20250524-E365142C: 1 line items, 1 objects, 0 attachments. Delete objects: True. Reason: 
2025-05-24 22:15:51,243 - routes - INFO - Deleted object: Weekend Pass Thursday Entry (ID: 1)
2025-05-24 22:15:51,270 - routes - ERROR - Error deleting receipt: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "vendor": "Eventeny", "is_paid": true, "subtotal": 215.0, "tax_amount": 0.0, "description": "Ticket purchase fo ... (143 characters truncated) ... ence": null, "payment_method": "Not specified", "receipt_number": "TDSLVDVJ", "original_filename": "RECEIPT Blue Heron Music Festival July 2025.pdf"}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.AmbiguousFunction: operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1120, in delete_receipt
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 442, in execute
    postsort_actions = self._generate_actions()
                       ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 400, in _generate_actions
    if action.execute(self):
       ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 540, in execute
    self.dependency_processor.prop_has_changes(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/dependency.py", line 254, in prop_has_changes
    history = uowcommit.get_attribute_history(s, self.key, passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 283, in get_attribute_history
    history = impl.get_history(
              ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1366, in get_history
    current = self.get(state, dict_, passive=passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "vendor": "Eventeny", "is_paid": true, "subtotal": 215.0, "tax_amount": 0.0, "description": "Ticket purchase fo ... (143 characters truncated) ... ence": null, "payment_method": "Not specified", "receipt_number": "TDSLVDVJ", "original_filename": "RECEIPT Blue Heron Music Festival July 2025.pdf"}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 22:15:51,855 - routes - INFO - Deleting receipt INV-20250524-E365142C: 1 line items, 1 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-24 22:15:51,862 - routes - ERROR - Error deleting receipt: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "vendor": "Eventeny", "is_paid": true, "subtotal": 215.0, "tax_amount": 0.0, "description": "Ticket purchase fo ... (143 characters truncated) ... ence": null, "payment_method": "Not specified", "receipt_number": "TDSLVDVJ", "original_filename": "RECEIPT Blue Heron Music Festival July 2025.pdf"}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.AmbiguousFunction: operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1120, in delete_receipt
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 442, in execute
    postsort_actions = self._generate_actions()
                       ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 400, in _generate_actions
    if action.execute(self):
       ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 540, in execute
    self.dependency_processor.prop_has_changes(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/dependency.py", line 254, in prop_has_changes
    history = uowcommit.get_attribute_history(s, self.key, passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 283, in get_attribute_history
    history = impl.get_history(
              ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1366, in get_history
    current = self.get(state, dict_, passive=passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "vendor": "Eventeny", "is_paid": true, "subtotal": 215.0, "tax_amount": 0.0, "description": "Ticket purchase fo ... (143 characters truncated) ... ence": null, "payment_method": "Not specified", "receipt_number": "TDSLVDVJ", "original_filename": "RECEIPT Blue Heron Music Festival July 2025.pdf"}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 22:16:49,724 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 22:16:49,725 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 22:16:49,726 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpm0tz_bu6.pdf
2025-05-24 22:16:49,727 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:16:50,125 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 22:16:50,126 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 22:16:50,200 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 22:16:50,236 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 22:16:50,238 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:16:50,239 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 22:16:58,915 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 22:16:58,916 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 22:16:58,917 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "category": "event",\n      "object_type": "service",\n      "confidence": 0.95\n    }\n  ],\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from an email confirmation for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 8.643802881240845, 'timestamp': '2025-05-24T22:16:58.914210', 'tokens_used': 3270, 'cost_estimate': 0.018660000000000003}
2025-05-24 22:16:58,921 - routes - WARNING - Potential duplicate receipt detected: Eventeny on 2025-03-17 for $257.61
2025-05-24 22:16:58,927 - routes - INFO - Receipt queued for review: Task ID 43
2025-05-24 22:16:58,934 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:16:58,935 - routes - INFO - DEBUG: Processing task 43, type=receipt_processing, status=pending_review
2025-05-24 22:16:58,936 - routes - INFO - DEBUG: Task 43 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:16:58,936 - routes - INFO - DEBUG: Task 43 has AI analysis
2025-05-24 22:16:58,937 - routes - INFO - DEBUG: Added task 43 to receipt_tasks, now has 1 items
2025-05-24 22:16:58,938 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:16:58,939 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:16:58,940 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:17:30,273 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:17:30,274 - routes - INFO - DEBUG: Processing task 43, type=receipt_processing, status=pending_review
2025-05-24 22:17:30,275 - routes - INFO - DEBUG: Task 43 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:17:30,276 - routes - INFO - DEBUG: Task 43 has AI analysis
2025-05-24 22:17:30,277 - routes - INFO - DEBUG: Added task 43 to receipt_tasks, now has 1 items
2025-05-24 22:17:30,278 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:17:30,278 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:17:30,279 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:18:09,938 - app - INFO - Creating database tables...
2025-05-24 22:18:09,939 - app - INFO - Creating database tables...
2025-05-24 22:18:09,940 - app - INFO - Creating database tables...
2025-05-24 22:18:09,942 - app - INFO - Creating database tables...
2025-05-24 22:18:09,976 - app - INFO - Database tables created successfully
2025-05-24 22:18:09,976 - app - INFO - Database tables created successfully
2025-05-24 22:18:09,976 - app - INFO - Database tables created successfully
2025-05-24 22:18:09,976 - app - INFO - Database tables created successfully
2025-05-24 22:18:08,289 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:18:08,289 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:18:08,289 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:18:08,293 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:21:09,138 - routes - INFO - Deleting receipt INV-20250524-E365142C: 1 line items, 1 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-24 22:21:09,147 - routes - ERROR - Error deleting receipt: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "vendor": "Eventeny", "is_paid": true, "subtotal": 215.0, "tax_amount": 0.0, "description": "Ticket purchase fo ... (143 characters truncated) ... ence": null, "payment_method": "Not specified", "receipt_number": "TDSLVDVJ", "original_filename": "RECEIPT Blue Heron Music Festival July 2025.pdf"}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.AmbiguousFunction: operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1131, in delete_receipt
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 442, in execute
    postsort_actions = self._generate_actions()
                       ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 400, in _generate_actions
    if action.execute(self):
       ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 540, in execute
    self.dependency_processor.prop_has_changes(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/dependency.py", line 254, in prop_has_changes
    history = uowcommit.get_attribute_history(s, self.key, passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 283, in get_attribute_history
    history = impl.get_history(
              ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1366, in get_history
    current = self.get(state, dict_, passive=passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.AmbiguousFunction) operator is not unique: unknown ->> unknown
LINE 3: ...ECEIPT Blue Heron Music Festival July 2025.pdf"}' ->> 'organ...
                                                             ^
HINT:  Could not choose a best candidate operator. You might need to add explicit type casts.

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.organization_type AS organizations_organization_type, organizations.data AS organizations_data, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.is_active AS organizations_is_active, organizations.needs_approval AS organizations_needs_approval, organizations.approved_at AS organizations_approved_at 
FROM organizations 
WHERE organizations.id = CAST((%(param_1)s ->> %(data_1)s) AS INTEGER)]
[parameters: {'param_1': '{"date": "2025-03-17", "fees": 41.61, "vendor": "Eventeny", "is_paid": true, "subtotal": 215.0, "tax_amount": 0.0, "description": "Ticket purchase fo ... (143 characters truncated) ... ence": null, "payment_method": "Not specified", "receipt_number": "TDSLVDVJ", "original_filename": "RECEIPT Blue Heron Music Festival July 2025.pdf"}', 'data_1': 'organization_id'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 22:24:13,731 - app - INFO - Creating database tables...
2025-05-24 22:24:13,747 - app - INFO - Creating database tables...
2025-05-24 22:24:13,766 - app - INFO - Database tables created successfully
2025-05-24 22:24:13,766 - app - INFO - Database tables created successfully
2025-05-24 22:24:13,775 - app - INFO - Creating database tables...
2025-05-24 22:24:13,792 - app - INFO - Database tables created successfully
2025-05-24 22:24:13,846 - app - INFO - Creating database tables...
2025-05-24 22:24:13,865 - app - INFO - Database tables created successfully
2025-05-24 22:24:14,751 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:24:14,752 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:24:14,752 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:24:14,756 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:25:25,947 - app - INFO - Creating database tables...
2025-05-24 22:25:25,948 - app - INFO - Creating database tables...
2025-05-24 22:25:25,953 - app - INFO - Creating database tables...
2025-05-24 22:25:25,954 - app - INFO - Creating database tables...
2025-05-24 22:25:25,995 - app - INFO - Database tables created successfully
2025-05-24 22:25:25,995 - app - INFO - Database tables created successfully
2025-05-24 22:25:25,995 - app - INFO - Database tables created successfully
2025-05-24 22:25:25,995 - app - INFO - Database tables created successfully
2025-05-24 22:25:26,944 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:25:26,944 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:25:26,944 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:25:26,947 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:25:35,585 - routes - INFO - Deleting receipt INV-20250524-E365142C: 1 line items, 1 objects, 0 attachments. Delete objects: True. Reason: 
2025-05-24 22:25:35,594 - routes - INFO - Deleted object: Weekend Pass Thursday Entry (ID: 1)
2025-05-24 22:25:35,610 - routes - ERROR - Error deleting receipt: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(psycopg2.errors.UndefinedColumn) column calendar_events.event_date does not exist
LINE 1: ..._events.event_type AS calendar_events_event_type, calendar_e...
                                                             ^
HINT:  Perhaps you meant to reference the column "calendar_events.event_type".

[SQL: SELECT calendar_events.id AS calendar_events_id, calendar_events.title AS calendar_events_title, calendar_events.description AS calendar_events_description, calendar_events.event_type AS calendar_events_event_type, calendar_events.event_date AS calendar_events_event_date, calendar_events.end_time AS calendar_events_end_time, calendar_events.location AS calendar_events_location, calendar_events.object_id AS calendar_events_object_id, calendar_events.organization_id AS calendar_events_organization_id, calendar_events.user_id AS calendar_events_user_id, calendar_events.event_metadata AS calendar_events_event_metadata, calendar_events.created_at AS calendar_events_created_at, calendar_events.updated_at AS calendar_events_updated_at, calendar_events.is_completed AS calendar_events_is_completed 
FROM calendar_events 
WHERE %(param_1)s = calendar_events.object_id]
[parameters: {'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column calendar_events.event_date does not exist
LINE 1: ..._events.event_type AS calendar_events_event_type, calendar_e...
                                                             ^
HINT:  Perhaps you meant to reference the column "calendar_events.event_type".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1130, in delete_receipt
    db.session.delete(receipt)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 673, in delete
    return self._proxied.delete(instance)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 3498, in delete
    self._delete_impl(state, instance, head=True)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 3525, in _delete_impl
    cascade_states = list(
                     ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/mapper.py", line 3964, in cascade_iterator
    queue = deque(
            ^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/relationships.py", line 1505, in cascade_iterator
    tuples = self._value_as_iterable(
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/relationships.py", line 1475, in _value_as_iterable
    x = impl.get(state, dict_, passive=passive)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2169, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 551, in orm_pre_session_exec
    session._autoflush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 3021, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 3010, in _autoflush
    self.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 442, in execute
    postsort_actions = self._generate_actions()
                       ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 400, in _generate_actions
    if action.execute(self):
       ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 532, in execute
    self.dependency_processor.presort_deletes(uow, delete_states)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/dependency.py", line 448, in presort_deletes
    history = uowcommit.get_attribute_history(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 283, in get_attribute_history
    history = impl.get_history(
              ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1683, in get_history
    current = self.get(state, dict_, passive=passive)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(psycopg2.errors.UndefinedColumn) column calendar_events.event_date does not exist
LINE 1: ..._events.event_type AS calendar_events_event_type, calendar_e...
                                                             ^
HINT:  Perhaps you meant to reference the column "calendar_events.event_type".

[SQL: SELECT calendar_events.id AS calendar_events_id, calendar_events.title AS calendar_events_title, calendar_events.description AS calendar_events_description, calendar_events.event_type AS calendar_events_event_type, calendar_events.event_date AS calendar_events_event_date, calendar_events.end_time AS calendar_events_end_time, calendar_events.location AS calendar_events_location, calendar_events.object_id AS calendar_events_object_id, calendar_events.organization_id AS calendar_events_organization_id, calendar_events.user_id AS calendar_events_user_id, calendar_events.event_metadata AS calendar_events_event_metadata, calendar_events.created_at AS calendar_events_created_at, calendar_events.updated_at AS calendar_events_updated_at, calendar_events.is_completed AS calendar_events_is_completed 
FROM calendar_events 
WHERE %(param_1)s = calendar_events.object_id]
[parameters: {'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 22:25:40,715 - routes - INFO - Deleting receipt INV-20250524-E365142C: 1 line items, 1 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-24 22:25:40,730 - routes - ERROR - Error deleting receipt: (psycopg2.errors.ForeignKeyViolation) update or delete on table "invoices" violates foreign key constraint "objects_invoice_id_fkey" on table "objects"
DETAIL:  Key (id)=(1) is still referenced from table "objects".

[SQL: DELETE FROM invoices WHERE invoices.id = %(id)s]
[parameters: {'id': 1}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.ForeignKeyViolation: update or delete on table "invoices" violates foreign key constraint "objects_invoice_id_fkey" on table "objects"
DETAIL:  Key (id)=(1) is still referenced from table "objects".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/app/routes.py", line 1131, in delete_receipt
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 679, in execute
    util.preloaded.orm_persistence.delete_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 191, in delete_obj
    _emit_delete_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1456, in _emit_delete_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.ForeignKeyViolation) update or delete on table "invoices" violates foreign key constraint "objects_invoice_id_fkey" on table "objects"
DETAIL:  Key (id)=(1) is still referenced from table "objects".

[SQL: DELETE FROM invoices WHERE invoices.id = %(id)s]
[parameters: {'id': 1}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-24 22:27:17,348 - app - INFO - Creating database tables...
2025-05-24 22:27:17,366 - app - INFO - Database tables created successfully
2025-05-24 22:27:17,407 - app - INFO - Creating database tables...
2025-05-24 22:27:17,409 - app - INFO - Creating database tables...
2025-05-24 22:27:17,419 - app - INFO - Creating database tables...
2025-05-24 22:27:17,426 - app - INFO - Database tables created successfully
2025-05-24 22:27:17,426 - app - INFO - Database tables created successfully
2025-05-24 22:27:17,435 - app - INFO - Database tables created successfully
2025-05-24 22:27:17,915 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:27:17,971 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:27:17,976 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:27:17,985 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:27:24,551 - routes - INFO - Deleting receipt INV-20250524-E365142C: 1 line items, 1 objects, 0 attachments. Delete objects: False. Reason: 
2025-05-24 22:27:24,552 - routes - INFO - Unlinked object: Weekend Pass Thursday Entry (ID: 1) from receipt
2025-05-24 22:27:40,104 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 22:27:40,105 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 22:27:40,106 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp8xn1jm33.pdf
2025-05-24 22:27:40,107 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:27:40,571 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 22:27:40,572 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 22:27:40,652 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 22:27:40,695 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 22:27:40,696 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:27:40,697 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 22:27:53,713 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 22:27:53,714 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 22:27:53,716 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Great Blue Heron Music Festival 2025 Ticket Purchase",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "category": "event",\n      "object_type": "service",\n      "confidence": 0.95\n    }\n  ],\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from an email confirmation for a music festival ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 12.970839500427246, 'timestamp': '2025-05-24T22:27:53.712366', 'tokens_used': 3269, 'cost_estimate': 0.018645000000000002}
2025-05-24 22:27:53,740 - routes - INFO - Receipt queued for review: Task ID 44
2025-05-24 22:27:53,748 - routes - INFO - DEBUG: Found 3 total tasks
2025-05-24 22:27:53,749 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:27:53,750 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:27:53,750 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:27:53,751 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:27:53,752 - routes - INFO - DEBUG: Processing task 43, type=receipt_processing, status=pending_review
2025-05-24 22:27:53,753 - routes - INFO - DEBUG: Task 43 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:27:53,753 - routes - INFO - DEBUG: Task 43 has AI analysis
2025-05-24 22:27:53,754 - routes - INFO - DEBUG: Added task 43 to receipt_tasks, now has 2 items
2025-05-24 22:27:53,755 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:27:53,756 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 2, ai_evaluations: 0
2025-05-24 22:27:53,757 - routes - INFO - AI Queue loaded: 3 tasks (3 pending review, 0 failed)
2025-05-24 22:28:03,694 - routes - INFO - Receipt task 43 rejected: 
2025-05-24 22:28:03,702 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:28:03,703 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:28:03,705 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:28:03,706 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:28:03,708 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:28:03,709 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:28:03,710 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:28:03,711 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:28:34,537 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:28:34,538 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:28:34,538 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:28:34,539 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:28:34,540 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:28:34,541 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:28:34,542 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:28:34,543 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:29:04,560 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:29:04,560 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:29:04,562 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:29:04,562 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:29:04,564 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:29:04,564 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:29:04,565 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:29:04,566 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:29:32,712 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:29:32,713 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:29:32,714 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:29:32,715 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:29:32,716 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:29:32,717 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:29:32,718 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:29:32,719 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:30:03,092 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:30:03,092 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:30:03,093 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:30:03,095 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:30:03,095 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:30:03,096 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:30:03,097 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:30:03,098 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:30:33,447 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:30:33,449 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:30:33,450 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:30:33,451 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:30:33,452 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:30:33,453 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:30:33,454 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:30:33,456 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:31:03,826 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:31:03,827 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:31:03,828 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:31:03,829 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:31:03,830 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:31:03,830 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:31:03,831 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:31:03,832 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:31:34,233 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:31:34,234 - routes - INFO - DEBUG: Processing task 44, type=receipt_processing, status=pending_review
2025-05-24 22:31:34,235 - routes - INFO - DEBUG: Task 44 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:31:34,236 - routes - INFO - DEBUG: Task 44 has AI analysis
2025-05-24 22:31:34,237 - routes - INFO - DEBUG: Added task 44 to receipt_tasks, now has 1 items
2025-05-24 22:31:34,238 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:31:34,239 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:31:34,240 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:31:39,284 - routes - INFO - Receipt task 44 rejected: 
2025-05-24 22:31:39,290 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:31:39,291 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:31:39,291 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:31:39,292 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:32:09,778 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:32:09,779 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:32:09,780 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:32:09,780 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:32:45,909 - app - INFO - Creating database tables...
2025-05-24 22:32:45,928 - app - INFO - Database tables created successfully
2025-05-24 22:32:46,012 - app - INFO - Creating database tables...
2025-05-24 22:32:46,031 - app - INFO - Database tables created successfully
2025-05-24 22:32:46,044 - app - INFO - Creating database tables...
2025-05-24 22:32:46,065 - app - INFO - Database tables created successfully
2025-05-24 22:32:46,081 - app - INFO - Creating database tables...
2025-05-24 22:32:46,099 - app - INFO - Database tables created successfully
2025-05-24 22:32:46,500 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:32:46,600 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:32:46,631 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:32:46,648 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:32:47,457 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:32:47,458 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:32:47,459 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:32:47,460 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:33:18,400 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:33:18,401 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:33:18,402 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:33:18,403 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:33:42,660 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 22:33:42,661 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 22:33:42,663 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmpq0wgf4ea.pdf
2025-05-24 22:33:42,664 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:33:43,086 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 22:33:43,087 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 22:33:43,170 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 22:33:43,210 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 22:33:43,211 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:33:43,212 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 22:34:03,384 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 22:34:03,385 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 22:34:03,387 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "tip_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "payment_method": "Not specified",\n  "due_date": null,\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Ticket purchase for Great Blue Heron Music Festival 2025",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "item_details": "Entry on 1:00 pm",\n      "create_object": false,\n      "object_type": "service",\n      "category": "event",\n      "expiration_info": {\n        "expiration_date": null,\n        "event_date": "2025-07-03",\n        "shelf_life_days": null\n      },\n      "object_details": {\n        "serial_numbers": [],\n        "specifications": {},\n        "warranty_info": null\n      },\n      "confidence": 0.95\n    }\n  ],\n  "people_found": [],\n  "digital_assets": {\n    "qr_codes": [],\n    "barcodes": [],\n    "urls": [\n      "https://eventeny.com"\n    ],\n    "confirmation_codes": [\n      "TDSLVDVJ"\n    ],\n    "ticket_numbers": [],\n    "account_numbers": []\n  },\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "event_time": "13:00",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States",\n    "seat_info": null,\n    "additional_details": {}\n  },\n  "vendor_details": {\n    "business_address": null,\n    "business_phone": null,\n    "business_email": "express@eventeny.com",\n    "business_website": "https://eventeny.com",\n    "business_hours": null,\n    "business_type": "event management"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Receipt extracted from email confirmation for event ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 20.123992443084717, 'timestamp': '2025-05-24T22:34:03.383043', 'tokens_used': 3595, 'cost_estimate': 0.023535}
2025-05-24 22:34:03,400 - routes - INFO - Receipt queued for review: Task ID 45
2025-05-24 22:34:03,407 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:34:03,408 - routes - INFO - DEBUG: Processing task 45, type=receipt_processing, status=pending_review
2025-05-24 22:34:03,409 - routes - INFO - DEBUG: Task 45 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:34:03,410 - routes - INFO - Task 45 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '13:00', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': None, 'additional_details': {}}
2025-05-24 22:34:03,410 - routes - INFO - DEBUG: Task 45 has AI analysis
2025-05-24 22:34:03,411 - routes - INFO - DEBUG: Added task 45 to receipt_tasks, now has 1 items
2025-05-24 22:34:03,412 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:34:03,413 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:34:03,414 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:34:31,102 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:34:31,103 - routes - INFO - DEBUG: Processing task 45, type=receipt_processing, status=pending_review
2025-05-24 22:34:31,104 - routes - INFO - DEBUG: Task 45 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:34:31,105 - routes - INFO - Task 45 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'event_time': '13:00', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States', 'seat_info': None, 'additional_details': {}}
2025-05-24 22:34:31,106 - routes - INFO - DEBUG: Task 45 has AI analysis
2025-05-24 22:34:31,106 - routes - INFO - DEBUG: Added task 45 to receipt_tasks, now has 1 items
2025-05-24 22:34:31,107 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:34:31,108 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:34:31,109 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:34:48,652 - routes - INFO - Receipt task 45 rejected: 
2025-05-24 22:34:48,659 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:34:48,660 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:34:48,661 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:34:48,662 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:35:19,161 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:35:19,162 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:35:19,163 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:35:19,164 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:35:49,571 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:35:49,572 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:35:49,572 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:35:49,573 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:36:19,930 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:36:19,931 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:36:19,932 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:36:19,933 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:36:47,591 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:36:47,593 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:36:47,594 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:36:47,595 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:37:17,952 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:37:17,953 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:37:17,954 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:37:17,955 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:37:48,281 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:37:48,282 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:37:48,283 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:37:48,284 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:38:18,404 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:38:18,405 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:38:18,406 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:38:18,407 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:38:49,180 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:38:49,181 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:38:49,182 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:38:49,183 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:39:17,870 - app - INFO - Creating database tables...
2025-05-24 22:39:17,870 - app - INFO - Creating database tables...
2025-05-24 22:39:17,889 - app - INFO - Database tables created successfully
2025-05-24 22:39:17,889 - app - INFO - Database tables created successfully
2025-05-24 22:39:17,917 - app - INFO - Creating database tables...
2025-05-24 22:39:17,935 - app - INFO - Database tables created successfully
2025-05-24 22:39:18,023 - app - INFO - Creating database tables...
2025-05-24 22:39:18,043 - app - INFO - Database tables created successfully
2025-05-24 22:39:18,967 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:39:18,967 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:39:18,974 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:39:18,982 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:39:32,043 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 22:39:32,044 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 22:39:32,045 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp5ea5iyi1.pdf
2025-05-24 22:39:32,046 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:39:32,500 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 22:39:32,501 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 22:39:32,579 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 22:39:32,614 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 22:39:32,616 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:39:32,617 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 22:39:38,129 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 22:39:38,131 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 22:39:38,132 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Great Blue Heron Music Festival 2025 Ticket Purchase",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "category": "event",\n      "object_type": "service",\n      "confidence": 0.95\n    }\n  ],\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "The receipt is for a music festival ticket purchase with no taxes applied."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 5.467743158340454, 'timestamp': '2025-05-24T22:39:38.128705', 'tokens_used': 3270, 'cost_estimate': 0.018660000000000003}
2025-05-24 22:39:38,158 - routes - INFO - Receipt queued for review: Task ID 46
2025-05-24 22:39:38,167 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:39:38,168 - routes - INFO - DEBUG: Processing task 46, type=receipt_processing, status=pending_review
2025-05-24 22:39:38,169 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-24 22:39:38,170 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-24 22:39:38,170 - routes - INFO - Task 46 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-24 22:39:38,171 - routes - INFO - DEBUG: Task 46 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:39:38,172 - routes - INFO - Task 46 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-03-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket purchase', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 215.0, 'total_price': 215.0, 'category': 'event_ticket', 'object_type': 'consumable', 'confidence': 0.95, 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-03-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-24 22:39:38,173 - routes - INFO - DEBUG: Task 46 has AI analysis
2025-05-24 22:39:38,173 - routes - INFO - DEBUG: Added task 46 to receipt_tasks, now has 1 items
2025-05-24 22:39:38,174 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:39:38,175 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:39:38,175 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:39:58,836 - routes - ERROR - Error creating object from task: invalid literal for int() with base 10: '1.0'
2025-05-24 22:40:08,555 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:40:08,556 - routes - INFO - DEBUG: Processing task 46, type=receipt_processing, status=pending_review
2025-05-24 22:40:08,558 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-24 22:40:08,559 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-24 22:40:08,560 - routes - INFO - Task 46 - Detected event from receipt data: Heron Music Festival 2025 Ticket
2025-05-24 22:40:08,561 - routes - INFO - DEBUG: Task 46 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:40:08,562 - routes - INFO - Task 46 has event details: {'event_name': 'Heron Music Festival 2025 Ticket', 'event_date': '2025-03-17', 'venue_location': '', 'description': 'great blue heron music festival 2025 ticket purchase', 'event_type': 'detected_from_receipt', 'confidence': 0.8, 'detection_method': 'smart_analysis', 'consumable_items_detected': 1, 'tickets_and_passes': [{'description': 'Weekend Pass Thursday Entry', 'quantity': 1.0, 'unit_price': 215.0, 'total_price': 215.0, 'category': 'event_ticket', 'object_type': 'consumable', 'confidence': 0.95, 'create_object': True, 'consumption_type': 'single_use', 'expiration_info': {'expires_after_event': True, 'event_date': '2025-03-17'}}], 'indicators': {'description_match': True, 'line_items_match': True, 'vendor_match': True, 'matching_line_items': 1}}
2025-05-24 22:40:08,563 - routes - INFO - DEBUG: Task 46 has AI analysis
2025-05-24 22:40:08,564 - routes - INFO - DEBUG: Added task 46 to receipt_tasks, now has 1 items
2025-05-24 22:40:08,565 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:40:08,568 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:40:08,568 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:40:10,544 - routes - INFO - Classified 'weekend pass thursday entry' as consumable event ticket
2025-05-24 22:40:10,545 - routes - INFO - Detected event from receipt: heron music festival 2025 ticket (confidence: 0.8, 1 consumable items)
2025-05-24 22:40:10,546 - routes - INFO - Task 46 - Using smart-detected event details for calendar creation
2025-05-24 22:40:10,557 - routes - ERROR - Error creating calendar event from task: (psycopg2.errors.UndefinedColumn) column "event_date" of relation "calendar_events" does not exist
LINE 1: ... calendar_events (title, description, event_type, event_date...
                                                             ^

[SQL: INSERT INTO calendar_events (title, description, event_type, event_date, end_time, location, object_id, organization_id, user_id, event_metadata, created_at, updated_at, is_completed) VALUES (%(title)s, %(description)s, %(event_type)s, %(event_date)s, %(end_time)s, %(location)s, %(object_id)s, %(organization_id)s, %(user_id)s, %(event_metadata)s, %(created_at)s, %(updated_at)s, %(is_completed)s) RETURNING calendar_events.id]
[parameters: {'title': 'Heron Music Festival 2025 Ticket', 'description': 'Event created from task analysis. great blue heron music festival 2025 ticket purchase', 'event_type': 'task_generated', 'event_date': datetime.datetime(2025, 3, 17, 0, 0), 'end_time': None, 'location': '', 'object_id': None, 'organization_id': None, 'user_id': None, 'event_metadata': '{"created_from_task": true, "task_id": "46", "vendor": "Eventeny", "event_details": {"event_name": "Heron Music Festival 2025 Ticket", "event_date":  ... (570 characters truncated) ... -17"}}], "indicators": {"description_match": true, "line_items_match": true, "vendor_match": true, "matching_line_items": 1}}, "ai_confidence": 0.95}', 'created_at': datetime.datetime(2025, 5, 24, 22, 40, 10, 555095), 'updated_at': datetime.datetime(2025, 5, 24, 22, 40, 10, 555097), 'is_completed': False}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-24 22:40:16,678 - routes - INFO - Receipt task 46 rejected: 
2025-05-24 22:40:16,684 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:40:16,685 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:40:16,686 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:40:16,687 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:40:47,050 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:40:47,051 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:40:47,052 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:40:47,053 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:41:16,990 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:41:16,991 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:41:16,992 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:41:16,993 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:41:47,785 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:41:47,786 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:41:47,787 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:41:47,787 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:42:12,135 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:42:12,136 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:42:12,137 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:42:12,138 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:42:46,042 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:42:46,042 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:42:46,043 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:42:46,044 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:43:16,410 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:43:16,411 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:43:16,412 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:43:16,412 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:43:46,780 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:43:46,781 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:43:46,782 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:43:46,782 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:44:28,146 - app - INFO - Creating database tables...
2025-05-24 22:44:28,147 - app - INFO - Creating database tables...
2025-05-24 22:44:28,147 - app - INFO - Creating database tables...
2025-05-24 22:44:28,149 - app - INFO - Creating database tables...
2025-05-24 22:44:28,182 - app - INFO - Database tables created successfully
2025-05-24 22:44:28,182 - app - INFO - Database tables created successfully
2025-05-24 22:44:28,182 - app - INFO - Database tables created successfully
2025-05-24 22:44:28,183 - app - INFO - Database tables created successfully
2025-05-24 22:44:29,140 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:44:29,140 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:44:29,144 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:44:29,146 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:44:31,622 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:44:31,623 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:44:31,624 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:44:31,624 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:44:36,459 - routes - INFO - Processing receipt file: RECEIPT Blue Heron Music Festival July 2025.pdf
2025-05-24 22:44:36,460 - routes - INFO - Processing PDF file: RECEIPT_Blue_Heron_Music_Festival_July_2025.pdf
2025-05-24 22:44:36,461 - ocr_utils - INFO - Saved PDF to temporary file: /tmp/tmp54h45iwq.pdf
2025-05-24 22:44:36,462 - ocr_utils - INFO - Converting all pages of PDF to images for comprehensive analysis
2025-05-24 22:44:36,933 - ocr_utils - INFO - Successfully converted 3 pages from PDF
2025-05-24 22:44:36,934 - ocr_utils - INFO - Concatenating 3 pages into single image for analysis
2025-05-24 22:44:37,009 - ocr_utils - INFO - Created combined image: 2550x9900 pixels
2025-05-24 22:44:37,045 - ocr_utils - INFO - Successfully converted PDF (3 pages) to JPEG image using pdf2image
2025-05-24 22:44:37,046 - routes - INFO - Successfully converted PDF to image for processing
2025-05-24 22:44:37,047 - routes - INFO - Sending receipt to MCP server for analysis with openai
2025-05-24 22:44:49,336 - httpx - INFO - HTTP Request: POST http://mcp-server:8080/ai/process "HTTP/1.1 200 OK"
2025-05-24 22:44:49,338 - mcp_client - INFO - Receipt analyzed successfully with openai
2025-05-24 22:44:49,339 - routes - INFO - MCP analysis successful: {'content': {'response': '```json\n{\n  "vendor_name": "Eventeny",\n  "date": "2025-03-17",\n  "total_amount": 257.61,\n  "subtotal": 215.00,\n  "tax_amount": 0.00,\n  "fees": 41.61,\n  "receipt_number": "TDSLVDVJ",\n  "is_bill": false,\n  "document_type": "receipt",\n  "description": "Great Blue Heron Music Festival 2025 Ticket Purchase",\n  "line_items": [\n    {\n      "description": "Weekend Pass Thursday Entry",\n      "quantity": 1.0,\n      "unit_price": 215.00,\n      "total_price": 215.00,\n      "category": "event",\n      "object_type": "service",\n      "confidence": 0.95\n    }\n  ],\n  "event_details": {\n    "event_name": "Great Blue Heron Music Festival 2025",\n    "event_date": "2025-07-03",\n    "venue_location": "2361 Waits Corners Rd, Sherman, NY 14781, United States"\n  },\n  "vendor_details": {\n    "business_address": "2361 Waits Corners Rd, Sherman, NY 14781, United States"\n  },\n  "overall_confidence": 0.95,\n  "image_quality": "good",\n  "missing_information": [],\n  "extraction_notes": "Extracted from email receipt for event ticket purchase."\n}\n```'}, 'provider': 'openai', 'prompt_type': 'unknown', 'confidence': None, 'processing_time': 12.244158506393433, 'timestamp': '2025-05-24T22:44:49.335544', 'tokens_used': 3359, 'cost_estimate': 0.019995000000000002}
2025-05-24 22:44:49,366 - routes - INFO - Receipt queued for review: Task ID 47
2025-05-24 22:44:49,374 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:44:49,374 - routes - INFO - DEBUG: Processing task 47, type=receipt_processing, status=pending_review
2025-05-24 22:44:49,375 - routes - INFO - DEBUG: Task 47 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:44:49,376 - routes - INFO - Task 47 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States'}
2025-05-24 22:44:49,377 - routes - INFO - DEBUG: Task 47 has AI analysis
2025-05-24 22:44:49,377 - routes - INFO - DEBUG: Added task 47 to receipt_tasks, now has 1 items
2025-05-24 22:44:49,378 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:44:49,379 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:44:49,380 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:44:59,328 - routes - INFO - Created calendar event 'Great Blue Heron Music Festival 2025' from task 47
2025-05-24 22:45:00,911 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:45:00,912 - routes - INFO - DEBUG: Processing task 47, type=receipt_processing, status=pending_review
2025-05-24 22:45:00,913 - routes - INFO - DEBUG: Task 47 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:45:00,914 - routes - INFO - Task 47 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States'}
2025-05-24 22:45:00,915 - routes - INFO - DEBUG: Task 47 has AI analysis
2025-05-24 22:45:00,916 - routes - INFO - DEBUG: Added task 47 to receipt_tasks, now has 1 items
2025-05-24 22:45:00,917 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:45:00,917 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:45:00,918 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:45:12,687 - routes - INFO - DEBUG: Found 2 total tasks
2025-05-24 22:45:12,688 - routes - INFO - DEBUG: Processing task 47, type=receipt_processing, status=pending_review
2025-05-24 22:45:12,689 - routes - INFO - DEBUG: Task 47 extracted receipt data: vendor=Eventeny, total=$257.61
2025-05-24 22:45:12,690 - routes - INFO - Task 47 has event details: {'event_name': 'Great Blue Heron Music Festival 2025', 'event_date': '2025-07-03', 'venue_location': '2361 Waits Corners Rd, Sherman, NY 14781, United States'}
2025-05-24 22:45:12,690 - routes - INFO - DEBUG: Task 47 has AI analysis
2025-05-24 22:45:12,691 - routes - INFO - DEBUG: Added task 47 to receipt_tasks, now has 1 items
2025-05-24 22:45:12,692 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:45:12,693 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 1, ai_evaluations: 0
2025-05-24 22:45:12,694 - routes - INFO - AI Queue loaded: 2 tasks (2 pending review, 0 failed)
2025-05-24 22:45:15,882 - routes - INFO - Successfully processed receipt task: Invoice INV-20250524-56D476BC, 0 objects created
2025-05-24 22:45:15,893 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:45:15,893 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:45:15,894 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:45:15,895 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:45:34,881 - routes - INFO - DEBUG: Found 1 total tasks
2025-05-24 22:45:34,882 - routes - INFO - DEBUG: Processing task 5, type=test_task, status=pending_review
2025-05-24 22:45:34,883 - routes - INFO - DEBUG: Before render_template - receipt_tasks: 0, ai_evaluations: 0
2025-05-24 22:45:34,883 - routes - INFO - AI Queue loaded: 1 tasks (1 pending review, 0 failed)
2025-05-24 22:46:44,989 - app - INFO - Creating database tables...
2025-05-24 22:46:44,990 - app - INFO - Creating database tables...
2025-05-24 22:46:44,990 - app - INFO - Creating database tables...
2025-05-24 22:46:44,995 - app - INFO - Creating database tables...
2025-05-24 22:46:45,025 - app - INFO - Database tables created successfully
2025-05-24 22:46:45,025 - app - INFO - Database tables created successfully
2025-05-24 22:46:45,026 - app - INFO - Database tables created successfully
2025-05-24 22:46:45,026 - app - INFO - Database tables created successfully
2025-05-24 22:46:45,986 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:46:45,986 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:46:45,996 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:46:46,000 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:49:22,071 - app - INFO - Creating database tables...
2025-05-24 22:49:22,071 - app - INFO - Creating database tables...
2025-05-24 22:49:22,072 - app - INFO - Creating database tables...
2025-05-24 22:49:22,074 - app - INFO - Creating database tables...
2025-05-24 22:49:22,107 - app - INFO - Database tables created successfully
2025-05-24 22:49:22,107 - app - INFO - Database tables created successfully
2025-05-24 22:49:22,108 - app - INFO - Database tables created successfully
2025-05-24 22:49:22,108 - app - INFO - Database tables created successfully
2025-05-24 22:49:23,119 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:49:23,119 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:49:23,119 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:49:23,122 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:57:53,614 - app - INFO - Creating database tables...
2025-05-24 22:57:53,618 - app - INFO - Creating database tables...
2025-05-24 22:57:53,618 - app - INFO - Creating database tables...
2025-05-24 22:57:53,650 - app - INFO - Database tables created successfully
2025-05-24 22:57:53,650 - app - INFO - Database tables created successfully
2025-05-24 22:57:53,651 - app - INFO - Database tables created successfully
2025-05-24 22:57:53,712 - app - INFO - Creating database tables...
2025-05-24 22:57:53,730 - app - INFO - Database tables created successfully
2025-05-24 22:57:54,620 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:57:54,620 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:57:54,620 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:57:54,621 - routes - INFO - AI Settings initialized successfully
2025-05-24 22:58:58,014 - routes - INFO - Auto-classified 'Weekend Pass Thursday Entry' as consumable event ticket
2025-05-24 22:58:58,034 - routes - INFO - Created consumable object 'Weekend Pass Thursday Entry' from receipt INV-20250524-56D476BC
2025-05-24 23:10:19,586 - app - INFO - Creating database tables...
2025-05-24 23:10:19,590 - app - INFO - Creating database tables...
2025-05-24 23:10:19,592 - app - INFO - Creating database tables...
2025-05-24 23:10:19,604 - app - INFO - Creating database tables...
2025-05-24 23:10:19,623 - app - INFO - Database tables created successfully
2025-05-24 23:10:19,623 - app - INFO - Database tables created successfully
2025-05-24 23:10:19,623 - app - INFO - Database tables created successfully
2025-05-24 23:10:19,624 - app - INFO - Database tables created successfully
2025-05-24 23:10:26,026 - app - INFO - Creating database tables...
2025-05-24 23:10:26,047 - app - INFO - Database tables created successfully
2025-05-24 23:10:26,097 - app - INFO - Creating database tables...
2025-05-24 23:10:26,118 - app - INFO - Database tables created successfully
2025-05-24 23:10:26,188 - app - INFO - Creating database tables...
2025-05-24 23:10:26,194 - app - INFO - Creating database tables...
2025-05-24 23:10:26,208 - app - INFO - Database tables created successfully
2025-05-24 23:10:26,212 - app - INFO - Database tables created successfully
2025-05-24 23:10:29,776 - app - INFO - Creating database tables...
2025-05-24 23:10:29,794 - app - INFO - Database tables created successfully
2025-05-24 23:10:29,900 - app - INFO - Creating database tables...
2025-05-24 23:10:29,918 - app - INFO - Database tables created successfully
2025-05-24 23:10:29,942 - app - INFO - Creating database tables...
2025-05-24 23:10:29,963 - app - INFO - Database tables created successfully
2025-05-24 23:10:36,169 - app - INFO - Creating database tables...
2025-05-24 23:10:36,186 - app - INFO - Database tables created successfully
2025-05-24 23:10:36,278 - app - INFO - Creating database tables...
2025-05-24 23:10:36,295 - app - INFO - Database tables created successfully
2025-05-24 23:10:42,961 - app - INFO - Creating database tables...
2025-05-24 23:10:42,978 - app - INFO - Database tables created successfully
2025-05-24 23:10:43,036 - app - INFO - Creating database tables...
2025-05-24 23:10:43,055 - app - INFO - Creating database tables...
2025-05-24 23:10:43,055 - app - INFO - Database tables created successfully
2025-05-24 23:10:43,073 - app - INFO - Database tables created successfully
2025-05-24 23:10:43,092 - app - INFO - Creating database tables...
2025-05-24 23:10:43,115 - app - INFO - Database tables created successfully
2025-05-24 23:10:50,508 - app - INFO - Creating database tables...
2025-05-24 23:10:50,526 - app - INFO - Creating database tables...
2025-05-24 23:10:50,526 - app - INFO - Database tables created successfully
2025-05-24 23:10:50,545 - app - INFO - Database tables created successfully
2025-05-24 23:10:50,634 - app - INFO - Creating database tables...
2025-05-24 23:10:50,652 - app - INFO - Database tables created successfully
2025-05-24 23:10:56,873 - app - INFO - Creating database tables...
2025-05-24 23:10:56,882 - app - INFO - Creating database tables...
2025-05-24 23:10:56,898 - app - INFO - Database tables created successfully
2025-05-24 23:10:56,905 - app - INFO - Database tables created successfully
2025-05-24 23:10:57,019 - app - INFO - Creating database tables...
2025-05-24 23:10:57,039 - app - INFO - Database tables created successfully
2025-05-24 23:10:57,147 - app - INFO - Creating database tables...
2025-05-24 23:11:09,262 - app - INFO - Creating database tables...
2025-05-24 23:11:09,279 - app - INFO - Database tables created successfully
2025-05-24 23:11:09,329 - app - INFO - Creating database tables...
2025-05-24 23:11:09,348 - app - INFO - Database tables created successfully
2025-05-24 23:11:09,422 - app - INFO - Creating database tables...
2025-05-24 23:11:09,443 - app - INFO - Database tables created successfully
2025-05-24 23:11:25,391 - app - INFO - Creating database tables...
2025-05-24 23:11:25,410 - app - INFO - Database tables created successfully
2025-05-24 23:11:25,476 - app - INFO - Creating database tables...
2025-05-24 23:11:25,496 - app - INFO - Database tables created successfully
2025-05-24 23:11:25,552 - app - INFO - Creating database tables...
2025-05-24 23:11:25,571 - app - INFO - Database tables created successfully
2025-05-24 23:11:54,279 - app - INFO - Creating database tables...
2025-05-24 23:11:54,299 - app - INFO - Database tables created successfully
2025-05-24 23:11:54,396 - app - INFO - Creating database tables...
2025-05-24 23:11:54,414 - app - INFO - Database tables created successfully
2025-05-24 23:11:54,508 - app - INFO - Creating database tables...
2025-05-24 23:12:46,092 - app - INFO - Creating database tables...
2025-05-24 23:12:46,109 - app - INFO - Database tables created successfully
2025-05-24 23:12:46,112 - app - INFO - Creating database tables...
2025-05-24 23:12:46,132 - app - INFO - Database tables created successfully
2025-05-24 23:12:46,231 - app - INFO - Creating database tables...
2025-05-24 23:12:46,249 - app - INFO - Database tables created successfully
2025-05-24 23:12:46,260 - app - INFO - Creating database tables...
2025-05-24 23:12:46,286 - app - INFO - Database tables created successfully
2025-05-24 23:13:46,990 - app - INFO - Creating database tables...
2025-05-24 23:13:46,990 - app - INFO - Creating database tables...
2025-05-24 23:13:46,990 - app - INFO - Creating database tables...
2025-05-24 23:13:46,997 - app - INFO - Creating database tables...
2025-05-24 23:13:47,023 - app - INFO - Database tables created successfully
2025-05-24 23:13:47,023 - app - INFO - Database tables created successfully
2025-05-24 23:13:47,023 - app - INFO - Database tables created successfully
2025-05-24 23:13:47,023 - app - INFO - Database tables created successfully
2025-05-24 23:14:47,824 - app - INFO - Creating database tables...
2025-05-24 23:14:47,826 - app - INFO - Creating database tables...
2025-05-24 23:14:47,827 - app - INFO - Creating database tables...
2025-05-24 23:14:47,829 - app - INFO - Creating database tables...
2025-05-24 23:14:47,857 - app - INFO - Database tables created successfully
2025-05-24 23:14:47,857 - app - INFO - Database tables created successfully
2025-05-24 23:14:47,857 - app - INFO - Database tables created successfully
2025-05-24 23:14:47,858 - app - INFO - Database tables created successfully
2025-05-24 23:15:48,350 - app - INFO - Creating database tables...
2025-05-24 23:15:48,368 - app - INFO - Database tables created successfully
2025-05-24 23:15:48,434 - app - INFO - Creating database tables...
2025-05-24 23:15:48,448 - app - INFO - Creating database tables...
2025-05-24 23:15:48,452 - app - INFO - Database tables created successfully
2025-05-24 23:15:48,467 - app - INFO - Database tables created successfully
2025-05-24 23:15:48,536 - app - INFO - Creating database tables...
2025-05-24 23:15:48,557 - app - INFO - Database tables created successfully
2025-05-24 23:16:48,017 - app - INFO - Creating database tables...
2025-05-24 23:16:48,035 - app - INFO - Database tables created successfully
2025-05-24 23:16:48,078 - app - INFO - Creating database tables...
2025-05-24 23:16:48,084 - app - INFO - Creating database tables...
2025-05-24 23:16:48,096 - app - INFO - Database tables created successfully
2025-05-24 23:16:48,101 - app - INFO - Database tables created successfully
2025-05-24 23:16:48,124 - app - INFO - Creating database tables...
2025-05-24 23:16:48,145 - app - INFO - Database tables created successfully
2025-05-24 23:17:46,633 - app - INFO - Creating database tables...
2025-05-24 23:17:46,633 - app - INFO - Creating database tables...
2025-05-24 23:17:46,652 - app - INFO - Database tables created successfully
2025-05-24 23:17:46,652 - app - INFO - Database tables created successfully
2025-05-24 23:17:46,703 - app - INFO - Creating database tables...
2025-05-24 23:17:46,725 - app - INFO - Database tables created successfully
2025-05-24 23:17:46,726 - app - INFO - Creating database tables...
2025-05-24 23:17:46,750 - app - INFO - Database tables created successfully
2025-05-24 23:18:47,159 - app - INFO - Creating database tables...
2025-05-24 23:18:47,179 - app - INFO - Database tables created successfully
2025-05-24 23:18:47,210 - app - INFO - Creating database tables...
2025-05-24 23:18:47,233 - app - INFO - Database tables created successfully
2025-05-24 23:18:47,302 - app - INFO - Creating database tables...
2025-05-24 23:18:47,319 - app - INFO - Database tables created successfully
2025-05-24 23:19:47,739 - app - INFO - Creating database tables...
2025-05-24 23:19:47,740 - app - INFO - Creating database tables...
2025-05-24 23:19:47,758 - app - INFO - Database tables created successfully
2025-05-24 23:19:47,758 - app - INFO - Database tables created successfully
2025-05-24 23:19:47,773 - app - INFO - Creating database tables...
2025-05-24 23:19:47,797 - app - INFO - Database tables created successfully
2025-05-24 23:19:47,867 - app - INFO - Creating database tables...
2025-05-24 23:19:47,886 - app - INFO - Database tables created successfully
2025-05-24 23:20:48,590 - app - INFO - Creating database tables...
2025-05-24 23:20:48,595 - app - INFO - Creating database tables...
2025-05-24 23:20:48,617 - app - INFO - Creating database tables...
2025-05-24 23:20:48,623 - app - INFO - Database tables created successfully
2025-05-24 23:20:48,623 - app - INFO - Database tables created successfully
2025-05-24 23:20:48,636 - app - INFO - Database tables created successfully
2025-05-24 23:20:48,689 - app - INFO - Creating database tables...
2025-05-24 23:20:48,708 - app - INFO - Database tables created successfully
2025-05-24 23:20:49,602 - routes - INFO - AI Settings initialized successfully
2025-05-24 23:20:49,602 - routes - INFO - AI Settings initialized successfully
2025-05-24 23:20:49,602 - routes - INFO - AI Settings initialized successfully
2025-05-24 23:20:49,608 - routes - INFO - AI Settings initialized successfully
2025-05-25 12:05:26,431 - app - INFO - Creating database tables...
2025-05-25 12:05:26,432 - app - INFO - Creating database tables...
2025-05-25 12:05:26,433 - app - INFO - Creating database tables...
2025-05-25 12:05:26,436 - app - INFO - Creating database tables...
2025-05-25 12:05:26,472 - app - INFO - Database tables created successfully
2025-05-25 12:05:26,472 - app - INFO - Database tables created successfully
2025-05-25 12:05:26,472 - app - INFO - Database tables created successfully
2025-05-25 12:05:26,472 - app - INFO - Database tables created successfully
2025-05-25 12:05:27,629 - routes - INFO - AI Settings initialized successfully
2025-05-25 12:05:27,629 - routes - INFO - AI Settings initialized successfully
2025-05-25 12:05:27,629 - routes - INFO - AI Settings initialized successfully
2025-05-25 12:05:27,629 - routes - INFO - AI Settings initialized successfully
2025-05-25 12:05:45,579 - routes - INFO - Deleted service object: Weekend Pass Thursday Entry (ID: 1)
